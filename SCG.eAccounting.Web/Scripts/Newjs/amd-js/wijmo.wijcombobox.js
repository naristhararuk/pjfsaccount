var wijmo;define(["./wijmo.widget","./wijmo.wijutil","./wijmo.wijlist"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijcombobox",s=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype._create=function(){var e=this,t;e.selectedItem=null,e.selectedItems=[],window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r));try{t=document.activeElement}catch(i){}e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.repaint(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijcombobox"),e._initInnerData(),e._createDOMElements(),e._bindInputEvents(),e._initDropDownList(),e.repaint(),e._checkSelectIndex(),e.options.text=e._input.val(),e._usingRemoteData()&&e.options.data&&(e.originalDataSourceLoaded=e.options.data.loaded),t===e._input[0]&&e.options.isEditable&&r(function(){e._input.focus()}),n.prototype._create.call(this)},i.prototype._initInnerData=function(){var e=this,t=e.options,n;t.dataSource!==null?(n=e._isBind(),n?e.innerData=e._getMappingItems():e.innerData=t.data):e.innerData=t.data,e.listHasCreated=!1},i.prototype._checkSelectIndex=function(){var e=this,t,n=e.options,i=e.innerData;n.selectedIndex===-1&&n.selectedValue!=null&&r.each(i,function(e,t){if(i[e].value===n.selectedValue)return n.selectedIndex=e,n.selectionMode==="multiple"&&(n.selectedIndex=[n.selectedIndex]),!1}),t=n.selectedIndex,!e._usingRemoteData()&&(t>=0||r.isArray(t))&&e.search(null,"checkindex"),n.selectedIndex===-1&&n.text&&(!n.forceSelectionText||n.forceSelectionText&&e._checkTextInItems(n.text)!==-1)&&(e._input.val(n.text),n.selectedIndex=e._checkTextInItems(n.text),n.selectionMode==="multiple"&&(n.selectedIndex=[n.selectedIndex]),n.selectedIndex>-1&&e._checkSelectIndex())},i.prototype.repaint=function(){var e=this.options,t=this;return t.element.is(":visible")||t._comboDiv||t._select!==undefined&&t._input.is(":visible")?(t._showTrigger(),t._handleAdjustWidthOptions(),t._isDisabled()&&t._innerDisable(),!0):!1},i.prototype._bindInputEvents=function(){var e=this,n=this.options.wijCSS,i,s,o,u=e._input,a=e.options;u.bind("keydown.wijcombobox",function(n){if(e._isDisabled())return;i=n.keyCode,s=t.getKeyCodeEnum();switch(i){case s.UP:e._move("previous",n),n.preventDefault();break;case s.DOWN:e._move("next",n),n.preventDefault();break;case s.ENTER:e.menu.active&&(n.preventDefault(),a.selectionMode==="multiple"&&e.menu&&e.menu.items&&e.menu.items.length===1&&r.each(e.selectedItems,function(t,n){n!==e.menu.items[0]&&(n.selected=!1)}),e.menu.select(n)),n.preventDefault();break;case s.TAB:u.trigger("wijcomboblur");if(!e.menu.active||a.selectionMode==="multiple"&&s.TAB===i)return;e.menu.select(n);var f=u.val().length;e._selectText(f,f,u);break;case s.ESCAPE:e.close(n,undefined);break;case s.LEFT:case s.RIGHT:case s.SHIFT:case 16:case 17:case s.CTRL:case s.HOME:case s.END:case s.PAGE_UP:case s.PAGE_DOWN:break;case s.DELETE:o||(o=u.val());break;case 18:u.trigger("wijcomboblur");break;default:if(i===229||r.browser.mozilla&&n.key==="Unidentified"&&i===0)return;e._processingSearch(u,i,n)}}).bind("keyup.wijcombobox",function(n){if(e._isDisabled())return;i=n.keyCode,s=t.getKeyCodeEnum();switch(i){case s.DELETE:o!==u.val()&&e._processingSearch(u,i,n),o=undefined}}).bind("wijcomboblur.wijcombobox",function(t){window.clearTimeout(e.searching),e._addInputFocus(!1,n.stateFocus),e.closing=window.setTimeout(function(){e.close(t,!0)},150)}).bind("focus.wijcombobox",function(){e._addInputFocus(!0,n.stateFocus)}).bind("blur.wijcombobox",function(){e.menu.element.is(":visible")||u.trigger("wijcomboblur"),e._inputBlurCausedByListItemClick||e._change()}).bind("compositionend.wijcombobox",function(t){e._processingSearch(u,i,t)}),r.browser.msie&&parseInt(r.browser.version)>9&&u.bind("mouseup.wijcombobox",function(t){if(u.val()==="")return;setTimeout(function(){u.val()===""&&e.menu.deactivate()},5)})},i.prototype._processingSearch=function(e,t,n){var r=this,i=r.options;window.clearTimeout(r.searching),i.isEditable===!1&&(r._cacheKey===undefined&&(r._cacheKey=""),r._cacheKey+=String.fromCharCode(t)),r.searching=window.setTimeout(function(){var t;i.isEditable===!1?(t=r._cacheKey,r._cacheKey=undefined):t=e.val(),r.search(t,n)},i.delay)},i.prototype._addInputFocus=function(e,t){var n=this,r,i,s;r=n._input.parent(),i=e?"addClass":"removeClass",s=n._triggerArrow,r[i](t),s!==undefined&&s[i](t)},i.prototype._renderColumnsHeader=function(e){var t=this,n=r("<ul class='wijmo-wijcombobox-rowheader'></ul>");r.each(this.options.columns,function(e,i){var s=r("<li class='wijmo-wijcombobox-cell "+t.options.wijCSS.header+"'></li>");s.html(i.name),i.width!==undefined&&s.width(i.width),s.appendTo(n)}),e.append(n)},i.prototype._hasSameValueText=function(e,t){return e.label===t.label&&e.value===t.value},i.prototype._initDropDownList=function(){var e=this,t,n,i=e.options,s,o,u=this.options.wijCSS,a=parseInt(e._input.css("zIndex"),10),f;t=e.element[0].ownerDocument,isNaN(a)&&(a=0),e._comboDiv?n=e._oriList:n=r("<div class='"+u.comboboxListCss+"'></div>"),i.columns.length>0&&(n.addClass("wijmo-wijcombobox-multicolumn"),s=r("<div class='wijmo-wijsuperpanel-header "+u.stateDefault+"'></div>"),e._renderColumnsHeader(s),n.append(s)),o={keepHightlightOnMouseLeave:!0,selectionMode:i.selectionMode,addHoverItemClass:i.columns.length===0,focus:function(t,n){var r=n;i.selectOnItemFocus&&e.menu.select(null,{notCloseAfterSelected:!0}),i.columns.length>0&&r.element&&(r.element.prev().addClass("wijmo-wijcombobox-active-prev"),r.element.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").addClass(u.stateHover))},selected:function(t,n){window.clearTimeout(e.closing);var s=i.selectionMode,o,u,a=!1,f,l,c;o=n.item,u=r.inArray(o,e.items);if(u<0)return;if(e._trigger("select",t,o))if(s==="single"){if(!e._usingRemoteData())if(u!==i.selectedIndex){l=i.selectedIndex,c=e.selectedItem,a=e._triggerSelectedIndexChanging(c,o,l,u);if(a)return;e._setInputText(o.label),c&&(c.selected=!1),e.selectedItem=o,i.selectedIndex=u,i.selectedValue=e.selectedItem.value,i.inputTextInDropDownList=!0,c&&c.element&&c.element.removeClass("wijmo-wijcombobox-selecteditem"),e._triggerChangeEvents(c,l)}else e.selectedItem&&e._input.val()!==e.selectedItem.label&&(n.data===undefined||!n.data.notCloseAfterSelected)&&e._input.val(o.label);else if(e.selectedItem===null||!e._hasSameValueText(o,e.selectedItem)){c=e.selectedItem,l=i.selectedIndex,a=e._triggerSelectedIndexChanging(c,o,l,n.selectedIndex);if(a)return;e._setInputText(o.label),e.selectedItem=o,u!==i.selectedIndex&&(i.selectedIndex=u,i.selectedValue=e.selectedItem.value),i.inputTextInDropDownList=!0,e._triggerChangeEvents(c,l)}}else if(!e._usingRemoteData()){a=e._triggerSelectedIndexChanging(null,o,l,n.selectedIndex);if(a)return;e.selectedItems=n.selectedItems,e._selectedItemsToInputVal(e.selectedItems),i.inputTextInDropDownList=!0,i.selectedIndex=n.selectedIndex,e._triggerChangeEvents(null,null)}(n.data===undefined||!n.data.notCloseAfterSelected)&&s==="single"&&(e.close(t),e._input.focus()),e._inputBlurCausedByListItemClick=!1},blur:function(e,t){var n=t.element;i.columns.length>0&&n&&(n.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").removeClass(u.stateHover),n.prev().removeClass("wijmo-wijcombobox-active-prev"))},mouseDown:function(t){e._inputBlurCausedByListItemClick=!0},itemRendering:function(e,t){var n=t,r="";n.isSeparator&&(r+=" wijmo-wijcombobox-separator"),n.selected&&(r+=" wijmo-wijcombobox-selecteditem"),r.length>0&&n.element.addClass(r)},itemRendered:function(e,t){var n=t,s,o;if(n.cells===undefined)return;s=n.element,s.empty(),o=r("<ul class='wijmo-wijcombobox-row'></ul>"),r.each(n.cells,function(e,t){var n=r("<li class='wijmo-wijcombobox-cell "+u.stateDefault+"'></li>");i.columns&&i.columns.length>e&&typeof i.columns[e].width!="undefined"&&n.width(i.columns[e].width),n.append(r.trim(t)||"&nbsp;"),n.attr("title",t),o.append(n)}),s.append(o)},listRendered:function(t,n){var s=e.menu.selectedItem,o=e.menu.selectedItems,u,a;if(i.selectionMode==="single"&&s){u=r.inArray(s,e.items);if(u<0)return;e.selectedItem=e.items[u],e._setInputText(e.selectedItem.label,!0),u>=-1&&(i.selectedIndex=u)}else o&&o.length>0&&(u=[],a=[],r.each(o,function(t,n){var i=r.inArray(n,e.items);if(i<0)return!0;u.push(i),a.push(e.items[i])}),e._selectedItemsToInputVal(a),u.length>=0&&(i.selectedIndex=u))},superPanelOptions:{resized:function(t){var n=e.menu,r=n.element;i.dropdownWidth=r.outerWidth(),i.dropdownHeight=r.outerHeight(),e._positionList(),e.menu.refreshSuperPanel()}}},o=r.extend(!0,o,i.listOptions),f=i.ensureDropDownOnBody?r("body"):e._comboElement,e.menu=n.appendTo(f,t).wijlist(o).css({zIndex:a+1,top:0,left:0}).hide().data("wijmo-wijlist"),e._createDropDownList(),e._menuUL=e.menu.ul},i.prototype._setInputText=function(e,t){var n=this,r=n.options.text;n._input.val(e),n.options.text=e,r!==e&&!t&&n._trigger("textChanged",null,{oldText:r,newText:e})},i.prototype._triggerChangeEvents=function(e,t){var n=this.options,i=n.selectionMode,s=this.selectedItem,o=this.options.selectedIndex,u;this._triggerSelectElementChange(),u={oldItem:e,selectedItem:this.selectedItem,newIndex:o,oldIndex:t},i==="multiple"&&(u=r.extend(u,{selectedItems:this.selectedItems})),this._trigger("changed",null,u),o!=t&&this._triggerSelectedIndexChanged(e,s,t,o)},i.prototype._triggerSelectElementChange=function(){var e=this.options;this._select!==undefined&&(r.isArray(e.selectedIndex)&&e.selectedIndex.length>0?this._select[0].selectedIndex=e.selectedIndex[0]:this._select[0].selectedIndex=e.selectedIndex,this._select.trigger("change"))},i.prototype._triggerSelectedIndexChanged=function(e,t,n,i){var s=this.options,o;s.selectionMode==="single"?this._trigger("selectedIndexChanged",null,{oldItem:e,selectedItem:t,newIndex:i,oldIndex:n}):(o=r.inArray(t,this.items),this._trigger("selectedIndexChanged",null,{selectedItem:t,selectedIndex:o,selectedItems:this.selectedItems}))},i.prototype._triggerSelectedIndexChanging=function(e,t,n,i){var s=this.options,o,u,a=!0;return s.selectionMode==="single"?(u={oldItem:e,selectedItem:t,newIndex:i,oldIndex:n},a=this._trigger("selectedIndexChanging",null,u)):(o=r.inArray(t,this.items),u={selectedItem:t,selectedIndex:o,selectedItems:this.selectedItems},a=this._trigger("selectedIndexChanging",null,u)),a||(t.selected=!1,t.element&&t.element.removeClass("wijmo-wijcombobox-selecteditem")),!a},i.prototype._createDropDownList=function(e){var t=this,n,i=t.options,s=e;s||(s=t.innerData),s===null?n=null:n=r.isArray(s)?s:s.items,t._comboDiv?!t.listHasCreated&&n&&n.length>0&&(t.menu.setTemplateItems(i.data),r.isArray(t.innerData)?t.innerData=t.menu.items:t.innerData.items=t.menu.items,t.items=t.menu.items,t.menu.renderList(),t.listHasCreated=!0):!t.listHasCreated&&n&&n.length>0&&(t.menu.setItems(n),r.isArray(t.innerData)?t.innerData=t.menu.items:t.innerData.items=t.menu.items,t.items=t.menu.items,t.menu.renderList(),t.listHasCreated=!0),t._handleAdjustWidthOptions()},i.prototype._getSelectedItemsText=function(e){var t="",n=this,i=n.options.multipleSelectionSeparator;return n.selectedItems=e,r.each(e,function(e,n){n&&(t+=n.label+i)}),t.length>0&&(t=t.substr(0,t.lastIndexOf(i))),t},i.prototype._selectedItemsToInputVal=function(e){var t=this;t._setInputText(t._getSelectedItemsText(e))},i.prototype._createDOMElements=function(){var e=this,t,n=this.options.wijCSS,i,s,o;o=r("<div class='"+n.comboboxWrapperCss+" "+n.stateDefault+" "+n.cornerAll+"'></div>"),i=e.element,i.is("select")?(t=r("<div role='combobox' class='"+n.comboboxCss+" "+n.widget+" "+n.helperClearFix+"'></div>"),t.append(o),e._comboElement=t,e._select=i,i.addClass(n.widget),s=e._input=r("<input role='textbox' aria-autocomplete='list' aria-haspopup='true' />").insertAfter(i),e.options.data||(e.options.data=e._convertSelectOptions(),e._initInnerData())):i.is("div")&&r(i.children()[0]).is("input[type='text']")&&r(i.children()[1]).is("div")?(e._comboElement=e._comboDiv=t=i,e._oriList=r(i.children()[1]),s=e._input=r(i.children()[0]),o.prependTo(t).append(s),i.addClass(n.comboboxCss+" "+n.widget+" "+n.helperClearFix),i.attr("role","combobox")):(t=r("<div role='combobox' class='"+n.comboboxCss+" "+n.widget+" "+n.helperClearFix+"'></div>"),t.append(o),e._comboElement=t,s=e._input=i),e._comboDiv||(t.insertBefore(s),e.element.is(":visible")&&s.width(s.width()),t.children("."+n.comboboxWrapperCss).append(s)),i.attr("title")&&e._comboElement.attr("title",i.attr("title")),s.attr({autocomplete:"off",role:"textbox","aria-wijcombobox":"list","aria-haspopup":"true"}).addClass(n.comoboboxInputCss),e._oldWidth=i.css("width"),e.options.isEditable===!1&&(s.attr("readonly","readonly"),o.bind("click",function(){if(e._isDisabled())return;e._triggerClick()})),e._isDisabled()&&(e._comboElement.addClass("wijmo-wijcombobox-disabled "+n.stateDisabled),s.attr("disabled","disabled")),t.bind("mouseenter.wijcombobox",function(){if(e._isDisabled())return;e._addInputFocus(!0,n.stateHover)}).bind("mouseleave.wijcombobox",function(){e._addInputFocus(!1,n.stateHover)})},i.prototype._convertSelectOptions=function(){var e=[],t=this,n;return n=t._select.get(0).options,r.each(n,function(t,n){e.push({label:n.text,value:n.value})}),t.options.selectedIndex===-1&&t.options.selectedValue===null&&t.options.text===null&&(t.options.selectedIndex=t._select[0].selectedIndex),e},i.prototype.getComboElement=function(){return this._comboElement},i.prototype._updateLabelTextElement=function(){var e=this,t=e.options,n=t.wijCSS,i="<label class='wijmo-wijcombobox-label "+n.content+"'></label>",s=e._input.parent().children(".wijmo-wijcombobox-label");t.labelText!==null?(s.length===0&&(s=r(i),e._input.parent().append(s)),e._label=s,s.html(t.labelText)):s&&(s.remove(),e._label=undefined)},i.prototype._showTrigger=function(){var e=this,t=e.options,n=e._input,i=n.parent(),s=e._comboElement,o=this.options.wijCSS,u,a=0,f=e._triggerArrow,l=e._label,c,h,p,d,v,m="<div class='"+o.comboboxTriggerCss+" "+o.stateDefault+" "+o.cornerRight+"'>"+"<span class='"+o.icon+" "+o.iconArrowDown+"'></span>"+"</div>";e._select!==undefined&&(e._select.is(":visible")?(r.browser.msie?(u=e._select.clone(),e._select.after(u),a=u.width(),u.remove()):a=e._select.width(),e._nativeWidth=a):a=e._nativeWidth,s.css("width",""),n.width(a+(t.dropdownHeight<e.menu.element.height()?t.selectElementWidthFix:0)),e._select.hide()),n.css("margin-left",""),n.css("margin-right",""),s.width(i[0].offsetWidth),e._updateLabelTextElement(),l=e._label,t.showTrigger?(n.removeClass(o.cornerAll),f===undefined&&(f=e._triggerArrow=r(m),s.append(f),f.bind("mouseover.triggerevent",e,function(t){if(e._isDisabled())return;var n=r(t.currentTarget);n.addClass(o.stateHover)}).bind("mousedown.triggerevent",e,function(t){if(e._isDisabled())return;var n=r(t.currentTarget);n.addClass(o.stateActive)}).bind("mouseup.triggerevent",e,function(e){var t=r(e.currentTarget);t.removeClass(o.stateActive)}).bind("click.triggerevent",e,function(){if(e._isDisabled())return;e._triggerClick()})),t.triggerPosition==="right"?(f.css({left:"",right:"0px"}),f.removeClass(o.cornerLeft),f.addClass(o.cornerRight)):(f.css({right:"",left:"0px"}),f.removeClass(o.cornerRight),f.addClass(o.cornerLeft)),f.setOutHeight(s.innerHeight()),c=f.find("span"),c.css("margin-left",(f.innerWidth()-c[0].offsetWidth)/2),c.css("margin-top",(f.innerHeight()-c[0].offsetHeight)/2)):(f!==undefined&&(f.unbind(".triggerevent"),f.remove(),f=undefined,e._triggerArrow=undefined),n.removeClass(o.cornerLeft),n.removeClass(o.cornerRight),n.addClass(o.cornerAll)),h=p=d=0,l!==undefined&&(p+=l.outerWidth(!0)),v=t.triggerPosition==="left"?i.leftBorderWidth():i.rightBorderWidth(),f!==undefined&&(d=f.outerWidth(!0)-v),h=p+d,n.setOutWidth(i.width()-h),h=h===0?"":h,t.triggerPosition==="right"?(n.css("margin-left",""),n.css("margin-right",h),l!==undefined&&(l.css("left",""),l.css("right",d))):(n.css("margin-right",""),n.css("margin-left",h),l!==undefined&&(l.css("right",""),l.css("left",d)))},i.prototype._triggerClick=function(){var e=this,t="";window.clearTimeout(e.closing),e.menu.element.is(":visible")?e.close():(e._usingRemoteData()&&(t=e._input.val()),e.search(t,undefined,!1))},i.prototype.destroy=function(){var e=this,t=this.options.wijCSS,i=e.element;e.options.isEditable===!1&&i.removeAttr("readonly"),e._input&&e._input.unbind(".wijcombobox"),e._comboElement&&e._comboElement.unbind(".wijcombobox"),e._triggerArrow&&e._triggerArrow.unbind(".triggerevent"),e._select!==undefined?(e._select.removeClass(t.widget),e._select.show(),e._input.remove()):e._comboDiv?(e._comboDiv.removeClass(t.comboboxCss+" "+t.widget+" "+t.helperClearFix),e._comboDiv.removeAttr("role"),e._input.insertBefore(e._comboDiv),e._comboDiv.children("."+t.comboboxWrapperCss).remove()):(i.css("width",e._oldWidth),i.removeClass(t.comoboboxInputCss),i.removeAttr("autocomplete").removeAttr("role").removeAttr("aria-wijcombobox").removeAttr("aria-haspopup"),i.insertBefore(e._comboElement),i.css("padding","")),e.options.ensureDropDownOnBody&&r(window).unbind("resize.wijcombobox"),e._comboElement.remove(),e.menu.destroy(),e.menu.element.remove(),n.prototype.destroy.call(this)},i.prototype._setOption=function(e,t){var i=this,s=i.options,o=i._comboElement,u=i.element,a,f=u.parent(),l,c=this.options.wijCSS,h=i._label,p,d=s.selectedIndex,v,m=s.disabled,g=null,y=0;i._triggerArrow&&(y=i._triggerArrow.outerWidth()),n.prototype._setOption.call(this,e,t);if(e==="labelText")i._updateLabelTextElement(),h=i._label,h&&h.length>0&&(i._triggerArrow!==undefined&&(p=i._triggerArrow[0].offsetWidth),s.triggerPosition==="right"?h!==undefined&&(h.css("left",""),h.css("right",p)):h!==undefined&&(h.css("right",""),h.css("left",p)),i.repaint());else if(e==="showTrigger")i._showTrigger(),!s.showTrigger&&i.element.is("select")&&u.width(u.width()+y);else if(e==="triggerPosition")u.width(u.width()+y),i._showTrigger();else if(e==="selectionMode")i.menu._setOption("selectionMode",t);else if(e==="isEditable")t?(i._input.removeAttr("readonly"),r("."+c.comboboxWrapperCss,i._comboElement[0]).bind("click",function(){i._triggerClick()})):(i._input.attr("readonly","readonly"),r("."+c.comboboxWrapperCss,i._comboElement[0]).unbind("click"));else if(e==="data"||e==="dataSource"){i._initInnerData(),i._setSelectedIndex(s.selectedIndex);if(r.isArray(i.innerData))i.listHasCreated=!1,i._createDropDownList();else try{i.innerData.loaded=function(e,t){e===null?i.items=null:i.items=r.isArray(e)?e:e.items,i.listHasCreated=!1,i._createDropDownList()},i.innerData.load(null)}catch(b){}s.selectedIndex!==-1&&(g=a?a[d]:null,a=i.innerData,i._triggerChangeEvents(g,d)),i._keypress=!1}else if(e==="selectedIndex"){if(t===d)return;if(t===null||t===undefined)t=-1;i.innerData===null?a=null:a=r.isArray(i.innerData)?i.innerData:i.innerData.items;if(s.selectionMode==="single"){g=a?a[d]:null;if(t>-1){a&&a[t]!==null&&(v=a[t]),l=i._triggerSelectedIndexChanging(g,v,d,t);if(l){s.selectedIndex=d;return}d!==null&&d!==-1&&d!==undefined&&g&&(g.selected=!1,this.menu.unselectItems(d),g.element&&g.element.removeClass("wijmo-wijcombobox-selecteditem")),a&&a[t]!==null&&(i.selectedItem=a[t],i.selectedItem&&(i.selectedItem.selected=!0,i._setInputText(i.selectedItem.label),s.selectedValue=i.selectedItem.value,s.inputTextInDropDownList=!0))}else if(t<=-1||!t){l=i._triggerSelectedIndexChanging(g,null,d,t);if(l){s.selectedIndex=d;return}s.inputTextInDropDownList=!1,i._clearSelection()}i._triggerChangeEvents(g,d)}else r.isArray(d)||(d=[d]),r.each(d,function(e,t){i.menu.items&&i.menu.items[t]&&(i.menu.items[t].selected=!1)}),this.menu.unselectItems(d),i.selectedItems=[],i.selectedItem=null,r.isArray(t)||(t=[t],s[e]=t),i._setSelectedIndex(t),r.each(t,function(e,t){i.menu.items&&i.menu.items[t]&&(i.menu.items[t].selected=!0)}),i._triggerChangeEvents(null,null)}else if(e==="selectedValue")a=i.items,a||(a=i.innerData),s.selectionMode==="single"?g=a?a[d]:null:d=null,t!=null?(i.selectedItem&&i.selectedItem.selected!==undefined&&(i.selectedItem.selected=!1),a&&(this.options.selectedIndex>-1&&a.length>this.options.selectedIndex&&a[this.options.selectedIndex]&&(a[this.options.selectedIndex].selected=!1,this.menu.deactivate(),this.menu.unselectItems(this.options.selectedIndex),i.menu.items[this.options.selectedIndex].selected=!1),r.each(a,function(e,n){if(a[e].value===t)return i.selectedItem=a[e],i.selectedItem.selected=!0,i.menu.items[e].selected=!0,i._setInputText(i.selectedItem.label),s.selectionMode==="single"?s.selectedIndex=e:s.selectedIndex=[e],s.inputTextInDropDownList=!0,!1}))):s.selectionMode==="single"&&(s.inputTextInDropDownList=!1,i._clearSelection()),i._triggerChangeEvents(g,d);else if(e==="text"){if(s.forceSelectionText&&i._checkTextInItems(t)===-1)return;i._setInputText(t)}else e==="selectElementWidthFix"?i._showTrigger():(e==="adjustComboWidth"||e==="dropdownWidth")&&i._handleAdjustWidthOptions()},i.prototype._handleAdjustWidthOptions=function(){var e=this,t=e.options,n=0,r=25;return t.adjustComboWidth===!0?(t.dropdownWidth==="auto"||t.dropdownWidth==="fit"?n=e._getMaxListItemWidth()+r:n=t.dropdownWidth,e._setComboWidth(n),e._setDropdownWidth(n)):(t.dropdownWidth==="auto"?n=e._getComboWidth():t.dropdownWidth==="fit"?n=Math.max(e._getComboWidth(),e._getMaxListItemWidth()+r):n=t.dropdownWidth,e._setDropdownWidth(n)),n},i.prototype._innerDisable=function(){n.prototype._innerDisable.call(this),this._toggleDisableCombobox(!0)},i.prototype._innerEnable=function(){n.prototype._innerEnable.call(this),this._toggleDisableCombobox(!1)},i.prototype._toggleDisableCombobox=function(e){var t=this.options.wijCSS;this._input.prop("disabled",e),this._comboElement.toggleClass("wijmo-wijcombobox-disabled "+t.stateDisabled,e),this._comboDiv&&this._input.toggleClass("wijmo-wijcombobox-disabled "+t.stateDisabled,e),e&&this.close()},i.prototype._setSelectedIndex=function(e){var t=this,n=t.options,i=[],s=t.innerData;if(e===null||e===undefined)return;e===-1?(t.selectedItem=null,n.selectedIndex=-1,n.selectedValue=null,n.text?t._input.val(n.text):t._input.val("")):r.isArray(e)?(t.selectedItems=[],r.each(e,function(e,t){s&&s[t]!==null&&s[t]!==undefined&&(s[t].selected=!0,i.push(s[t]))}),t.selectedItems=i,t._selectedItemsToInputVal(i)):s&&s[e]!==null&&s[e]!==undefined?(s[e].selected=!0,t._input.val(s[e].label),t.selectedItem=s[e]):s&&r.isArray(s)&&e>s.length-1&&(n.selectedIndex=-1,t._input.val("")),n.text=t._input.val()},i.prototype.search=function(e,t,n){typeof n=="undefined"&&(n=!0);var i=this,s=i.options,o=i.innerData,u,a;window.clearTimeout(i.closing),u={value:e,e:t,self:i};if(o!==null||i._comboDiv){a=i._isBind();if(t!=="checkindex"){if(i._trigger("search",t,{datasrc:o,term:u})===!1)return;o=i.innerData}if(r.isArray(o)||a||i._comboDiv||!i._usingRemoteData()&&o.items&&r.isArray(o.items)&&o.items.length>0)i._hideShowArrow(!1),i._onListLoaded(o,u,n);else{if(!a&&r.isArray(s.dataSource))return;if(i._usingRemoteData()&&t!==undefined&&e.length<s.minLength)return;i._hideShowArrow(!1),o.loaded=function(e,t){i.listHasCreated=!1,i._createDropDownList(e),i._onListLoaded(e,t,n),i.originalDataSourceLoaded&&i.originalDataSourceLoaded(e,t)},o.load(u)}}},i.prototype.getSelectedItems=function(){var e=this.options;return e.selectionMode==="single"?this.selectedItem:this.selectedItems},i.prototype._isBind=function(){var e=this.options,t=e.data;return t!==null&&t.label&&t.label.bind?!0:!1},i.prototype._getMappingItems=function(){var e=this.options,t=e.dataSource,n=e.data,i,s,o;return!t||!n?null:!n.label||!n.label.bind||!n.value||!n.value.bind?null:(s=n.label.bind,o=n.value.bind,t&&t.length!==0?(i=[],r.each(t,function(e,t){i.push({label:t[s],value:t[o]})}),i):null)},i.prototype._clearSelection=function(e){var t=this,n=t.options;n.selectionMode==="single"?t.selectedItem&&(t.selectedItem.selected=!1,t.selectedItem=null):t.selectedItems&&(r.each(t.selectedItems,function(e,t){t&&t.selected&&(t.selected=!1)}),t.selectedItem=null,t.selectedItems=[]),n.selectedValue=null,t._setInputText("",e)},i.prototype._usingRemoteData=function(){var e=this.options.data,t=!1;return!r.isArray(e)&&e!==null&&e.proxy&&(t=!0),t},i.prototype._hideShowArrow=function(e){var t=this,n=t.element,r=t._triggerArrow;r!==undefined&&r[e?"show":"hide"](),n[e?"removeClass":"addClass"]("wijmo-wijcombobox-loading")},i.prototype._onListLoaded=function(e,t,n){var i=t.self,s=i._input,o=i.options,u=this.options.wijCSS,a=t.value,f,l,c,h,p;e?f=r.isArray(e)?e:e.items:f=null,i.items=f;if(t.e==="checkindex"){l=o.selectedIndex,o.selectionMode==="multiple"&&r.isArray(l)?(i.selectedItems=[],r.each(l,function(e,t){var n=f[t];n.selected=!0,i.selectedItems.push(n)}),i._selectedItemsToInputVal(i.selectedItems)):(f[l].selected=!0,i.selectedItem=f[l],s.val(i.selectedItem.label)),i._hideShowArrow(!0);return}n&&s.val()===""&&(h=this.selectedItem,h&&h.label!==""&&(p=o.selectedIndex,i._clearSelection(!0),i._setSelectedIndex(-1),i._triggerChangeEvents(h,p),i.menu.deactivate())),!i._usingRemoteData()&&f?c=f:(i._topHit=null,c=f),c&&c.length>0||i._comboDiv?i._openlist(c,t,a)&&i._addInputFocus(!0,u.stateFocus):i.close(null,!0),i._hideShowArrow(!0)},i.prototype.close=function(e,t){var n=this,i,s=this.options.wijCSS,o,u;i=n.menu,n._dropDownHeight=i.element.outerHeight(),n._dropDownWidth=i.element.outerWidth(),window.clearTimeout(n.closing),i.element.is(":visible")&&!i.element.is(":animated")&&!i.element.parent().is(":animated")&&(n._trigger("close",e),i.deactivate(),o=n.options.hidingAnimation,o&&(o.effect==="size"||o.animated==="size")&&(o.options=r.extend({to:{width:0,height:0}},o.options)),u=i.element.attr("style"),t!==!0&&o?i.element.hide(o.effect||o.animated,o.options,o.speed||o.duration,function(){i.element.removeAttr("style").attr("style",u).hide(),o.callback&&o.callback.apply(this,arguments)}):i.element.hide(),n._addInputFocus(!1,s.stateFocus),r(document).unbind("mouseup",n.closeOnClick),n._inputBlurCausedByListItemClick=!1)},i.prototype._change=function(){var e=this,t=e.options,n=t.forceSelectionText,i=t.selectionMode,s=e._input,o=s.val(),u=e.selectedItem,a=e.selectedItems,f,l=e.innerData,c=-1;f=t.selectedIndex||t.selectedIndex>-1?t.selectedIndex:-1;if(n)i==="single"&&(u!==null&&u!==undefined?u.label!==o&&e._setInputText(u.label):e._setInputText(""));else if(i==="single"){var h=!1;u!==null&&u!==undefined&&(h=u.label?u.label.toString()!==o:""!==o),!u&&o!==""||h?(e.selectedItem!==null&&e.selectedItem!==undefined&&(e.selectedItem.selected=!1,e.menu.unselectItems(t.selectedIndex)),c=e._checkTextInItems(o),c===-1?(e.selectedItem=null,t.selectedIndex=-1,t.selectedValue=null,t.inputTextInDropDownList=!1):l&&(l=r.isArray(l)?l:l.items,e.selectedItem=l[c],t.selectedIndex=c,t.selectedValue=e.selectedItem.value,t.inputTextInDropDownList=!0),e._setInputText(e._input.val()),e._triggerChangeEvents(u,f)):e._setInputText(o)}if(i==="multiple"){if(!e.selectedItems||e.selectedItems.length===0)a=[u];e._selectedItemsToInputVal(a)}},i.prototype._checkTextInItems=function(e){var t=this.items,n=-1;return e&&!!t&&!!t.length&&r.each(t,function(t,r){if(r&&r.label&&r.label.toString()===e)return n=t,!1}),n},i.prototype._openlist=function(e,n,i){var s=n.self,o=s.options,u=n.e,a,f,l,c=s.menu.element,h=2,p=0,d,v,m,g,y,b,w=r.trim(s._input.val()).length,E=t.getKeyCodeEnum(),S,x=!1,T,N,C=!1;a=s._keypress=!!u,f=u!==undefined&&(u.keyCode===E.BACKSPACE||u.keyCode===E.DELETE),C=c.is(":visible"),r.ui?c.zIndex(s.element.zIndex()+100):(S=parseInt(s.element.css("zIndex"),10),isNaN(S)&&(S=0),c.css("zIndex",S+100)),s.listHasCreated||s._createDropDownList(),s.innerData&&(r.isArray(s.innerData)?T=s.innerData:T=s.innerData.items);if(!T||T.length===0)return!1;if(!s._usingRemoteData()&&i!==null&&i!==undefined){x=s._keypress&&o.isEditable&&o.columns.length===0&&o.highlightMatching&&w>0,u&&u.keyCode===E.DOWN&&i.length===0&&w>0?s._topHit=s.menu.filterItems(s._input.val(),!1,x):s._topHit=s.menu.filterItems(i,o.autoFilter,x);if(s._topHit===null&&s.innerData&&r("li[wijhidden]",s.menu.element).length===s.innerData.length)return s.close(null,!0),!1}return c.show(),l=s._handleAdjustWidthOptions(),d=o.dropdownHeight,c.children(".wijmo-wijsuperpanel-header")&&(p=c.children(".wijmo-wijsuperpanel-header").outerHeight()||0),m=s._menuUL.outerHeight()+h+p,m<d?(s._menuUL.setOutWidth(l),m=s._menuUL.outerHeight()+h+p):m=d,c.setOutHeight(m),s.menu.refreshSuperPanel(),s._positionList(),!a&&s.selectedItem!==undefined&&s.menu.activate(null,s.selectedItem,!0),a&&!f?o.isEditable?s._runAutoComplete():s.menu.activate(null,s._topHit,!0):(g=s.options.showingAnimation,o.showingAnimation!==null&&!f&&(s.menu.element.hide(),b={from:{width:0,height:0},to:{width:s._dropDownWidth||c.outerWidth(),height:s._dropDownHeight||c.outerHeight()}},g&&(g.effect==="size"||g.animated==="size")&&(g.options=r.extend(b,g.options)),y=c.attr("style"),c.show(g.effect||g.animated,g.options,g.speed||g.duration,function(){c.removeAttr("style").attr("style",y).show(),g.callback&&g.callback.apply(this,arguments),r.browser.msie&&c.css("filter","")}))),s.hasOwnProperty("closeOnClick")||(v=s.closeOnClick,s.closeOnClick=function(e){return v(e)}),C||s._trigger("open"),r(document).bind("mouseup",s,s.closeOnClick),o.ensureDropDownOnBody&&r(window).bind("resize.wijcombobox",function(){N&&clearTimeout(N),N=setTimeout(function(){s._positionList()},100)}),!0},i.prototype.closeOnClick=function(e){var t=e.data,n=t.options.wijCSS,i,s=e.target;!r.contains(t._comboElement[0],s)&&!r.contains(t.menu.element[0],s)&&(r.support.isTouchEnabled&&r.support.isTouchEnabled()?(i=t.menu.element.offset(),(e.pageX<i.left||e.pageX>i.left+t.menu.element.width()||e.pageY<i.top||e.pageY>i.top+t.menu.element.height())&&t.close()):t.close(),r("."+n.comboboxWrapperCss,t._comboElement[0]).removeClass(n.stateHover).removeClass(n.stateFocus),r("."+n.comboboxTriggerCss,t._comboElement[0]).removeClass(n.stateHover).removeClass(n.stateFocus)),t.options.ensureDropDownOnBody&&r(window).unbind("resize.wijcombobox")},i.prototype._positionList=function(){var e=this,t,n=e.options.dropDownListPosition;t={my:"left top",at:"left bottom",of:e._comboElement,collision:"none"},t=r.extend(t,n),e.menu.element.position(t)},i.prototype._runAutoComplete=function(){var e=this,t=e._input,n=e._topHit,r,i,s,o;if(!e.options.autoComplete||n===null||n===undefined)return;e.menu.activate(null,n,!0),r=t.val(),i=n.label,t.val(i),s=r.length,o=i.length,e._selectText(s,o,t)},i.prototype._selectText=function(e,t,n){var r=n.val(),i=n.get(0),s;r.length>0&&(i.setSelectionRange!==undefined?i.setSelectionRange(e,t):i.createTextRange!==undefined&&(s=i.createTextRange(),s.moveStart("character",e),s.moveEnd("character",t-r.length),s.select()))},i.prototype._move=function(e,t){if(!this.menu.element.is(":visible")){this.search("",t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e))return;this.menu[e](t)},i.prototype._escapeRegex=function(e){return e===undefined?e:e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},i.prototype._filter=function(e,t){var n=this._escapeRegex(t),i,s=null;return e?(i=new RegExp(n,"i"),r.each(e,function(e,t){if(n===undefined||n.length===0){t.match=!0;return}var r=i.exec(t.label);r===null?t.match=!1:(s===null&&r.index===0&&(s=t),t.match=r.index>=0)}),this._topHit=s,e):null},i.prototype._getMaxListItemWidth=function(){var e=r("<div>").addClass("wijmo-wijcombobox-list ui-widget").appendTo(document.body),t=this.menu.element.find("ul").clone().css("width","").appendTo(e),n=t.outerWidth();return e.remove(),n},i.prototype._setComboWidth=function(e){this._comboElement.width(e),this._triggerArrow&&(e-=this._triggerArrow.outerWidth()),this._input.width(e)},i.prototype._setDropdownWidth=function(e){var t=this.menu.element,n=t.css("padding");t.css("padding","0px"),t.setOutWidth(e),t.css("padding",n)},i.prototype._getComboWidth=function(){return this._comboElement.outerWidth()},i.prototype._getDropdownWidth=function(){return this.menu.element.outerWidth()},i}(t.wijmoWidget);n.wijcombobox=s;var o=function(){function e(){this.initSelector=":jqmData(role='wijcombobox')",this.wijCSS={comboboxCss:"wijmo-wijcombobox",comboboxWrapperCss:"wijmo-wijcombobox-wrapper",comoboboxInputCss:"wijmo-wijcombobox-input",comboboxListCss:"wijmo-wijcombobox-list",comboboxTriggerCss:"wijmo-wijcombobox-trigger"},this.dataSource=null,this.data=null,this.labelText=null,this.minLength=4,this.delay=300,this.showingAnimation=null,this.hidingAnimation=null,this.showTrigger=!0,this.triggerPosition="right",this.dropdownHeight=300,this.dropdownWidth="auto",this.selectOnItemFocus=!1,this.autoFilter=!0,this.autoComplete=!0,this.highlightMatching=!0,this.dropDownListPosition={},this.columns=[],this.selectionMode="single",this.multipleSelectionSeparator=",",this.forceSelectionText=!1,this.select=null,this.isEditable=!0,this.selectedIndex=-1,this.selectedValue=null,this.inputTextInDropDownList=!1,this.text=null,this.ensureDropDownOnBody=!0,this.open=null,this.close=null,this.selectElementWidthFix=6,this.search=null,this.changed=null,this.textChanged=null,this.selectedIndexChanged=null,this.selectedIndexChanging=null,this.listOptions=null,this.adjustComboWidth=!1}return e}();s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new o),r.wijmo.registerWidget("wijcombobox",s.prototype),r.mobile&&r.mobile.textinput&&r.mobile.textinput.initSelector&&(r.mobile.textinput.initSelector=r.map(r.mobile.textinput.initSelector.split(","),function(e){return e+":not(:jqmData(role='wijcombobox'))"}).join(","))})(t.combobox||(t.combobox={}));var n=t.combobox})(wijmo||(wijmo={}))});