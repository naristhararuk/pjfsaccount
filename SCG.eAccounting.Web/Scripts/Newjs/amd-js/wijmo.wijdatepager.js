var wijmo;define(["globalize","./wijmo.widget","./wijmo.wijpopup"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijdatepager",s="wijmo-wijdatepager",o="wijmo-wijdatepager-increment",u="wijmo-wijdatepager-decrement",a="wijmo-wijdatepager-container",f="wijmo-wijdatepager-pages",l="wijmo-wijdatepager-pagelabel",c="wijmo-wijdatepager-pagelabel-first",h="wijmo-wijdatepager-pagelabel-last",p="wijmo-wijdatepager-pageheader",d="wijmo-wijdatepager-pagerange",v="wijmo-wijdatepager-tooltip",m="wijmo-wijdatepager-tooltip-inner",g="wijmo-wijdatepager-triangle",y="wijmo-wijdatepager-width-smallest",b="wijmo-wijdatepager-width-small",w="wijmo-wijdatepager-width-medium",E="wijmo-wijdatepager-width-normal",S=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._setOption=function(e,n){var r=this.options.selectedDate,i=function(e,t){return e&&t&&e.getTime&&t.getTime?e.getTime()===t.getTime():e===t};t.prototype._setOption.call(this,e,n);switch(e){case"culture":case"cultureCalendar":this.options[e]=n,this._innerCulture=null,this._resetCulture(),this._initBackground();break;case"selectedDate":this.options.selectedDate=n,this._initBackground(),i(n,r)||this._onSelectedDateChanged();break;case"viewType":this.options.viewType=n,this._resetPageDates(),this._initBackground();break;case"customViewOptions":this.options.customViewOptions=n,this._resetPageDates(),this._initBackground();break;case"nextTooltip":this.element.find("."+o).attr("title",n);break;case"prevTooltip":this.element.find("."+u).attr("title",n);break;case"firstDayOfWeek":this.options.firstDayOfWeek=n,this.options.viewType==="week"&&this._initBackground()}return this},n.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._toggleDisableDatePager(!0)},n.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._toggleDisableDatePager(!1)},n.prototype._toggleDisableDatePager=function(e){this.element.toggleClass(this.options.wijCSS.stateDisabled,e),r.mobile==null?(this.element.find("."+u).button("option","disabled",e),this.element.find("."+o).button("option","disabled",e)):(this.element.find("."+u).toggleClass(this.options.wijCSS.stateDisabled,e),this.element.find("."+o).toggleClass(this.options.wijCSS.stateDisabled,e))},n.prototype._create=function(){var e=this.options,n,i,l;window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r)),e.selectedDate||(e.selectedDate=new Date),this._nativeClass=this.element.attr("class"),this._dtpagernamespacekey="dtpager"+(new Date).getTime(),this.element.addClass(s).addClass(e.wijCSS.wijdatepager).addClass(e.wijCSS.widget).addClass(e.wijCSS.helperClearFix),n=r.proxy(this.invalidate,this),r(window).bind("resize."+this._dtpagernamespacekey,n),this.element.disableSelection&&this.element.disableSelection(),this.element.append(r("<a></a>").addClass(u).addClass(e.wijCSS.wijdatepagerDecButton).append(r("<span>"+e.prevTooltip+"</span>"))).append(r("<div></div>").addClass(a).addClass(e.wijCSS.wijdatepagerContainer).addClass(e.wijCSS.content).append(r("<div></div>").addClass(f).addClass(e.wijCSS.wijdatepagerPages))).append(r("<a></a>").addClass(o).addClass(e.wijCSS.wijdatepagerIncButton).append(r("<span>"+e.nextTooltip+"</span>"))),i=this.element.find("."+u),l=this.element.find("."+o),r.mobile==null?(i.button({icons:{primary:e.wijCSS.iconArrowLeft},text:!1}),l.button({icons:{primary:e.wijCSS.iconArrowRight},text:!1})):(i.html(""),i.addClass(e.wijCSS.iconArrowLeft+" "+e.wijCSS.icon+" ui-btn"),l.html(""),l.addClass(e.wijCSS.iconArrowRight+" "+e.wijCSS.icon+" ui-btn")),i.click(r.proxy(this.goLeft,this)),l.click(r.proxy(this.goRight,this)),this._initBackground(),t.prototype._create.call(this)},n.prototype.destroy=function(){var e=this.options.wijCSS;this.element.empty().removeAttr("aria-disabled"),this.element.attr("class",this._nativeClass?this._nativeClass:""),r(window).unbind("."+this._dtpagernamespacekey),r(document).unbind("."+this._dtpagernamespacekey),t.prototype.destroy.call(this)},n.prototype.refresh=function(){this.invalidate()},n.prototype._getCustomViewUnit=function(){var e=this.options,t;return e.customViewOptions.unit?(t=e.customViewOptions.unit.toLowerCase(),r.inArray(t,["day","week","month","year"])?t:"day"):"day"},n.prototype.invalidate=function(){var e=this,t,n=e.options,i=n.selectedDate,s,c=e.element.find("."+a),h=e.element.find("."+u),p=e.element.find("."+o),d=e.element.innerWidth(),v=i,m=h.is(":visible")?h.outerWidth(!0):0,g=p.is(":visible")?p.outerWidth(!0):0,S,x,T,N,C,k,L,A=this._getCustomViewUnit(),O;if(n.viewType.toLowerCase()==="custom"){k=n.customViewOptions.count||1;for(L=0;L<k;L++){switch(A){case"day":O=e._getDateClass(e._addDays(i,-L));break;case"month":O=e._getDateClass(new Date(i.getFullYear(),i.getMonth()-L,1));break;case"year":O=e._getDateClass(new Date(i.getFullYear()-L,0,1));break;default:O=e._getDateClass(v)}t=e.element.find("."+l+"."+O);if(t.length===1)break}}else t=e.element.find("."+l+"."+e._getDateClass(v));t.length!==1?t=r(e.element.find("."+l)[e._index]):(s=this.element.find("."+l).index(t),this._index=s),C="."+l,N=n.wijCSS.stateActive.split(" "),r.each(N,function(e){C+="."+N[e]}),e.element.find(C).removeClass(n.wijCSS.stateActive),t.addClass(e.options.wijCSS.stateActive),c.css("left",m),e.element.removeClass(y).removeClass(n.wijCSS.wijdatepagerWidthSmallest).removeClass(b).removeClass(n.wijCSS.wijdatepagerWidthSmall).removeClass(w).removeClass(n.wijCSS.wijdatepagerWidthMedium).removeClass(E).removeClass(n.wijCSS.wijdatepagerWidthNormal),d<300?e.element.addClass(y).addClass(n.wijCSS.wijdatepagerWidthSmallest):d<475?e.element.addClass(b).addClass(n.wijCSS.wijdatepagerWidthSmall):d<600?e.element.addClass(w).addClass(n.wijCSS.wijdatepagerWidthMedium):e.element.addClass(E).addClass(n.wijCSS.wijdatepagerWidthNormal),c.outerWidth(d-m-g),r.browser.msie&&parseInt(r.browser.version,10)<=7&&(S=e.element.find("."+f),x=S.find("."+l),T=Math.round(S.width()/e._datesDef.length)-(x.outerWidth(!0)-x.width()),x.width(T))},n.prototype.goLeft=function(e){if(this._isDisabled())return;this._setSelectedIndex(this._index-1,!0);if(e)return e.preventDefault(),!1},n.prototype.goRight=function(){if(this._isDisabled())return;this._setSelectedIndex(this._index+1)},n.prototype._getCulture=function(e){return this._innerCulture||this._resetCulture(e),this._innerCulture},n.prototype._resetCulture=function(e){var t=r.wijGetCulture(e||this.options.culture,this.options.cultureCalendar);this._innerCulture=t},n.prototype._isRTL=function(){return!!this._getCulture().isRTL},n.prototype._initBackground=function(e,t){var n=this;typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var i,s,o,u,a,v=this,m=v.options,g,y=r("<div></div>");if(this._isInAnimate)return;this._index=0,this._datesDef=this._getDatesDefinition(),this._min=0,this._max=this._datesDef.length-1,r.each(this._datesDef,function(e,t){var i=r("<div>"+n._datesDef[e].l+"</div>").addClass(l).addClass(m.wijCSS.wijdatepagerPageLabel).addClass(n._getDateClass(t.d));e===0&&i.addClass(c).addClass(m.wijCSS.wijdatepagerPageLabelFirst),t.range&&i.addClass(d).addClass(m.wijCSS.wijdatepagerPageRange),t.header&&i.addClass(p).addClass(m.wijCSS.wijdatepagerPageHeader).addClass(m.wijCSS.stateHighlight),e===n._max&&i.addClass(h).addClass(m.wijCSS.wijdatepagerPageLabelLast),y.append(i)}),i=y.html(),o=this.element.find("."+f),e?(this._isInAnimate=!0,s=o.clone(!0),o.html(i),u=o.find("."+l),t?(s.insertAfter(o),a=r(u[this._index]).offset().left,o.css("opacity",0).css("left",-s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.css("left",0).stop().animate({left:s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()})):(s.insertBefore(o),a=r(u[this._index]).offset().left,o.css("opacity",0).css("left",s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.stop().animate({left:"-"+s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),v._isInAnimate=!1,v.invalidate()}))):(o.html(i),this.invalidate()),u=o.find("."+l),u.hover(r.proxy(this._pagelabelHover,this),r.proxy(this._pagelabelHout,this)),u.bind("mousedown",r.proxy(this._pagelabelMouseDown,this)),u.click(r.proxy(function(e){var t=r(e.target),n;n=this.element.find("."+l).index(t),this._setSelectedIndex(n)},this))},n.prototype._getDateClass=function(e){return"c1dt"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},n.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)},n.prototype._nextYears=function(e,t){return new Date(e.getFullYear()+t,0,1)},n.prototype._nextMonths=function(e,t){return new Date(e.getFullYear(),e.getMonth()+t,1)},n.prototype._getDatesDefinition=function(){var e=this,t=e.options,n=t.viewType.toLowerCase(),r,i,s,o,u,a=[],f,l=t.selectedDate,c=t.maxDateGroup||6,h,p,d,v,m=t.customViewOptions.count||1;switch(n){case"week":s=new Date(l.getFullYear(),l.getMonth(),-6),r=t.firstDayOfWeek-s.getDay(),Math.abs(r)>6&&(r=s.getDay()-t.firstDayOfWeek),s=e._addDays(s,r),u=new Date(l.getFullYear(),l.getMonth()+1,7),r=0;while(s<=u||s.getMonth()===l.getMonth())o=e._addDays(s,7),a.push({l:e._formatString(e.localizeString("weekViewLabelFormat","{0:MMM dd}-{1:dd}"),s,e._addDays(s,6)),d:s,d2:e._addDays(s,6)}),l>=s&&l<=o&&(e._index=r),s=o,r+=1;break;case"month":i=new Date(l.getFullYear()-1,0,1),a.push({l:e._formatString(e.localizeString("monthViewYearLabelFormat","{0:yyyy}"),i),d:i,range:!0}),i=new Date(l.getFullYear(),0,1),a.push({l:e._formatString(e.localizeString("monthViewYearLabelFormat","{0:yyyy}"),i),d:i,header:!0});for(r=0;r<12;r+=1)i=new Date(l.getFullYear(),r,1),a.push({l:e._formatString(e.localizeString("monthViewLabelFormat","{0:MMM}"),i),d:i}),o=new Date(l.getFullYear(),r+1,1),l>=i&&l<=o&&(e._index=r+2);i=new Date(l.getFullYear()+1,0,1),a.push({l:e._formatString(e.localizeString("monthViewYearLabelFormat","{0:yyyy}"),i),d:i,range:!0});break;case"custom":v=e._getCustomViewUnit(),h=(v==="week"?7:1)*m,s=e._getDateAfterAdjusting(-c*h/2),u=e._getDateAfterAdjusting(c*h/2);if(!e._shouldResetDates(s,u))return e._datesDef;r=0;while(s<=u){switch(v){case"week":f=t.firstDayOfWeek-s.getDay(),s=e._addDays(s,f),u=e._addDays(u,f);case"day":o=e._addDays(s,h),p=e._addDays(s,h-1),m===1&&v==="day"?d=e.localizeString("customViewUnitSingleDayLabelFormat","{0:MMM dd}"):s.getMonth()===p.getMonth()?d=e.localizeString("customViewUnitDayLabelFormat","{0:MMM dd}-{1:dd}"):d=e.localizeString("customViewUnitDayLabelFormat2Months","{0:MMM dd}-{1:MMM dd}");break;case"month":o=e._nextMonths(s,m),p=e._nextMonths(s,m-1),m===1?d=e.localizeString("customViewUnitSingleMonthLabelFormat","{0:MMM}"):s.getFullYear()===p.getFullYear()?d=e.localizeString("customViewUnitMonthLabelFormat","{0:MMM}-{1:MMM, yyyy}"):d=e.localizeString("customViewUnitMonthLabelFormat2Years","{0:MMM yyyy}-{1:MMM yyyy}");break;case"year":o=e._nextYears(s,m),p=e._nextYears(s,m-1),m===1?d=e.localizeString("customViewUnitSingleYearLabelFormat","{0:yyyy}"):d=e.localizeString("customViewUnitYearLabelFormat","{0:yyyy}-{1:yyyy}")}a.push({l:e._formatString(d,s,p),d:s,d2:p}),l>=s&&l<=o&&(e._index=r),s=o,r+=1}e._resetPageDates(a[0].d,a[a.length-1].d);break;default:i=new Date(l.getFullYear(),l.getMonth(),0),a.push({l:e._formatString(e.localizeString("dayViewMonthLabelFormat","{0:MMM}"),i),d:i,range:!0}),i=new Date(l.getFullYear(),l.getMonth(),1),a.push({l:e._formatString(e.localizeString("dayViewMonthLabelFormat","{0:MMM}"),i),d:i,header:!0}),s=i,r=2;while(s.getMonth()===l.getMonth())o=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),a.push({l:e._formatString(e.localizeString("dayViewLabelFormat","{0:d }"),s),d:s}),l>=s&&l<=o&&(e._index=r),s=o,r+=1;i=new Date(l.getFullYear(),l.getMonth()+1,1),a.push({l:e._formatString(e.localizeString("dayViewMonthLabelFormat","{0:MMM}"),i),d:i,range:!0})}return a},n.prototype._getDateAfterAdjusting=function(e){var t=this,n=t.options,r=n.selectedDate,i=r.getFullYear(),s=r.getMonth();switch(t._getCustomViewUnit()){case"day":case"week":return new Date(i,s,r.getDate()+e);case"month":return new Date(i,s+e,1);case"year":return new Date(i+e,0,1)}},n.prototype._resetPageDates=function(e,t){this._startDate=e||null,this._endDate=t||null},n.prototype._shouldResetDates=function(e,t){var n=this,r=n.options,i=r.selectedDate;return!n._startDate||!n._endDate?(n._resetPageDates(e,t),!0):n._startDate<new Date(i.getFullYear(),i.getMonth(),i.getDate())&&n._endDate>new Date(i.getFullYear(),i.getMonth(),i.getDate())?!1:(n._resetPageDates(e,t),!0)},n.prototype._setSelectedIndex=function(e,t){typeof t=="undefined"&&(t=!1);var n=this.options,r;if(this._isDisabled())return;if(e>=this._min&&e<=this._max){this._dragActivated&&this._showTooltip(e);if(this._index!==e){if(this._datesDef[e].header){if(!t)return;e-=1}this._index=e,r=this._datesDef[e].d,n.selectedDate=r,this._max>2&&this._index===0?this._initBackground(!0,!0):this._index===this._max?(n.viewType==="week"&&(n.selectedDate=new Date(n.selectedDate.getFullYear(),n.selectedDate.getMonth(),n.selectedDate.getDate()+7)),this._initBackground(!0,!1),n.selectedDate=r):this.invalidate(),this._onSelectedDateChanged()}}},n.prototype._onSelectedDateChanged=function(){var e=this.options;this._trigger("selectedDateChanged",null,{selectedDate:e.selectedDate})},n.prototype._pagelabelHover=function(e){var t=r(e.target),n=this.options;if(t.hasClass(p))return;t.addClass(n.wijCSS.stateHover)},n.prototype._showTooltip=function(e){var t=this,n=t.options,i=t._datesDef[e],s=n.viewType,o,u=this.element.find("."+l)[e],a=t._getCustomViewUnit(),f=n.customViewOptions.count||1;t._tooltip||(t._tooltip=r("<div></div>").addClass(v).addClass(n.wijCSS.wijdatepagerTooltip).append(r("<div></div>").addClass(m).addClass(n.wijCSS.wijdatepagerTooltipInner)).append(r("<div></div>").addClass(g).addClass(n.wijCSS.wijdatepagerTriangle)),t.element.append(t._tooltip),t._tooltip.wijpopup());switch(s){case"week":i.d.getMonth()!==i.d2.getMonth()?o=t._formatString(t.localizeString("weekViewTooltip2MonthesFormat","{0:MMMM d} - {1:MMMM d, yyyy}"),i.d,i.d2):o=t._formatString(t.localizeString("weekViewTooltipFormat","{0:MMMM d} - {1:d, yyyy}"),i.d,i.d2);break;case"month":o=t._formatString(t.localizeString("monthViewTooltipFormat","{0:MMMM yyyy}"),i.d);break;case"custom":a==="day"||a==="week"?f===1?o=t._formatString(t.localizeString("customViewSingleDayTooltipFormat","{0:MMMM d yyyy}"),i.d):i.d.getMonth()!==i.d2.getMonth()?o=t._formatString(t.localizeString("customViewDayUnitTooltip2MonthesFormat","{0:MMMM d} - {1:MMMM d, yyyy}"),i.d,i.d2):o=t._formatString(t.localizeString("customViewDayTooltipFormat","{0:MMMM d} - {1:d, yyyy}"),i.d,i.d2):a==="month"?f===1?o=t._formatString(t.localizeString("customViewSingleMonthTooltipFormat","{0:MMMM yyyy}"),i.d):i.d.getFullYear()!==i.d2.getFullYear()?o=t._formatString(t.localizeString("customViewMonthTooltip2YearsFormat","{0:MMMM yyyy} - {1:MMMM yyyy}"),i.d,i.d2):o=t._formatString(t.localizeString("customViewMonthTooltipFormat","{0:MMMM} - {1:MMMM, yyyy}"),i.d,i.d2):a==="year"&&(f===1?o=t._formatString(t.localizeString("customViewSingleYearTooltipFormat","{0:yyyy}"),i.d):o=t._formatString(t.localizeString("customViewYearTooltipFormat","{0:yyyy} - {1:yyyy}"),i.d,i.d2));break;default:o=this._formatString(t.localizeString("dayViewTooltipFormat","{0:dddd, MMMM d, yyyy}"),i.d)}r.ui&&(t._tooltip.wijpopup("show",{of:u,my:"center bottom",at:"center top",offset:"-10 -10"}),t._tooltip.find("."+m).html(o))},n.prototype._hideTooltip=function(){this._tooltip.wijpopup("hide")},n.prototype._pagelabelHout=function(e){r(e.target).removeClass(this.options.wijCSS.stateHover)},n.prototype._pagelabelMouseDown=function(e){this._dragActivated=!1;if(this._isDisabled())return;e.preventDefault();var t=r(e.target),n;if(t.hasClass(p))return;n=this.element.find("."+l).index(t),this._dragActivated=!0,this._setSelectedIndex(n),this._mouseDownTimeFix20555=(new Date).getTime(),this._startClientX=e.pageX,this._startInd=n,r(document).bind("mousemove."+this._dtpagernamespacekey,r.proxy(this._pageindicatorMouseMove,this)),r(document).bind("mouseup."+this._dtpagernamespacekey,r.proxy(this._pageindicatorMouseUp,this))},n.prototype._detectLeftButton=function(e){return e.originalEvent&&(e=e.originalEvent),"buttons"in e?e.buttons===1:"which"in e?e.which===1:e.button===1},n.prototype._pageindicatorMouseMove=function(e){if(!this._detectLeftButton(e)){this._pageindicatorMouseUp();return}e.preventDefault();if(this._isInAnimate)return;var t=this.element.find("."+l)[this._startInd],n,r;if(!t)return;n=t.offsetLeft+Math.round(t.offsetWidth/2)+(e.pageX-this._startClientX),r=this._findClosesPageIndexByPos(n);if(this._prevMoveInd===r)return;this._prevMoveInd=r;if(this._mouseDownTimeFix20555+150>(new Date).getTime())return;r!==-1&&r!==this._index&&this._setSelectedIndex(r)},n.prototype._pageindicatorMouseUp=function(){this._dragActivated=!1,r(document).unbind("."+this._dtpagernamespacekey),this._hideTooltip()},n.prototype._findClosesPageIndexByPos=function(e){var t=this.element.find("."+f).find("."+l),n;for(n=0;n<t.length;n+=1)if(t[n].offsetLeft<e&&t[n].offsetLeft+t[n].offsetWidth>e)return n;return-1},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._formatString=function(e,t,n,r){var i,s=arguments,o,u,a=this;if(s.length<=1)return Globalize.format(s);typeof e=="string"&&typeof window[e]=="function"&&(e=window[e]);if(typeof e=="function"){u=[];for(o=1;o<s.length;o+=1)u[o-1]=s[o];return e.apply(this,u)}return i=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(i,function(e,t,n,r,i){return e=s[Number(t)+1],r?Globalize.format(e,r,a._getCulture()):e})},n}(t.wijmoWidget);n.wijdatepager=S;var x=function(){function e(){this.wijCSS={wijdatepager:"",wijdatepagerIncButton:"",wijdatepagerDecButton:"",wijdatepagerContainer:"",wijdatepagerPages:"",wijdatepagerPageLabel:"",wijdatepagerPageLabelFirst:"",wijdatepagerPageLabelLast:"",wijdatepagerPageHeader:"",wijdatepagerPageRange:"",wijdatepagerTooltip:"",wijdatepagerTooltipInner:"",wijdatepagerTriangle:"",wijdatepagerWidthSmallest:"",wijdatepagerWidthSmall:"",wijdatepagerWidthMedium:"",wijdatepagerWidthNormal:""},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body ui-body-b",stateDefault:"ui-btn ui-btn-b"},this.initSelector=":jqmData(role='wijdatepager')",this.culture="",this.cultureCalendar="",this.localization=null,this.firstDayOfWeek=0,this.maxDateGroup=6,this.selectedDate=null,this.viewType="day",this.customViewOptions={unit:"day",count:1},this.nextTooltip="right",this.prevTooltip="left",this.selectedDateChanged=null}return e}();S.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new x),r.wijmo.registerWidget(i,S.prototype)})(t.datepager||(t.datepager={}));var n=t.datepager})(wijmo||(wijmo={}))});