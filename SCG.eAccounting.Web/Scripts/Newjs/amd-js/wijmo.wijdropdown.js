var wijmo;define(["./wijmo.widget","./wijmo.wijsuperpanel","./wijmo.wijutil","jquery.bgiframe"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijdropdown",s=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype._innerDisable=function(){n.prototype._innerDisable.call(this),this._toggleDisableDropDown(!0)},i.prototype._innerEnable=function(){n.prototype._innerEnable.call(this),this._toggleDisableDropDown(!1)},i.prototype._toggleDisableDropDown=function(e){var t=this.options.wijCSS;this._labelWrap.toggleClass(t.stateDisabled,e),this._label.toggleClass(t.stateDisabled,e),this.element.attr("disabled",e?"disabled":"")},i.prototype._create=function(){var e=this,t=e.element;window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r));if(t.get(0).tagName.toLowerCase()!=="select")return;t.is(":visible")?(e._activeItem=null,e._createSelect(),e._bindEvents(),e.needInit=!1):e.needInit=!0,e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.refresh(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijdropdown"),n.prototype._create.call(this)},i.prototype._createSelect=function(){this.cssWidth=this.element.get(0).style.width;var e=this,t=e.options,n=e.options.wijCSS,i=e.element,s=i.width(),o=s,u=i.wrap("<div></div>").parent().addClass(n.helperHidden),a=u.wrap("<div></div>").parent().attr("role","select").addClass(n.wijdropdown).addClass(n.widget).addClass(n.stateDefault).addClass(n.cornerAll).addClass(n.helperClearFix),f=r("<label></label>").addClass(n.wijdropdownLabel).addClass(n.cornerAll).attr("id",i.get(0).id+"_select"),l=r("<div></div>").addClass(n.wijdropdownTrigger).addClass(n.stateDefault).addClass(n.cornerRight),c=r('<a href="#"></a>'),h=r("<div>").addClass(n.wijmodropdown),p=r("<ul></ul>").addClass(n.wijdropdownList).addClass(n.content).addClass(n.widget).addClass(n.cornerAll).addClass(n.helperReset).appendTo(h);i.attr("name")&&i.attr("name")!==""&&f.attr("name",i.attr("name")),r("<span></span>").addClass(n.icon).addClass(n.iconArrowDown).appendTo(l),i.get(0).tabIndex.toString()!==""&&c.attr("tabindex",i.attr("tabindex")),i.get(0).disabled!==!1&&(e.options.disabled=!0),e._isDisabled()&&(c.addClass(n.stateDisabled),f.addClass(n.stateDisabled)),c.append(f),a.append(u).append(c).append(l),t.ensureDropDownOnBody?h.wrap(r("<div></div>").addClass(n.wijdropdown)).parent().appendTo("body").css("position","absolute"):a.append(h),o+=parseInt(f.css("padding-left").replace(/px/,""),10),o+=parseInt(f.css("padding-right").replace(/px/,""),10),o-=16,a.width(o),e._container=a,e._buildList(p,h,o),e._rightTrigger=l,e._label=f,e._listContainer=h,e._list=p,e._value=i.val(),e._selectedIndex=r("option",i).index(i.find("option:selected")),e._selectWrap=u,e._labelWrap=c,a.attr("title",i.attr("title"))},i.prototype._buildList=function(e,t,n){var i=this,s=i.options.wijCSS,o=i.element,u,a;t.show(),o.children().each(function(t,n){var o=r(n),u,a,f,l=!1;return o.is("option")?e.append(i._buildItem(o)):(u=r("<li></li>").addClass(s.wijdropdownOptgroup),a=r("<span>"+o.attr("label")+"</span>").addClass(s.wijdropdownOptgroupHeader).addClass(s.priorityPrimary),f=r("<ul></ul>").addClass(s.helperReset).addClass(s.wijdropdownItems),o.attr("disabled")=="disabled"&&(l=!0,u.addClass(s.stateDisabled)),o.children("option").each(function(){return l&&r(this).attr("disabled","disabled"),f.append(i._buildItem(r(this))),this}),u.append(a).append(f),e.append(u)),this}),t.height(""),e.width("").css("float","left"),a=e.outerWidth(),e.css("float",""),u=t.height(),u=e.outerHeight()<u?e.outerHeight():u,(this.cssWidth===""||this.cssWidth==="auto")&&a>n-19&&(n=a+10,this._container.width(n)),t.css({height:u,width:n}),r.browser.msie&&/^[8]\.[0-9]+/.test(r.browser.version)?e.setOutWidth(n-19):e.setOutWidth(n-18),t.data("wijmo-wijsuperpanel")?(t.wijsuperpanel("paintPanel"),i.superpanel=t.data("wijmo-wijsuperpanel")):i.superpanel=t.wijsuperpanel({unfocus:i.options.unfocus}).data("wijmo-wijsuperpanel"),r.fn.bgiframe&&i.superpanel.element.bgiframe(),i.superpanel.vNeedScrollBar||(r.browser.msie&&/^[8]\.[0-9]+/.test(r.browser.version)?e.setOutWidth(n-1):e.setOutWidth(n),i.superpanel.paintPanel(i.options.unfocus)),t.hide()},i.prototype._toggleStateClass=function(e,t){this._label.toggleClass(e,t),this._rightTrigger.toggleClass(e,t),this._container.toggleClass(e,t)},i.prototype._handelEvents=function(e){var t=this,n=t.options.wijCSS,r="."+t.widgetName,i=t.element;e.bind("click"+r,function(n){if(t._isDisabled()){n.preventDefault(),n.stopPropagation();return}t._listContainer.is(":hidden")?t._show():t._hide(),i.click(),e.get(0)===t._label.get(0)?n.preventDefault():t._labelWrap.focus()}).bind("mouseover"+r,function(){if(t._isDisabled())return;t._toggleStateClass(n.stateHover,!0),i.trigger("mouseover")}).bind("mouseout"+r,function(){if(t._isDisabled())return;t._toggleStateClass(n.stateHover,!1),i.trigger("mouseout")}).bind("mousedown"+r,function(){if(t._isDisabled())return;t._toggleStateClass(n.stateActive,!0),i.trigger("mousedown")}).bind("mouseup"+r,function(){if(t._isDisabled())return;t._toggleStateClass(n.stateActive,!1),i.trigger("mouseup")})},i.prototype._bindEvents=function(){var e=this,n=e.options.wijCSS,i="."+e.widgetName,s=e._label,o=e._rightTrigger,u=e._labelWrap,a=e._listContainer,f=e.element,l=!1,c;e._handelEvents(e._label),e._handelEvents(e._rightTrigger),r(window).bind("resize",function(t){e._setListContainerPosition()}),r(document).bind("mouseup"+i,function(t){if(a.is(":hidden")){e._toggleStateClass(n.stateFocus,!1);return}c=a.offset();if(t.target===s.get(0)||t.target===o.get(0)||t.target===o.children().get(0))return;if(r(t.target).closest(a).length>0)return;if(t.pageX<c.left||t.pageX>c.left+a.width()||t.pageY<c.top||t.pageY>c.top+a.height())e._toggleStateClass(n.stateFocus,!1),e._hide()}),a.bind("click"+i,function(t){var i=r(t.target),s=i.closest("li"),o=s.attr("disabled")&&s.attr("disabled")==="disabled";if(o)return;i.closest("li."+n.wijdropdownItem,r(this).get(0)).length>0&&(e._setValue(),a.css("z-index",""),r.browser.msie&&/^[6,7].[0-9]+/.test(r.browser.version)&&a.parent().css("z-index",""),a.hide(),e._setValueToEle()),f.click()}),u.bind("keydown"+i,function(n){if(e._isDisabled())return;var r=t.getKeyCodeEnum();switch(n.which){case r.UP:case r.LEFT:e._previous(),e._setValue(),e._setValueToEle();break;case r.DOWN:case r.RIGHT:e._next(),e._setValue(),e._setValueToEle();break;case r.PAGE_DOWN:e._nextPage(),e._setValue(),e._setValueToEle();break;case r.PAGE_UP:e._previousPage(),e._setValue(),e._setValueToEle();break;case r.ENTER:case r.NUMPAD_ENTER:e._setValue(),e._listContainer.hide(),e._setValueToEle()}n.which!==r.TAB&&n.preventDefault(),f.trigger("keydown")}).bind("focus"+i,function(){if(e._isDisabled())return;e._toggleStateClass(n.stateFocus,!0),f.focus()}).bind("blur"+i,function(){if(e._isDisabled())return;e._toggleStateClass(n.stateFocus,!1),f.trigger("blur")}).bind("keypress"+i,function(){if(e._isDisabled())return;f.trigger("keypress")}).bind("keyup"+i,function(){if(e._isDisabled())return;f.trigger("keyup")}),l=/chrome/.test(navigator.userAgent.toLowerCase());if(l||r.browser.safari)u.bind("click"+i,function(){u.focus()}),o.bind("mouseout"+i,function(){if(e._isDisabled())return;e._toggleStateClass(n.stateFocus,!1)})},i.prototype._setListContainerPosition=function(){var e=this,t=e.options,n;if(!t.ensureDropDownOnBody)return;n=e._container.offset(),e._listContainer.parent().offset({left:n.left,top:n.top+e._container.outerHeight()})},i.prototype._init=function(){var e=this;e._initActiveItem(),e._activeItem&&e._label.text(e._activeItem.text())},i.prototype._buildItem=function(e){var t=e.val(),n=e.text(),i=this,s=i.options.wijCSS,o;return n===""&&(n="&nbsp;"),o=r("<li></li>").addClass(s.wijdropdownItem).addClass(s.stateDefault).addClass(s.cornerAll).append(r("<span>"+n+"</span>")).attr("role","option"),e.is(":disabled")?o.attr("disabled","disabled").addClass(s.stateDisabled):o.mousemove(function(e){var t=r(e.target).closest("."+s.wijdropdownItem);t!==this.last&&i._activate(r(this)),this.last=r(e.target).closest("."+s.wijdropdownItem)}),o.data("value",t),o},i.prototype._show=function(){var e=this,t=e._listContainer,n=e.options.showingAnimation;e._setListContainerPosition(),t.css("z-index","100000"),r.browser.msie&&/^[6,7]\.[0-9]+/.test(r.browser.version)&&t.parent().css("z-index","99999"),n?t.show(n.effect,n.options,n.speed,function(){e._initActiveItem()}):t.show()},i.prototype._hide=function(){var e=this,t=e._listContainer,n=e.options.hidingAnimation;if(t.is(":hidden"))return;n?t.hide(n.effect,n.options,n.speed,function(){r.isFunction(n.callback)&&n.callback.apply(e,arguments),r.browser.msie&&/^[6,7]\.[0-9]+/.test(r.browser.version)&&t.parent().css("z-index",""),t.css("z-index","")}):(r.browser.msie&&r.browser.version==="6.0"&&t.parent().css("z-index",""),t.css("z-index",""),t.hide())},i.prototype._setValue=function(){var e=this,t=e.options.wijCSS,n=e._listContainer,i,s;e._activeItem&&(e._label.text(e._activeItem.text()),e._value=e._activeItem.data("value"),e._selectedIndex=r("li."+t.wijdropdownItem,n).index(e._activeItem),e.superpanel.vNeedScrollBar&&(i=e._activeItem.offset().top,s=e._activeItem.outerHeight(),n.offset().top>i?n.wijsuperpanel("scrollTo",0,i-e._list.offset().top):n.offset().top<i+s-n.innerHeight()&&n.wijsuperpanel("scrollTo",0,i+s-n.height()-e._list.offset().top)))},i.prototype._setValueToEle=function(){var e=this,t=e.element,n=t.find(":selected"),i=r("option",t).index(n),s=e._selectedIndex;i!==s&&(r.browser.mozilla&&t.val(e._value),n.removeAttr("selected"),t.find("option:eq("+s+")").prop("selected",!0),t.trigger("change"))},i.prototype._initActiveItem=function(){var e=this,t=e.options.wijCSS;if(e._value!==undefined){if(e._selectedIndex===-1){e._activate(e._list.find("li."+t.wijdropdownItem).eq(0));return}e._list.find("li."+t.wijdropdownItem).each(function(t){if(t===e._selectedIndex)return e._activate(r(this)),!1})}},i.prototype._activate=function(e){var t=this,n=t.options.wijCSS;t._deactivate(),t._activeItem=e,t._activeItem.addClass(n.stateHover).attr("aria-selected",!0)},i.prototype._deactivate=function(){var e=this,t=e.options.wijCSS;e._activeItem&&e._activeItem.removeClass(t.stateHover).attr("aria-selected",!1)},i.prototype._next=function(){this._move("next","first")},i.prototype._previous=function(){this._move("prev","last")},i.prototype._nextPage=function(){this._movePage("first")},i.prototype._previousPage=function(){this._movePage("last")},i.prototype.refresh=function(){var e=this,t=e.options.wijCSS,n=e.element,i;if(e.needInit)e.element.is(":visible")&&(e._activeItem=null,e._createSelect(),e._bindEvents(),e._init(),e.needInit=!1);else{if(!e._list)return;e._listContainer.show(),e._selectWrap.removeClass(t.helperHidden),i=e.element.width(),i+=parseInt(e._label.css("padding-left").replace(/px/,""),10),i+=parseInt(e._label.css("padding-right").replace(/px/,""),10),i-=16,e._container.width(i),e._selectWrap.addClass(t.helperHidden),e._list.empty(),e._buildList(e._list,e._listContainer,i),e._value=e.element.val(),e._selectedIndex=r("option",n).index(n.find("option:selected")),e._initActiveItem(),e._activeItem&&e._label.text(e._activeItem.text())}},i.prototype._move=function(e,t){var n=this,r=n.options.wijCSS,i,s;if(!n._activeItem){n._activate(n._list.find("."+r.wijdropdownItem+":"+t));return}i=n._activeItem[e]().eq(0),i.length?s=n._getNextItem(i,e,t):n._activeItem.closest("."+r.wijdropdownOptgroup).length&&(s=n._getNextItem(n._activeItem.closest("."+r.wijdropdownOptgroup)[e](),e,t));if(!s||!s.length)s=n._getNextItem(n._list.find("."+r.wijdropdownItem+":"+t),e,t);n._activate(s)},i.prototype._movePage=function(e){var t=this,n=t.options.wijCSS,i,s,o,u,a=e==="first"?"next":"prev",f=e==="first"?"last":"first";t.superpanel.vNeedScrollBar?(i=t._activeItem.offset().top,s=t.options.height,o=t._list.find("."+n.wijdropdownItem).filter(function(){var t=r(this).offset().top-i+(e==="first"?-s:s)+r(this).height(),n=r(this).height();return t<n&&t>-n}),o.length||(o=t._list.find("."+n.wijdropdownItem+":"+f))):o=t._list.find("."+n.wijdropdownItem+":"+(t._activeItem?f:e)),u=t._getNextItem(o,a);if(!u||!u.length)u=t._getNextItem(o,a==="next"?"prev":"next");t._activate(u)},i.prototype._getNextItem=function(e,t,n){var r=this.options.wijCSS,i;if(e.length)return e.is("."+r.wijdropdownOptgroup)?e.find(">ul>li."+r.wijdropdownItem).length?i=e.find(">ul>li."+r.wijdropdownItem+":"+n).eq(0):i=this._getNextItem(e[t]().eq(0)):i=e,i.attr("disabled")==="disabled"?i[t]().length?this._getNextItem(i[t](),t):(n||(n=t=="next"?"first":"last"),this._getNextItem(i.closest("."+r.wijdropdownOptgroup)[t](),t,n)):i},i.prototype.destroy=function(){var e=this,t=e.options.wijCSS;this.element.attr("title",this._container.attr("title")),this.element.closest("."+t.wijdropdown).find(">div."+t.wijdropdownTrigger+",>div."+t.wijmodropdown+",>a").remove(),this._listContainer.remove(),this.element.unwrap().unwrap().removeData("maxZIndex"),n.prototype.destroy.call(this)},i}(t.wijmoWidget);n.wijdropdown=s;var o=function(){function e(){this.initSelector=":jqmData(role='wijdropdown')",this.wijCSS={wijmodropdown:"wijmo-dropdown",wijdropdown:"wijmo-wijdropdown",wijdropdownLabel:"wijmo-dropdown-label",wijdropdownTrigger:"wijmo-dropdown-trigger",wijdropdownList:"wijmo-dropdown-list",wijdropdownOptgroup:"wijmo-dropdown-optgroup",wijdropdownOptgroupHeader:"wijmo-optgroup-header",wijdropdownItems:"wijmo-dropdown-items",wijdropdownItem:"wijmo-dropdown-item"},this.zIndex=1e3,this.showingAnimation={effect:"blind"},this.hidingAnimation={effect:"blind"},this.ensureDropDownOnBody=!1}return e}();s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new o),r.wijmo.registerWidget(i,s.prototype)})(t.dropdown||(t.dropdown={}));var n=t.dropdown})(wijmo||(wijmo={}))});