var wijmo;define(["./wijmo.widget","./wijmo.wijsplitter","./wijmo.wijdialog","globalize","./wijmo.wijribbon"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijeditor",s=alert,o=window,u=document,a=parseInt,f=t.ribbon.wijribbonDataRender,l,c,h,p=[],d=null,v=!0,m=0,g=[],y=null,b="setButtonDisabled",w="setButtonsDisabled",E="setButtonChecked",S="setButtonsChecked",x="form",T="imagebutton",N="textarea",C="button",k="textbox",L="list",A="passwordfield",O="dropdownlist",M="hiddenfield",_="radio",D="checkbox",P="insertcol",H="insertrow",B="insertcell",j="splitcell",F="mergecell",I="deletecol",q="deleterow",R="deletecell",U="justifyleft",z="justifycenter",W="justifyright",X="justifyfull",V="borders",$="insertorderedlist",J="insertunorderedlist",K="outdent",Q="indent",G="backcolor",Y="fontcolor",Z="bold",et="italic",tt="strikethrough",nt="underline",rt="subscript",it="superscript",st="template",ot="removeformat",ut="insertbreak",at="insertparagraph",ft="insertprintpagebreak",lt="inserthorizontalrule",ct="tablebutton",ht="inserttable",pt="edittable",dt="wysiwyg",vt="split",mt="code",gt="wordwrap",yt="fullscreen",bt="undo",wt="redo",Et="preview",St="cleanup",xt="cut",Tt="copy",Nt="paste",Ct="selectall",kt="media",Lt="specialchar",At="datetime",Ot="find",Mt="inspect",_t="save",Dt="spelling",Pt="imagebrowser",Ht="link",Bt="xx-small",jt="x-small",Ft="small",It="medium",qt="large",Rt="x-large",Ut="xx-large",zt="fontname",Wt="fontsize",Xt="blockquote",Vt="insertcode",$t="wijmo-wijribbon",Jt=$t+"-bigbutton",Kt=$t+"-dropdownbutton",Qt=$t+"-splitbutton",Gt=$t+"-list",Yt=$t+"-save",Zt=$t+"-save16",en=$t+"-undo",tn=$t+"-redo",nn=$t+"-preview",rn=$t+"-cleanup",sn=$t+"-cut",on=$t+"-copy",un=$t+"-paste",an=$t+"-selectall",fn=$t+"-bgcolor",ln=$t+"-color",cn=$t+"-bold",hn=$t+"-italic",pn=$t+"-underline",dn=$t+"-strike",vn=$t+"-sub",mn=$t+"-sup",gn=$t+"-template",yn=$t+"-removeformat",bn=$t+"-justifyleft",wn=$t+"-justifycenter",En=$t+"-justifyright",Sn=$t+"-justifyfull",xn=$t+"-borders",Tn=$t+"-orderlist",Nn=$t+"-unorderlist",Cn=$t+"-outdent",kn=$t+"-indent",Ln=$t+"-inspect",An=$t+"-find",On=$t+"-table",Mn=$t+"-inserttable",_n=$t+"-edittable",Dn=$t+"-insertcol",Pn=$t+"-insertrow",Hn=$t+"-insertcell",Bn=$t+"-splitcell",jn=$t+"-mergecell",Fn=$t+"-deletecol",In=$t+"-deleterow",qn=$t+"-deletecell",Rn=$t+"-insertbreak",Un=$t+"-insertparagraph",zn=$t+"-insertprintpagebreak",Wn=$t+"-inserthr",Xn=$t+"-form",Vn=$t+"-textarea",$n=$t+"-textbox",Jn=$t+"-password",Kn=$t+"-hiddenfield",Qn=$t+"-imagebutton",Gn=$t+"-button",Yn=$t+"-listbox",Zn=$t+"-dropdownlist",er=$t+"-radio",tr=$t+"-checkbox",nr=$t+"-link",rr=$t+"-link16",ir=$t+"-imagebrowser",sr=$t+"-media",or=$t+"-specialchar",ur=$t+"-datetime",ar=$t+"-blockquote",fr=$t+"-insertcode",lr=$t+"-modes",cr=$t+"-designview",hr=$t+"-sourceview",pr=$t+"-splitview",dr=$t+"-wordwrap",vr=$t+"-fullscreen",mr="wijmo-wijeditor",gr=mr+"-container",yr=mr+"-header",br=mr+"-content",wr=mr+"-footer",Er=mr+"-pathselector",Sr=mr+"-fullscreen",xr=mr+"-dialog",Tr=xr+"-hr",Nr=xr+"-buttons",Cr=xr+"-button",kr=xr+"-text",Lr=mr+"-imagedlg",Ar=Lr+"-content",Or=Lr+"-fields",Mr=Lr+"-imagefield",_r=Lr+"-imagelist",Dr=Lr+"-preview",Pr=Lr+"-imagesrc",Hr=Lr+"-imagealt",Br=Lr+"-imagewidth",jr=Lr+"-imageheight",Fr=Lr+"-css",Ir=Lr+"-hideimagelist",qr=mr+"-templatedlg",Rr=qr+"-toplabels",Ur=qr+"-topleftlabel",zr=qr+"-toprightlabel",Wr=qr+"-content",Xr=qr+"-templatelist",Vr=qr+"-preview",$r=qr+"-templateinfo",Jr=qr+"-nameinfo",Kr=qr+"-descriptioninfo",Qr=qr+"-fields",Gr=qr+"-name",Yr=qr+"-description",Zr=qr+"-buttons",ei=qr+"-delete",ti=qr+"-save",ni=mr+"-linkdlg",ri=ni+"-address",ii=ni+"-linktype",si=ni+"-anchor",oi=ni+"-text",ui=ni+"-target",ai=ni+"-css",fi=ni+"-src",li=ni+"-width",ci=ni+"-height",hi=ni+"-imagecontainer",pi=ni+"-linkicontype",di=mr+"-codedlg",vi=di+"-source",mi=di+"-sourcelabel",gi=mr+"-taginsdlg",yi=gi+"-caption",bi=gi+"-taglabel",wi=gi+"-tagtext",Ei=gi+"-filterempty",Si=gi+"-attribs",xi=gi+"-attriblist",Ti=gi+"-innerhtml",Ni=gi+"-css",Ci=mr+"-colordlg",ki=Ci+"-picker",Li=Ci+"-color",Ai=mr+"-tabledlg",Oi=Ai+"-rows",Mi=Ai+"-columns",_i=Ai+"-width",Di=Ai+"-height",Pi=Ai+"-border",Hi=Ai+"-cellpadding",Bi=Ai+"-cellspacing",ji=Ai+"-csstext",Fi=Ai+"-bgcolor",Ii=mr+"-previewdlg",qi=Ii+"-caption",Ri=Ii+"-navigator",Ui=Ii+"-prev",zi=Ii+"-next",Wi=Ii+"-printall",Xi=Ii+"-printone",Vi=Ii+"-ok",$i=Ii+"-printdocument",Ji=Ii+"-previewiframe",Ki=mr+"-cleanupdlg",Qi=Ki+"-caption",Gi=Ki+"-document",Yi=Ki+"-actions",Zi=mr+"-finddlg",es=Zi+"-find",ts=Zi+"-replace",ns=mr+"-mediadlg",rs=ns+"-type",is=ns+"-src",ss=ns+"-width",os=ns+"-height",us=mr+"-specialchardlg",as=us+"-chars",fs=us+"-preview",ls=us+"-content",cs=us+"-list",hs=us+"_label",ps=us+"-punctuation",ds=us+"-symbols",vs=us+"-diacritics",ms="wijmo-formatspan",gs="."+Nr+" input:first",ys="."+Nr+" input:last",bs="."+Nr+" input[value='OK']",ws="."+Nr+" input[engValue='Cancel']",Es=["Bold","Italic","UnderLine","StrikeThrough","SubScript","SuperScript","JustifyLeft","JustifyCenter","JustifyRight","JustifyFull","Border","NumberedList","BulletedList","Outdent","Indent"],Ss=["Bold","Italic","Link","BlockQuote","StrikeThrough","InsertDate","InsertImage","NumberedList","BulletedList","InsertCode"],xs=["Bold","Italic","StrikeThrough","UnderLine","ForeColor","FontSize","Link","InsertImage","NumberedList","BulletedList","BlockQuote"],Ts={Form:{name:"form",tip:"Form",css:Xn},Image:{name:"imagebutton",tip:"Image Button",css:Qn},TextArea:{name:"textarea",tip:"TextArea",css:Vn},Button:{name:"button",tip:"Button",css:Gn},TextBox:{name:"textbox",tip:"TextBox",css:$n},List:{name:"list",tip:"ListBox",css:Yn},PasswordField:{name:"passwordfield",tip:"Password Field",css:Jn},DropDownList:{name:"dropdownlist",tip:"DropDownList",css:Zn},HiddenField:{name:"hiddenfield",tip:"Hidden Field",css:Kn},Radio:{name:"radio",tip:"RadioButton",css:er},CheckBox:{name:"checkbox",tip:"CheckBox",css:tr},InsertColumn:{name:"insertcol",tip:"Insert Column",css:Dn},InsertRow:{name:"insertrow",tip:"Insert Row",css:Pn},InsertCell:{name:"insertcell",tip:"Insert Cell",css:Hn},SplitCell:{name:"splitcell",tip:"Split Cell",css:Bn},MergeCell:{name:"mergecell",tip:"Merge Cell",css:jn},DeleteColumn:{name:"deletecol",tip:"Delete Column",css:Fn},DeleteRow:{name:"deleterow",tip:"Delete Row",css:In},DeleteCell:{name:"deletecell",tip:"Delete Cell",css:qn},JustifyLeft:{name:"justifyleft",tip:"Justify Left",css:bn,grpname:"alignment"},JustifyCenter:{name:"justifycenter",tip:"Justify Center",css:wn,grpname:"alignment"},JustifyRight:{name:"justifyright",tip:"Justify Right",css:En,grpname:"alignment"},JustifyFull:{name:"justifyfull",tip:"Justify Full",css:Sn,grpname:"alignment"},Border:{name:"borders",tip:"Border",css:xn},NumberedList:{name:"insertorderedlist",tip:"Numbered List",css:Tn,grpname:"list"},BulletedList:{name:"insertunorderedlist",tip:"Bulleted List",css:Nn,grpname:"list"},Outdent:{name:"outdent",tip:"Outdent",css:Cn,grpname:"block"},Indent:{name:"indent",tip:"Indent",css:kn,grpname:"block"},BackColor:{name:"backcolor",tip:"Background Color",css:fn},ForeColor:{name:"fontcolor",tip:"Font Color",css:ln},Bold:{name:"bold",tip:"Bold",css:cn},Italic:{name:"italic",tip:"Italic",css:hn},StrikeThrough:{name:"strikethrough",tip:"Strikethrough",css:dn},UnderLine:{name:"underline",tip:"Underline",css:pn},SubScript:{name:"subscript",tip:"Subscript",css:vn},SuperScript:{name:"superscript",tip:"Superscript",css:mn},Template:{name:"template",tip:"Template",css:gn},RemoveFormat:{name:"removeformat",tip:"RemoveFormat",css:yn},InsertBreak:{name:"insertbreak",tip:"Insert Break",css:Rn},InsertParagraph:{name:"insertparagraph",tip:"Insert Paragraph",css:Un},InsertPrint:{name:"insertprintpagebreak",tip:"Insert Print Page Break",css:zn},InsertHR:{name:"inserthorizontalrule",tip:"Insert Horizontal Line",css:Wn},Table:{name:"tablebutton",tip:"Table",css:On},InsertTable:{name:"inserttable",tip:"Insert Table",css:Mn},EditTable:{name:"edittable",tip:"Edit Table",css:_n},Wysiwyg:{name:"wysiwyg",tip:"Design View",css:cr,grpname:"modes"},Split:{name:"split",tip:"Split View",css:pr,grpname:"modes"},Code:{name:"code",tip:"Source View",css:hr,grpname:"modes"},Wordwrap:{name:"wordwrap",tip:"Wordwrap",css:dr},FullScreen:{name:"fullscreen",tip:"Fullscreen",css:vr},Undo:{name:"undo",tip:"Undo",css:en},Redo:{name:"redo",tip:"Redo",css:tn},Preview:{name:"preview",tip:"Preview",css:nn},Cleanup:{name:"cleanup",tip:"Clean up",css:rn},Cut:{name:"cut",tip:"Cut",css:sn},Copy:{name:"copy",tip:"Copy",css:on},Paste:{name:"paste",tip:"Paste",css:un},SelectAll:{name:"selectall",tip:"Select All",css:an},Media:{name:"media",tip:"Media",css:sr},InsertSpecialChar:{name:"specialchar",tip:"Insert Special Character",css:or},InsertDate:{name:"datetime",tip:"Insert Date Time",css:ur},Find:{name:"find",tip:"Find And Replace",css:An,text:"Find"},Inspect:{name:"inspect",tip:"Tag Inspect",css:Ln,text:"Inspect"},Save:{name:"save",tip:"Save",css:Yt,text:"Save"},Spelling:{name:"spelling",tip:"Form",css:""},InsertImage:{name:"imagebrowser",tip:"Image Browser",css:ir},Link:{name:"link",tip:"Link",css:nr,text:"Link"},FontName:{name:"fontname",tip:"Font Name",text:"Font Name",css:Kt},FontSize:{name:"fontsize",tip:"Font Size",text:"Font Size",css:Kt},BlockQuote:{name:"blockquote",tip:"Block Quote",css:ar},InsertCode:{name:"insertcode",tip:"Insert Code",css:fr}},Ns={Actions:["Save","","Undo","Redo","","Preview","Cleanup","","Cut","Copy","Paste","SelectAll"],Font:["FontName","FontSize","","BackColor","ForeColor","","Bold","Italic","UnderLine","StrikeThrough","SubScript","SuperScript","","Template","","RemoveFormat"],Paragraph:["","JustifyLeft","JustifyCenter","JustifyRight","JustifyFull","","Border","","NumberedList","BulletedList","","Outdent","Indent"],Review:["Inspect","Find"]},Cs={Tables:["Table","","InsertColumn","InsertRow","InsertCell","","SplitCell","MergeCell","","DeleteColumn","DeleteRow","DeleteCell"],Breaks:["InsertBreak","InsertParagraph","InsertPrint","InsertHR"],Forms:["","Form","","TextArea","TextBox","PasswordField","HiddenField","","Image","Button","","List","DropDownList","Radio","CheckBox"],Special:["Link","InsertImage","Media","InsertSpecialChar","InsertDate"]},ks=function(e){this.text=e,this.render=function(){return this.text}},Ls=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype.wijeditor=function(){this._curPageIdx=0,this.tRange=null,this.txtFoundInIE=!1,this.txtFoundInNoneIE=!1,this.rangeSelection=null},n.prototype._create=function(){var e=this,n=e.element.attr("id");window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r));if(e.element.is("input"))return;e.wijeditor();if(!n||n==="")e.element.uniqueId(),n=e.element.attr("id");e.id_prefix="wijeditor-"+n+"-",e.$ribbon=undefined,e.$modes=undefined,e._isIE11=r.browser.msie&&r.browser.version&&parseFloat(r.browser.version)>=11,e._isEdge=navigator.userAgent.indexOf("Edge/")>0,e._editorify(),e._initElements(),o.setTimeout(function(){e._isDisabled()&&e._handleDisabledOption(!0,e.editor)},40),e._continueSavingInputTextForUndo=!1,e.element.is(":hidden")&&e.editor.wijAddVisibilityObserver&&e.editor.wijAddVisibilityObserver(function(t){if(r.contains(e.editor[0],t.target))return;e.refresh(),e.editor.wijRemoveVisibilityObserver&&e.editor.wijRemoveVisibilityObserver()},"wijeditor"),t.prototype._create.call(this)},n.prototype._contextMenuWidgetName=function(){return"wijmenu"},n.prototype._createDropdownButton=function(e,t,n,i,s){var o=this,u=f.createElement("div",{title:e,"class":Kt}),a=f.createElement("ul");return u.add(f.createTextButton(e,t,n)),u.add(a),r.each(i,function(e,n){var i=f.createElement("li"),o=f.createTextRadioButton(n.tip,s,n.name,t,n.text);r.each(o,function(e,t){i.add(t)}),a.add(i)}),u},n.prototype._createSplitButton=function(e,t,n,i,s){var o=this,u=f.createElement("div",{title:e,"class":Qt}),a=f.createElement("ul");return u.add(f.createBigButton(e,t,n,i)),u.add(f.createElement("button",{"class":Jt})),u.add(a),r.each(s,function(e,t){var n=f.createElement("li");n.add(f.createButton(t.tip,t.css,t.name,t.text)),a.add(n)}),u},n.prototype._createButtonByCommand=function(e){var t=this,n,r=Ts[e],i,s,o,u,a;if(!r)return;a=r.name,i=a+"ButtonTip",s=a+"ButtonText",o=this.localizeString(i,r.tip),u=this.localizeString(s,r.text);switch(a){case Xt:case x:case T:case N:case C:case k:case L:case A:case O:case M:case _:case D:case P:case H:case B:case j:case F:case I:case q:case R:case ot:case ut:case at:case ft:case yt:case bt:case wt:case xt:case Tt:case Nt:case At:case gt:case G:case Y:case Et:case St:case kt:case Lt:case st:case Pt:case Vt:case lt:case Ct:n=f.createButton(o,r.css,a);break;case Ot:case Mt:n=f.createButton(o,r.css,a,u);break;case V:case rt:case it:case Z:case et:case nt:case tt:n=f.createImageCheckButton(o,t.id_prefix,r.css,a);break;case dt:case vt:case mt:case U:case z:case W:case X:case K:case Q:case $:case J:n=f.createImageRadioButton(o,t.id_prefix,r.css,a,r.grpname);break;case ct:n=t._createSplitButton(this.localizeString("tableButtonTip","Table"),On,ct,this.localizeString("tableButtonText","Table"),[{tip:this.localizeString("insertTableButtonTip","Insert Table"),css:Mn,name:ht,text:this.localizeString("insertTableButtonText","Insert")},{tip:this.localizeString("editTableButtonTip","Edit Table"),css:_n,name:pt,text:this.localizeString("editTableButtonText","Edit")}]);break;case _t:t.options.mode==="ribbon"?n=f.createBigButton(o,r.css,a,u):n=f.createButton(o,Zt,a);break;case Ht:t.options.mode==="ribbon"?n=f.createBigButton(o,r.css,a,u):n=f.createButton(o,rr,a);break;case zt:n=t._createDropdownButton(o,zt,u,t.options.fontNames||[],t.id_prefix);break;case Wt:n=t._createDropdownButton(o,Wt,u,t.options.fontSizes||[],t.id_prefix);break;case Dt:}return n},n.prototype._createGroup=function(e,t){var n=this,r=f.createElement("li"),i=n.localizeString(e.toLowerCase()+"Group",e);return n._createGroupButtons(r,t),r.add(f.createElement("div",i,{displayname:e})),r},n.prototype._createGroupButtons=function(e,t){var n=this,i,s=e,o;r.each(t,function(t,u){u===""?(s=e,i=f.createRibbonList(),s.add(i),s=i):(o=n._createButtonByCommand(u),r.isArray(o)&&o.length>0?r.each(o,function(e,t){s.add(t)}):s.add(n._createButtonByCommand(u)))})},n.prototype._getDefaultRibbonMarkup=function(){var e=this,t=f.createElement("div"),n=f.createElement("ul"),i=f.createElement("li"),s=f.createElement("li"),o=f.createElement("div",{id:e.id_prefix+"format"}),u=f.createElement("div",{id:e.id_prefix+"insert"}),a=f.createElement("ul"),l=f.createElement("ul"),c=e.localizeString("formatTab","Format"),h=e.localizeString("insertTab","Insert");return t.add(n),t.add(o),t.add(u),n.add(i),n.add(s),i.add(f.createElement("a",c,{href:"#"+e.id_prefix+"format"})),s.add(f.createElement("a",h,{href:"#"+e.id_prefix+"insert"})),o.add(a),r.each(Ns,function(t,n){a.add(e._createGroup(t,n))}),u.add(l),r.each(Cs,function(t,n){l.add(e._createGroup(t,n))}),t.render()},n.prototype._resetModesBtnTip=function(e,t){var n=this.element.find(".wijeditor-footer"),i=r(n.find("."+e));i.length>0&&(t.tip=i.attr("title")||t.tip)},n.prototype._getRibbonModesMarkup=function(){var e=this,t=f.createDiv(lr),n=f.createRibbonList(),r=e.element.find(".wijeditor-footer");return r.length>0&&(e._resetModesBtnTip(cr,Ts.Wysiwyg),e._resetModesBtnTip(pr,Ts.Split),e._resetModesBtnTip(hr,Ts.Code),e._resetModesBtnTip(dr,Ts.Wordwrap),e._resetModesBtnTip(vr,Ts.FullScreen),r.remove()),t.add(n),e._createGroupButtons(n,["Wysiwyg","Code","Split"]),e._createGroupButtons(t,["Wordwrap","FullScreen"]),t.render()},n.prototype._getSimpleToolBar=function(e){var t=this,n,i=f.createDiv("");return r.each(e,function(e,s){n=t._createButtonByCommand(s),n&&(r.inArray(s,Es)!==-1?r.each(n,function(e,t){i.add(t)}):i.add(n))}),i.render()},n.prototype._editorify=function(){var e=this,t=e.element,n=t.width(),i=t.height(),s=e.options,o=s.mode,u,a,f,l,c,h,p;e._oriStyle=t.attr("style"),e._oriContent=t.html(),e._oriEleWidth=n,e._oriEleHeight=i,t.is("textarea")?(o==="ribbon"?e.$ribbon=r(e._getDefaultRibbonMarkup()):o==="bbcode"?e.$ribbon=r(e._getSimpleToolBar(xs)):s.simpleModeCommands&&s.simpleModeCommands.length!==0?(f=r.grep(s.simpleModeCommands,function(e,t){return e!=="Table"},undefined),e.$ribbon=r(e._getSimpleToolBar(f))):e.$ribbon=r(e._getSimpleToolBar(Ss)),s.text&&t.val(s.text),e.sourceView=t,e.editor=t.wrap("<div></div>").parent(),e.editor.width(n).height(i)):(e.editor=t,e.$ribbon=t.children(":eq(0)"),h=t.children(":eq(1)"),h.is("textarea")?(s.text&&h.val(s.text),e.sourceView=h):(s.text?p=s.text:p=h.html(),h.remove(),e.sourceView=r("<textarea></textarea>").val(p))),u=r("<div class='"+gr+"'></div>"),e.dialog=r("<div class ='"+mr+"'></div>"),e.subDialog=r("<div class ='"+mr+"'></div>"),e.editor.addClass(mr).addClass(e.options.wijCSS.widget).append(u).append(e.dialog).append(e.subDialog),e._createMenuMarkUp(e,s),e.$ribbon.wrap("<a href='javascript:void(null)'></a>").parent().appendTo("<div class='"+yr+" ui-widget-header ui-helper-clearfix ui-corner-top'></div>").parent().appendTo(u),a=r("<div class='"+br+"'></div>").appendTo(u),e.designView=r("<iframe frameborder='0'></iframe>"),e.designView.wrap("<div></div>").parent().appendTo(a),e.sourceView.wrap("<div></div>").parent().appendTo(a),l=[e.$ribbon],e.$modes=r(e._getRibbonModesMarkup()),s.showFooter&&(c=r("<div class='"+wr+" "+"ui-widget ui-widget-content ui-state-default'></div>"),u.append(c),c.append("<div class='"+Er+"'></div>"),e.$modes.appendTo(c),l.push(e.$modes)),r.each(l,function(t,n){n.wijribbon({compactMode:e.options.compactRibbonMode,click:function(t,n){e._ribbonCommand(n.commandName,n.name),e._trigger("commandButtonClick",t,n)}})})},n.prototype._createMenuMarkUp=function(e,t){t.customContextMenu&&!r.browser.webkit&&(e.contextMenu=r("<ul><li _c1buttoncmd='cut'><a>"+this.localizeString("contextMenuCut","Cut")+"</a></li>"+"<li _c1buttoncmd='copy'><a>"+this.localizeString("contextMenuCopy","Copy")+"</a></li>"+"<li _c1buttoncmd='paste'><a>"+this.localizeString("contextMenuPaste","Paste")+"</a></li></ul>"),r("<a href='#'></a>").append(e.contextMenu).appendTo(e.editor))},n.prototype._handleDisabledOption=function(e,t){var n=this;e?(n.disabledDiv||(n.disabledDiv=n._createDisabledDiv(t)),r("body").focus(),n.disabledDiv.appendTo(n.editor)):n.disabledDiv&&(n.disabledDiv.remove(),n.disabledDiv=null)},n.prototype._createDisabledDiv=function(e){var t=this,n=e?e:t.element,i=n.outerWidth(),s=n.outerHeight();return r("<div></div>").addClass("ui-state-disabled").css({"z-index":"99999",position:"relative","background-color":"lightgray",width:i,height:s,left:0,top:-s})},n.prototype._initElements=function(){var e=this,t=e.options,n=e.editor.height()-e._getHeader().outerHeight(!0)-e._getFooter().outerHeight(!0),r={};e._getContent().height(n).wijsplitter({showExpander:!1,orientation:"horizontal",panel1:{scrollBars:"none",collapsed:!1},panel2:{scrollBars:"none",collapsed:!0}}),e.sourceView.css("width","").css("height",""),e._addHandlerToDesignView(),e._addDefaultFontStyleToDesignView(),e._createWijMenu(),(!t.showPathSelector||e.options.mode==="bbcode")&&e._getPathSelector().hide(),e._ribbonCommand(t.editorMode,null,!0),t.fullScreenMode&&e._setFullScreen(t.fullScreenMode),r[wt]=!0,r[bt]=!0,e.$ribbon.wijribbon(w,r),e._handleWinDocumentKeyDown()},n.prototype._handleWinDocumentKeyDown=function(){var e=this;r(document).bind("keydown."+e.widgetName+"."+e.id_prefix.replace(/-/g,""),function(t){if(e._isDisabled())return;switch(t.keyCode){case 27:e._escActionAssociated()}})},n.prototype._setOption=function(e,n){var i=this,s=i.options,o=s.mode,u=s.editorMode,a=s.compactRibbonMode,f=i.$ribbon.parent(),l=s.fullScreenMode,c=s.customContextMenu;t.prototype._setOption.call(this,e,n);if(e==="fullScreenMode")n!==l&&i._setFullScreen(n);else if(e==="showPathSelector")n?(i._getPathSelector().show(),i._refreshPathSelector()):i._getPathSelector().hide();else if(e==="editorMode"&&u!==n)i._ribbonCommand(n),i.$modes.data("wijmo-wijribbon")&&i.$modes.wijribbon(E,u,!1);else if(e==="fullScreenContainerSelector")i.options.fullScreenMode&&i._setFullScreen(!0);else if(e==="showFooter")n?r("."+wr).is(":visible")||r("."+wr).show():r("."+wr).is(":visible")&&r("."+wr).hide();else if(e==="commandButtonClick")s.commandButtonClick=n;else if(e==="text")i.setText(n);else if(e==="customContextMenu"){if(c===n)return;n?(i.contextMenu||i._createMenuMarkUp(i,s),i._createWijMenu()):(i.contextMenu[i._contextMenuWidgetName()]("destroy").remove(),i.contextMenu=undefined)}else e==="mode"&&n!==o||e==="compactRibbonMode"&&n!==a?(i._recreateRibbon(s.mode),i._ribbonCommand(s.editorMode)):(e==="fontNames"||e==="fontSizes")&&i._recreateRibbon(s.mode)},n.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._handleDisabledOption(!0,this.editor)},n.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._handleDisabledOption(!1,this.editor)},n.prototype._recreateRibbon=function(e){var t=this,n=t.$ribbon.parent();t.$ribbon.wijribbon("destroy"),t.$ribbon.remove(),e==="ribbon"?t.$ribbon=r(t._getDefaultRibbonMarkup()):e==="bbcode"?t.$ribbon=r(t._getSimpleToolBar(xs)):t.$ribbon=r(t._getSimpleToolBar(Ss)),n.append(t.$ribbon),t.$ribbon.wijribbon({compactMode:t.options.compactRibbonMode,click:function(e,n){t._ribbonCommand(n.commandName,n.name),t._trigger("commandButtonClick",e,n)}})},n.prototype._getHeader=function(){return r("."+yr,this.editor)},n.prototype._getContent=function(){return r("."+br,this.editor)},n.prototype._getFooter=function(){return r("."+wr,this.editor)},n.prototype._getPathSelector=function(){return r("."+Er,this.editor)},n.prototype._getModes=function(){return r("."+lr,this.editor)},n.prototype._getDesignView=function(){return this.designView},n.prototype._getDesignViewWindow=function(){var e=this.designView;return e&&e.length>0?e[0].contentWindow:null},n.prototype._getDesignViewDocument=function(){var e=this._getDesignViewWindow();return e?e.document:null},n.prototype._getDesignViewText=function(){var e=this._getDesignViewDocument();return e&&e.body&&e.body.innerHTML?e.body.innerHTML:""},n.prototype._setDesignViewText=function(e){var t=this,n=this._getDesignViewDocument();this.options.mode==="bbcode"&&(e=t._convertBBCodeToHtml(e)),n&&n.body&&(n.body.innerHTML=e),t.options.text=e},n.prototype._getDialog=function(){return this.dialog},n.prototype._getSubDialog=function(){return this.subDialog},n.prototype._initContentDocument=function(){var e=this,t=e.sourceView.val(),n=e._getDesignViewDocument(),i=e.options.tableVirtualBorderShowing,s=function(){e.designView.load(function(){try{e._addHandlerToDesignView(),e._addDefaultFontStyleToDesignView(),e._createWijMenu()}catch(t){}})};if(t!==""&&t===e._getDesignViewText())return;e.options.mode==="bbcode"&&(t=e._convertBBCodeToHtml(r.trim(t))),e.designView.unbind("load"),n.open(),n.write('<html style="width:100%;height:100%;'+(e.options.enabled?"cursor:text;":"")+'"><head><title></title><style id="__wijStyle" '+' type="text/css" >table,td,tr{border: 1px #acacac dashed;}'+'</style></head><body style="word-wrap:break-word">'+t+"</body></html>"),n.close(),i||(e._updateTableBorderShowing(i),e.$ribbon.wijribbon(E,V,!i)),e.element.attr("accesskey")&&(r(n.body).attr("accesskey",e.element.attr("accesskey")),e.element.removeAttr("accesskey")),g=[],g.push(t),m=0,s()},n.prototype._addHandlerToDesignView=function(){var e=this,t=e._getDesignViewWindow(),n=t.document;e._initContentDocument(),e._loadDesignView(),r.browser.msie&&r(n).unbind("beforedeactivate").bind("beforedeactivate",function(){e._saveSelectionForIE()})},n.prototype._loadDesignView=function(){var e=this,t=e._getDesignViewWindow(),n=t.document;r.browser.mozilla?setTimeout(e._setDesignModeForFF,1e3,e):e._setContentEditable(n,!0),r.browser.msie&&e._setContentSpellCheck(n,!1),e.sourceView.unbind("blur."+e.widgetName).bind("blur."+e.widgetName,function(t){e._onSourceViewBlur()}),e.sourceView.unbind("keyup."+e.widgetName).bind("keyup."+e.widgetName,function(t){e._onSourceViewBlur()}),r.browser.mozilla?r(n).unbind("blur."+e.widgetName).bind("blur."+e.widgetName,function(t){e._onDesignViewBlur(t)}):r(t).blur(function(t){e._onDesignViewBlur(t)}),r(n).unbind("mouseup."+e.widgetName).bind("mouseup."+e.widgetName,function(t){e._onDesignViewMouseUp(t)}).unbind("keydown."+e.widgetName).bind("keydown."+e.widgetName,function(t){e._onDesignViewKeyDown(t)}).unbind("keyup."+e.widgetName).bind("keyup."+e.widgetName,function(t){e._onDesignViewKeyUp(t),e._onDesignViewBlur(t)})},n.prototype._addDefaultFontStyleToDesignView=function(){var e=this,t=e.options,n=e._getDesignViewDocument(),i=t.defaultFontName,s=t.defaultFontSize,o='<style type="text/css"> body {';if(!(i!==""&&i!==null||s!==""&&s!==null))return;i!==""&&i!==null&&(o+="font-family: "+i+";"),t.defaultFontSize!==""&&t.defaultFontSize!==null&&(o+=" font-size: "+s+";"),o+="}</style>",window.setTimeout(function(){r(o).appendTo(r("head",n))},200),e._setFontStyleButtonState(i,zt),e._setFontStyleButtonState(s,Wt)},n.prototype._setFontStyleButtonState=function(e,t){var n="";if(!e||e===null)return;r.each(this.$ribbon.wijribbon("getDropdownList",t),function(t,r){if(r.toUpperCase()===e.toUpperCase())return n=t,!1}),this.$ribbon.wijribbon(E,n,!0,t)},n.prototype._setDesignModeForFF=function(e){var t=e._getDesignViewDocument();t&&(t.designMode="on")},n.prototype.destroy=function(){var e=this;e.element.html(e._oriContent),e.element.removeAttr("tabindex"),e._oriStyle===undefined?e.element.removeAttr("style"):e.element.attr("style",e._oriStyle),e.dialog&&e.dialog.remove(),e.element.insertBefore(e.editor),e.element.unbind("."+e.widgetName),r(document).unbind("."+e.widgetName+"."+e.id_prefix.replace(/-/g,"")),e.element.removeUniqueId(),e.editor.remove(),e._oriDocOverFlow&&r(document.documentElement).css({overflow:e._oriDocOverFlow}),r.Widget.prototype.destroy.call(e)},n.prototype.showEditorDialog=function(e){switch(e){case ht:case st:case Pt:case Mt:case Ot:case Lt:case kt:case St:case Ht:case G:case Y:case Vt:this._ribbonCommand(e);break;default:s(this.localizeString("notFindCommandError","Cannot find the dialog with command name '")+e+"'!")}},n.prototype.executeEditorAction=function(e,t){this._ribbonCommand(e,t)},n.prototype._isFontSizeCustomized=function(){if(d!==null)return d;var e=this.$ribbon.wijribbon("getDropdownList",Wt),t=[Bt,jt,Ft,It,qt,Rt,Ut];return d=!1,r.each(e,function(e,n){if(r.inArray(e,t)===-1)return d=!0,!1}),d},n.prototype._fontSizeCommand=function(e){var t=this,n=t._getDesignViewDocument(),i,s=4,o="font-size",u=[];t._getDesignViewWindow().getSelection&&(i=t._getDesignViewWindow().getSelection());switch(e){case Bt:s=1;break;case jt:s=2;break;case Ft:s=3;break;case It:s=4;break;case qt:s=5;break;case Rt:s=6;break;case Ut:s=7}t._setIEFocus(),t._isFontSizeCustomized()?t._formatFontSpan(n,o,e):r.browser.msie&&a(r.browser.version)>=9?i&&i.rangeCount>0&&n.execCommand("FontSize",!1,s):n.execCommand("FontSize",!1,s),t.options.mode==="bbcode"&&!r.browser.msie&&t._convertFontStyleToStandTag(),t._addtoUndoBuffer()},n.prototype._fontNameCommand=function(e){var t=this,n=t._getDesignViewDocument(),i,s=t.$ribbon.wijribbon("getDropdownList",zt),o;t._getDesignViewWindow().getSelection&&(i=t._getDesignViewWindow().getSelection()),r.each(s,function(t,n){if(e===t)return o=n,!1}),t._setIEFocus(),r.browser.msie&&a(r.browser.version)>=9?i&&i.rangeCount>0&&n.execCommand("FontName",!1,o):n.execCommand("FontName",!1,o),t._isFontSizeCustomized()&&r.browser.msie&&t._formatFontSpan(n,"font-family",o),t._addtoUndoBuffer()},n.prototype._formatFontSpan=function(e,t,n){var i=this,s=n,o="fontFamily",u=[];t!=="font-family"&&(s="c1-temp",o="fontSize"),e.execCommand("FontName",!1,s),r.each(r("font[face='"+s+"']",e),function(e,s){var a=i._replaceFontWithSpan(r(s),"face",t,n),f,l;u.push(a),f=r("span."+ms,a);for(l=f.length-1;l>=0;l--)i._removeSpecifiedStyleSpan(r(f[l]),o,t);r.each(a,function(e,n){r.each(r(n).parents("span."+ms),function(e,s){var u=r(s);if(u.children().length>1)return!1;u.text()===r(n).text()&&i._removeSpecifiedStyleSpan(u,o,t)})})}),i._setSelection(u)},n.prototype._replaceFontWithSpan=function(e,t,n,r){e.wrap("<span class = '"+ms+"' style='"+n+":"+r+"'></span>");var i=e.parent();return e.removeAttr(t),/<font\s*>/ig.test(i.html())&&(i.html(e.html()),e.remove()),i},n.prototype._removeSpecifiedStyleSpan=function(e,t,n){var i,s=!0;e[0].style[t]!==""&&e.css(n,""),i=e.attr("style"),i&&r.each(i.split(";"),function(e,t){var i=r.trim(t).toLowerCase();if(i!==""&&i.indexOf(n)!==-1)return s=!1,!1}),s&&e.replaceWith(e.html())},n.prototype._removeFormat=function(){var e=this,t=e._getDesignViewDocument(),n={};t.execCommand(ot,!1,null),e._isFontSizeCustomized()&&r.browser.msie&&e._removeFormatForIE(t),e._addtoUndoBuffer(),n[Z]=!1,n[et]=!1,n[tt]=!1,n[nt]=!1,n[rt]=!1,n[it]=!1,n[$]=!1,n[J]=!1,n[U]=!1,n[z]=!1,n[W]=!1,n[X]=!1,e.$ribbon.wijribbon(S,n)},n.prototype._removeFormatForIE=function(e){var t=this._getIESelectionRange(),n=this._getSelectedContent(),i=this._getSelectedContent(!0),s=0,o=e.getSelection(),u=this._isIE11?o&&o.anchorNode&&o.anchorNode.parentNode?r(o.anchorNode.parentNode):null:r(t.parentElement()),a=r(e.body),f="",l="",c="__c1temp",h="c1-temp",p="<span class='"+h+"'>"+c+"</span>",d,v,m,g,y,b,w;u.addClass("c1-app-parent"),this._isIE11?(t.deleteContents(),w=t.createContextualFragment(p),t.insertNode(w),t.collapse(!1)):t.pasteHTML(p),s=a.text().indexOf(c),d=r("span."+h,e),v=d,d.parentsUntil("body").each(function(e){if(r(this).is(".c1-app-parent"))return!1;v=r(this)}),d.html(n),m=r("span."+ms,d);for(y=m.length-1;y>=0;y--)g=r(m[y]),g.replaceWith(g.html());v.is("."+h)||v.after(d),r.each(v.parents("span."+ms),function(e,t){f+="</span>",l="<span class='"+ms+"' style = '"+r(t).attr("style")+"'>"+l}),n=d.html(),d.replaceWith(c),b=a.html().split(c),a.html(b[0]+f+n+l+b[1]),m=r("span."+ms,e);for(y=m.length-1;y>=0;y--)g=r(m[y]),g.text()===""&&g.replaceWith(g.html());r(".c1-app-parent",e).removeClass("c1-app-parent"),this._setSelection(null,s,i.length)},n.prototype._toggleFullScreen=function(){var e=this,t=e.options;t.fullScreenMode=!t.fullScreenMode,e._setFullScreen(t.fullScreenMode),e.$modes.wijribbon(E,yt,t.fullScreenMode),e.$modes.wijribbon("removeButtonHoverState",yt)},n.prototype._setFullScreen=function(e){var t=this,n=1,i=t._getHeader(),s=t._getFooter(),u=t._getContent(),a=t.options.fullScreenContainerSelector,f=r(a),p=t._getDesignViewText(),d,v,m;e?(f.length===0&&(f=r(o),a="body",t._oriDocOverFlow=r(document.documentElement).css("overflow"),r(document.documentElement).css({overflow:"hidden"}),r.browser.mozilla||window.scrollTo(0,0),r(o).bind("resize.wijeditor",function(){t._fullscreenOnWindowResize()})),d=f.width(),v=f.height()-2*n,l=t.editor.width(),c=t.editor.height(),h||(h=t.editor.parent()),t._replacedDiv||(t._replacedDiv=r("<div />")),t.editor.after(t._replacedDiv),r(a).append(t.editor),t.editor.css({width:d,height:v,position:""}).addClass(Sr),t.$ribbon.wijribbon("updateRibbonSize")):(t._replacedDiv.after(t.editor).remove(),t.editor.css({width:l,height:c,position:"static"}).removeClass(Sr),t.options.fullScreenContainerSelector||r(document.documentElement).css({overflow:t._oriDocOverFlow}),r(o).unbind("resize.wijeditor"),t.$ribbon.wijribbon("updateRibbonSize")),t.disabledDiv&&(e?t.disabledDiv.css({position:"fixed",width:"",height:"",left:0,top:0,right:0,bottom:0}):t.disabledDiv.css({position:"relative",width:t.editor.outerWidth(),height:t.editor.outerHeight(),left:0,top:-t.editor.outerHeight(),right:"",bottom:""})),m=t.editor.height()-i.outerHeight(!0)-s.outerHeight(!0),u.height(m).wijsplitter("refresh"),t.$modes.data("wijmo-wijribbon")&&t.$modes.wijribbon(E,yt,e)},n.prototype._createWijMenu=function(){var e=this,t=e._getDesignViewDocument();e.contextMenu&&e.contextMenu[e._contextMenuWidgetName()]({orientation:"vertical",trigger:e.designView,triggerEvent:"rtclick",showing:function(t,n){r.browser.msie&&e._saveSelectionForIE();var i=e.designView.offset(),s=r(r(e.designView)[0].contentWindow).scrollLeft(),o=r(r(e.designView)[0].contentWindow).scrollTop(),u=i.left+2-s,a=i.top-o;n.options.position={my:"left+"+u+" "+"top+"+a,at:"right top",of:t,collision:"none none"}},animation:{animated:"fade"},select:function(t,n){e._setIESelection(),e._contextMenuItemClick(t,n),e.contextMenu[e._contextMenuWidgetName()]("deactivate")}})},n.prototype._fullscreenOnWindowResize=function(){var e=this,t=e._getHeader(),n=e._getFooter(),i=e._getContent(),s,o=r(window).width(),u=r(window).height();e.editor.css({width:o,height:u}),s=e.editor.height()-t.height()-n.height(),i.height(s),i.data("wijmo-wijsplitter")&&i.wijsplitter("refresh")},n.prototype._saveText=function(e){},n.prototype._doSpellCheck=function(){},n.prototype._ribbonCommand=function(e,t,n){var i=this,s=i._isDisabled(),o=i._getDesignViewDocument(),u=i._getContent(),a,f=u.height()/2,l,c,h;if(t===zt){i._fontNameCommand(e),i._onDesignViewBlur(null);return}if(t===Wt){i._fontSizeCommand(e),i._onDesignViewBlur(null);return}!i.editor.hasClass("ui-helper-hidden-accessible")&&!s&&(n?setTimeout(function(){i._setIEFocus()},0):r.browser.msie&&i.focus());switch(e){case Xt:r.browser.msie?(o.execCommand("FormatBlock",!1,"<ADDRESS>"),i._isIE11&&o.getSelection?(a=o.getSelection(),a&&a.anchorNode&&(h=r(a.anchorNode).closest("address"))):(h=o.selection.createRange(),h=r(h.parentElement()).closest("address")),h.length&&(h.replaceWith("<blockquote>"+h.html()+"</blockquote>"),o.body.innerHTML=o.body.innerHTML.replace(/<BLOCKQUOTE>\s*?<BLOCKQUOTE>/gi,"<BLOCKQUOTE>"),o.body.innerHTML=o.body.innerHTML.replace(/<\/BLOCKQUOTE>\s*?<\/BLOCKQUOTE>/gi,"</BLOCKQUOTE>"),o.body.innerHTML=o.body.innerHTML.replace(/<BLOCKQUOTE>\s*?<\/BLOCKQUOTE>/gi,""))):o.execCommand("FormatBlock",!1,"<BLOCKQUOTE>"),i._addtoUndoBuffer(),i._setFocusNotIE();break;case x:l=i._generateUniqueName("form"),i.insertHTML('<form id="'+l+'" name="'+l+'" method="post">'+l+"</form>"),i._setFocusNotIE();break;case T:l=i._generateUniqueName("image"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="image"'+' value="'+l+'"/>'),i._setFocusNotIE();break;case N:l=i._generateUniqueName("textarea"),i.insertHTML('<textarea id="'+l+'" name="'+l+'" rows="4" cols="48"></textarea>'),i._setFocusNotIE();break;case C:l=i._generateUniqueName("button"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="button"'+' value="'+l+'"/>'),i._setFocusNotIE();break;case k:l=i._generateUniqueName("textbox"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="text"'+' value="'+l+'"/>'),i._setFocusNotIE();break;case L:l=i._generateUniqueName("list"),i.insertHTML('<select id="'+l+'" name="'+l+'" style="width: 120px" size="8"></select>'),i._setFocusNotIE();break;case A:l=i._generateUniqueName("password"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="password" value="'+l+'"/>'),i._setFocusNotIE();break;case O:l=i._generateUniqueName("dropdown"),i.insertHTML('<select id="'+l+'" name="'+l+'"></select>'),i._setFocusNotIE();break;case M:l=i._generateUniqueName("hidden"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="hidden" value="'+l+'" />'),i._setFocusNotIE();break;case _:l=i._generateUniqueName("radiobox"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="radio"'+' value="'+l+'">'+'<label for="'+l+'">'+l+"</label></input>"),i._setFocusNotIE();break;case D:l=i._generateUniqueName("checkbox"),i.insertHTML('<input id="'+l+'" name="'+l+'" type="checkbox"'+' value="'+l+'">'+'<label for="'+l+'">'+l+"</label></input>"),i._setFocusNotIE();break;case P:case H:case B:case j:case F:case I:case q:case R:i._tableAction(e);break;case V:i._toggleTableBorders();break;case rt:try{o.queryCommandState(it)&&(o.execCommand(it,!1,null),i.$ribbon.wijribbon(E,it,!1))}catch(p){}o.execCommand(rt,!1,null),i._addtoUndoBuffer(),i._setFocusNotIE();break;case it:try{o.queryCommandState(rt)&&(o.execCommand(rt,!1,null),i.$ribbon.wijribbon(E,rt,!1))}catch(d){}o.execCommand(it,!1,null),i._addtoUndoBuffer(),i._setFocusNotIE();break;case ot:i._removeFormat(),i._setFocusNotIE();break;case ut:i.insertHTML("<br/>"),i._setFocusNotIE();break;case at:c=i._getSelectedContent();if(!c||c==="")c="&nbsp;";i.insertHTML("<p>"+c+"</p>"),i._setFocusNotIE();break;case ft:i.insertHTML('<div title="Print Page Break" style="font-size:1px;page-break-before:always;vertical-align:middle;height:1px;background-color:#c0c0c0">&nbsp;</div>'),i._setFocusNotIE();break;case yt:i._storeSelectionForIE(),i._toggleFullScreen();break;case bt:i._undoAction(),i._setFocusNotIE();break;case wt:i._redoAction(),i._setFocusNotIE();break;case xt:i._execCut(),i._setFocusNotIE();break;case Tt:i._execCopy();break;case Nt:i._execPaste();break;case At:i.insertDateAndTime(),i._setFocusNotIE();break;case dt:i.$modes.data("wijmo-wijribbon")&&i.$modes.wijribbon(b,gt,!0).wijribbon(E,dt,!0),i.$ribbon.wijribbon("option","disabled",!1),u.wijsplitter("option","panel2",{collapsed:!0}),i._restoreSelectionForIE();break;case vt:i.$modes.data("wijmo-wijribbon")&&i.$modes.wijribbon(b,gt,!0).wijribbon(E,vt,!0),i.$ribbon.wijribbon("option","disabled",!1),u.wijsplitter("option",{splitterDistance:f,panel1:{collapsed:!1},panel2:{collapsed:!1}}),i._restoreSelectionForIE();break;case mt:i.$modes.data("wijmo-wijribbon")&&i.$modes.wijribbon(b,gt,!1).wijribbon(E,mt,!0),i._storeSelectionForIE(),i.$ribbon.wijribbon("option","disabled",!0),u.wijsplitter("option","panel1",{collapsed:!0}),r.browser.msie&&!s&&i.sourceView.focus();break;case gt:u.wijsplitter("option","panel1").collapsed&&i._toggleWordWrap();break;case G:i._saveSelectionForIE(),i._createDialog(this.localizeString("backColorDialogTitle","Set BackColor"),i._getDialogRes_BackColor(),i.initBackColorDialog);break;case Y:i._saveSelectionForIE(),i._createDialog(this.localizeString("foreColorDialogTitle","Set ForeColor"),i._getDialogRes_ForeColor(),i.initForeColorDialog);break;case ht:i._saveSelectionForIE(),i._createDialog(this.localizeString("insertTableDialogTitle","Insert Table"),i._getDialogRes_Table(),i.initInsertTableDialog);break;case pt:i._getEditableTable()&&i._createDialog(this.localizeString("editTableDialogTitle","Edit Table"),i._getDialogRes_Table(),i.initEditTableDialog);break;case Et:i._createDialog(this.localizeString("previewDialogPreview","Preview"),i._getDialogRes_Preview(),i.initPreviewDialog);break;case St:i._createDialog(this.localizeString("cleanUpDialogTitle","Clean up source HTML document"),i._getDialogRes_CleanUp(),i.initCleanUpDialog);break;case kt:i._saveSelectionForIE(),i._createDialog(this.localizeString("mediaDialogTitle","Insert media"),i._getDialogRes_Media(),i.initMediaDialog);break;case Lt:i._saveSelectionForIE(),i._createDialog(this.localizeString("specialCharacterDialogTitle","Insert special character"),i._getDialogRes_SpecialCharacter(),i.initSpecialCharacterDialog);break;case Ot:i._createDialog(this.localizeString("findAndReplaceDialogTitle","Find and replace"),i._getDialogRes_FindAndReplace(),i.initFindDialog);break;case Mt:y=i._getSelectedElement(),i._createDialog(this.localizeString("tagInspectorDialogTitle","Tag Inspector"),i._getDialogRes_TagInspector(),i.initTagInspectorDialog);break;case st:i._saveSelectionForIE(),i._createDialog(this.localizeString("templateDialogApplyTemplate","Apply Template"),i._getDialogRes_Template(),i.initTemplateDialog);break;case Pt:i._saveSelectionForIE(),i._createDialog(this.localizeString("imageEditorDialogImageBrowser","Image Browser"),i._getDialogRes_ImageBrowser(),i.initImageBrowserDialog);break;case Ht:i._storeSelectionForIE(),i._createDialog(this.localizeString("hyperLinkDialogInserthyperLink","Insert hyperLink"),i._getDialogRes_Link(),i.initHyperLinkDialog);break;case Vt:i._saveSelectionForIE(),i._createDialog(this.localizeString("insertCodeDialogInsertCode","Insert Code"),i._getDialogRes_Code(),i.initInsertCodeDialog);break;case U:case z:case W:case X:case K:case Q:case Z:case et:case nt:case $:case J:case tt:case lt:case Ct:o.execCommand(e,!1,null),i.options.mode==="bbcode"&&!r.browser.msie&&i._convertStyleToStandTag(),i._addtoUndoBuffer(),i._setFocusNotIE();break;case _t:i._saveText();break;case Dt:i._doSpellCheck()}e!==yt&&o&&o.readyState==="complete"&&i._onDesignViewBlur(null)},n.prototype._createDialog=function(e,t,n){var i=this,s,o=i.dialog;o.html("").undelegate(i.widgetName).undelegate("."+i.widgetName).append(t),i.subDialog&&i.subDialog.html("").undelegate(i.widgetName).undelegate("."+i.widgetName),s={width:"auto",height:"auto",modal:!0,title:e,position:{my:"center",at:"center",of:window},resizable:!1,captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}}},o.data("wijmo-wijdialog")?(o.wijdialog("reset"),o.wijdialog("option",{width:"auto",height:"auto",title:e})):r.browser.msie&&a(r.browser.version)===6?window.setTimeout(function(){o.wijdialog(s)},0):o.wijdialog(s),i._adjustDialogLayoutForIE7(),n&&n.call(i),o.wijdialog("open")},n.prototype._adjustDialogLayoutForIE7=function(){var e=this.dialog;r.browser.msie&&(/^7\.[0-9]+/.test(r.browser.version)||document.documentMode===7)&&e.wijdialog("option","width",e.parent().width())},n.prototype._contextMenuItemClick=function(e,t,n){var r=this,i=t.item.element.attr("_c1buttoncmd");switch(i){case xt:r._execCut();break;case Tt:r._execCopy();break;case Nt:r.focus(),r._execPaste()}},n.prototype._execCut=function(){var e=this,t=e._getDesignViewDocument();r.browser.safari?s(this.localizeString("errorMessageCutError","This function is not supported in current browser.  Plesse use (Ctrl + X).")):r.browser.msie?(t.execCommand("Cut",!1,null),e._addtoUndoBuffer()):(e._execCopy(),e._deleteSelectionContent(),e._addtoUndoBuffer())},n.prototype._execCopy=function(){var e=this,t=e._getDesignViewDocument();r.browser.safari?s(this.localizeString("errorMessageCopyError","This function is not supported in current browser. Plesse use (Ctrl + C).")):r.browser.msie?(t.execCommand("Copy",!1,null),e._addtoUndoBuffer()):e._copyToClipboard(e._getSelectedContent())},n.prototype._execPaste=function(){var e=this,t,n=e._getDesignViewDocument();if(r.browser.safari)s(this.localizeString("errorMessagePasteError","This function is not supported in current browser. Plesse use (Ctrl + V)."));else if(r.browser.msie)n.execCommand("Paste",!1,null),e._addtoUndoBuffer();else try{t=e._copyFromClipboard(),t&&t!==""&&e.insertHTML(t)}catch(i){}},n.prototype._getFontSizeCollection=function(){return{"10px":Bt,"13px":jt,"16px":Ft,"18px":It,"24px":qt,"32px":Rt,"48px":Ut,1:Bt,2:jt,3:Ft,4:It,5:qt,6:Rt,7:Ut}},n.prototype._updateButtonStates=function(e){var t=this,n=t._getDesignViewDocument(),i,s,o={},u=[Z,et,tt,nt,rt,it,$,J,U,z,W,X],a,f=e.target,l=r(f);r.each(u,function(e,t){o[t]=n.queryCommandState(t)}),t.$ribbon.wijribbon(S,o),i=t._queryCommandValue(zt)||"",r.each(t.$ribbon.wijribbon("getDropdownList",zt),function(e,t){if(t.toUpperCase()===i.toUpperCase())return s=e,!1}),t.$ribbon.wijribbon(E,s,!0,zt),t._isFontSizeCustomized()?(l.is("span")?s=f.style.fontSize:s="",s===""&&(a=l.parents("span."+ms),r.each(a,function(e,t){s=t.style.fontSize;if(s&&s!=="")return!1})),s===""&&(s=l.css("font-size"))):(i=t._queryCommandValue(Wt)||"",i===""&&(i=l.css("font-size")),r.each(t._getFontSizeCollection(),function(e,t){if(e.toString()===i.toString())return s=t,!1})),t.$ribbon.wijribbon(E,s,!0,Wt)},n.prototype._queryCommandValue=function(e){var t=this._getDesignViewDocument();try{if(!t.queryCommandEnabled(e))return null}catch(n){return null}try{return t.queryCommandValue(e)}catch(r){}return null},n.prototype._escActionAssociated=function(){var e=this,t=e._getDesignViewWindow();t&&t.document&&t.document.selection!==undefined&&t.document.selection.empty(),t&&t.getSelection!==undefined&&t.getSelection().removeAllRanges(),e._hideAllDropdownsMenus()},n.prototype._hideAllDropdownsMenus=function(){var e=this;e.contextMenu&&e.contextMenu[e._contextMenuWidgetName()]("hideAllMenus"),e.$ribbon.wijribbon("hideDropdown",zt).wijribbon("hideDropdown",Wt).wijribbon("hideDropdown",ct)},n.prototype._onDesignViewKeyDown=function(e){var t=this,n;t._setSaveBtnEnabled();try{if(e.ctrlKey)n=String.fromCharCode(e.keyCode).toLowerCase();else switch(e.keyCode){case 27:t._escActionAssociated();break;case 13:case 46:t._addtoUndoBuffer(),t._continueSavingInputTextForUndo=!1;break;default:t._continueSavingInputTextForUndo=!0}}catch(r){}},n.prototype._onDesignViewKeyUp=function(e){var t=this,n;if(e.keyCode===37||e.keyCode===38||e.keyCode===39||e.keyCode===40||e.keyCode===33||e.keyCode===34||e.keyCode===35||e.keyCode===36)r.browser.msie&&r.browser.version==="6.0"?(t._keyTimeoutHandlerIE6&&(clearTimeout(t._keyTimeoutHandlerIE6),t._keyTimeoutHandlerIE6=null),t._keyTimeoutHandlerIE6=window.setTimeout(function(){t._updateButtonStates(e)},300)):t._updateButtonStates(e);if(e.ctrlKey){n=String.fromCharCode(e.keyCode).toLowerCase();switch(n){case"y":t._redoAction(),e.preventDefault(),e.stopPropagation();break;case"z":t._undoAction(),e.preventDefault(),e.stopPropagation();break;case"x":case"v":t._addtoUndoBuffer(),t._continueSavingInputTextForUndo=!1}}},n.prototype._onDesignViewMouseUp=function(e){var t=this,n;if(e.button===2)return;t._updateButtonStates(e),t.options.showPathSelector&&t._refreshPathSelector(),t._hideAllDropdownsMenus(),t.editor.mouseup();if(r.browser.msie){n=r(e.target).closest("a");if(e.ctrlKey&&n.length>0)try{n.focus(),o.open(n[0].href,"_blank")}catch(i){}}},n.prototype._onDesignViewBlur=function(e){var t=this,n=t.options,i;i=t._getDesignViewText(),n.mode==="bbcode"&&(i=t._convertHtmlToBBCode(r.trim(i))),t.sourceView.val(i),t._onTextChange(e),n.text=i},n.prototype._onTextChange=function(e){var t=this;t._continueSavingInputTextForUndo&&(t._addtoUndoBuffer(),t._continueSavingInputTextForUndo=!1),t._trigger("textChanged",e,{text:t.options.text})},n.prototype._onSourceViewBlur=function(){var e=this,t;t=e.sourceView.val(),e._setDesignViewText(t),e.options.text=t},n.prototype._convertBBCodeToHtml=function(e){return e?(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),r.browser.msie&&(e=e.replace(/&lt;p&gt;/gim,"<p>"),e=e.replace(/&lt;\/p&gt;/gim,"</p>")),e=e.replace(/(?:\r\n|\n|\r)/g,"<br>"),e=e.replace(/\[EMAIL\]([\s\S]*?)\[\/EMAIL\]/gim,'<a href="mailto:$1">$1</a>'),e=e.replace(/\[EMAIL\=([^\]]+)]([\s\S]*?)\[\/EMAIL\]/gim,'<a href="mailto:$1">$2</a>'),e=e.replace(/\[URL\]([\s\S]*?)\[\/URL\]/gim,'<a href="$1">$1</a>'),e=e.replace(/\[URL\=([^\]]+)]([\s\S]*?)\[\/URL\]/gim,'<a href="$1">$2</a>'),e=e.replace(/\[B\]/gim,"<b>"),e=e.replace(/\[\/B\]/gim,"</b>"),e=e.replace(/\[I\]/gim,"<i>"),e=e.replace(/\[\/I\]/gim,"</i>"),e=e.replace(/\[S\]/gim,"<strike>"),e=e.replace(/\[\/S\]/gim,"</strike>"),e=e.replace(/\[U\]/gim,"<u>"),e=e.replace(/\[\/U\]/gim,"</u>"),e=e.replace(/\[IMG height=(.*?) width=(.*?)](.+?)\[\/IMG\]/gim,'<img height="$1" width = "$2" src="$3"/>'),e=e.replace(/\[BLOCK\]/gim,"<blockquote>"),e=e.replace(/\[\/BLOCK\]/gim,"</blockquote>"),e=e.replace(/\[LIST\=1\]\[\*\]([\s\S]*?)\[\/LIST\]/gim,"<ol><li>$1</li></ol>"),e=e.replace(/\[LIST\]\[\*\]([\s\S]*?)\[\/LIST\]/gim,"<ul><li>$1</li></ul>"),e=e.replace(/\[\*\]/gim,"</li><li>"),e=e.replace(/\[size=([^\]]*?)\]/gi,'<font size="$1">'),e=e.replace(/\[\/size\]/gim,"</font>"),e=e.replace(/\[color=([^\]]*?)\]/gi,'<font color="$1">'),e=e.replace(/\[\/color\]/gim,"</font>"),e):""},n.prototype._replaceComplexHtml=function(e){var t,n,i,s,o=r("<div/>").html(e);t=r("img",o),r.each(t,function(){i="[IMG height="+r(this).height()+" width="+r(this).width()+"]"+r(this).attr("src").toString()+"[/IMG]",r(this).replaceWith(i)}),n=r("font",o);for(s=n.length-1;s>=0;s--)r(n[s]).attr("color")&&r(r(n[s])).attr("size")?i="[Color="+r(r(n[s])).attr("color")+"]"+"[Size="+r(r(n[s])).attr("size")+"]"+r(r(n[s])).html()+"[/Size][/Color]":r(r(n[s])).attr("color")&&!r(r(n[s])).attr("size")?i="[Color="+r(r(n[s])).attr("color")+"] "+r(r(n[s])).html()+"[/Color]":r(r(n[s])).attr("size")&&!r(r(n[s])).attr("color")&&(i="[Size="+r(r(n[s])).attr("size")+"]"+r(r(n[s])).html()+"[/Size]"),r(r(n[s])).replaceWith(i);return o.html()},n.prototype._convertHtmlToBBCode=function(e){var t=this;if(e==="")return;return e=t._replaceComplexHtml(e),e=e.replace(/<br(?=[ \/>]).*?>/gim,"\r\n"),r.browser.msie&&(e=e.replace(/<p>/gim,"&lt;p&gt;"),e=e.replace(/<\/p>/gim,"&lt;/p&gt;")),e=e.replace(/<a .*?href=(["'])(.+?)\1.*?>(.+?)<\/a>/gi,"[URL=$2]$3[/URL]"),e=e.replace(/<a .*?href=(["'])mailto:(.+?)\1.*?>(.+?)<\/a>/gi,"[EMAIL=$2]$3[/EMAIL]"),e=e.replace(/<(?:b|strong)>/gim,"[B]"),e=e.replace(/<\/(?:b|strong)>/gim,"[/B]"),e=e.replace(/<(?:i|em)>/gim,"[I]"),e=e.replace(/<\/(?:i|em)>/gim,"[/I]"),e=e.replace(/<(?:strike|s)>/gim,"[S]"),e=e.replace(/<\/(?:strike|s)>/gim,"[/S]"),e=e.replace(/<u>/gim,"[U]"),e=e.replace(/<\/u>/gim,"[/U]"),e=e.replace(/<blockquote.*?\>/gim,"[BLOCK]"),e=e.replace(/\s{0,}<\/blockquote>/gim,"[/BLOCK]"),e=e.replace(/(?:\r\n|\r|\n){0,1}<(?:ol)>[\s]*/gim,"[LIST=1]"),e=e.replace(/<\/(?:ol)>/gim,"[/LIST]"),e=e.replace(/(?:\r\n|\r|\n){0,1}\<(?:ul)>[\s]*/gim,"[LIST]"),e=e.replace(/<\/(?:ul)>/gim,"[/LIST]"),e=e.replace(/\s{0,}<li\s{0,1}.*?>([\s\S]*?)\n{0,}\s{0,}<\/li>/gim,"[*]$1"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/(<[^>]+>)/gm,""),e},n.prototype._convertFontStyleToStandTag=function(){var e=this,t=e._getDesignViewDocument(),n=r(t.body),i,s,o=r("[style*='color: ']",n);o.length!==0&&(i=o,s="<font color='"+e._getWebColorFromRgb(o.css("color"))+"'></font>"),i&&r.each(i,function(e){r(this).is("span")?r(this).replaceWith(r(s).html(r(this).html())):r(this).is("font")&&r(this).attr("size")&&r(this).removeAttr("style").html(r(s).html())})},n.prototype._convertStyleToStandTag=function(){var e=this,t=e._getDesignViewDocument(),n=r(t.body),i,s,o,u=r("[style*='font-weight: bold;']",n),a=r("[style*='font-style: italic;']",n),f=r("[style*='text-decoration: line-through;']",n),l=r("[style*='text-decoration: underline;']",n);u.length!==0?(i=u,s="<b></b>",o="font-weight"):a.length!==0?(i=a,s="<i></i>",o="font-style"):f.length!==0?(i=f,s="<strike></strikes>",o="text-decoration"):l.length!==0&&(i=l,s="<u></u>",o="text-decoration"),i&&r.each(i,function(e){r(this).is("span")&&this.style.fontSize===""?r(this).replaceWith(r(s).html(r(this).html())):r(this).removeAttr("style").html(r(s).html())})},n.prototype._getWebColorFromRgb=function(e){var t=this,n;return e.indexOf("rgb(")===0&&(n=e.substring(4,e.length-1).split(","),e=t._convertToWebColor(a(n[0]),a(n[1]),a(n[2]))),e},n.prototype._updateList=function(e,t){var n;r("option",t).remove();for(n in e)e[n]&&t.append("<option>"+n+"</option>")},n.prototype._triggerEvent=function(e,t){var n=this,r=n.options[e];return r&&typeof r=="function"?r.call(n,t):r},n.prototype._closeDialog=function(){this.dialog.wijdialog("close"),this.rangeSelection=null,this.focus()},n.prototype._onTemplateList=function(e){return this._triggerEvent("templateList",e)},n.prototype.updateTemplateList=function(e,t){var n=this,i=t||r("select",n.dialog);n._updateList(e,i),n._templateList=e},n.prototype.initTemplateDialog=function(){var e=this,t=e.dialog,n=r("select",t),i=e._onTemplateList();t.delegate("select","change."+e.widgetName,function(){e.templateListOnChanged()}).delegate("."+ei,"click."+e.widgetName,function(){e.deleteTemplate()}).delegate("."+ti,"click."+e.widgetName,function(){e.saveTemplate()}).delegate(gs,"click."+e.widgetName,function(){e.applyTemplate()}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()});if(!i){i=e._templateList;if(!i)return}e.updateTemplateList(i,n)},n.prototype.templateListOnChanged=function(){var e=this,t=e.dialog,n=r("select",t).val(),i=r("iframe",t),s=e._templateList,o;if(!s)return;o=s[n],o.src&&i.attr("src",o.src+"?d="+(new Date).getMilliseconds().toString()),o.text&&i.length>0&&i[0].contentWindow.document.write(o.text),n&&(r("."+Jr,t).html(n),r("."+Gr,t).val(n)),o.desc&&(r("."+Kr,t).html(o.desc),r("."+Yr,t).val(o.desc))},n.prototype._onSaveTemplate=function(e){this._triggerEvent("saveTemplate",e)},n.prototype.saveTemplate=function(){var e=this,t=e.dialog,n=r("."+Gr,t).val(),i=r("."+Yr,t).val(),o=e._templateList,u=this._getDesignViewText();if(r.trim(n)===""){s(this.localizeString("errorMessageTemplateNameError","Please input a template name!"));return}o||(e._templateList=[],o=e._templateList),o[n]||r("select",t).append("<option>"+n+"</option>"),o[n]={desc:i,text:u},e._onSaveTemplate({name:n,desc:i,text:u})},n.prototype._onDeleteTemplate=function(e){this._triggerEvent("deleteTemplate",e)},n.prototype.deleteTemplate=function(){var e=this,t=e.dialog,n=r("select",t),i=n.val(),o=e._templateList;if(r.trim(i)===""){s(this.localizeString("errorMessageTemplateFileError","Please select a template file."));return}r("option:selected",n).remove(),r("iframe",t).attr("src","about:blank"),r("."+Jr,t).empty(),r("."+Gr,t).val(""),r("."+Kr,t).empty(),r("."+Yr,t).val(""),delete o[i],e._onDeleteTemplate(i)},n.prototype.applyTemplate=function(){var e=this,t=e.dialog,n=r("select",t),i=n.val(),o=r("iframe",t)[0],u=r("."+Gr,t).val(),a=o.contentWindow.document.body.innerHTML;if(r.trim(u)===""||r.trim(i)===""){s(this.localizeString("errorMessageValidTemplateFileError","Please select a valid template file."));return}e._setDesignViewText(a),e._addtoUndoBuffer(),e._setSaveBtnEnabled(),e._closeDialog()},n.prototype._onImageList=function(){var e=this,t=e.options.imageList;return t&&typeof t=="function"?t.call(e):t},n.prototype.updateImageList=function(e,t){var n=this,i=n.dialog,s=t||r("select",i),o=r("."+Mr,i);n._updateList(e,s),n._imgList=e;if(!e){o.addClass(Ir);return}o.removeClass(Ir)},n.prototype.initImageBrowserDialog=function(){var e=this,t=e.dialog,n=e._onImageList();r("img",t).hide(),t.delegate("select","change."+e.widgetName,function(){e.imageListOnChanged()}).delegate(gs,"click."+e.widgetName,function(t){e.submitInsertImageDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()}),r("."+Pr+" input",t).bind("change."+e.widgetName,function(){e.imageUrlChanged(this)});if(!n){n=e._imgList;if(!n){r("."+Mr,t).addClass(Ir);return}}e.updateImageList(n,r("select",t))},n.prototype.imageUrlChanged=function(e){var t=this,n=t.dialog;r("img",this.dialog).attr("src",r(e).val()+"?"+(new Date).getTime()).show().bind("load",function(){r("."+Br+" input",n).val(r("img",n).width().toString()),r("."+jr+" input",n).val(r("img",n).height().toString())})},n.prototype.imageListOnChanged=function(){var e=this,t=e.dialog,n=r("select",t).val(),i=e._imgList,s;if(!i)return;s=i[n],r("img",t).prop("src",s).show(),r("."+Pr+" input",t).prop("value",s),o.setTimeout(function(){r("."+Br+" input",t).val(r("img",t).width().toString()),r("."+jr+" input",t).val(r("img",t).height().toString())},200)},n.prototype.submitInsertImageDialog=function(){var e=this,t,n=e.dialog,i=r("."+Pr+" input",n).val(),o=r("."+Hr+" input",n).val(),u=r("."+Br+" input",n).val(),a=r("."+jr+" input",n).val(),f=r("."+Fr+" input",n).val();if(r.trim(i)===""){s(this.localizeString("errorMessageSelectImageError","Please select a image."));return}if(!e._isNumeric(u)){s(this.localizeString("errorMessageImageWidthError","Please input a number for 'Image width' textbox."));return}if(!e._isNumeric(a)){s(this.localizeString("errorMessageImageHeightError","Please input a number for 'Image height' textbox."));return}e.focus(),r.browser.msie?(t='<img src="'+i+'" alt="'+o+'" style="width:'+u+"px;height:"+a+"px",e.options.mode!=="bbcode"&&f!==null&&f!==undefined&&f.length>0&&(t+=";"+f)):(t='<img src="'+i+'" alt="'+o+'" width="'+u+'" height="'+a,e.options.mode!=="bbcode"&&(t+='" style="'+f)),t+='"/>',e.insertHTML(t),e._closeDialog()},n.prototype.initHyperLinkDialog=function(){var e=this,t=e.dialog,n=e.getLinkHrefField(),i=r("."+hi,t),s,u,a,f=r("."+oi+" input",t),l=r("."+ri+" input",t);t.one("wijdialogclose",function(){e._restoreSelectionForIE()}),t.delegate(gs,"click."+e.widgetName,function(t){e.submitHyperLinkDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()}).delegate("."+si,"change."+e.widgetName,function(){e.anchorListOnChanged(this)}).delegate("."+ii+">div","click."+e.widgetName,function(){e.radioListOnChanged()}).delegate("."+pi+">div","click."+e.widgetName,function(){e.linkIconTypeOnChanged()}).delegate("."+fi+" input","change."+e.widgetName,function(){e.tempImg=r('<img src="'+r("."+fi+" input",t).val()+'">').appendTo("body"),o.setTimeout(function(){r("."+li+" input",t).val(e.tempImg.width().toString()),r("."+ci+" input",t).val(e.tempImg.height().toString()),e.tempImg.remove(),e.tempImg=undefined},200)});try{l.val(n),u=e._getLinkInnerHTML()}catch(c){}u&&u.substring(0,3)==="<img"?(s=!0,a=r(u)):s=!1,s?(i.show(),f.hide(),r("."+fi+" input",t).val(a.attr("src")),r("."+li+" input",t).val(a.attr("width")),r("."+ci+" input",t).val(a.attr("heigth"))):(f.show(),i.hide(),f.val(u)),r("."+ai+" input",t).val(e._getLinkCssField()),r("."+ui+" select",t).val(e._getLinkTarget()),r("#radAnchor",t).prop("checked",!0),r("#radLinkTypeIsText",t).prop("checked",!0),n.length>6&&(n.substring(0,4)==="http"?r("#radUrl",t).prop("checked",!0):n.substring(0,6)==="mailto"?r("#radMail",t).prop("checked",!0):n.substring(0,1)==="#"?r("#radAnchor",t).prop("checked",!0):r("#radFile",t).prop("checked",!0)),l.focus(),a=undefined},n.prototype._getLinkInnerHTML=function(){var e=this,t,n;e.focus(),t=e._getInspectElement(),e._hyperlinkTextStyle="";try{n=e._getHyperLinkElement(t);if(n&&n.tagName==="A")return t.innerHTML!==n.innerHTML&&(e._hyperlinkTextStyle=n.innerHTML.replace(t.innerHTML,"{0}")),r(t).text()}catch(i){}return""},n.prototype.getLinkHrefField=function(){var e=this,t;e.focus(),t=e._getInspectElement();try{t=e._getHyperLinkElement(t);if(t&&t.tagName==="A")return e.fixAbsoluteUrlsIfNeeded(t.href||"")}catch(n){}return""},n.prototype._getLinkTarget=function(){var e=this,t;e.focus(),t=e._getInspectElement();try{t=e._getHyperLinkElement(t);if(t&&t.tagName==="A")return t.target||""}catch(n){}return""},n.prototype._getLinkCssField=function(){var e=this,t;e.focus(),t=e._getInspectElement();try{t=e._getHyperLinkElement(t);if(t&&t.tagName==="A")return t.style.cssText||""}catch(n){}return""},n.prototype.submitHyperLinkDialog=function(){var e=this,t=e.dialog,n=r("#radUrl",t),i=r("#radAnchor",t),o=r("#radMail",t),u=r("."+ri+" input",t),a=r("."+oi+" input",t),f=r("."+ai+" input",t),l=r("."+ui+" select",t),c=u.val(),h=a.val(),p=l.val(),d=r("#radLinkTypeIsImage",t),v=d.prop("checked"),m=r("."+fi+" input",t).val(),g=r("."+li+" input",t).val(),y=r("."+ci+" input",t).val(),b=f.val();if(c===""){s(this.localizeString("errorMessageAddressError","Please input address!"));return}if(h===""&&!v){s(this.localizeString("errorMessageDisplayTextError","Please input display text!"));return}if(m===""&&v){s(this.localizeString("errorMessageHyperLinkImageUrlError","Please input image url!"));return}if(!e._isNumeric(g)&&v){s(this.localizeString("errorMessageHyperLinkImageWidthError","Please input correct image width!"));return}if(!e._isNumeric(y)&&v){s(this.localizeString("errorMessageHyperLinkImageHeightError","Please input correct image height!"));return}if(n.prop("checked")&&!e._isUrl(c)){s(this.localizeString("errorMessageHyperLinkUrl","Please input correct url!"));return}if(i.prop("checked")&&!e._isAnchor(c)){s(this.localizeString("errorMessageHyperLinkAnchor","Please input correct anchor!"));return}if(o.prop("checked")&&!e._isEmail(c)){s(this.localizeString("errorMessageHyperLinkEmail","Please input correct email!"));return}v&&(h='<img src="'+m+'" width="'+g+'" height="'+y,h+='"/>'),e._closeDialog(),e._editLink(h,c,b,p)},n.prototype._editLink=function(e,t,n,r){var i=this,s="",o;i.focus(),o=i._getInspectElement();try{o=i._getHyperLinkElement(o);if(o&&o.tagName==="A"){o.innerHTML=i._hyperlinkTextStyle&&i._hyperlinkTextStyle!==""?i._hyperlinkTextStyle.replace("{0}",e):e,o.href=t,o.target=r,n!==o.style.cssText&&(o.style.cssText=n),i._addtoUndoBuffer(),i._setSaveBtnEnabled();return}}catch(u){}s='<a href="'+t+'" target="'+r+'"',n!==""&&(s+=' style="'+n+'"'),s+=">"+e+"</a>",i.insertHTML(s)},n.prototype.anchorListOnChanged=function(e){var t=this,n=t.dialog,i=r(e).val();i!==""&&(r("."+ri+" input",n).val(i),r("#radAnchor",n).attr("checked","checked"))},n.prototype.radioListOnChanged=function(){var e=this,t=e.dialog,n=r("."+si,t),i=r("."+ri+" input",t);i.val(""),r("#radUrl",t).is(":checked")?n.hide():r("#radAnchor",t).is(":checked")?n.show():r("#radMail",t).is(":checked")?(n.hide(),i.val(this.localizeString("insertHyperLinkMailTo","mailto:"))):r("#radFile",t).is(":checked")&&n.hide()},n.prototype.linkIconTypeOnChanged=function(){var e=this,t=e.dialog,n=r("."+hi,t),i=r("."+oi,t);r("#radLinkTypeIsText",t).is(":checked")?(i.show(),n.hide()):r("#radLinkTypeIsImage",t).is(":checked")&&(i.hide(),n.show())},n.prototype._getDialogRes_Code=function(){var e=this,t=f.createDiv(ni);return t.add(f.createElement("div",this.localizeString("insertCodeDialogEnterSourceCode","Enter source code:"),{"class":mi})),t.add(f.createElement("textarea","",{"class":vi})),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype.initInsertCodeDialog=function(){var e=this,t=e.dialog;t.delegate(gs,"click."+e.widgetName,function(t){e.submitCodeDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()})},n.prototype.submitCodeDialog=function(){var e=this,t=e.dialog,n=r("."+vi,t),i=n.val();if(i==="")return;i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i="<pre>"+i+"</pre>",e._setIESelection(),e.insertHTML(i),e._closeDialog()},n.prototype.initTagInspectorDialog=function(){var e=this,t=e.dialog,n=r("."+Ti);t.delegate(gs,"click."+e.widgetName,function(t){e.submitTagInspectorDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()}).delegate("#displayNoEmpty","click."+e.widgetName,function(){e.tagInspectorDialogSwitchAttList(this)}),e._laySelectedElementAttributes(r("."+xi,t),r("."+wi,t)),r("."+Ni+" input",t).val(e._getSelectedElementStyle()),e._selectedElementCanHaveChildren()?(n.show(),r("textarea",n).val(e._getSelectedElementInnerHTML())):n.hide()},n.prototype.submitTagInspectorDialog=function(){var e=this,t=e.dialog,n=e._getInspectElement(),i=r("."+xi,t),s=r("."+Ni+" input").val(),o=r("."+Ti+" textarea").val();try{r.each(r("input:checkbox",i),function(e,t){var i,s,o=r(t);o.is(":checked")&&(i=o.siblings("span").text(),i=i.substring(0,i.length-1),s=o.siblings("input:text").val(),r(n).attr(i,s))}),r.trim(s)!==""&&(n.style.cssText=s),e._selectedElementCanHaveChildren()&&r(n).html(o)}catch(u){}e._closeDialog(),e._addtoUndoBuffer(),e._setSaveBtnEnabled()},n.prototype.tagInspectorDialogSwitchAttList=function(e){var t=r("."+xi,this.dialog),n=!e.checked;r.each(r("input:text",t),function(e,t){r(t).val()===""&&r(t).parent("li")[n?"show":"hide"]()})},n.prototype._laySelectedElementAttributes=function(e,t){var n=this,i=n._getInspectElement(),s,o,u,a=this.localizeString("tagInspectorDialogSave","Save"),f="";if(!i)return;t.html(i.tagName),s=n._getDictionaryDeclare(),o=i.tagName.toLowerCase(),u=s[o];switch(o){case"ul":case"u":case"textarea":case"tbody":case"tr":case"th":case"td":case"table":case"select":case"strong":case"span":case"p":case"option":case"ol":case"li":case"label":case"input":case"img":case"i":case"hr":case"form":case"font":case"em":case"div":case"code":case"button":case"body":case"b":case"a":f+="<ul class='ui-helper-reset'>",r.each(u,function(e,t){var n=i.getAttribute(t)||"";f+="<li><span class='"+kr+"'>",f+=t+":</span>",f+="<input type='text' value='"+n+"'/>",f+="<input type='checkbox' id='save"+e+"'/>",f+="<label for='save"+e+"'>"+a+"</label></li>"})}e.html(f)},n.prototype._getSelectedElementStyle=function(){var e=this._getInspectElement();return e&&e.style?e.style.cssText||"":""},n.prototype._getSelectedElementInnerHTML=function(){var e=this._getInspectElement();return e?e.innerHTML:""},n.prototype._selectedElementCanHaveChildren=function(){return!r(this._getInspectElement()).is("input,hr,br,img")},n.prototype.initBackColorDialog=function(){this._initColorDialog("BackColor")},n.prototype.initForeColorDialog=function(){this._initColorDialog("ForeColor")},n.prototype._initColorDialog=function(e){var t=this,n=t.dialog,i=t._getDesignViewDocument(),s=i.queryCommandValue(e),o,u,f;n.delegate(gs,"click."+t.widgetName,function(n){t.submitColorDialog(e),t._onDesignViewBlur(n)}).delegate(ys,"click."+t.widgetName,function(){t._closeDialog()});if(s){f=s.toString(),r.browser.mozilla&&f==="transparent"&&(f="#ffffff");if(r.browser.msie||!isNaN(f))o=a(f),f="rgb("+(o&255)+", "+((o&65280)>>8)+", "+((o&16711680)>>16)+")";f.indexOf("rgb(")===0?(u=f.substring(4,f.length-1).split(","),f=t._convertToWebColor(a(u[0]),a(u[1]),a(u[2]))):f.indexOf("rgba(")===0&&(u=f.substring(5,f.length-1).split(","),f=t._convertToWebColor(a(u[0]),a(u[1]),a(u[2]))),r("."+Li+" input",n).attr("value",f)}r("."+ki,n).wijeditorcolorcanvas("."+Li+" input",f)},n.prototype.submitColorDialog=function(e){var t=this,n=r("."+Li+" input",t.dialog);t.setColor(e,n.val()),t._closeDialog()},n.prototype.setColor=function(e,t){var n=this,i,s=n._getDesignViewDocument(),o=n._getDesignViewWindow(),u;n._setIESelection(),r.browser.mozilla&&e==="BackColor"?(u=o.getSelection(),n.insertHTML('<span style="background-color:'+t+';">'+u+"</span>")):(s.execCommand(e,!1,t),r.browser.msie&&(i=n._getHtmlTextInIE(s),i.indexOf("<U>")>=0&&i.indexOf("</U>")>=0&&(s.execCommand("Underline",!1,!1),s.execCommand("Underline")),i.indexOf("<STRIKE>")>=0&&i.indexOf("</STRIKE>")>=0&&(s.execCommand("StrikeThrough",!1,!1),s.execCommand("StrikeThrough"))),n.options.mode==="bbcode"&&!r.browser.msie&&n._convertFontStyleToStandTag()),n._addtoUndoBuffer(),n._setSaveBtnEnabled()},n.prototype.initInsertTableDialog=function(){var e=this,t=e.dialog;t.delegate(gs,"click."+e.widgetName,function(t){e.submitInsertTableDialog(),e._onDesignViewBlur(t)}).delegate(ws,"click."+e.widgetName,function(){e._closeDialog()}).delegate("."+Fi+" input:button","click."+e.widgetName,function(){e.showTableColorDialog(this,t)})},n.prototype.submitInsertTableDialog=function(){var e=this,t=e._getValuesFromTableDialog();if(!t)return;e._insertTable(t),e._closeDialog()},n.prototype._insertTable=function(e){var t=this,n="",i,s;if(!e)return!1;t.focus(),n+='<table width="'+e.width+'" height="'+e.height+'" cellspacing="'+e.cspacing+'" cellpadding="'+e.cpadding+'" border="'+e.border+'" bgcolor="'+e.bgcolor+'" style="'+e.css+'">';for(i=0;i<e.rows;i++){n+="<tr>";for(s=0;s<e.cols;s++)n+="<td>Cell "+(i+1)+"-"+(s+1)+"</td>";n+="</tr>"}n+="</table>";if(r.browser.mozilla||r.browser.msie&&a(r.browser.version)>=9||this._isEdge)n+="<br />";t.insertHTML(n)},n.prototype.initEditTableDialog=function(){var e=this,t=e.dialog,n=e._getInspectElement(),i,s;t.delegate(gs,"click."+e.widgetName,function(t){e.submitEditTableDialog(),e._onDesignViewBlur(t)}).delegate(ws,"click."+e.widgetName,function(){e._closeDialog()}).delegate("."+Fi+" input:button","click."+e.widgetName,function(){e.showTableColorDialog(this,t)});if(!n)return;try{i=n.rows,i.length>0?s=i[0].cells.length:s=0,i=i.length}catch(o){}r("."+Oi+" input",t).val(i),r("."+Mi+" input",t).val(s),r("."+_i+" input",t).val(n.getAttribute("width")),r("."+Di+" input",t).val(n.getAttribute("height")),r("."+Pi+" input",t).val(n.getAttribute("border")),r("."+Hi+" input",t).val(n.getAttribute("cellPadding")),r("."+Bi+" input",t).val(n.getAttribute("cellSpacing")),r("."+Fi+" input",t).val(n.getAttribute("bgcolor")||"#ffffff"),r("."+ji+" input",t).val(n.style.cssText)},n.prototype.submitEditTableDialog=function(){var e=this,t=e._getInspectElement(),n=r(t),i=e._getValuesFromTableDialog(),s=i&&a(i.rows),o=i&&a(i.cols),u,f;if(!i)return;if(t){n.attr("width",i.width),n.attr("height",i.height),n.attr("bgcolor",i.bgcolor),n.attr("border",i.border),n.attr("cellSpacing",i.cspacing),n.attr("cellPadding",i.cpadding),t.style.cssText=i.css;if(!s||isNaN(s))return;if(!o||isNaN(o))return;while(t.rows.length>s)t.deleteRow(0);while(t.rows.length<s){u=t.insertRow(0);while(u.cells.length<o)f=u.insertCell(0),f.innerHTML="&nbsp;"}r.each(t.rows,function(e,t){while(t.cells.length>o)t.deleteCell(0);while(t.cells.length<o)f=t.insertCell(0),f.innerHTML="&nbsp;"})}e._closeDialog()},n.prototype._getValuesFromTableDialog=function(){var e=this,t=e.dialog,n=r("."+Oi+" input",t).val(),i=r("."+Mi+" input",t).val(),o=r("."+_i+" input",t).val(),u=r("."+Di+" input",t).val(),f=r("."+Pi+" input",t).val(),l=r("."+Hi+" input",t).val(),c=r("."+Bi+" input",t).val(),h=r("."+ji+" input",t).val(),p=r("."+Fi+" input",t).val();return e._isNumeric(n)?e._isNumeric(i)?e._isNumeric(o)?e._isNumeric(u)?e._isNumeric(f)?e._isNumeric(l)?e._isNumeric(c)?{rows:n,cols:i,width:a(o),height:a(u),border:f,cpadding:l,cspacing:c,css:h,bgcolor:p}:(s(this.localizeString("tableDialogCellSpacingError","Please input a number for 'Cell Spacing' textbox.")),!1):(s(this.localizeString("tableDialogCellPaddingError","Please input a number for 'Cell Padding' textbox.")),!1):(s(this.localizeString("tableDialogBorderError","Please input a number for 'Border thickness' textbox.")),!1):(s(this.localizeString("errorMessageTableHeightError","Please input a number for 'Table Height' textbox.")),!1):(s(this.localizeString("errorMessageTableWidthError","Please input a number for 'Table Width ' textbox.")),!1):(s(this.localizeString("errorMessageColumnsError","Please input a number for 'Columns' textbox.")),!1):(s(this.localizeString("errorMessageRowsError","Please input a number for 'Rows' textbox.")),!1)},n.prototype.showTableColorDialog=function(e,t){var n=this,i,s=n.subDialog,o=r(e).prev().val(),u=n._getDialogRes_Color();i={width:"auto",height:"auto",modal:!0,title:n.localizeString("backColorDialogTitle","Set BackColor"),position:{my:"center",at:"center",of:window},resizable:!1,captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}},close:function(){t.focus()}},s.empty().append(u),r.browser.msie&&a(r.browser.version)===6?window.setTimeout(function(){s.wijdialog(i)},0):s.wijdialog(i),s.delegate(bs,"click."+n.widgetName,function(){n.submitTableColorDialog()}).delegate(ws,"click."+n.widgetName,function(){n.closeSubDialog()}),o!==""&&r("."+Li+" input",s).val(o),r("."+ki,s).wijeditorcolorcanvas("."+Li+" input",o),s.wijdialog("open")},n.prototype.submitTableColorDialog=function(){var e=this,t=e.subDialog,n=e.dialog,i=r("."+Li+" input",t).val();r("."+Fi+" input:text",n).val(i),e.closeSubDialog()},n.prototype.closeSubDialog=function(){this.subDialog.wijdialog("close")},n.prototype._getEditableTable=function(){var e=this,t,n,i;n=e._getSelectedElement();if(!n)return s(this.localizeString("errorMessageSelectTableError","Please select a table!")),!1;i=r(n);if(i.is("td,tr,tbody,th"))n=i.parents("table:first")[0];else if(!i.is("table")){t=i.find("table:only-child");if(!r.browser.msie||!t.length)return s(this.localizeString("errorMessageSelectTableError","Please select a table!")),!1;n=t[0]}return y=n,!0},n.prototype.initPreviewDialog=function(){var e=this,t=e.dialog;e._setPreviewContent(0),t.one("wijdialogclose",function(){e._curPageIdx=0}),t.delegate("#rad640_480","click."+e.widgetName,function(){e._setPreviewDialogSize(640,480)}).delegate("#rad800_600","click."+e.widgetName,function(){e._setPreviewDialogSize(800,600)}).delegate("#rad1024_768","click."+e.widgetName,function(){e._setPreviewDialogSize(1024,768)}).delegate("#chkSplit","click."+e.widgetName,function(){e._splitPreviewPages(this.checked)}).delegate("."+Wi,"click."+e.widgetName,function(){e._printPreviewPage(!0)}).delegate("."+Xi,"click."+e.widgetName,function(){e._printPreviewPage(!1)}).delegate("."+Vi,"click."+e.widgetName,function(){e._closeDialog()}).delegate("."+Ui,"click."+e.widgetName,function(){e._navigatePreviewPage(!1)}).delegate("."+zi,"click."+e.widgetName,function(){e._navigatePreviewPage(!0)})},n.prototype._setPreviewContent=function(e){var t=this,n=t.dialog,i=r("iframe",n),s=r("."+Ri+" span",n),o=i[0].contentWindow.document;o.open(),e===-1?(o.write(t._getPreviewAllPageContent()),s.html("1 / 1")):(o.write(t._getPreviewPageContent(e)),s.html(e+1+" / "+t._getPreviewPageCount())),o.close()},n.prototype._setPreviewDialogSize=function(e,t){var n=this,i=n.dialog,s=r("iframe",i),o=i.wijdialog("option","width"),u=i.wijdialog("option","height");o==="auto"?o=i.parent(".wijmo-wijdialog").width()-s.width():o-=s.width(),u==="auto"?u=i.parent(".wijmo-wijdialog").height()-s.height():u-=s.height(),s.css("width",e).css("height",t),i.wijdialog("option",{width:e+o,height:t+u})},n.prototype._getPreviewPageCount=function(){return this._getPreviewPages().length},n.prototype._getPreviewPageContent=function(e){var t=this._getPreviewPages();return t.length>e?t[e]:null},n.prototype._getPreviewAllPageContent=function(){return this._getDesignViewText()},n.prototype._getPreviewPages=function(){var e=this._getPreviewAllPageContent(),t=new RegExp("<(DIV|div)[^>]*(page-break-before|PAGE-BREAK-BEFORE)[ ]*:[ ]*always[^>]*>(.*?)<\\/(DIV|div)>","g"),n=e.replace(t,"!-~U^n#i@q,P|.a=g~e+br!");return n.split("!-~U^n#i@q,P|.a=g~e+br!")},n.prototype._splitPreviewPages=function(e){var t=this,n=t.dialog,i=r("."+$i,n),s=r("."+Ri,n);e?(t._setPreviewContent(0),s.show(),i.hide()):(t._setPreviewContent(-1),s.hide(),i.show()),t._curPageIdx=0},n.prototype._navigatePreviewPage=function(e){var t=this,n=r("#chkSplit",t.dialog),i=t._curPageIdx,s=t._getPreviewPageCount();n.is(":checked")&&(e?(i++,i<s?t._setPreviewContent(i):i=s-1):(i--,i>=0?t._setPreviewContent(i):i=0),t._curPageIdx=i)},n.prototype._printPreviewPage=function(e){var t=this,n=t.dialog,i=r("#chkSplit",n),s=r("iframe",n)[0].contentWindow;e&&(i.removeAttr("checked"),t._setPreviewContent(-1)),s.focus(),s.print()},n.prototype.initCleanUpDialog=function(){var e=this,t=e.dialog;r("textarea",t).val(e.sourceView.val()),t.delegate(gs,"click."+e.widgetName,function(t){e.submitCleanUpDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()})},n.prototype.submitCleanUpDialog=function(){var e=this,t=e.dialog,n=e.sourceView,i=n.val(),s;r("#replaceSpans",t).is(":checked")&&(s=new RegExp("<\\/?SPAN[^>]*>","g"),i=i.replace(s,"")),r("#replaceClass",t).is(":checked")&&(s=new RegExp("<(\\w[^>]*) class=([^ |>]*)([^>]*)","g"),i=i.replace(s,"<$1$3")),r("#replaceStyle",t).is(":checked")&&(s=new RegExp('<(\\w[^>]*) style="([^"]*)"([^>]*)',"g"),i=i.replace(s,"<$1$3"),s=new RegExp("<(\\w[^>]*) lang=([^ |>]*)([^>]*)","g"),i=i.replace(s,"<$1$3"),s=new RegExp("<\\\\?\\?xml[^>]*>","g"),i=i.replace(s,""),s=new RegExp("<\\/?\\w+:[^>]*>","g"),i=i.replace(s,"")),r("#replaceNbsp",t).is(":checked")&&(s=new RegExp("&nbsp;","g"),i=i.replace(s," ")),r("#transformPtoDiv",t).is(":checked")&&(s=new RegExp("(<P)([^>]*>.*?)(<\\/P>)","g"),i=i.replace(s,"<div$2</div>")),n.val(i),e._setDesignViewText(i),e._addtoUndoBuffer(),e._closeDialog()},n.prototype.initFindDialog=function(){var e=this,t=e.dialog;e.tRange&&(e.tRange=null),t.delegate(gs,"click."+e.widgetName,function(){e.submitFindAction()}).delegate(ys,"click."+e.widgetName,function(t){e.submitReplaceAction(),e._onDesignViewBlur(t)})},n.prototype.submitFindAction=function(){var e=this,t=r("textarea:first",e.dialog).val();if(r.trim(t)==="")return;e._findAndReplaceString(t)},n.prototype.submitReplaceAction=function(){var e=this,t=e.dialog,n=r("textarea:first",t).val(),i=r("textarea:last",t).val();if(r.trim(n)==="")return;if(r.trim(i)===""){s(this.localizeString("errorMessageReplaceStringError","please input replace string!"));return}e._findAndReplaceString(n,i)},n.prototype._findAndReplaceString=function(e,t){var n=this,i=n._getDesignViewWindow(),o=0,u=!1,a,f=t&&t!==e;t||(t=e);if(r.browser.msie)n.tRange&&(n.txtFoundInIE&&f?(o=n.tRange.findText(e),o&&(n.tRange.pasteHTML(t),n.tRange.collapse(!1),u=!0,n.txtFoundInIE=!1)):(n.tRange.collapse(!1),o=n.tRange.findText(e),o&&n.tRange.select())),!u&&(!n.tRange||!o)&&(n.tRange=i.document.body.createTextRange(),o=n.tRange.findText(e),o&&(n.tRange.select(),f&&(n.tRange.pasteHTML(t),u=!0)));else{if(n.txtFoundInNoneIE&&f)n._replaceSelectionForNoneIE(t),u=!0,n.txtFoundInNoneIE=!1;else{a=i.getSelection(),a.rangeCount>0&&a.collapseToEnd(),o=i.find(e);if(!o){o=i.find(e,0,1);while(i.find(e,0,1))continue}}n.txtFoundInNoneIE=n.txtFoundInNoneIE||o>0,n.txtFoundInNoneIE&&f&&(n._replaceSelectionForNoneIE(t),u=!0,n.txtFoundInNoneIE=!1)}!o&&!u?(s('"'+e+'"'+this.localizeString("errorMessageFindTextError"," String Not Found!")),n.tRange=null,n.txtFoundInNoneIE=!1,n.txtFoundInIE=!1):n.txtFoundInIE=!0},n.prototype._replaceSelectionForNoneIE=function(e){var t=this._getDesignViewDocument();t.execCommand("inserttext",!1,e)},n.prototype.initMediaDialog=function(){var e=this,t=e.dialog;t.delegate(gs,"click."+e.widgetName,function(t){e.submitMediaDialog(),e._onDesignViewBlur(t)}).delegate(ys,"click."+e.widgetName,function(){e._closeDialog()})},n.prototype.submitMediaDialog=function(){var e=this,t=e.dialog,n=r("select",t).val(),i=r("."+is+" input",t).val(),o=r("."+ss+" input",t).val(),u=r("."+os+" input",t).val();if(i===""){s(this.localizeString("errorMessageUrlEmptyError","URL is empty!"));return}if(!e._isUrl(i)){s(this.localizeString("errorMessageUrlCorrectError","please input correct URL!"));return}if(!e._isNumeric(o)){s(this.localizeString("errorMessageMediaWidthError","please input width of the media!"));return}if(!e._isNumeric(u)){s(this.localizeString("errorMessageMediaHeightError","please input height of the media!"));return}e._insertMedia(n,i,o,u),e._closeDialog()},n.prototype._insertMedia=function(e,t,n,r){var i=this,s="";i._setIESelection();switch(e){case"video":s+='<embed src="'+t+'" width="'+n+'" '+'height="'+r+'" '+'type=audio/x-pn-realaudio-plugin console="Clip1" '+'controls="IMAGEWINDOW,ControlPanel,StatusBar" '+'autostart="true"></embed>';break;case"flash":s+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="'+n+'" height="'+r+'">',s+='<param name="movie" value="'+t+'">',s+='<param name="wmode" value="opaque">',s+='<param name="quality" value="high">',s+='<embed src="'+t+'" quality="high" '+'pluginspage="http://www.macromedia.com/go/getflashplayer" '+'type="application/x-shockwave-flash" '+'width="'+n+'" height="'+r+'"></embed>',s+="</object>";break;case"applet":s+='<applet code="'+t+'" width="'+n+'" '+'height="'+r+'"></applet>';break;case"other":s+='<embed src="'+t+'" width="'+n+'" '+'height="'+r+'"></embed>'}i.insertHTML(s)},n.prototype.initSpecialCharacterDialog=function(){var e=this,t=e.dialog,n=r("."+ls+" span",t);t.delegate("label","click."+e.widgetName,function(t){e.submitSpecialCharacterDialog(this),e._onDesignViewBlur(t)}).delegate(gs,"click."+e.widgetName,function(){e._closeDialog()}).delegate("label","mouseover."+e.widgetName,function(){n.html(r(this).html())}).delegate("label","mouseout."+e.widgetName,function(){n.empty()})},n.prototype.submitSpecialCharacterDialog=function(e){var t=this;t._setIESelection(),t.insertHTML(r(e).html()),t._closeDialog()},n.prototype._setSaveBtnEnabled=function(){this.$ribbon.wijribbon(b,_t,!1)},n.prototype._undoAction=function(){var e=this._getDesignViewDocument().body,t={};m--,m<=0&&(m=0),e.innerHTML=g[m],m?this.$ribbon.wijribbon(b,wt,!1):(t[bt]=!0,t[wt]=!1,this.$ribbon.wijribbon(w,t))},n.prototype._redoAction=function(){var e=this._getDesignViewDocument().body,t=g.length,n={};m++,m>=t-1&&(m=t-1),e.innerHTML=g[m],m===t-1?(n[bt]=!1,n[wt]=!0,this.$ribbon.wijribbon(w,n)):this.$ribbon.wijribbon(b,bt,!1)},n.prototype._addtoUndoBuffer=function(){var e=g.length-1-m,t;for(t=0;t<e;t++)g.pop();m++,g.push(this._getDesignViewText()),this.$ribbon.wijribbon(b,bt,!1)},n.prototype._deleteSelectionContent=function(){var e=this._getDesignViewWindow(),t,n,i,s="rangeCount";if(r.browser.msie)t=e.document.selection,t.type.toLowerCase()!=="none"&&t.clear();else{t=e.getSelection();for(n=0;n<t[s];n++)i=t.getRangeAt(n),i.deleteContents()}},n.prototype._refreshPathSelector=function(){var e=this,t=e._getParentElement(e._getDesignViewWindow()),n,i=e._getPathSelector(),s=r(t).parents(),o=s.length,u="wijmo-wijeditor-label ui-state-default ui-corner-all",a,f,l,c=r(".wijmo-wijeditor-footer",e.editor).outerWidth(!0),h=r(".wijmo-wijribbon-modes",e.editor).outerWidth(!0),p,d="";if(!t)return;n=t.tagName?t.tagName.toLowerCase():"",i.empty(),i.append("<label class='"+u+"'>&lt;"+s[o-1].tagName.toLowerCase()+"&gt;</label>"),p=r(".wijmo-wijeditor-pathselector>.wijmo-wijeditor-label",e.editor).outerWidth(!0),f=Math.floor((c-h)/p),l=Math.floor((c-h)/(p*2));if(o<=f)for(a=o-2;a>=0;a--)s[a]&&(d+="<label class='"+u+"'> &lt;"+s[a].tagName.toLowerCase()+"&gt;</label>");else{for(a=o-2;a>=o-l+1;a--)s[a]&&(d+="<label class='"+u+"'> &lt;"+s[a].tagName.toLowerCase()+"&gt;</label>");d+="<label class='"+u+"'>&lt;.......&gt;</label>";for(a=l-2;a>=0;a--)s[a]&&(d+="<label class='"+u+"'> &lt;"+s[a].tagName.toLowerCase()+"&gt;</label>")}d+="<label class='"+u+" wijmo-wijeditor-selectlabel ui-state-highlight ui-corner-all'>&lt;"+n+"&gt;</label>",i.append(d)},n.prototype._toggleTableBorders=function(){var e=this.options.tableVirtualBorderShowing;this._updateTableBorderShowing(!e),this.options.tableVirtualBorderShowing=!e},n.prototype._updateTableBorderShowing=function(e){var t=this._getDesignViewDocument(),n=r("#__wijStyle",t);r.browser.safari||this._isEdge?e?n.html("table,td,tr{border: 1px #acacac dashed;}"):n.empty():n.prop("disabled",!e)},n.prototype._tableAction=function(e){var t=this,n=t._getParentElement(t._getDesignViewWindow()),i=r(n).closest("td"),o,u,a,f,l,c,h,p,d,v,m=0;t._setSaveBtnEnabled();if(i.length===0&&e!==F)return!1;e!==F&&(o=i.parent(),u=o.closest("table"),a=i[0],f=o[0],l=u[0],c=f.rowIndex,h=a.cellIndex);try{switch(e){case H:p=f.cells.length,v=l.insertRow(c);for(m=0;m<p;m++)t._insertCell(v,m);break;case q:l.deleteRow(c);break;case P:d=l.rows.length;for(m=0;m<d;m++)t._insertCell(l.rows[m],h);break;case I:t._removeColumn(l,h);break;case B:t._insertCell(f,h+1);break;case R:p=f.cells.length,p===1?l.deleteRow(c):f.deleteCell(h);break;case j:t._splitCell(l,f,c,h);break;case F:t._mergeCell(t._getSelectedCells(n))}this._addtoUndoBuffer()}catch(g){return s(g.message),!1}return!0},n.prototype._removeColumn=function(e,t){var n=e.rows.length,r=0,i,s,o,u,a;while(r<n)i=e.rows[r],s=i.cells,o=s.length,u=t>o-1?o-1:t,a=s[u].colSpan,a>1&&o>1&&(u+1<o?s[u+1].colSpan+=a-1:s[u-1].colSpan+=a+1),o===1?(e.deleteRow(r),n=e.rows.length):(i.deleteCell(u),r++)},n.prototype._splitCell=function(e,t,n,r){var i=e.rows.length,s=0,o=0,u,a,f,l,c;while(s<=r)t.cells[s].colSpan>1&&(o+=t.cells[s].colSpan-1),s++;this._insertCell(t,r+1);if(t.cells[r].colSpan>1)t.cells[r].colSpan--;else for(f=0;f<i;f++){u=e.rows[f];if(f!==n){l=r,s=0,a=0;while(s<=l)u.cells[s].colSpan>1&&(a+=u.cells[s].colSpan-1,l-=a),s++;c=r+o-a,c<0&&(c=0),u.cells[c].colSpan++}}},n.prototype._mergeCell=function(e){var t=this,n=e.length,i=e[0].parentNode,s,o,u,a=e[n-1].parentNode,f=i.cells.length,l={},c,h=!0,p=[];if(n<2)return;if(f===1&&i!==a)for(var d=1;d<e.length;d++)e[0].innerHTML+=e[d].innerHTML,r(e[d].parentNode).remove();else if(f>1&&i===a){s=e[0].cellIndex,o=s+n;for(u=s+1;u<o;u++)i.cells[s].innerHTML+=i.cells[s+1].innerHTML,i.cells[s].colSpan++,i.deleteCell(s+1)}else f>1&&i!==a&&(r.each(e,function(t,n){c=e[t].parentNode.rowIndex,l[c]||(l[c]=[]),l[c].push(n)}),r.each(l,function(e,t){if(t.length!==f)return h=!1,!1}),h&&(r.each(l,function(e,n){p.push(n[0]),t._mergeCell(n)}),this._mergeCell(p)))},n.prototype._getSelectedCells=function(e){var t=this,n=this._getDesignViewWindow(),i=n.document,s=[],o,u,a,f,l,c,h,p,d;if(r.browser.msie)a=r(e).closest("tr")[0],u=t._getIESelectionRange(),o=a?a.cells:t._getPrepareTableCells(e),r.each(o,function(e,r){t._isIE11?t._checkSelectionIncludeNodeForIE11AndChrome(n,u,r)&&s.push(r):t._checkSelectionIncludeNodeExceptIE11(n,u,r)&&s.push(r)});else if(r.browser.mozilla){f=n.getSelection(),c=f.rangeCount;for(l=0;l<c;l++)u=f.getRangeAt(l),h=u.startContainer,p=h.nodeName.toLowerCase(),p==="td"||p==="th"?s.push(h):p==="tr"&&(d=u.startOffset,s.push(h.cells[d]))}else a=r(e).closest("tr")[0],f=n.getSelection(),f&&f.rangeCount>0&&(u=f.getRangeAt(0)),o=a?a.cells:t._getPrepareTableCells(e),r.each(o,function(e,r){t._checkSelectionIncludeNodeForIE11AndChrome(n,u,r)&&s.push(r)});return s},n.prototype._getPrepareTableCells=function(e){var t=r(e.parentElement),n;return n=t?t.children().children("tr").children("td"):[],n},n.prototype.insertDateAndTime=function(){var e=new Date;this.options.culture&&this.options.culture!==""?this.insertHTML(Globalize.format(e,"dddd ",Globalize.findClosestCulture(this.options.culture))+Globalize.format(e,"F",Globalize.findClosestCulture(this.options.culture))):this.insertHTML(e.toDateString()+" "+e.toTimeString())},n.prototype._toggleWordWrap=function(){var e=this,t=e.sourceView,n="wrap",i;v=!v,i=v?"soft":"off",t.attr(n,i),t[0].focus(),r.browser.mozilla&&(t.hide(),o.setTimeout(function(){t.show()},40))},n.prototype.insertHTML=function(e){var t=this,n=t._getDesignViewDocument(),i;try{r.browser.msie?(t._isIE11&&n.getSelection?i=t._getRangeForInsertHTML(n,e):(n.selection.type==="Control"&&n.selection.clear(),i=n.selection.createRange(),i.pasteHTML(e),i.collapse(!1),t.rangeSelection=null),t._setIESelection(i,!0)):n.execCommand("insertHTML",!1,e)}catch(s){r.browser.msie&&r.browser.version&&parseFloat(r.browser.version)>=9&&parseFloat(r.browser.version)<=10&&t.rangeSelection&&(i=t.rangeSelection,i.pasteHTML(e),i.collapse(!1),t._setIESelection(i,!0))}t._addtoUndoBuffer(),t._setSaveBtnEnabled()},n.prototype._getRangeForInsertHTML=function(e,t){var n,r,i;return e.getSelection&&(n=e.getSelection(),this.rangeSelection?(r=this.rangeSelection,this.rangeSelection=null):n.getRangeAt&&n.rangeCount&&(r=n.getRangeAt(0)),r&&(r.deleteContents(),i=r.createContextualFragment(t),r.insertNode(i),r.collapse(!1))),r},n.prototype._setIEFocus=function(){var e=this._getDesignViewDocument();if(r.browser.msie)try{e.body.focus()}catch(t){}},n.prototype.focus=function(){var e=this._getDesignViewWindow(),t=e.document;r.browser.msie?this.rangeSelection?this._setIESelection():t.body?t.body.focus():t.onreadystatechange=function(){t.readyState==="complete"&&t.body.focus()}:e.focus()},n.prototype._setFocusNotIE=function(){var e=this._getDesignViewWindow(),t=e.document;if(r.browser.msie)return;r.browser.mozilla?e.focus():t.body&&t.body.focus()},n.prototype._createInputButton=function(e,t){var n={"class":e,type:"button",value:undefined};return t&&(n.value=t),f.createElement("input",n)},n.prototype._createTextField=function(e,t,n,r){var i=this,s=f.createDiv(t),o={type:"text",value:""};return r&&(o.value=r),s.add(f.createSpan(kr,e)),s.add(f.createElement("input",o)),n&&s.add(new ks(n)),s},n.prototype._createTextAreaField=function(e,t,n,r){var i=f.createDiv(t);return i.add(f.createSpan(kr,e)),i.add(f.createElement("textarea",n)),r&&i.add(new ks(r)),i},n.prototype._createSeparator=function(){var e=this,t=f.createDiv(Tr);return t.add(f.createElement("hr")),t},n.prototype._createOKCancelButtons=function(){var e=this,t=f.createDiv(Nr);return t.add(f.createElement("input",{type:"button","class":Cr,value:this.localizeString("dialogOK","OK")})),t.add(f.createElement("input",{type:"button","class":Cr,engValue:"Cancel",value:this.localizeString("dialogCancel","Cancel")})),t},n.prototype._getDialogRes_Template=function(){var e=this,t=f.createDiv(qr),n=f.createDiv(Rr),r=f.createDiv(Wr),i=f.createDiv(Xr),s=f.createDiv(Vr),o=f.createDiv($r),u=f.createElement("div",this.localizeString("templateDialogName","Name :")),a=f.createElement("div",this.localizeString("templateDialogDescription","Description :")),l=f.createDiv(Qr),c=f.createDiv(Zr);return n.add(f.createElement("div",this.localizeString("templateDialogSelectTemplate","Select Template:"),{"class":Ur})),n.add(f.createElement("div",this.localizeString("templateDialogTemplatePreview","Template Preview:"),{"class":zr})),t.add(n),i.add(f.createElement("select",{size:8})),s.add(f.createElement("iframe",{frameborder:0})),r.add(i),r.add(s),t.add(r),u.add(f.createSpan(Jr)),a.add(f.createSpan(Kr)),o.add(u),o.add(a),t.add(o),l.add(f.createSpan(kr,this.localizeString("templateDialogName","Name :"))),l.add(f.createTextBox(Gr)),l.add(f.createSpan(kr,this.localizeString("templateDialogDescription","Description :"))),l.add(f.createTextBox(Yr)),t.add(l),c.add(e._createInputButton(Cr+" "+ei,this.localizeString("templateDialogDeleteSelected","Delete selected"))),c.add(e._createInputButton(Cr+" "+ti,this.localizeString("templateDialogSaveCurrentPage","Save current page as template"))),t.add(c),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_ImageBrowser=function(){var e=this,t=f.createDiv(Lr),n=f.createDiv(Ar),r=f.createDiv(Or),i=f.createDiv(Mr),s=f.createDiv(_r),o=f.createDiv(Dr);return r.add(e._createTextField(this.localizeString("imageEditorDialogImageSrc","Image Src:"),Pr)),r.add(e._createTextField(this.localizeString("imageEditorDialogImageAltText","Image alt text:"),Hr)),r.add(e._createTextField(this.localizeString("imageEditorDialogImageWidth","Image width:"),Br,this.localizeString("dialogPixel","px"))),r.add(e._createTextField(this.localizeString("imageEditorDialogImageHeight","Image height:"),jr,this.localizeString("dialogPixel","px"))),r.add(e._createTextField(this.localizeString("imageEditorDialogCssText","Css text:"),Fr)),n.add(r),i.add(s),s.add(f.createElement("select",{size:8})),i.add(o),o.add(f.createElement("img",{src:"",alt:""})),n.add(i),n.add(e._createSeparator()),n.add(e._createOKCancelButtons()),t.add(n),t.render()},n.prototype._getDialogRes_link_address=function(){return this._createTextField(this.localizeString("hyperLinkDialogAddress","Address :"),ri)},n.prototype._getDialogRes_link_linkType_options=function(){return[{id:"radUrl",value:"url",text:this.localizeString("hyperLinkDialogUrl","url")},{id:"radAnchor",value:"anchor",checked:!0,text:this.localizeString("hyperLinkDialogAnchor","anchor")},{id:"radMail",value:"email",text:this.localizeString("hyperLinkDialogEmail","email")}]},n.prototype._getDialogRes_link_linkType=function(){var e=f.createDiv(ii+" ui-helper-clearfix"),t=f.createElement("div"),n=[],i;e.add(t),r.each(this._getDialogRes_link_linkType_options(),function(e,n){t.add(f.createRadio(n.id,"radioList",n.value)),t.add(f.createLabel(n.text,n.id))});for(i=1;i<8;i++)n.push("#anchor"+i.toString());return e.add(f.createSelect(si,n)),e},n.prototype._getDialogRes_Link_linkIconType=function(){var e=f.createDiv(pi),t=f.createElement("div"),n=f.createSpan(kr,this.localizeString("hyperLinkDialogIconType","Icon Type :")),i=[{id:"radLinkTypeIsText",value:"text",checked:!0,text:this.localizeString("hyperLinkDialogText","text")},{id:"radLinkTypeIsImage",value:"image",text:this.localizeString("hyperLinkDialogImage","image")}];return r.each(i,function(e,n){t.add(f.createRadio(n.id,"linkIconRadioList",n.value)),t.add(f.createLabel(n.text,n.id))}),e.add(t),t.add(n),e},n.prototype._getDialogRes_Link_text=function(){return this._createTextField(this.localizeString("hyperLinkDialogTextToDisplay","Text to display :"),oi)},n.prototype._getDialogRes_Link_image=function(){var e=f.createDiv(hi);return e.add(this._createTextField(this.localizeString("imageEditorDialogImageSrc","Image Src:"),fi)),e.add(this._createTextField(this.localizeString("imageEditorDialogImageWidth","Image width:"),li,this.localizeString("dialogPixel","px"))),e.add(this._createTextField(this.localizeString("imageEditorDialogImageHeight","Image height:"),ci,this.localizeString("dialogPixel","px"))),e},n.prototype._getDialogRes_link_target=function(){var e=f.createDiv(ui),t=f.createSpan(kr,this.localizeString("hyperLinkDialogTarget","Target :")),n=[{text:"_blank",selected:!0},"_parent","_self","_top"],r=f.createSelect(ui,n);return e.add(t),e.add(r),e},n.prototype._getDialogRes_Link_Css=function(){return this._createTextField(this.localizeString("hyperLinkDialogCss","Css :"),ai)},n.prototype._getDialogRes_Link=function(){var e=this,t=f.createDiv(ni);return t.add(e._getDialogRes_link_address()),t.add(e._getDialogRes_link_linkType()),t.add(e._createSeparator()),t.add(e._getDialogRes_Link_linkIconType()),t.add(e._getDialogRes_Link_text()),t.add(e._getDialogRes_Link_image()),t.add(e._getDialogRes_link_target()),t.add(e._getDialogRes_Link_Css()),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_TagInspector=function(){var e=this,t=f.createDiv(gi),n=f.createDiv(yi),r=f.createDiv(Ei),i=f.createDiv(Si),s=f.createDiv(Ti);return t.add(n),n.add(f.createSpan(bi,this.localizeString("tagInspectorDialogSelectedTag","Selected tag :"))),n.add(f.createSpan(wi,"")),t.add(r),r.add(f.createCheckbox("displayNoEmpty")),r.add(f.createLabel(this.localizeString("tagInspectorDialogDisplayNotEmptyAttributes","Display not empty attributes only"),"displayNoEmpty")),t.add(i),i.add(f.createSpan(kr,this.localizeString("tagInspectorDialogAttributes","Attributes:"))),i.add(f.createDiv(xi)),t.add(s),s.add(f.createSpan(kr,this.localizeString("tagInspectorDialogInnerHTML","Inner HTML:"))),s.add(f.createElement("textarea")),t.add(e._createTextField(this.localizeString("tagInspectorDialogCSSText","Css Text:"),Ni)),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_Color=function(){return this._getDialogRes_CommonColor("#FFFFFF")},n.prototype._getDialogRes_ForeColor=function(){return this._getDialogRes_CommonColor("#000000")},n.prototype._getDialogRes_BackColor=function(){return this._getDialogRes_CommonColor("#FFFFFF")},n.prototype._getDialogRes_CommonColor=function(e){var t=this,n=f.createDiv(Ci),r=f.createDiv(Li);return n.add(f.createDiv(ki)),n.add(r),r.add(f.createSpan(kr,this.localizeString("backColorDialogSelectedColor","Selected Color:"))),r.add(f.createElement("input",{type:"text",value:e})),n.add(t._createSeparator()),n.add(t._createOKCancelButtons()),n.render()},n.prototype._getDialogRes_Table=function(){var e=this,t=f.createDiv(Ai),n=f.createDiv(Fi);return t.add(e._createTextField(this.localizeString("tableDialogRows","Rows :"),Oi,"",3)),t.add(e._createTextField(this.localizeString("tableDialogColumns","Columns :"),Mi,"",3)),t.add(e._createTextField(this.localizeString("tableDialogTableWidth","Table Width :"),_i,this.localizeString("tableDialogPixels","pixels"),200)),t.add(e._createTextField(this.localizeString("tableDialogTableHeight","Table Height :"),Di,this.localizeString("tableDialogPixels","pixels"),200)),t.add(e._createTextField(this.localizeString("tableDialogBorder","Border thickness:"),Pi)),t.add(e._createTextField(this.localizeString("tableDialogCellPadding","Cell Padding :"),Hi)),t.add(e._createTextField(this.localizeString("tableDialogCellSpacing","Cell Spacing :"),Bi)),t.add(e._createTextField(this.localizeString("tableDialogCssText","Css Text :"),ji)),t.add(n),n.add(f.createSpan(kr,this.localizeString("tableDialogBackgroundColor","Background Color:"))),n.add(f.createElement("input",{type:"text"})),n.add(f.createElement("input",{type:"button",value:"..."})),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_Preview=function(){var e=this,t=f.createDiv(Ii),n=f.createDiv(qi),r=f.createDiv(Nr),i=f.createDiv(Ri),s=f.createDiv(Ji);return t.add(n),n.add(f.createSpan(kr,this.localizeString("previewDialogPreviewSize","Preview Size:"))),n.add(f.createElement("input",{id:"rad640_480",name:"preview",type:"radio",checked:"checked"})),n.add(f.createLabel("640x480","rad640_480")),n.add(f.createElement("input",{id:"rad800_600",name:"preview",type:"radio"})),n.add(f.createLabel("800x600","rad800_600")),n.add(f.createElement("input",{id:"rad1024_768",name:"preview",type:"radio"})),n.add(f.createLabel("1024x768","rad1024_768")),n.add(f.createElement("input",{id:"chkSplit",type:"checkbox",checked:"checked"})),n.add(f.createLabel(this.localizeString("previewDialogSplit","Split pages"),"chkSplit")),t.add(e._createSeparator()),t.add(r),r.add(e._createInputButton(Cr+" "+Wi,this.localizeString("previewDialogPrintAll","Print All"))),r.add(e._createInputButton(Cr+" "+Xi,this.localizeString("previewDialogPrintPage","Print Page"))),r.add(e._createInputButton(Cr+" "+Vi,this.localizeString("dialogOK","OK"))),t.add(e._createSeparator()),t.add(i),i.add(f.createElement("a",this.localizeString("previewDialogPrevPage","Prev page"),{"class":Ui,href:"#"})),i.add(f.createElement("span","1 / 1")),i.add(f.createElement("a",this.localizeString("previewDialogNextPage","Next page"),{"class":zi,href:"#"})),t.add(f.createDiv($i)),t.add(s),s.add(f.createElement("iframe",{src:"about:blank"})),t.render()},n.prototype._getDialogRes_CleanUp=function(){var e=this,t=f.createDiv(Ki),n=f.createDiv(Qi),i=f.createDiv(Gi),s=f.createDiv(Yi),o=[{id:"replaceSpans",label:this.localizeString("cleanUpDialogStripSpanTag","Strip SPAN tag")},{id:"replaceClass",label:this.localizeString("cleanUpDialogStripClass","Strip CLASS tag")},{id:"replaceStyle",label:this.localizeString("cleanUpDialogStripStyle","Strip STYLE attribute")},{id:"replaceNbsp",label:this.localizeString("cleanUpDialogReplaceSymbol","Replace &amp;nbsp; symbol")},{id:"transformPtoDiv",label:this.localizeString("cleanUpDialogTransformParagraphToDIV","Transform Paragraph to DIV")}];return t.add(n),n.add(f.createSpan(kr,this.localizeString("cleanUpDialogDocumentSource","Document source :"))),t.add(i),i.add(f.createElement("textarea",{readonly:"readonly"})),t.add(s),r.each(o,function(e,t){s.add(f.createCheckbox(t.id)),s.add(f.createLabel(t.label,t.id))}),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_FindAndReplace=function(){var e=this,t=f.createDiv(Zi),n=f.createDiv(es),r=f.createDiv(ts),i=f.createDiv(Nr);return t.add(n),n.add(f.createSpan(kr,this.localizeString("findAndReplaceDialogFind","Find:"))),n.add(f.createElement("textarea","text")),t.add(r),r.add(f.createSpan(kr,this.localizeString("findAndReplaceDialogReplace","Replace:"))),r.add(f.createElement("textarea")),t.add(e._createSeparator()),t.add(i),i.add(e._createInputButton(Cr,this.localizeString("findAndReplaceDialogFindButton","Find"))),i.add(e._createInputButton(Cr,this.localizeString("findAndReplaceDialogReplaceButton","Replace"))),t.render()},n.prototype._getDialogRes_Media=function(){var e=this,t=f.createDiv(ns),n=f.createDiv(rs);return t.add(n),n.add(f.createSpan(kr,this.localizeString("mediaDialogMediaType","Media Type :"))),n.add(f.createSelect("",["flash","video","applet","other"])),t.add(e._createTextField(this.localizeString("mediaDialogMediaUrl","Media Url :"),is)),t.add(e._createTextField(this.localizeString("mediaDialogWidth","Width :"),ss,this.localizeString("dialogPixel","px"),200)),t.add(e._createTextField(this.localizeString("mediaDialogHeight","Height :"),os,this.localizeString("dialogPixel","px"),200)),t.add(e._createSeparator()),t.add(e._createOKCancelButtons()),t.render()},n.prototype._getDialogRes_SpecialCharacter=function(){var e=this,t=f.createDiv(us),n=f.createDiv(as),i=f.createDiv(fs),s=f.createDiv(ls),o=f.createDiv(cs),u=f.createDiv(hs,"Punctuation"),a=f.createDiv(ps),l=["&#8211;","&#8212;","&iexcl;","&iquest;","&quot;","&laquo;","&raquo;","&nbsp;"],c=f.createDiv(hs,"Symbols"),h=f.createDiv(ds),p=["&amp;","&cent;","&copy;","&divide;","&gt;","&lt;","&micro;","&#8226;","&para;","&plusmn;","&#8364;","&pound;","&reg;","&sect;","&yen;"],d=f.createDiv(hs,"Diacritics"),v=f.createDiv(vs),m=["&aacute;","&Aacute;","&agrave;","&Agrave;","&acirc;","&Acirc;","&aring;","&Aring;","&atilde;","&Atilde;","&auml;","&Auml;","&aelig;","&AElig;","&ccedil;","&Ccedil;","&eacute;","&Eacute;","&egrave;","&Egrave;","&ecirc;","&Ecirc;","&euml;","&Euml;","&iacute;","&Iacute;","&igrave;","&Igrave;","&icirc;","&Icirc;","&iuml;","&Iuml;","&ntilde;","&Ntilde;","&oacute;","&Oacute;","&ograve;","&Ograve;","&ocirc;","&Ocirc;","&oslash;","&Oslash;","&otilde;","&Otilde;","&ouml;","&Ouml;","&uacute;","&Uacute;","&ugrave;","&Ugrave;","&ucirc;","&Ucirc;","&uuml;","&Uuml;","&szlig;","&yuml;","&#8216;","&#8217;"],g=f.createDiv(Nr);return t.add(n),n.add(i),i.add(s),s.add(f.createElement("span")),n.add(o),o.add(u),u.add(a),r.each(l,function(e,t){a.add(f.createLabel(t))}),o.add(c),c.add(h),r.each(p,function(e,t){h.add(f.createLabel(t))}),o.add(d),d.add(v),r.each(m,function(e,t){v.add(f.createLabel(t))}),t.add(e._createSeparator()),g.add(e._createInputButton(Cr,e.localizeString("dialogCancel","Cancel"))),t.add(g),t.render()},n.prototype._copyFromClipboard=function(){var e,t,n,i;if(o.clipboardData)return o.clipboardData.getData("Text");if(r.browser.mozilla){try{netscape.security.PrivilegeManager.enablePrivilege&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(s){}return e=Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard),e?(t=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable),t?(t.addDataFlavor("text/unicode"),e.getData(t,e.kGlobalClipboard),t.getTransferData("text/unicode",n,i),n&&(n=n.value.QueryInterface(Components.interfaces.nsISupportsString)),n?n.data.substring(0,i.value/2):""):!1):!1}},n.prototype._copyToClipboard=function(e){var t,n,i,u={},a={};if(o.clipboardData&&e)o.clipboardData.setData("Text",e);else if(r.browser.mozilla)try{netscape.security.PrivilegeManager.enablePrivilege&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),t=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!t)return;n=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!n)return;n.addDataFlavor("text/unicode"),a={},u=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString),u.data=e,n.setTransferData("text/unicode",u,e.length*2),i=Components.interfaces.nsIClipboard;if(!t)return!1;t.setData(n,null,i.kGlobalClipboard)}catch(f){u="Copy text to Clipboard \n",u+="If you are using firefox please do the following :\n ",u+="1. Write in your url box : 'about:config'\n",u+="2. Change signed.applets.codebase_principal_support = true\n",s(this.localizeString("errorMessageCopyToClipboardError",u))}},n.prototype.fixAbsoluteUrlsIfNeeded=function(e){var t=this,n=u.URL,r=u.URL,i=u.URL,s=!1,o=r.length,a=e,f,l,c,h,p,d,v,m;for(v=o-1;v>0;v--){f=r.charAt(v),l=r.charAt(v-1);if(f==="/"||f==="\\"){if(f===l)break;i=r.substring(0,v)+f,s||(r=i,s=!0)}}return c=t._prepareLiteralRegexText(n+"?"),h=new RegExp(c,"g"),a=a.replace(h,"?"),p=t._prepareLiteralRegexText(r),h=new RegExp(p,"g"),a=a.replace(h,""),d=t._prepareLiteralRegexText(i),h=new RegExp(d,"g"),a=a.replace(h,"/"),m=a.indexOf("#"),m>-1&&(a=a.substr(m)),a},n.prototype._insertCell=function(e,t){var n=e.insertCell(t);return n.innerHTML="&nbsp;",n},n.prototype._getDictionaryDeclare=function(){var e={};return e.a=["accesskey","charset","class","coords","dir","href","hreflang","id","lang","name","rel","rev","shape","tabindex","target","title"],e.b=["class","dir","id","lang","title"],e.body=["alink","background","bgColor","bgproperties","bottommargin","class","dir","id","lang","leftmargin","link","marginheight","marginwidth","rightmargin","text","title","topmargin","vlink"],e.button=["accesskey","class","dir","disabled","id","lang","name","tabindex","title","type","value"],e.code=["class","dir","id","lang","title"],e.div=["align","class","dir","id","lang","title"],e.em=["class","dir","id","lang","title"],e.font=["class","color","dir","face","id","lang","pointsize","size","title"],e.form=["action","class","dir","enctype","id","lang","method","name","runat","target","title"],e.hr=["align","class","color","id","noshade","size","title","width"],e.i=["class","dir","id","lang","title"],e.img=["align","alt","border","class","controls","dir","dynsrc","height","hspace","id","ismap","lang","longdesc","loop","lowsrc","name","src","start","title","usemap","vspace","width"],e.input=["accept","accesskey","align","alt","border","checked","class","dir","disabled","height","hspace","id","lang","maxlength","name","readonly","size","src","tabindex","title","type","usemap","value","vspace","width"],e.label=["accesskey","class","dir","for","id","lang","title"],e.li=["class","dir","id","lang","title","type","value"],e.ol=["class","compact","dir","id","lang","start","title","type"],e.option=["class","dir","disabled","id","label","lang","selected","title","value"],e.p=["align","class","dir","id","lang","title"],e.span=["class","dir","id","lang","title"],e.strong=["class","dir","id","lang","title"],e.select=["accesskey","class","dir","disabled","id","lang","multiple","name","size","tabindex","title"],e.table=["align","background","bgColor","border","bordercolor","bordercolordark","bordercolorlight","cellpadding","cellspacing","class","cols","datapagesize","dir","frame","height","hspace","id","lang","rules","summary","title","vspace","width"],e.td=["abbr","align","axis","background","bgColor","bordercolor","bordercolordark","bordercolorlight","class","colspan","dir","headers","height","id","lang","nowrap","rowspan","scope","title","valign","width"],e.th=["abbr","align","axis","background","bgColor","bordercolor","bordercolordark","bordercolorlight","class","colspan","dir","headers","height","id","lang","nowrap","rowspan","scope","title","valign","width"],e.tr=["align","bgColor","bordercolor","bordercolordark","bordercolorlight","class","dir","height","id","lang","nowrap","title","valign"],e.tbody=["align","bgColor","class","dir","id","lang","title","valign"],e.textarea=["accesskey","class","cols","dir","disabled","id","label","lang","name","readonly","rows","tabindex","title","wrap"],e.u=["class","id","xml:lang"],e.ul=["class","compact","dir","id","lang","title","type"],e},n.prototype._generateUniqueName=function(e){var t=p[e];return t||(t=0),p[e]=++t,e+t},n.prototype._setContentEditable=function(e,t){var n="designMode",i="contentEditable";try{e.body[i]&&(e.body[i]=t.toString()),e[n]&&(!t&&e[n]!=="off"?e[n]="off":t&&e[n]!=="on"&&(r.browser.msie&&a(r.browser.version)>=9&&a(r.browser.version)<11||(e[n]="on"))),t&&!r.browser.msie&&e.execCommand("useCSS",!1,!0)}catch(s){}},n.prototype._setContentSpellCheck=function(e,t){var n="spellcheck";try{e.body[n]!==undefined&&(e.body[n]=t)}catch(r){}},n.prototype._formatString=function(e,t){var n=e.length,r;for(r=0;r<t-n;r++)e="0"+e;return e},n.prototype._convertToWebColor=function(e,t,n){var r=this,i,s,o,u;if(isNaN(e)||255-e<0)e=0;if(isNaN(t)||255-t<0)t=0;if(isNaN(n)||255-n<0)n=0;return i=r._formatString(a(e).toString(16),2),s=r._formatString(a(t).toString(16),2),o=r._formatString(a(n).toString(16),2),u="#"+i+s+o,u},n.prototype._prepareLiteralRegexText=function(e){var t=e;return t=t.replace(/\\/g,"\\\\"),t=t.replace(/\./g,"\\."),t=t.replace(/\?/g,"\\?"),t},n.prototype._isNumeric=function(e){return(new RegExp("^\\d+$")).test(e)},n.prototype._isEmail=function(e){return(new RegExp("mailto:(\\S)+[@]{1}(\\S)+[.]{1}(\\w)+")).test(e)},n.prototype._isUrl=function(e){return(new RegExp("[a-zA-z]+://[^s]+")).test(e)},n.prototype._isAnchor=function(e){return(new RegExp("#[^s]+")).test(e)?!0:(new RegExp("[a-zA-z]+://[^s]+#[^s]+")).test(e)?!0:!1},n.prototype.refresh=function(){var e=this,t=e._getDesignViewDocument(),n=e.element,i=e._getHeader(),s=e._getFooter(),o=i.outerHeight(!0),u=s.outerHeight(!0),a=e._oriEleWidth,f=e._oriEleHeight,l=e._getContent(),c;e.editor.width(a).height(f),this.$ribbon.wijribbon("updateRibbonSize"),window.setTimeout(function(){e.editor.is(":visible")&&(o=i.outerHeight(!0),u=s.outerHeight(!0)),c=e.editor.height()-o-u,l.height(c),l.data("wijmo-wijsplitter")&&(e.options.editorMode==="split"?l.wijsplitter("option","splitterDistance",c/2):l.wijsplitter("refresh"))},0),r.browser.mozilla?setTimeout(e._setDesignModeForFF,1e3,e):e._setContentEditable(t,!0)},n.prototype.getText=function(){var e=this;return e._getDesignViewText()},n.prototype.setText=function(e){var t=this;e&&(t._setDesignViewText(e),t.sourceView.val(e))},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._getParentElement=function(e){var t=this,n=t._getRange(e),r,i,s,o,u;if(!n)return null;if(n.commonAncestorContainer)return r=e.getSelection(),i=n.startContainer||r.baseNode,s=n.endContainer||r.extentNode,o=n.startOffset,o===null&&(o=r.baseOffset),u=n.endOffset,u===null&&(u=r.extentOffset),i===s&&u-o===1?r.anchorNode.childNodes[r.anchorOffset]:n.commonAncestorContainer.tagName?n.commonAncestorContainer:e.document===n.commonAncestorContainer&&r.baseNode?r.baseNode.parentNode:n.commonAncestorContainer.parentNode;return n.length?n.item(0):n.parentElement?n.parentElement():null},n.prototype._getRange=function(e){var t,n;if(e.document.selection&&!o.opera)return e.document.selection.createRange();if(e.getSelection)return t=e.getSelection(),!t||t.rangeCount<1?null:(t.getRangeAt?n=t.getRangeAt(0):n=e.document.createRange(),n)},n.prototype._getInspectElement=function(){return y||this._getSelectedElement()},n.prototype._getSelectedElement=function(){return this._getParentElement(this._getDesignViewWindow())},n.prototype._checkSelectionIncludeNodeForIE11AndChrome=function(e,t,n){var r=e.document,i;if(t){i=r.createRange(),i.selectNode(n);if(t.compareBoundaryPoints(Range.START_TO_END,i)<=0||t.compareBoundaryPoints(Range.END_TO_START,i)>=0)return!1}return!0},n.prototype._checkSelectionIncludeNodeExceptIE11=function(e,t,n){var r=e.document,i=r.selection.createRange(),s="compareEndPoints";if(t){i.moveToElementText(n);if(t.inRange(i)||t[s]("StartToStart",i)>=0&&t[s]("StartToEnd",i)<=0||t[s]("EndToStart",i)>=0&&t[s]("EndToEnd",i)<=0)return!0}return!1},n.prototype._getIESelectionRange=function(){var e=this,t=this._getDesignViewWindow(),n=t.document,r,i;return e._isIE11?(r=t.getSelection(),r&&r.rangeCount>0&&(i=r.getRangeAt(0))):i=n.selection.createRange(),i},n.prototype._setIESelection=function(e,t){var n;if(!r.browser.msie)return;!e&&!t&&(e=this.rangeSelection);if(e)try{n=this._getDesignViewDocument(),this._isIE11&&n.getSelection?n.getSelection().addRange(e):e.select()}catch(i){n.body.focus()}},n.prototype._getSelectedContent=function(e){var t=this._getDesignViewWindow(),n=t.document,i="",s="cloneContents",o,u,a;return n.selection?(o=n.selection.createRange(),e?o.text:o.htmlText):(o=t.getSelection().getRangeAt(0),o&&o[s]&&(u=o[s](),a=document.createElement("div"),a.appendChild(u),i=e?r(a).text():a.innerHTML,a=null),i||"")},n.prototype._getHtmlTextInIE=function(e){if(!r.browser.msie||!e)return"";var t="",n;return this._isIE11&&e.getSelection?(n=e.getSelection(),t=n.getRangeAt&&n.rangeCount?n.getRangeAt(0).toString():""):t=e.selection.createRange().htmlText,t},n.prototype._saveSelectionForIE=function(){var e=this._getDesignViewWindow().document,t,n,i;if(!r.browser.msie)return;if(this._isIE11&&e.getSelection){t=e.getSelection(),this.rangeSelection=t.getRangeAt&&t.rangeCount?t.getRangeAt(0):null;return}t=e.selection,i=t.createRange();if(r.browser.version&&parseFloat(r.browser.version)>=9&&parseFloat(r.browser.version)<=10&&i.parentElement){n=i.parentElement();if(n&&n.tagName=="INPUT"&&n.type=="hidden")return}this.rangeSelection=i},n.prototype._storeSelectionForIE=function(){var e=this._getDesignViewWindow().document,t,n,i,s;if(!r.browser.msie)return;e.selection?(t=e.selection.createRange(),t.getBookmark&&(this.bookmark=t.getBookmark())):e.getSelection&&e.getSelection().rangeCount&&(t=e.getSelection().getRangeAt(0),n=t.cloneRange(),n.selectNode(e.body),n.setEnd(t.startContainer,t.startOffset),i=n.toString().length,t.startContainer.nodeType===3?s=t.startContainer.nodeValue:s=t.startContainer.innerHTML,this.bookmark={startContainerText:s,start:i,end:i+t.toString().length})},n.prototype._restoreSelectionForIE=function(e){var t=this,n=this._getDesignViewWindow(),i=n.document,s=!1,o,u=0,a,f,l,c,h,p,d,v,m,g,y,b,w;if(!this.bookmark||!r.browser.msie)return;if(i.selection)e?o=setInterval(function(){u++,u>5||a?(f.select(),t.bookmark=null,clearInterval(o)):(f=i.body.createTextRange(),a=f.moveToBookmark(t.bookmark))},50):(f=i.body.createTextRange(),f.moveToBookmark(this.bookmark)&&f.select(),this.bookmark=null);else if(i.getSelection){l=this.bookmark.start,y=this.bookmark.end,c=this.bookmark.startContainerText,f=i.createRange(),f.setStart(i.body,0),h=[i.body],v=0;while(!p&&(d=h.pop()))if(d.nodeType==3)m=v+d.length,!g&&(s||d.nodeValue===c)&&l>=v&&l<=m&&(f.setStart(d,l-v),g=!0),g&&y>=v&&y<=m&&(f.setEnd(d,y-v),p=!0),v=m;else{d.innerHTML===c&&(s=!0),w=d.childNodes.length;while(w--)h.push(d.childNodes[w])}b=n.getSelection(),b.removeAllRanges(),b.addRange(f),this.rangeSelection=null,this.bookmark=null}},n.prototype._setSelection=function(e,t,n){var i=this._getDesignViewWindow(),s=i.document,o,u,a,f,l=0;try{window.getSelection?(f=i.getSelection(),o=s.createRange(),u=e[0][0],a=e[e.length-1][0],o.setStart(u,0),o.setEnd(a,a.childNodes.length),f.removeAllRanges(),f.addRange(o)):(o=s.selection.createRange(),e?(r.each(e,function(e,t){l+=t.text().length}),o.moveToElementText(e[0][0]),o.collapse(!0),o.moveEnd("character",l)):(o.moveStart("textedit",-1),o.collapse(!0),o.moveStart("character",t),o.moveEnd("character",n)),o.select())}catch(c){}},n.prototype._getHyperLinkElement=function(e){while(e&&e.tagName!=="A"){if(e.tagName==="BODY"||e.tagName==="HTML")break;e=e.parentElement}return e},n}(t.wijmoWidget);n.wijeditor=Ls;var As=function(){function e(){this.initSelector=":jqmData(role='wijeditor')",this.fullScreenContainerSelector="",this.compactRibbonMode=!1,this.editorMode="wysiwyg",this.fullScreenMode=!1,this.fontSizes=[{tip:"VerySmall",name:"xx-small",text:"VerySmall"},{tip:"Smaller",name:"x-small",text:"Smaller"},{tip:"Small",name:"small",text:"Small"},{tip:"Medium",name:"medium",text:"Medium"},{tip:"Large",name:"large",text:"Large"},{tip:"Larger",name:"x-large",text:"Larger"},{tip:"VeryLarge",name:"xx-large",text:"VeryLarge"}],this.fontNames=[{tip:"Arial",name:"fn1",text:"Arial"},{tip:"Courier New",name:"fn2",text:"Courier New"},{tip:"Garamond",name:"fn3",text:"Garamond"},{tip:"Tahoma",name:"fn4",text:"Tahoma"},{tip:"Times New Roman",name:"fn5",text:"Times New Roman"},{tip:"Verdana",name:"fn6",text:"Verdana"},{tip:"Wingdings",name:"fn7",text:"Wingdings"}],this.showPathSelector=!0,this.mode="ribbon",this.commandButtonClick=null,this.simpleModeCommands=null,this.showFooter=!0,this.customContextMenu=!0,this.text=null,this.textChanged=null,this.localization=null}return e}();Ls.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new As),Ls.prototype.options.tableVirtualBorderShowing=!0,r.wijmo.registerWidget("wijeditor",Ls.prototype);var Os=mr+"-colorcanvas",Ms=mr+"-color",_s=mr+"-wheel",Ds=mr+"-overlay",Ps=mr+"-marker";r.fn.wijeditorcolorcanvas=function(e,t){var n=this.get(0);return n.wijeditorcolorcanvas||(n.wijeditorcolorcanvas=new Hs(n,e,t))};var Hs=function(){function e(e,t,n){var i=this,s="",o,f;f="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, ",s+="<div class='"+Os+"'>",s+="<div class='"+Ms+"'></div>",s+="<div class='"+_s+"'></div>",s+="<div class='"+Ds+"'></div>",s+="<div class='h-marker "+Ps+"'></div>",s+="<div class='sl-marker "+Ps+"'></div></div>",r(e).html(s),o=r("."+Os,e),i.wheel=r("."+_s,e).get(0),i.radius=84,i.square=100,i.width=194,r.browser.msie&&parseInt(r.browser.version,10)<7&&r("*",o).each(function(){var e=this,t=e.currentStyle.backgroundImage;return t!=="none"&&(t=t.substring(5,t.length-2),r(e).css({backgroundImage:"none",filter:f+"src='"+t+"')"})),this}),i.linkTo=function(e){typeof i.callback=="object"&&r(i.callback).unbind("keyup",i.updateValue),i.color=null;if(typeof e=="function")i.callback=e;else if(typeof e=="object"||typeof e=="string")i.callback=r(e),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value);return this},i.updateValue=function(e){var t=this;t.value&&t.value!==i.color&&i.setColor(t.value)},i.setColor=function(e){var t=i.unpack(e);return i.color!==e&&t&&(i.color=e,i.rgb=t,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(e){return i.hsl=e,i.rgb=i.HSLToRGB(e),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(e){var t,n,s,o,u;return s=e.target||e.srcElement,o=i.wheel,u=i.absolutePosition(o),t=(e.pageX||0*(e.clientX+r("html").get(0).scrollLeft))-u.x,n=(e.pageY||0*(e.clientY+r("html").get(0).scrollTop))-u.y,{x:t-i.width/2,y:n-i.width/2}},i.mousedown=function(e){u.dragging||(r(u).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),u.dragging=!0);var t=i.widgetCoords(e);return i.circleDrag=Math.max(Math.abs(t.x),Math.abs(t.y))*2>i.square,i.mousemove(e),!1},i.mousemove=function(e){var t=i.widgetCoords(e),n,r,s;return i.circleDrag?(n=Math.atan2(t.x,-t.y)/6.28,n<0&&(n+=1),i.setHSL([n,i.hsl[1],i.hsl[2]])):(r=Math.max(0,Math.min(1,-(t.x/i.square)+.5)),s=Math.max(0,Math.min(1,-(t.y/i.square)+.5)),i.setHSL([i.hsl[0],r,s])),!1},i.mouseup=function(){r(u).unbind("mousemove",i.mousemove).unbind("mouseup",i.mouseup),u.dragging=!1},i.updateDisplay=function(){var e=i.hsl[0]*6.28,t;r(".h-marker",o).css({left:Math.round(Math.sin(e)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(e)*i.radius+i.width/2)+"px"}),r(".sl-marker",o).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),r("."+Ms,o).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),typeof i.callback=="object"?(r(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),r(i.callback).each(function(){return t=this,t.value&&t.value!==i.color&&(t.value=i.color),this})):typeof i.callback=="function"&&i.callback.call(i,i.color)},i.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop},n;return e.offsetParent&&(n=i.absolutePosition(e.offsetParent),t.x+=n.x,t.y+=n.y),t},i.pack=function(e){var t=Math.round(e[0]*255),n,r;return n=Math.round(e[1]*255),r=Math.round(e[2]*255),"#"+(t<16?"0":"")+t.toString(16)+(n<16?"0":"")+n.toString(16)+(r<16?"0":"")+r.toString(16)},i.unpack=function(e){if(e.length===7)return[a("0x"+e.substring(1,3))/255,a("0x"+e.substring(3,5))/255,a("0x"+e.substring(5,7))/255];if(e.length===4)return[a("0x"+e.substring(1,2))/15,a("0x"+e.substring(2,3))/15,a("0x"+e.substring(3,4))/15]},i.HSLToRGB=function(e){var t,n,r,i,s,o=this;return r=e[0],i=e[1],s=e[2],n=s<=.5?s*(i+1):s+i-s*i,t=s*2-n,[o.hueToRGB(t,n,r+.33333),o.hueToRGB(t,n,r),o.hueToRGB(t,n,r-.33333)]},i.hueToRGB=function(e,t,n){return n=n<0?n+1:n>1?n-1:n,n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(.66666-n)*6:e},i.RGBToHSL=function(e){var t,n,r,i,s,o,u,a,f;return u=e[0],a=e[1],f=e[2],t=Math.min(u,Math.min(a,f)),n=Math.max(u,Math.max(a,f)),r=n-t,o=(t+n)/2,s=0,o>0&&o<1&&(s=r/(o<.5?2*o:2-2*o)),i=0,r>0&&(n===u&&n!==a&&(i+=(a-f)/r),n===a&&n!==f&&(i+=2+(f-u)/r),n===f&&n!==u&&(i+=4+(u-a)/r),i/=6),[i,s,o]},r("*",o).mousedown(i.mousedown),i.setColor(n||"#000000"),t&&i.linkTo(t)}return e}();n._wijeditorcolorcanvas=Hs})(t.editor||(t.editor={}));var n=t.editor})(wijmo||(wijmo={}))});