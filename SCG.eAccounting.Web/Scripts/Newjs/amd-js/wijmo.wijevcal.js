var wijmo;define(["./wijmo.widget","globalize","./wijmo.wijcalendar","./wijmo.wijpopup","./wijmo.wijdialog","./wijmo.wijdatepager","./wijmo.wijsuperpanel","./wijmo.wijcheckbox","./wijmo.wijtextbox","./wijmo.wijdropdown","./wijmo.wijinputdate","exportUtil"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){function s(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function o(){var e,t,n;e="";for(n=0;n<32;n+=1){if(n===8||n===12||n===16||n===20)e+="-";t=Math.floor(Math.random()*16).toString(16).toUpperCase(),e+=t}return e}function h(e,t,n){l?(c=amplify.store("wijevcal_tables1"),c||(c={}),c[e]||(c[e]={fields:t},amplify.store("wijevcal_tables1",c),amplify.store("wijevcal_tbl_"+e,{})),n&&n()):u&&u.transaction(function(r){r.executeSql("SELECT COUNT(*) FROM "+e,[],function(){n&&n()},function(r,i){r.executeSql("CREATE TABLE "+e+" "+t,[],n,n)})})}function p(e,t,n,r){var i={rowsAffected:0,rows:new Array},s,o,a,f,h,p,d,v,m,g,y,b,w,E;t||(t=[]),i.rows.item||(i.rows.item=function(e){return this[e]});if(l)try{a=new RegExp("(SELECT) *(.*) *FROM (\\w+)"),f=new RegExp("(INSERT OR REPLACE|INSERT) *(.*) *INTO *(\\w*) *\\(([\\w|,| ]*)\\)"),h=new RegExp("(DELETE) *(.*) *FROM (\\w+) *(\\w*)WHERE (\\w+)='*([^']+)");if(e.match(f)){p=f.exec(e);if(p&&p.length>1){d=p[3],v=c[d],m=amplify.store("wijevcal_tbl_"+d);if(m){y=p[4].split(","),s={};for(o=0;o<y.length;o+=1)y[o]&&(o===0&&(m[t[o]]=s),b=y[o].replace(" ",""),s[b]=t[o])}amplify.store("wijevcal_tbl_"+d,m)}}else if(e.match(a)){p=a.exec(e);if(p&&p.length>1){d=p[3],v=c[d],m=amplify.store("wijevcal_tbl_"+d);if(m){w=e.replace(a,"");if(w.toUpperCase().indexOf(" WHERE ")===0){w=w.substr(7),E=w.split(" OR ");for(o=0;o<E.length;o+=1)E[o]=E[o].split("="),w=E[o][1],w.indexOf("'")===0?(w=w.substring(1,w.length-1),E[o][1]=w):E[o][1]=parseFloat(w)}for(g in m)if(m.hasOwnProperty(g)){s=m[g];if(s)if(E)for(o=0;o<E.length;o+=1)s[E[o][0]]===E[o][1]&&i.rows.push(s);else i.rows.push(s)}}}}else e.match(h)&&(p=h.exec(e),p&&p.length>1&&(d=p[3],v=c[d],m=amplify.store("wijevcal_tbl_"+d),m&&m[p[6]]&&delete m[p[6]],amplify.store("wijevcal_tbl_"+d,m)));n&&n(i)}catch(S){r&&r(S)}else{if(!u){r("Local data storage not found.");return}u.transaction(function(i){i.executeSql(e,t,function(e,t){n&&n(t)},function(e,t){r&&r(t.message);return})})}}var r=jQuery,i="wijevcal",u,a="C1EventsCalendarDB",f="1.1",l=!1,c,d=function(t){function n(){t.apply(this,arguments),this._dynIdCounter=0}return e(n,t),n.prototype._setOption=function(e,t){var n=this,i=r.when.apply(this,n._defferObjs),s;i.always(function(){n._setOptionCallbacks.fire(),n._setOptionCallbacks.empty(),n._defferObjs=[]}),i.state()==="pending"?this._setOptionCallbacks.add(function(){r.isPlainObject(t)?s=r.extend(!0,{},t):r.isArray(t)?s=[].concat(t):s=t,n._setOptionInternal(e,s)}):this._setOptionInternal(e,t)},n.prototype._setOptionInternal=function(e,t){var n=this,i=n.options,o,u,a,f,l,c;switch(e){case"dataSource":i.dataSource=t,n._needLoadLocalStorage=!1,i.eventsData=[],n._bindDataView();break;case"eventsData":i.eventsData=t,i.appointments=t,n._needLoadLocalStorage=!1,n._onEventsDataChanged(),n._bindEvents();break;case"appointments":i.eventsData=t,i.appointments=t,n._needLoadLocalStorage=!1,n._onEventsDataChanged(),n._bindEvents();break;case"localization":n._setLocalization(t);break;case"culture":case"cultureCalendar":i[e]=t,n._innerCulture=null,n._resetCulture(),n.element.find(".wijmo-wijdatepager").wijdatepager("option",e,t),n._editEventDialog&&n._editEventDialog.find(".wijmo-wijinput-date").wijinputdate("option",e,t),n.element.find(".wijmo-wijcalendar").wijcalendar("option",e,t),n._redrawActiveView();break;case"calendar":n.element.find(".wijmo-wijcalendar").wijcalendar("option",t),n._redrawActiveView();break;case"disabled":i.disabled!==t&&(i.disabled=t,n._ensureDisabled());break;case"enableLogs":i.enableLogs=t,n._initLogPanel();break;case"selectedDate":t&&(t=s(t),i.selectedDates[0].getTime()!==t.getTime()&&(i.selectedDates[0]=t,n._onSelectedDatesChanged()));return;case"selectedDates":t&&(i.selectedDates=t,n._onSelectedDatesChanged());return;case"statusBarVisible":i.statusBarVisible=t,n._initStatusbar(),n.invalidate();return;case"headerBarVisible":i.headerBarVisible=t,n._initHeaderbar(),n.invalidate();return;case"navigationBarVisible":i.navigationBarVisible=t,n._initNavigationbar(),n.invalidate();return;case"rightPaneVisible":i.rightPaneVisible=t,n._initRightPane(),n.invalidate();return;case"timeInterval":case"timeIntervalHeight":case"timeRulerInterval":case"timeRulerFormat":i[e]!==t&&(i[e]=t,n._redrawActiveView());break;case"firstDayOfWeek":i[e]!==t&&(i[e]=t,n._redrawActiveView(),o=n._getCulture(),o&&o.calendar&&(o.calendar.firstDay=t,u=n.element.find(".wijmo-wijcalendar").data("wijmo-wijcalendar"),u&&u._getCulture&&u.refresh&&(u._getCulture().calendar.firstDay=t,u.refresh())));break;case"viewType":i.viewType!==t&&(i.viewType=t,n._updateSelectedDates());break;case"views":i.views!==t&&(!t||t.length===0?i.views=["day"]:i.views=t,n._unBindToolsBarEvent(),a=n.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),a.empty(),a.append(n._getToolsButtonMarkup()),f=n._getCurrentViewIndex(),c=i.views[f],l=r.isPlainObject(c)?c.name:c,i.viewType!==l&&(i.viewType=l,n._updateSelectedDates()),a.find("input:eq("+f+")")[0].checked=!0,n._setToolsBar(),n.invalidate());break;default:}r.wijmo.widget.prototype._setOption.apply(n,arguments)},n.prototype._updateSelectedDates=function(){var e=this,t=this.options;if(t.viewType.toLowerCase()==="day"||t.viewType.toLowerCase()==="list")t.selectedDates=[t.selectedDate];e._onViewTypeChanged()},n.prototype._setLocalization=function(e){this._destroyInternal(),this.options.localization=e,this._create(),this._init()},n.prototype._ensureDisabled=function(){var e=this.options;if(this._isDisabled()){this.element.addClass(e.wijCSS.stateDisabled);try{this.element.find(".wijmo-wijcalendar").wijcalendar("option","disabled",!0),this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option","disabled",!0),this.element.find(".wijmo-wijdatepager").wijdatepager("option","disabled",!0),r().buttonset&&this.element.find(".ui-buttonset").buttonset("option","disabled",!0),this.element.find(".wijmo-wijev-today.ui-button").button("option","disabled",!0)}catch(t){this.log(t,"error")}this._unbindEvents()}else{this.element.removeClass(e.wijCSS.stateDisabled);try{this.element.find(".wijmo-wijcalendar").wijcalendar("option","disabled",!1),this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option","disabled",!1),this.element.find(".wijmo-wijdatepager").wijdatepager("option","disabled",!1),r().buttonset&&this.element.find(".ui-buttonset").buttonset("option","disabled",!1),this.element.find(".wijmo-wijev-today.ui-button").button("option","disabled",!1)}catch(t){this.log(t,"error")}this._bindEvents(),this._updateTitleText()}},n.prototype._isCustomView=function(e){var t=this,n=e||t._getCurrentViewIndex();return n<0?!1:r.isPlainObject(t.options.views[n])},n.prototype._resetSuperPanelScrollPosition=function(e){e.each(function(e,t){var n=r(t);n.data("wijmoWijsuperpanel")&&(n.wijsuperpanel("option","vScroller").scrollValue=0,n.wijsuperpanel("option","hScroller").scrollValue=0)})},n.prototype._onViewTypeChanged=function(){var e=this,t=e.options,n=e._getCurrentViewIndex(),r=e._isCustomView(n),i=this.element.find(".wijmo-wijev-panel");i&&e._resetSuperPanelScrollPosition(i),e._renderActiveView(),e._updateTitleText(),e._resetHeaderContainer(),e._trigger("viewTypeChanged",null,e.options.viewType),e.element.find(".wijmo-wijev-datepager").wijdatepager("option","viewType",r?"custom":e.options.viewType),r&&e.element.find(".wijmo-wijev-datepager").wijdatepager("option","customViewOptions",t.views[n])},n.prototype._onSelectedDatesChanged=function(){var e=this,t=e.options;t.selectedDate=t.selectedDates[0],e.element.find(".wijmo-wijev-datepager").wijdatepager("option","selectedDate",t.selectedDate),e._trigger("selectedDatesChanged",null,{selectedDates:t.selectedDates}),e._renderActiveView(),e._updateTitleText(),e._updateHeaderPosition()},n.prototype._updateHeaderPosition=function(){var e=this,t={afterPosition:{left:0}},n=e.element.find(".wijmo-wijev-scrollpanel"),r=n.wijsuperpanel("option","hScroller").scrollValue;t.afterPosition.left=-n.wijsuperpanel("scrollValueToPx",r,"h"),e._scrolling(null,t)},n.prototype._updateHeaderTitleText=function(){var e=this,t=e.options,n=t.titleFormat,r=t.selectedDates[0],i=t.selectedDates[t.selectedDates.length-1],s=e._getCurrentViewIndex(),o=e._isCustomView(s),u;o?u="custom":u=t.viewType;if(n[u])n=n[u];else{if(n[u]===!1){e.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").hide();return}n=n.toString()}if(t.viewType==="list")i=e._addDays(r,14);else if(o)switch(e._getCustomViewUnit()){case"month":i=e._addMonths(r,(t.views[s].count||1)-1);break;case"year":i=e._addYears(r,(t.views[s].count||1)-1)}e.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").show().html(e._formatString(n,r,i))},n.prototype._updateTitleText=function(){var e=this,t=e.options,n=t.selectedDates[0],i=t.selectedDates[t.selectedDates.length-1],s=new Date,o=!1;o=e._compareDayDates(n,s)===0||n<s&&e._addDays(i,1)>s,r.mobile==null&&e.element.find(".wijmo-wijev-navigationbar .wijmo-wijev-today").button("option","disabled",o),e._updateHeaderTitleText()},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._create=function(){window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r));var e=this,n,i,s,o=e.options,u=e._isCustomView();e._defferObjs=[],e._chromeLoadDataDeffer=r.Deferred(),e._defferObjs.push(e._chromeLoadDataDeffer),e._setOptionCallbacks=r.Callbacks("once"),e._needLoadLocalStorage=!0;if(e.options.appointments&&e.options.appointments.length||e.options.eventsData&&e.options.eventsData.length)e._needLoadLocalStorage=!1;r.isFunction(window.wijmoASPNetParseOptions)&&window.wijmoASPNetParseOptions(e.options),o.colors||(o.colors=["red","darkorchid","green","blue","cornflowerblue","yellow","bronze"]),e.wijevcalnamespacekey||(e.wijevcalnamespacekey="wijevcal"+(new Date).getTime()),e.element[0].id||(e.element[0].id="wijevcal_dynid_"+(new Date).getTime()),e._uidPref=e.element[0].id+"evcdynid",e.element.addClass("wijmo-wijevcal wijmo-wijev "+o.wijCSS.widget+" "+o.wijCSS.helperReset+" "+o.wijCSS.stateDefault),n=!!o.views&&o.views.length>0?e._viewsToLower(o.views):["day"],e._getCurrentViewIndex()<0&&(o.viewType=e._isCustomView(0)?n[0].name:n[0]),r('<div class="wijmo-wijev-headerbar '+o.wijCSS.header+" "+o.wijCSS.cornerTop+'">'+'<fieldset class="wijmo-wijev-tools">'+e._getToolsButtonMarkup()+"</fieldset>"+"</div>").appendTo(e.element),r('<div class="wijmo-wijev-view-container"><div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails '+o.wijCSS.content+' wijmo-wijev-day-details">'+'<div class="wijmo-wijev-leftpane-inner">'+'<div class="wijmo-wijev-daycalendar"></div>'+'<div class="wijmo-wijev-monthday-container">'+'<div class="wijmo-wijev-monthday-label">...</div>'+'<div class="wijmo-wijev-fulldate-label">'+e.localizeString("activityLoading","Loading...")+"</div>"+'<div class="wijmo-wijev-year-label">...</div>'+"</div>"+'<div class="wijmo-wijev-agenda-container '+o.wijCSS.content+" "+o.wijCSS.cornerAll+" "+o.wijCSS.helperClearFix+'"></div>'+"</div>"+"</div>"+'<div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails '+o.wijCSS.content+' wijmo-wijev-list-details">'+'<div class="wijmo-wijev-leftpane-inner">'+'<div class="wijmo-wijev-agenda-container '+o.wijCSS.content+" "+o.wijCSS.cornerAll+" "+o.wijCSS.helperClearFix+'">&nbsp;'+"</div>"+"</div>"+"</div>"+'<div class="wijmo-wijev-rightpane">'+"&nbsp;</div>"+"</div>").appendTo(e.element),r('<div class="wijmo-wijev-loading-modal-frame"></div><div class="wijmo-wijev-loading"><div class="wijmo-wijev-loading-text">'+e.localizeString("activityLoading","Loading...")+"</div></div>").appendTo(e.element),r('<div class="wijmo-wijev-navigationbar '+o.wijCSS.header+" "+o.wijCSS.cornerBottom+" "+o.wijCSS.helperClearFix+'">'+'<a class="wijmo-wijev-today">'+e.localizeString("buttonToday","today")+"</a>"+'<div class="wijmo-wijev-datepager">'+"</div>"+"</div>").appendTo(e.element),r('<div class="wijmo-wijev-statusbar '+o.wijCSS.header+" "+o.wijCSS.cornerBottom+'">'+"</div>").appendTo(e.element),i=e.element.find(".wijmo-wijev-navigationbar"),r.mobile!=null?i.find(".wijmo-wijev-today").addClass("ui-btn ui-btn-corner-all").click(r.proxy(e._onTodayClick,e)):i.find(".wijmo-wijev-today").button({text:e.localizeString("buttonToday","today")}).click(r.proxy(e._onTodayClick,e)),e._setToolsBar(),e.element.find(".wijmo-wijev-datepager").wijdatepager({customViewOptions:u?o.views[e._getCurrentViewIndex()]:{},selectedDate:o.selectedDate,localization:o.datePagerLocalization,culture:o.culture,cultureCalendar:o.cultureCalendar,viewType:u?"custom":o.viewType,nextTooltip:e.localizeString("navigatorBarNextTooltip","right"),prevTooltip:e.localizeString("navigatorBarPrevTooltip","left"),firstDayOfWeek:o.firstDayOfWeek,selectedDateChanged:r.proxy(function(t,n){e.goToDate(n.selectedDate)},e)}),e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver(),e._redrawActiveView()},"wijevcal"),e.showLoadingLabel(),t.prototype._create.call(this)},n.prototype._setToolsBar=function(){var e=this,t=e.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),n=e.options;r.mobile==null?(t.find(".wijmo-wijev-day").button().button("widget").addClass(n.wijCSS.stateDefault),t.find(".wijmo-wijev-week").button().button("widget").addClass(n.wijCSS.stateDefault),t.find(".wijmo-wijev-month").button().button("widget").addClass(n.wijCSS.stateDefault),t.find(".wijmo-wijev-list").button().button("widget").addClass(n.wijCSS.stateDefault),r.each(t.find(".wijmo-wijev-custom"),function(e,t){r(t).button().button("widget").addClass(n.wijCSS.stateDefault)}),t.buttonset()):(t.attr("data-role","controlgroup"),t.attr("data-type","horizontal"),t.parent().trigger("create"),t.controlgroup("refresh")),e._bindToolsBarEvent()},n.prototype._bindToolsBarEvent=function(){var e=this,t=e.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),n=e.options;t.find(".wijmo-wijev-day").click(r.proxy(e._onDayViewClick,e)),t.find(".wijmo-wijev-week").click(r.proxy(e._onWeekViewClick,e)),t.find(".wijmo-wijev-month").click(r.proxy(e._onMonthViewClick,e)),t.find(".wijmo-wijev-list").click(r.proxy(e._onListViewClick,e)),t.find(".wijmo-wijev-custom").click(r.proxy(e._onCustomViewClick,e))},n.prototype._unBindToolsBarEvent=function(){var e=this,t=e.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),n=e.options;t.find(".wijmo-wijev-day").unbind("click"),t.find(".wijmo-wijev-week").unbind("click"),t.find(".wijmo-wijev-month").unbind("click"),t.find(".wijmo-wijev-list").unbind("click"),t.find(".wijmo-wijev-custom").unbind("click")},n.prototype._viewsToLower=function(e){var t=[];return r.each(e,function(e,n){t.push(typeof n=="string"?n.toLowerCase():n)}),t},n.prototype._getToolsButtonMarkup=function(){var e=this,t=e.options,n=e._viewsToLower(t.views),i,s="",o,u;return r.each(n,function(t,n){var a=!1;if(r.isPlainObject(n))i=e.localizeString("customView",n.name||"Custom"),o="custom",u="custom"+n.name,a=!0;else{u=o=n,a=!0;switch(n){case"day":i=e.localizeString("buttonDayView","Day");break;case"week":i=e.localizeString("buttonWeekView","Week");break;case"month":i=e.localizeString("buttonMonthView","Month");break;case"list":i=e.localizeString("buttonListView","List");break;default:a=!1}}a&&(s+='<input id="'+e._uidPref+"_"+u+'btn" name="viewselection"'+' type="radio" class="wijmo-wijev-'+o+"\" value='"+t+"' />"+'<label for="'+e._uidPref+"_"+u+'btn">'+i+"</label>")}),s},n.prototype.showLoadingLabel=function(e,t){e===!1?this.element.find(".wijmo-wijev-loading-text").hide():(this.element.find(".wijmo-wijev-loading-text").show(),e||(e=this.localizeString("activityLoading","Loading..."))),(t===undefined||t===!0)&&this.element.find(".wijmo-wijev-loading-modal-frame").show(),this.element.find(".wijmo-wijev-loading").show(),this.element.find(".wijmo-wijev-loading-text").html(e)},n.prototype.hideLoadingLabel=function(){this.element.find(".wijmo-wijev-loading-modal-frame").hide(),this.element.find(".wijmo-wijev-loading").hide()},n.prototype._init=function(){var e=this.options;e.selectedDates&&e.selectedDates.length>0?e.selectedDate=e.selectedDates[0]=s(e.selectedDates[0]):e.selectedDate?(e.selectedDate=s(e.selectedDate),e.selectedDates||(e.selectedDates=[]),e.selectedDates[0]=e.selectedDate):(e.selectedDate=s(new Date),e.selectedDates=[e.selectedDate]),this._isDisabled()&&this.element.addClass(e.wijCSS.stateDisabled),this._initHeaderbar(),this._initNavigationbar(),this._initStatusbar(),this._initRightPane(),e.fullScreen&&this._onFullScreenModeChanged(e.fullScreen),this._initLogPanel(),this._initLocalDataStorage(),this.element.ajaxError(jQuery.proxy(this._onAjaxError,this)),r(window).bind("resize."+this.wijevcalnamespacekey,r.proxy(this._onWindowResize,this)),this._renderActiveView(),this._bindDataView()},n.prototype._onFullScreenModeChanged=function(e){},n.prototype._isDataViewLoaded=function(e){return e&&(e.isLoaded()||e.count()>0)},n.prototype._isDataview=function(e){if(e&&typeof e=="object"&&!r.isArray(e))return!0},n.prototype._getDataViewInst=function(){return this.element.data("wijdataview")},n.prototype._bindDataView=function(){var e=this.options,t=e.dataSource,t,n=this;!t&&this._getDataViewInst()&&(t=this._getDataViewInst(),t=e.dataSource=t),t&&this._isDataview(t)?this._isDataViewLoaded(t)?(this._dataView=t,this._setOption("eventsData",t.toArray())):t.element.bind("dataloaded",function(){n._dataView=t,n._setOption("eventsData",t.toArray())}):this._dataView=null},n.prototype._initLocalDataStorage=function(){try{l=!1;if(window.amplify&&window.amplify.store)try{c=amplify.store("wijevcal_tables1"),l=!0,this.log("Using amplify.store for the local data storage")}catch(e){this.log("amplify.store exception:"+e),this._loadData();return}else{if(!window.openDatabase){this.log(this.localizeString("logCouldntOpenLocalStorage","Couldn't open built-in local data storage. Please, add amplify.store references.")),this._loadData();return}try{u=window.openDatabase(a,f,"Wijmo Events Calendar Offline DB",2e5)}catch(t){this.log("web sql database error: "+t),this._loadData();return}if(!u){this.log("Failed to open the database on disk. This is probably because the version was bad or there is not enough space left in this domain's quota"),this._loadData();return}this.log("Using Web SQL Database for the local data storage.")}h("calendars","(id TEXT PRIMARY KEY, name TEXT, location TEXT, description TEXT, color TEXT, tag TEXT)");var n=r.Deferred(),i=this;this._defferObjs.push(n),h("events","(id TEXT PRIMARY KEY, calendar TEXT, subject TEXT, location TEXT, start TIMESTAMP, end TIMESTAMP, description TEXT, color TEXT, allday INTEGER, properties TEXT, tag TEXT)",function(){i._loadData(),n.resolve()})}catch(s){this.log("local datastorage initialization error:"+s)}},n.prototype._initStatusbar=function(){var e=this.element.find(".wijmo-wijev-statusbar");if(!this.options.statusBarVisible){e.hide();return}e.css("float","left"),e.show(),this.statusbarEventsAdded||(this.statusbarEventsAdded=!0)},n.prototype._initHeaderbar=function(){var e=this.element.find(".wijmo-wijev-headerbar");if(!this.options.headerBarVisible){e.hide();return}e.show()},n.prototype._initNavigationbar=function(){var e=this.element.find(".wijmo-wijev-navigationbar");if(!this.options.navigationBarVisible){e.hide();return}e.show()},n.prototype._initRightPane=function(){var e=this.element.find(".wijmo-wijev-rightpane");if(!this.options.rightPaneVisible){e.hide();return}e.show()},n.prototype._initLogPanel=function(){this.options.enableLogs?(this._createLogPanel(),this.log=this._log):(this.logDialog&&this.logDialog.wijdialog("close"),this.log=function(){})},n.prototype._handleServerError=function(e){return e&&e.toString().indexOf("error:")===0?(this.status(e.toString(),"error"),!0):!1},n.prototype._loadData=function(){var e=this.options,t=this,n,i,s,o,u,a,f,l,c,h,d,v,m;this.showLoadingLabel(),h=function(e){e==="Local data storage not found."&&(m=!0),t.hideLoadingLabel()},e.calendars=[],u=this._calendarsById={},l=function(r){e.calendars=[];if(!r)return;if(typeof r=="string"){if(t._handleServerError(r)){h(r);return}try{r=t._jsonParse(r)}catch(i){t.status("Unable to parse received calendars data. "+i,"error");return}}r.calendars&&r.calendars.length&&(r=r.calendars);for(n=0;n<r.length;n+=1)s=t._cloneObj(r[n]),s.prevData=t._cloneObj(s),e.calendars.push(s),u[s.id]=s;t._onCalendarsChanged()},e.dataStorage.loadCalendars?e.dataStorage.loadCalendars(l,h):e.webServiceUrl?r.getJSON(e.webServiceUrl+"?clientId="+this.element[0].id+"&command=loadCalendars"+"&calendars="+e.calendars,l):p("SELECT * FROM calendars",[],function(r){for(n=0,i=r.rows.length;n<i;n+=1)s=t._cloneObj(r.rows.item(n)),s.prevData=t._cloneObj(s),e.calendars.push(s),u[s.id]=s;t._onCalendarsChanged()},h),this._dataView&&(e.eventsData=this._dataView.toArray()),this._eventsDataById?a=this._eventsDataById:a=this._eventsDataById={},e.eventsData||(e.eventsData=[]),c=function(e){if(!e)return;if(typeof e=="string"){if(t._handleServerError(e)){h(e);return}try{e=t._jsonParse(e)}catch(r){t.log("Unable to parse received calendars data. "+r);return}}e.events&&e.events.length&&(e=e.events);for(n=0;n<e.length;n+=1)a[e[n].id]||(o=t._readEventData(e[n]),t._storeEventWithSort(o));t._onEventsDataChanged(),t._onInitialized()};if(e.dataStorage.loadEvents)e.dataStorage.loadEvents(e.visibleCalendars,c,h),t._chromeLoadDataDeffer.resolve();else if(e.webServiceUrl)r.ajax({url:e.webServiceUrl+"?clientId="+this.element[0].id+"&command=loadEvents&timestamp="+(new Date).getTime(),dataType:"text",cache:!1,contentType:"application/json; charset=utf-8",type:"POST",success:c,error:h}),t._chromeLoadDataDeffer.resolve();else{if(this._dataView){this._onInitialized();return}f="SELECT * FROM events where ";for(n=0;n<e.visibleCalendars.length;n+=1)n>0&&(f+=" OR "),f+="calendar='"+e.visibleCalendars[n]+"'";p(f,[],function(r){if(t._needLoadLocalStorage){e.eventsData=[];for(n=0,i=r.rows.length;n<i;n+=1)o=t._readEventData(r.rows.item(n)),t._storeEventWithSort(o)}t._onEventsDataChanged(),t._onInitialized(),t._chromeLoadDataDeffer.resolve()},function(){h.apply(this,arguments),m&&(t._onEventsDataChanged(),t._onInitialized()),t._chromeLoadDataDeffer.resolve()})}},n.prototype._onInitialized=function(){this._ensureDisabled(),this.hideLoadingLabel(),this._trigger("initialized")},n.prototype._readEventData=function(e){var t=this._cloneObj(e);return t.start=new Date(t.start),t.end=new Date(t.end),typeof t.allday=="string"&&(t.allday==="false"&&(t.allday=!1),t.allday==="true"&&(t.allday=!0)),t.start.getTime()>=t.end.getTime()&&(t.end=this._addMinutes(t.start,this.options.timeInterval)),this._deSerializeProperties(t.properties,t),t.prevData=this._cloneObj(t),t},n.prototype._prepareEventsForView=function(){this._eventsView=this.getOccurrences()},n.prototype._cloneObj=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},n.prototype._onDayViewClick=function(){var e=this.options;if(this._isDisabled())return;e.viewType!=="day"&&(e.viewType="day",this._onViewTypeChanged()),e.selectedDates=[e.selectedDate],this._onSelectedDatesChanged()},n.prototype._onCustomViewClick=function(e){var t=this,n=t.options,i,s,o,u;if(t._isDisabled())return;u=n.views[r(e.target).val()]||{name:"Custom",unit:"day",count:1},n.viewType!==u.name&&(n.viewType=u.name,t._onViewTypeChanged()),i=n.selectedDate,s=u.count||1;switch(t._getCustomViewUnit()){case"week":t._addSelectedDatesForWeekView(s);break;case"day":n.selectedDates=[];for(o=0;o<s;o++)n.selectedDates.push(t._addDays(i,o));t._onSelectedDatesChanged()}},n.prototype._addSelectedDatesForWeekView=function(e){typeof e=="undefined"&&(e=1);var t=this,n=t.options,r,i,s,o=n.selectedDate;s=n.firstDayOfWeek-o.getDay(),Math.abs(s)>6&&(s=o.getDay()-n.firstDayOfWeek),o=t._addDays(o,s),n.selectedDates=[];for(s=0;s<7*(e||1);s+=1)n.selectedDates.push(t._addDays(o,s));t._onSelectedDatesChanged()},n.prototype._onWeekViewClick=function(){var e=this,t=e.options,n,r;if(e._isDisabled())return;t.viewType!=="week"&&(t.viewType="week",e._onViewTypeChanged()),e._addSelectedDatesForWeekView()},n.prototype._onMonthViewClick=function(){var e=this.options;if(this._isDisabled())return;e.viewType!=="month"&&(e.viewType="month",this._onViewTypeChanged())},n.prototype._onListViewClick=function(){var e=this.options;if(this._isDisabled())return;e.viewType!=="list"&&(e.viewType="list",this._onViewTypeChanged()),e.selectedDates=[e.selectedDate],this._onSelectedDatesChanged()},n.prototype._ensureEditCalendarDialogCreated=function(){var e=this.options,t,n={};this._editCalendarDialog||(t=e.editCalendarTemplate,t||(t="<p><label>"+this.localizeString("labelCalendarName","Calendar name")+"</label>"+'<input type="text" class="wijmo-wijev-name" value=""> '+'<div class="wijmo-wijev-color-button">'+'<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>'+"</div>"+"</p>"+"<p><label>"+this.localizeString("labelLocation","Location")+"</label>"+'<input type="text" class="wijmo-wijev-location" value=""></p>'+"<p><label>"+this.localizeString("labelDescription","Description")+'</label><textarea class="wijmo-wijev-description" /></p>'),this._editCalendarDialog=r('<div class="wijmo-wijev-editcalendar-dialog">'+t+"</div>"),this.element.append(this._editCalendarDialog),n[this.localizeString("buttonSave","Save")]=r.proxy(function(){try{var e=this._validateAndReadCalendarDialogFields(this._editCalendarDialog);e.prevData?this.updateCalendar(e):this.addCalendar(e),this._editCalendarDialog.wijdialog("close")}catch(t){alert(t)}},this),this._editCalendarDialog.wijdialog({autoOpen:!0,height:340,width:440,modal:!0,title:this.localizeString("titleEditCalendar","Edit calendar"),buttons:n,captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}}}),this._editCalendarDialog.find(".wijmo-wijev-name, .wijmo-wijev-location, .wijmo-wijev-description").wijtextbox(),this._editCalendarDialog.find(".wijmo-wijev-color-button").button({icons:{primary:e.wijCSS.iconArrowDown}}).click(r.proxy(this._onColorButtonClick,{dlg:this._editCalendarDialog,self:this})))},n.prototype._ensureEditEventDialogCreated=function(){var e=this.options,t,n=!1,i=!1;this._editEventDialog||(t=this.options.editEventDialogTemplate,t||(t='<div class="wijmo-wijev-event-dialog '+this.options.wijCSS.content+" "+e.wijCSS.cornerAll+'">'+'<ul class="wijmo-wijev-brief-content">'+"<li><label>"+this.localizeString("labelName","name")+"</label>"+'<input type="text" name="subject" class="wijmo-wijev-subject" value="">'+'<div class="wijmo-wijev-color-button">'+'<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>'+"</div>"+"</li>"+'<li><label for="'+this._uidPref+'_alldaybtn">'+this.localizeString("labelAllDay","all-day")+"</label>"+'<input type="checkbox" class="wijmo-wijev-allday" id="'+this._uidPref+'_alldaybtn" />'+"</li>"+"<li><label>"+this.localizeString("labelStarts","Starts")+"</label>"+'<input type="text" class="wijmo-wijev-start" value="">'+'<input type="text" class="wijmo-wijev-start-time" value="">'+"</li>"+"<li><label>"+this.localizeString("labelEnds","Ends")+"</label>"+'<input type="text" class="wijmo-wijev-end" value="">'+'<input type="text" class="wijmo-wijev-end-time" value="">'+"</li>"+"</ul>"+'<ul class="wijmo-wijev-detailed-content '+e.wijCSS.cornerAll+'">'+"<li><label>"+this.localizeString("labelLocation","Location")+"</label>"+'<input type="text" class="wijmo-wijev-location" value=""></li>'+"<li><label>"+this.localizeString("labelRepeat","Repeat")+"</label>"+'<select class="wijmo-wijev-repeat">'+'<option value="none">'+this.localizeString("repeatNone","None")+"</option>"+'<option value="daily">'+this.localizeString("repeatDaily","Every Day")+"</option>"+'<option value="workdays">'+this.localizeString("repeatWorkDays","Work days")+"</option>"+'<option value="weekly">'+this.localizeString("repeatWeekly","Every Week")+"</option>"+'<option value="monthly">'+this.localizeString("repeatMonthly","Every Month")+"</option>"+'<option value="yearly">'+this.localizeString("repeatYearly","Every Year")+"</option>"+"</select></li>"+"<li><label>"+this.localizeString("labelCalendar","Calendar")+"</label>"+'<select class="wijmo-wijev-calendar"></select></li>'+'<li class="wijmo-wijev-description-item"><label>'+this.localizeString("labelDescription","Description")+"</label>"+'<textarea class="wijmo-wijev-description" /></li>'+"</ul>"+'<div class="footer">'+'<a href="#" class="wijmo-wijev-delete">'+this.localizeString("buttonDelete","Delete")+"</a>"+'<a href="#" class="wijmo-wijev-save">'+this.localizeString("buttonOK","OK")+"</a>"+'<a href="#" class="wijmo-wijev-cancel">'+this.localizeString("buttonCancel","Cancel")+"</a>"+"</div>"+'<div class="wijmo-wijev-angle"></div>'+"</div>"),this._editEventDialog=r(t),e.ensureEventDialogOnBody?r("body").append(this._editEventDialog):this.element.append(this._editEventDialog),this._initEventDialogButton(this._editEventDialog.find(".wijmo-wijev-color-button"),r.proxy(this._onColorButtonClick,{dlg:this._editEventDialog,self:this}),{icons:{primary:e.wijCSS.iconArrowDown}}),this._initEventDialogButton(this._editEventDialog.find(".wijmo-wijev-delete"),r.proxy(function(e){return this.deleteEvent(this._editEventDialog.appt),this._editEventDialog.wijpopup("hide"),e.preventDefault(),!1},this)),this._initEventDialogButton(this._editEventDialog.find(".wijmo-wijev-cancel"),r.proxy(function(e){return this._editEventDialog.wijpopup("hide"),e.preventDefault(),!1},this)),this._editEventDialog.find(".wijmo-wijev-start").width(114).wijinputdate({culture:this.options.culture,cultureCalendar:this.options.cultureCalendar,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showDropDownButton:!0,dateFormat:"d",dropDownOpen:function(e,t){n=!1},dropDownClose:function(e,t){n=!0,r(document).one("mouseup",function(){n=!1})},dateChanged:r.proxy(function(e,t){n&&(i=!0,r(document).one("mouseup",function(){i=!1}));var s=this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option","date");t.date>s&&this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-start-time").width(80).wijinputdate({culture:this.options.culture,cultureCalendar:this.options.cultureCalendar,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showDropDownButton:!1,dateFormat:"t",dateChanged:r.proxy(function(e,t){if(!t.date)return;var n=this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option","date"),r=this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date");if(!r)return;t.date.getDate()!==r.getDate()&&(t.date.setDate(r.getDate()),this._editEventDialog.find(".wijmo-wijev-start-time").wijinputdate("option","date",t.date)),t.date>n&&this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-end").width(114).wijinputdate({culture:this.options.culture,cultureCalendar:this.options.cultureCalendar,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showDropDownButton:!0,dateFormat:"d",dropDownOpen:function(e,t){n=!1},dropDownClose:function(e,t){n=!0,r(document).one("mouseup",function(){n=!1})},dateChanged:r.proxy(function(e,t){n&&(i=!0,r(document).one("mouseup",function(){i=!1}));var s=this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date");t.date<s&&this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-end-time").width(80).wijinputdate({culture:this.options.culture,cultureCalendar:this.options.cultureCalendar,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showDropDownButton:!1,dateFormat:"t"}),this._editEventDialog.find(".wijmo-wijev-allday").wijcheckbox().change(r.proxy(this._eventDialogEnsureTimePartState,this)),this._editEventDialog.find(".wijmo-wijev-subject,.wijmo-wijev-location,.wijmo-wijev-description").wijtextbox(),this._initEventDialogButton(this._editEventDialog.find(".wijmo-wijev-save"),r.proxy(function(e){try{var t=this._validateAndReadApptDialogFields(this._editEventDialog);return t.prevData?this.updateEvent(t):this.addEvent(t),this._editEventDialog.wijpopup("hide"),e.preventDefault(),!1}catch(n){alert(n)}},this)),this._editEventDialog.wijpopup({autoHide:!0,hiding:r.proxy(function(e){if(i)return i=!1,!1;this._colorMenu&&this._colorMenu.wijpopup("hide"),this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected")},this),shown:r.proxy(function(e){var t=this,n=r.browser.msie?!0:!1;this._dropDownInitialized?(this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown("refresh"),this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown("refresh")):(this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown({unfocus:n}).bind("change",r.proxy(t._updateEventColor,this)),this._updateEventColor(),this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown({unfocus:n}).bind("change",function(e){var n=this.value,r=t._editEventDialog.appt;switch(n){case"none":r.recurrenceState=null,r.recurrencePattern=null;break;case"daily":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"daily"};break;case"workdays":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"workdays"};break;case"weekly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"weekly"};break;case"monthly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"monthly"};break;case"yearly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"yearly"};break;case"custom":alert("show custom recurrence pattern.")}}),this._dropDownInitialized=!0),this._onEditEventDialogShown(this._editEventDialog,this._editEventDialog.appt),this._editEventDialog.find(".wijmo-wijev-subject").focus(),this._updateEditEventPopupCallout()},this)}))},n.prototype._updateEventColor=function(){var e=this,t=e._editEventDialog.find(".wijmo-wijev-calendar"),n;n=t.length>0?e._calendarsById[t[0].value]:null,n&&n.color?e._addColorClass(e._editEventDialog.find(".wijmo-wijev-color"),n.color):e._editEventDialog.appt&&e._editEventDialog.appt.color&&e._addColorClass(e._editEventDialog.find(".wijmo-wijev-color"),e._editEventDialog.appt.color)},n.prototype._initEventDialogButton=function(e,t,n){r.mobile==null?e.button(n).click(t):e.addClass("ui-btn").click(t)},n.prototype._updateEditEventPopupCallout=function(){if(this._editEventDialog&&this._editEventDialog._arrowTarget){var e=this._editEventDialog,t=r(e._arrowTarget),n=t.offset(),i=e.offset(),s;n.left===i.left?e.removeClass("wijmo-wijev-rightangle").removeClass("wijmo-wijev-leftangle"):n.left<i.left?e.removeClass("wijmo-wijev-rightangle").addClass("wijmo-wijev-leftangle"):e.removeClass("wijmo-wijev-leftangle").addClass("wijmo-wijev-rightangle"),s=Math.round(n.top-i.top+t.outerHeight(!0)/2),this._editEventDialog.find(".wijmo-wijev-angle").css("top",s)}},n.prototype._onColorButtonClick=function(){var e=this.self,t=this.dlg,n,i=e.options,s=i.colors,o="";if(s&&s.length>0)for(n=0;n<s.length;n+=1)o+='<span class="wijmo-wijev-listcolor wijmo-wijev-event-color-'+s[n]+'">&nbsp;</span>';e._colorMenu?e._colorMenu.parent()[0]!==t[0]&&(e._colorMenu.detach(),t.append(e._colorMenu)):(e._colorMenu=r('<div class="wijmo-wijev-color-menu '+i.wijCSS.content+" "+i.wijCSS.cornerAll+'"></div>'),t.append(e._colorMenu),e._colorMenu.wijpopup({autoHide:!0})),e._colorMenu.html(o),e._colorMenu.find(".wijmo-wijev-listcolor").click(r.proxy(function(n){this._addColorClass(t.find(".wijmo-wijev-color"),this._readColorFromClass(r(n.target),"default")),e._colorMenu.wijpopup("hide")},e)),e._colorMenu.wijpopup("show",{of:t.find(".wijmo-wijev-color-button"),my:"left top",at:"left bottom"})},n.prototype._validateAndReadCalendarDialogFields=function(e){var t=e.cal||{};t.name=e.find(".wijmo-wijev-name").val(),t.location=e.find(".wijmo-wijev-location").val(),t.description=e.find(".wijmo-wijev-description").val(),t.color=this._readColorFromClass(e.find(".wijmo-wijev-color"),t.color||"default");if(!t.name)throw"Calendar name can not be empty";return t},n.prototype._validateAndReadApptDialogFields=function(e){var t=e.appt,n,r,i,o,u;n=s(e.find(".wijmo-wijev-start").wijinputdate("option","date")),r=s(e.find(".wijmo-wijev-end").wijinputdate("option","date")),i=e.find(".wijmo-wijev-start-time").wijinputdate("option","date"),o=e.find(".wijmo-wijev-end-time").wijinputdate("option","date");var a=(i.getHours()*60+i.getMinutes())*60+i.getSeconds(),f=(o.getHours()*60+o.getMinutes())*60+o.getSeconds();if(n.getTime()===r.getTime()&&a>f)throw this.localizeString("messageEndOccursBeforeStart","The end date you entered occurs before the start date.");return t.subject=e.find(".wijmo-wijev-subject").val(),t.location=e.find(".wijmo-wijev-location").val(),t.start=n,t.end=r,e.find(".wijmo-wijev-allday").length>0&&(t.allday=e.find(".wijmo-wijev-allday")[0].checked),t.allday?t.start.getTime()>=t.end.getTime()&&(t.end=this._addMinutes(t.start,this.options.timeInterval)):(t.start=new Date(t.start.getFullYear(),t.start.getMonth(),t.start.getDate(),i.getHours(),i.getMinutes(),i.getSeconds()),t.end=new Date(t.end.getFullYear(),t.end.getMonth(),t.end.getDate(),o.getHours(),o.getMinutes(),o.getSeconds())),t.calendar=e.find(".wijmo-wijev-calendar").val(),t.description=e.find(".wijmo-wijev-description").val(),t.color=this._readColorFromClass(e.find(".wijmo-wijev-color"),t.color),u=t.recurrencePattern,u&&t.recurrenceState==="master"&&(u.startTime=t.start,u.endTime=t.end,u.patternStartDate=t.start),t},n.prototype._bindApptToDialog=function(e){if(!e)return;var t=this._editEventDialog,n,r;t.appt=e,t.find(".wijmo-wijev-subject").val(e.subject||""),t.find(".wijmo-wijev-location").val(e.location||"");try{t.find(".wijmo-wijev-start").wijinputdate("option","date",e.start),t.find(".wijmo-wijev-start-time").wijinputdate("option","date",e.start),t.find(".wijmo-wijev-end").wijinputdate("option","date",e.end),t.find(".wijmo-wijev-end-time").wijinputdate("option","date",e.end)}catch(i){alert("[e0001a] wijinputdate/wijtextselection firefox error\n"+i)}t.find(".wijmo-wijev-allday").length>0&&(t.find(".wijmo-wijev-allday")[0].checked=e.allday),t.find(".wijmo-wijev-allday").wijcheckbox("refresh"),this._fillCalendarsSelect(t.find(".wijmo-wijev-calendar"),e.calendar),this._loadRepeatValue(e,t.find(".wijmo-wijev-repeat")),t.find(".wijmo-wijev-description").val(e.description||""),e.prevData?t.find(".wijmo-wijev-delete").show():t.find(".wijmo-wijev-delete").hide(),t.find(".wijmo-wijev-calendar").length>0&&(n=this._calendarsById[t.find(".wijmo-wijev-calendar")[0].value]),r=e.color,!r&&n&&n.color&&(r=n.color),this._addColorClass(t.find(".wijmo-wijev-color"),r),this._eventDialogEnsureTimePartState()},n.prototype._onEditEventDialogShown=function(e,t){t.recurrenceState==="exception"?e.find(".wijmo-wijev-repeat").wijdropdown("option","disabled",!0):e.find(".wijmo-wijev-repeat").wijdropdown("option","disabled",!1)},n.prototype._eventDialogEnsureTimePartState=function(){var e=this._editEventDialog;e.find(".wijmo-wijev-allday").length>0&&(e.find(".wijmo-wijev-allday")[0].checked?(e.find(".wijmo-wijev-start-time").wijinputdate("option","disabled",!0),e.find(".wijmo-wijev-end-time").wijinputdate("option","disabled",!0)):(e.find(".wijmo-wijev-start-time").wijinputdate("option","disabled",!1),e.find(".wijmo-wijev-end-time").wijinputdate("option","disabled",!1)))},n.prototype._loadRepeatValue=function(e,t){var n="none";if(e.recurrencePattern)switch(e.recurrencePattern.recurrenceType){case"daily":n="daily";break;case"workdays":n="workdays";break;case"weekly":n="weekly";break;case"monthly":n="monthly";break;case"yearly":n="yearly";break;default:n="custom"}t.val(n)},n.prototype._addColorClass=function(e,t){var n,r=new RegExp("wijmo-wijev-event-color-(\\w+)\\s*");e.length>0&&(n=e[0].className,e[0].className=n.replace(r,""),e.addClass("wijmo-wijev-event-color-"+(t||"default")))},n.prototype._readColorFromClass=function(e,t){var n=new RegExp("wijmo-wijev-event-color-(\\w+)\\s*"),r;if(e.length>0){r=n.exec(e[0].className);if(r&&r.length>1)return r[1]}return t},n.prototype._fillCalendarsSelect=function(e,t){var n="",r=this.options,i,s,o,u=r.calendars.slice(0),a=r.visibleCalendars;if(a&&a.length>0)for(i=0;i<a.length;i+=1){o=!1;for(s=0;s<u.length;s+=1)u[s].name===a[i]&&(o=!0);o||u.push({id:a[i],name:a[i]})}if(u.length===0){e.html("");return}for(i=0;i<u.length;i+=1)n+='<option value="'+u[i].id+'">'+u[i].name+"</option>";e.html(n).val(t)},n.prototype._bindCalendarToDialog=function(e){if(!e)return;var t=this._editCalendarDialog;t.cal=e,t.find(".wijmo-wijev-name").val(e.name||""),t.find(".wijmo-wijev-location").val(e.location||""),t.find(".wijmo-wijev-description").val(e.description||""),this._addColorClass(t.find(".wijmo-wijev-color"),e.color)},n.prototype._onTodayClick=function(){if(this._isDisabled())return;return this.goToday(),!1},n.prototype._bindEvents=function(){var e=this,t=e.element;e._eventsAttached||(r(e.element).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-appointment",r.proxy(e._onAppointmentClick,e)),r(t).on("mousedown."+e.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-appointment",r.proxy(e._onDayViewAppointmentMouseDown,e)),r(t).on("mousedown."+e.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-appointment",r.proxy(e._onMonthViewAppointmentMouseDown,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-timeinterval",r.proxy(e._onDayViewTimeIntervalClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-allday-cell",r.proxy(e._onDayViewAllDayCellClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcellheader",r.proxy(e._onMonthViewDayLabelClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcell-showmore",r.proxy(e._onMonthViewDayLabelClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-weekview .wijmo-wijev-daylabel",r.proxy(e._onMonthViewDayLabelClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-customview .wijmo-wijev-daylabel",r.proxy(e._onMonthViewDayLabelClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-yearview .wijmo-wijev-yearcellheader",r.proxy(e._onYearViewDayLabelClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcell",r.proxy(e._onMonthViewCellClick,e)),r(t).on("click."+e.wijevcalnamespacekey,".wijmo-wijev-yearview .wijmo-wijev-yearcell",r.proxy(e._onYearViewCellClick,e)),e._eventsAttached=!0)},n.prototype._unbindEvents=function(){this._eventsAttached&&(r(this.element).off("mousedown."+this.wijevcalnamespacekey),r(this.element).off("click."+this.wijevcalnamespacekey),this._eventsAttached=!1)},n.prototype.destroy=function(){this._destroyInternal(),r.wijmo.widget.prototype.destroy.apply(this,arguments)},n.prototype._destroyInternal=function(){var e=this,t=e.options;e.element.removeClass("wijmo-wijev wijmo-wijevcal "+t.wijCSS.widget+" "+t.wijCSS.helperReset),r(window).unbind("resize."+e.wijevcalnamespacekey),e._unBindToolsBarEvent(),e._unbindEvents(),e.element.empty(),e.wijevcalnamespacekey=null,e._uidPref=null,e._isUpdating=null,e._resolveDayApptConflictsTimeout=null,e._pendingRedrawActiveView=null,e._listViewDetailsInit=null,e._dayViewDetailsInit=null,e._eventsAttached=null,e.statusbarEventsAdded=null,e._dataView=null,e._eventsView=null,e._eventsDataById=null,e._calendarsById=null,e._dayViewCache=null,e._templateDayColumn=null,e._templateDayHeader=null,e._dayViewScrollToEvent=null,e._maxAllDayEventCount=null,e._dayColumnsToResolve=null,e._dayColumnResolveIdx=null,e.logDialog=null,e.logPanel=null,e._editCalendarDialog=null,e._editEventDialog=null,e._renderAgendaEventsTimeoutId=null,e.__targetAppt=null,e._isApptResize=null,e.__startApptH=null,e.__startApptY=null,e.__startClientY=null,e._apptDragResizeFlag=null,e._apptMovedFlag=null,e._movedFromTimeInervalApptElem=null,e.__targetApptChanged=null,e._defferObjs=null,e._setOptionCallbacks=null,e._chromeLoadDataDeffer=null,r.wijmo.wijevcal.prototype.options.eventsData=[]},n.prototype.exportEventsCalendar=function(e,t,n,r,i){},n.prototype.deleteCalendar=function(e,t,n){var i,s=this.options.calendars,o=e.id||e,u=!1,a,f,l,c=this;for(i=0;i<s.length;i+=1)if(s[i].id===o){u=!0,e=s[i];if(!this._trigger("beforeDeleteCalendar",null,{data:e}))return!1;delete this._calendarsById[e.id],s.splice(i,1);break}if(!u)for(i=0;i<s.length;i+=1)if(s[i].name===o){u=!0,e=s[i];if(!this._trigger("beforeDeleteCalendar",null,{data:e}))return!1;delete this._calendarsById[e.id],s.splice(i,1);break}if(!u)return this.status("Calendar with id/name '"+o+"' not found."),!1;this.showLoadingLabel(this.localizeString("activityDeletingCalendar","Deleting calendar...")),a=function(n){c.status("Calendar '"+e.name+"' deleted."),c._onCalendarsChanged(),c.hideLoadingLabel(),t&&t(n)},f=function(t){c.status("Unable to delete calendar '"+e.name+"': "+t),c.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.deleteCalendar)this.options.dataStorage.deleteCalendar(e,a,f);else if(this.options.webServiceUrl){try{l=this._jsonStringify(e)}catch(h){this.status("Unable to prepare calendar data for server. "+h,"error"),f("Unable to prepare calendar data for server. "+h);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=deleteCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+l,success:a,error:f})}else p("DELETE FROM calendars WHERE id='"+e.id+"'",[],a,f)},n.prototype.addCalendar=function(e,t,n){var i,s,o,u=this,a=!1;if(!this._trigger("beforeAddCalendar",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(s in e.prevData)e.prevData.hasOwnProperty(s)&&(e[s]=e.prevData[s]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id="dynid"+this._dynIdCounter+"ts"+(new Date).getTime()),r.each(u.options.calendars,function(t,n){if(e.name===n.name)return a=!0,!1});if(a)return;this.showLoadingLabel(this.localizeString("activityCreatingCalendar","Creating calendar...")),i=function(n){if(u._handleServerError(n)){o(n);return}u._readUpdatedServerDataIfAny(n,e),u._calendarsById[e.id]?u.status("Calendar '"+e.name+"' added."):(u.options.calendars.push(e),u._calendarsById[e.id]=e,u.status("Calendar '"+e.name+"' added.")),e.prevData=u._cloneObj(e),u._onCalendarsChanged(),u.hideLoadingLabel(),t&&t(n)},o=function(t){u.status("Unable to add calendar '"+e.name+"': "+t),u.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.addCalendar)this.options.dataStorage.addCalendar(e,i,o);else if(this.options.webServiceUrl){try{s=this._jsonStringify(e)}catch(f){this.status("Unable prepare calendar data for server."+f,"error"),o("Unable to prepare calendar data for server."+f);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=addCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+s,success:i,error:o})}else p("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);",[e.id,e.name,e.location,e.description,e.color,e.tag],i,o)},n.prototype.updateCalendar=function(e,t,n){var i,s,o,u=this;if(!this._trigger("beforeUpdateCalendar",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(s in e.prevData)e.prevData.hasOwnProperty(s)&&(e[s]=e.prevData[s]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id="dynid"+this._dynIdCounter+"ts"+(new Date).getTime()),this.showLoadingLabel(this.localizeString("activityUpdatingCalendar","Updating calendar...")),i=function(n){var i=!1,s=u.options.visibleCalendars;if(u._handleServerError(n)){o(n);return}u._readUpdatedServerDataIfAny(n,e),u._calendarsById[e.id]?(r.each(s,function(t,n){if(n===e.prevData.name)return s[t]=e.name,!1}),u.status("Calendar '"+e.name+"' updated.")):(r.each(u.options.calendars,function(t,n){if(e.name===n.name)return i=!0,!1}),i||(u.options.calendars.push(e),u._calendarsById[e.id]=e,u.status("Calendar '"+e.name+"' added."))),e.prevData=u._cloneObj(e),u._onCalendarsChanged(),u.hideLoadingLabel(),t&&t(n)},o=function(t){u.status("Unable to update calendar '"+e.name+"': "+t),u.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.updateCalendar)this.options.dataStorage.updateCalendar(e,i,o);else if(this.options.webServiceUrl){try{s=this._jsonStringify(e)}catch(a){this.status("Unable prepare calendar data for server. "+a,"error"),o("Unable to prepare calendar data for server. "+a);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=updateCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+s,success:i,error:o})}else p("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);",[e.id,e.name,e.location,e.description,e.color,e.tag],i,o)},n.prototype._initEventData=function(e){return r.extend({allday:!1,location:null,subject:null,description:null,color:null,tag:null},e)},n.prototype.addEvent=function(e,t,n){var i,s,u,a=this;if(!this._trigger("beforeAddEvent",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(u in e.prevData)e.prevData.hasOwnProperty(u)&&(e[u]=e.prevData[u]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id=o()),e.calendar||(e.calendar="Default"),this.showLoadingLabel(this.localizeString("activityCreatingEvent","Creating event...")),s=function(t){a.hideLoadingLabel(),a.status("Unable to add event '"+e.subject+"': "+t,"error");if(e.prevData)for(u in e.prevData)e.prevData.hasOwnProperty(u)&&(e[u]=e.prevData[u]);n&&n(t)},i=function(n){if(a._handleServerError(n)){s(n);return}a._readUpdatedServerDataIfAny(n,e),!a._eventsDataById[e.id]||e.recurrenceState==="exception"?(a._storeEventWithSort(e),a.status("Event '"+e.subject+"' added.")):a.status("Event '"+e.subject+"' added."),e.prevData=a._cloneObj(e),a._onEventsDataChanged(),a.hideLoadingLabel(),t&&t(n)};if(this.options.dataStorage.addEvent)this.options.dataStorage.addEvent(e,i,s);else if(this.options.webServiceUrl){try{u=this._jsonStringify(e)}catch(f){this.status("Unable prepare event data for server. "+f,"error"),s("Unable to prepare event data for server. "+f);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=addEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+u,success:i,error:s})}else{e=a._initEventData(e);if(!l&&!window.openDatabase){i.call(this,{rowsAffected:0,rows:[e]});return}p("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);",[e.id,e.calendar,e.subject,e.location,e.start.getTime(),e.end.getTime(),e.description,e.color,e.allday,this._serializeProperties(e),e.tag],i,s)}},n.prototype._storeEventWithSort=function(e){var t=this.options.eventsData,n,r;this._eventsDataById[e.id]=e;if(!t)return;for(n=0,r=t.length;n<r;n+=1){if(t[n].start>e.start){t.splice(n,0,e);return}if(t[n].start.getTime()===e.start.getTime()&&t[n].subject>e.subject){t.splice(n,0,e);return}}t.push(e)},n.prototype._readUpdatedServerDataIfAny=function(e,t){var n=null,r;if(typeof e=="string"&&e.indexOf("update:")===0){e=e.toString().substr("update:".length);try{n=this._jsonParse(e)}catch(i){this.status("Unable to read updated server data. "+i,"warning")}if(n)for(r in n)n[r]&&(t[r]=n[r])}},n.prototype.updateEvent=function(e,t,n){var i,s,o,u=this;if(!this._trigger("beforeUpdateEvent",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(o in e.prevData)e.prevData.hasOwnProperty(o)&&(e[o]=e.prevData[o]);return this._updateAppointmentVisual(e),!1}e.calendar||(e.calendar="Default"),this.showLoadingLabel(this.localizeString("activityUpdatingEvent","Updating event...")),s=function(t){u.hideLoadingLabel(),u.status("Unable to update event '"+e.subject+"': "+t,"error");if(e.prevData)for(o in e.prevData)e.prevData.hasOwnProperty(o)&&(e[o]=e.prevData[o]);u._updateAppointmentVisual(e),n&&n(t)};if(!e.id){s("id is empty");return}if(e.recurrenceState==="occurrence"){if(!this._eventsDataById[e.parentRecurrenceId]){s("Unable to find master event for event with id:"+e.id);return}return this.log(this._formatString("[updateEvent->addEvent] recurrenceState for event {0} changed to 'exception'.",e.id)),e.recurrenceState="exception",this.addEvent(e,t,n)}i=function(i){if(u._handleServerError(i)){s(i);return}u._readUpdatedServerDataIfAny(i,e),u._eventsDataById[e.id]?(r.extend(u._eventsDataById[e.id],e),e.recurrenceState==="master"&&u._updateEventsData(e,t,n),u.status("Event '"+e.subject+"' updated.")):(u._storeEventWithSort(e),u.status("Event '"+e.subject+"' added.")),e.prevData=u._cloneObj(e),u._onEventsDataChanged(),u.hideLoadingLabel(),t&&t(i)};if(this.options.dataStorage.updateEvent)this.options.dataStorage.updateEvent(e,i,s);else if(this.options.webServiceUrl){try{o=this._jsonStringify(e)}catch(a){this.status("Unable prepare event data for server. "+a,"error"),s("Unable to prepare event data for server. "+a);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=updateEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+o,success:i,error:s})}else{e=u._initEventData(e);if(!l&&!window.openDatabase){i.call(this,{rowsAffected:0,rows:[e]});return}p("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);",[e.id,e.calendar,e.subject,e.location,e.start.getTime(),e.end.getTime(),e.description,e.color,e.allday,this._serializeProperties(e),e.tag],i,s)}},n.prototype._updateEventsData=function(e,t,n){var r,i,s=this,o=!1,u=s.options.eventsData,a=e.parentRecurrenceId;for(r=0;r<u.length;r++)if(u[r].id===e.id){o=!0;break}o||u.push(e),a&&(i=s._eventsDataById[a],i&&(i.recurrencePattern.removedOccurrences||(i.recurrencePattern.removedOccurrences=[]),i.recurrencePattern.removedOccurrences.push(e.id),s.updateEvent(i,t,n)))},n.prototype._serializeProperties=function(e){var t="",n={};n.parentRecurrenceId=e.parentRecurrenceId,n.recurrenceState=e.recurrenceState,n.recurrencePattern=e.recurrencePattern,n.color=e.color,n.allday=e.allday;try{t=this._jsonStringify(n)}catch(r){this.status("Unable save additional event properties. "+r,"error")}return t},n.prototype._deSerializeProperties=function(e,t){var n={},r;if(e){if(typeof e=="string")try{n=this._jsonParse(e)}catch(i){this.status("Unable to load additional event properties. "+i,"error");return}else n=e;n.parentRecurrenceId&&(t.parentRecurrenceId=n.parentRecurrenceId),n.recurrenceState&&(t.recurrenceState=n.recurrenceState),n.recurrencePattern&&(t.recurrencePattern=n.recurrencePattern),n.color&&(t.color=n.color),n.allday&&(t.allday=n.allday)}t&&t.recurrencePattern&&(r=t.recurrencePattern,r.patternStartDate=r.patternStartDate?new Date(r.patternStartDate):r.patternStartDate,r.startTime=r.startTime?new Date(r.startTime):r.startTime,r.endTime=r.endTime?new Date(r.endTime):r.endTime,r.startTime.getTime()>=r.endTime.getTime()&&(r.endTime=this._addMinutes(r.startTime,this.options.timeInterval)))},n.prototype._jsonStringify=function(e){var t;if(window.__JSONC1)t=window.__JSONC1.stringify(e);else{if(!window.JSON)throw"JSON not found.";t=JSON.stringify(e)}return t},n.prototype._jsonParse=function(e){var t,n,r;if(window.__JSONC1)t=window.__JSONC1.parse(e);else{if(!window.JSON)throw"JSON variable not found.";n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,r=/^\/Date\((d|-|.*)\)\/$/,t=window.JSON.parse(e,function(e,t){if(typeof t=="string"){var i=n.exec(t),s;if(i)return new Date(Date.UTC(+i[1],+i[2]-1,+i[3],+i[4],+i[5],+i[6]));i=r.exec(t);if(i)return s=i[1].split(/[-,.]/),new Date(+s[0])}return t})}return t},n.prototype.getOccurrences=function(e,t){var n=this.options,r=n.eventsData,i,s,o,u,a,f,l,c,h,p=100,d,v,m,g=[],y=[],b=[],w={};this._eventsDataById||(this._eventsDataById={});if(r)for(f=0,c=r.length;f<c;f+=1){i=r[f],this._eventsDataById[i.id]=i;if(i.recurrenceState==="master"){u=i.recurrencePattern,u.removedOccurrences&&(b=b.concat(u.removedOccurrences)),h=u.occurrences||p,d=u.patternStartDate||i.start,v=u.startTime||i.start,m=u.endTime||i.end,a=(u.dayOfWeekMask||"none").toLocaleLowerCase();switch(u.recurrenceType){case"daily":for(l=0;l<h;l+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(d,l),v),s.end=this._setTime(s.start,m,v),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),w[s.id]=s);break;case"workdays":for(l=0;l<h;l+=1){s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(d,l),v);if(s.start.getDay()===0||s.start.getDay()===6)continue;s.end=this._setTime(s.start,m,v),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),w[s.id]=s)}break;case"weekly":if(a!=="none")this._getOccurrenceWeekly(i,a,h,e,t,d,v,m,w);else for(l=0;l<h;l+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(d,l*7),v),s.end=this._setTime(s.start,m,v),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),w[s.id]=s);break;case"monthly":for(l=0;l<h;l+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(new Date(d),v),s.start.setMonth(s.start.getMonth()+l),s.end=this._setTime(s.start,m,v),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),w[s.id]=s);break;case"yearly":for(l=0;l<h;l+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(new Date(d),v),s.start.setYear(s.start.getFullYear()+l),s.end=this._setTime(s.start,m,v),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),w[s.id]=s);break;case"monthlyNth":break;case"yearlyNth":}}else this._testIsEventInTimeInterval(i,e,t)&&(i.recurrenceState==="exception"?y.push(i):i.recurrenceState==="removed"?(b.push(i.id),this.log("[warning] Seems we found removed event inside events storage, id:"+i.id)):g.push(i))}for(f=0,c=y.length;f<c;f+=1)o=y[f],w[o.id]&&delete w[o.id],g.push(o),this._eventsDataById[o.id]=o;for(f=0,c=b.length;f<c;f+=1)w[b[f]]&&delete w[b[f]];for(f in w)s=w[f],g.push(s),this._eventsDataById[s.id]=s;return g},n.prototype._getOccurrenceWeekly=function(e,t,n,i,s,o,u,a,f){var l=this,c,h,p=t.split(","),d=[],v={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6};r.each(p,function(e,t){switch(t){case"weekenddays":d.push(0,6);break;case"workdays":d.push(1,2,3,4,5);break;case"everyday":d.push(0,1,2,3,4,5,6);break;default:d.push(v[t])}});for(c=0;c<n;c++){h=l._cloneObj(e),h.parentRecurrenceId=e.id,h.recurrenceState="occurrence",h.start=l._setTime(l._addDays(o,c),u);if(d.indexOf(h.start.getDay())===-1)continue;h.end=l._setTime(h.start,a,u),h.recurrencePattern=null,l._testIsEventInTimeInterval(h,i,s)&&(h.id=l._formatString("{0}_OCCR_{1:yyyy_MM_dd}",e.id,h.start),f[h.id]=h)}},n.prototype._testIsEventInTimeInterval=function(e,t,n){return!t||!n?!0:e.start<n&&e.end>t?!0:!1},n.prototype.deleteEvent=function(e,t,n){e.id&&(e=e.id);var i=this._eventsDataById[e],s,o,u,a,f=this,c,h;if(!this._trigger("beforeDeleteEvent",null,{data:i}))return!1;this.showLoadingLabel(this.localizeString("activityDeletingEvent","Deleting event...")),a=function(e){f.status("Unable to delete event '"+(i?i.subject:"undefined")+"': "+e),f.hideLoadingLabel(),n&&n(e)};if(i.recurrenceState==="exception"||i.recurrenceState==="occurrence"){h=this._eventsDataById[i.parentRecurrenceId];if(h&&h.recurrencePattern){this.log(this._formatString("[deleteEvent] removing {0} with id {1}. Updating master event with id {2}",i.recurrenceState,i.id,h.id)),h.recurrencePattern.removedOccurrences||(h.recurrencePattern.removedOccurrences=[]),h.recurrencePattern.removedOccurrences.push(i.id),this.updateEvent(h,t,n);if(i.recurrenceState==="occurrence"){this.log("No need to delete occurrence from store. Master event should be updated.");return}}else if(i.recurrenceState!=="exception")return a("Unable to find master event with id "+i.parentRecurrenceId),!1}i.recurrenceState==="master",u=function(n){if(f._handleServerError(n)){a(n);return}if(f._eventsDataById[i.id]){o=f.options.eventsData;if(o)for(s=0;s<o.length;s+=1)o[s].id===e&&o.splice(s,1);delete f._eventsDataById[i.id],f.status("Event '"+i.subject+"' deleted.")}else f.status("Event '"+i.subject+"' deleted.");i.prevData=f._cloneObj(i),f._onEventsDataChanged(),f.hideLoadingLabel(),t&&t(n)};if(this.options.dataStorage.deleteEvent)this.options.dataStorage.deleteEvent(i,u,a);else if(this.options.webServiceUrl){try{c=this._jsonStringify(i)}catch(d){this.status("Unable prepare event data for server. "+d,"error"),a("Unable prepare event data for server. "+d);return}r.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=deleteEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+c,success:u,error:a})}else{if(!l&&!window.openDatabase){u.call(this,{rowsAffected:0,rows:[i]});return}p("DELETE FROM events WHERE id='"+e+"'",[],u,a)}},n.prototype.beginUpdate=function(){this._isUpdating=!0,this.showLoadingLabel("Updating...")},n.prototype.endUpdate=function(){this._isUpdating=!1,this._pendingRedrawActiveView&&this._redrawActiveView(),this.hideLoadingLabel()},n.prototype.goToEvent=function(e){e.id&&(e=e.id);var t=this.options,n,r,i=this.findEventById(e);switch(t.viewType){case"day":case"week":case"list":n=this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ."+this._eventIdToCssClass(e)),n.length>0?(r=n.parents(".wijmo-wijev-scrollpanel"),r.length>0&&r.wijsuperpanel("scrollChildIntoView",n)):(this._dayViewScrollToEvent=i,this.goToDate(i.start));break;case"month":this.goToDate(i.start)}},n.prototype.isAllDayEvent=function(e){var t=e;return e.id||(t=this.findEventById(e)),t.allday?(t.end.getTime()-t.start.getTime())/864e5>=1?!0:!0:!1},n.prototype.goToDate=function(e){e=s(e);var t=this,n=t.options,r=e.getDay(),i,o,u,a,f,l=n.selectedDates,c=t._getCurrentViewIndex(),h,p,d=t._isCustomView(c);if(l&&l.length>0){if(this._isContainsDayDate(l,e))return;f=l[0],u=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),a=Date.UTC(f.getFullYear(),f.getMonth(),f.getDate()),o=(u-a)/864e5,d?h=n.views[c].unit:h=n.viewType,h.toLowerCase()==="week"&&(p=(d?n.views[c].count:1)*7,o=Math.floor(o/p)*p);for(i=0;i<l.length;i+=1)l[i]=this._addDays(l[i],o);this._onSelectedDatesChanged()}else n.selectedDates=[e],this._onSelectedDatesChanged()},n.prototype.goToTime=function(e){var t=this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:first-child"),n=this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:last"),r=t.position().top,i=n.position().top+n.height(),s,o,u;u=86400,o=e.getHours()*60*60+e.getMinutes()*60,s=(i-r)*o/u+r,this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("vScrollTo",s)},n.prototype.goToday=function(){this.goToDate(new Date)},n.prototype._navigatingDatePager=function(e){var t=this,n=e?-1:1,r=t.options,i,s=1,o,u=r.selectedDates[0],a=t._getCurrentViewIndex();t._isCustomView(a)?(o=r.views[a],i=o.unit,s=o.count):i=r.viewType;switch(i){case"week":n*=7;case"list":case"day":t.goToDate(t._addDays(u,n*s));break;case"month":t.goToDate(t._addMonths(u,n*s));break;case"year":t.goToDate(t._addYears(u,n*s))}},n.prototype.goLeft=function(){this._navigatingDatePager(!0)},n.prototype.goRight=function(){this._navigatingDatePager(!1)},n.prototype.refresh=function(){this.invalidate()},n.prototype.invalidate=function(){var e=this,t=e.options,n=e._getCurrentViewType();switch(n){case"list":case"day":case"week":this._invalidateDayView();break;case"month":this._invalidateMonthView();break;case"year":this._invalidateYearView();break;default:}},n.prototype._getCurrentViewType=function(){var e=this,t=e.options,n=e._getCurrentViewIndex(),i=t.views[n],s=r.isPlainObject(i)?e._getCustomViewUnit():i;return s.toLowerCase()},n.prototype.showEditCalendarDialog=function(e){var t=this.options,n=t.calendars,r;if(!e)e={name:"",description:"",location:"",color:""};else if(!e.name)for(r=0;r<n.length;r+=1)if(n[r].name===e){e=n[r];break}this._ensureEditCalendarDialogCreated(),this._bindCalendarToDialog(e),this._editCalendarDialog.wijdialog("open")},n.prototype.showEditEventDialog=function(e,t,n){var i=this.options,s,o,u,a,f,l,c=t?r(t):n?r(n.target):null;this._ensureEditEventDialogCreated(),this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected"),c&&c.hasClass("wijmo-wijev-daylabel")&&(c=c.parent(".wijmo-wijev-allday-cell")),e?(this._editEventDialog._arrowTarget=c,e.prevData||(e.prevData=this._cloneObj(i)),e.recurrenceState==="occurrence"&&(s=this._eventsDataById[e.parentRecurrenceId],window.confirm(this._formatString(this.localizeString("promptOpenOccurrenceFormat","{2}  is recurring event. Do you want to open only this occurrence?"),e.start,e.end,e.subject,e.location))||(e=s))):(e={subject:this.localizeString("textNewEvent","New event")},e.isNewEvent=!0,c&&c.length>0?(this._editEventDialog._arrowTarget=c,c.addClass("ui-selected"),o=c.parent(".wijmo-wijev-daycolumn"),o.length<1&&(o=c.parent(".wijmo-wijev-dayheadercolumn")),o=o[0],c.hasClass("wijmo-wijev-allday-cell")?e.allday=!0:c.hasClass("wijmo-wijev-monthcellcontainer")?(o=c[0],e.allday=!0):c.hasClass("wijmo-wijev-yearcellcontainer")?(o=c[0],e.allday=!1,l=!0):e.allday=!1,o&&(u=this._parseDateFromClass(o.className,e.allday?null:c[0].className),e.start=u,e.allday?e.end=this._addMinutes(e.start,1440):e.end=this._addMinutes(e.start,i.timeInterval),l&&(e.end=this._addDays(e.start,(new Date(e.start.getFullYear(),e.start.getMonth()+1,0)).getDate()-1)))):(e.start=new Date(i.selectedDates[0]),e.end=this._addMinutes(e.start,i.timeInterval))),this._trigger("beforeEditEventDialogShow",null,{data:e,targetCell:c})&&(f={of:c,my:"left center",at:"right center",offset:(c&&n?Math.round(n.offsetX-c.width()):10)+" 0",collision:"fit"},this._bindApptToDialog(e),this._editEventDialog.wijpopup("show",f),a=this._editEventDialog.data("wijmo-wijpopup"),a&&a._setPosition(f))},n.prototype._getCustomViewUnit=function(){var e=this.options,t,n=this._getCurrentViewIndex();return e.views[n].unit?(t=e.views[n].unit.toLowerCase(),r.inArray(t,["day","week","month","year"])?t:"day"):"day"},n.prototype._renderViewByViewType=function(e){var t=this,n=t.options;switch(e){case"day":case"week":case"list":t.element.find(".wijmo-wijev-view.wijmo-wijev-dayview").show(),t._renderDayView();break;case"month":t.element.find(".wijmo-wijev-view.wijmo-wijev-monthview").show(),t._renderMonthView();break;case"year":t.element.find(".wijmo-wijev-view.wijmo-wijev-yearview").show(),t._renderYearView();break;default:}},n.prototype._getCurrentViewIndex=function(){var e=this,t=e.options,n=0;return r.each(t.views,function(e,i){if(r.isPlainObject(i)){if(i.name.toLowerCase()===t.viewType.toLowerCase())return n=e,!1}else if(i.toLowerCase()===t.viewType.toLowerCase())return n=e,!1}),n},n.prototype._renderActiveView=function(){var e=this,t=e.options,n=e.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),i,s,o;e.element.find(".wijmo-wijev-view").hide(),e.element.find(".wijmo-wijev-viewdetails").hide(),o=e._getCurrentViewIndex(),e._isCustomView(o)?(s=t.views[o].unit,t.viewType=t.views[o].name):(s=t.views[o],t.viewType=s),e.element.find(".wijmo-wijev-"+t.viewType.toLowerCase()+"-details").show(),e._renderViewByViewType(s),n.find("input")[o].checked=!0,r().buttonset?n.buttonset("refresh"):r().checkboxradio&&n.find(":radio").checkboxradio("refresh")},n.prototype._redrawActiveView=function(){if(this._isUpdating){this._pendingRedrawActiveView=!0;return}switch(this.options.viewType.toLowerCase()){case"day":case"week":case"list":this._clearDayViewCache(),this._templateDayColumn=null}this._renderActiveView()},n.prototype._getDayColumnDates=function(e){var t=this,n=t.options,r=n.selectedDates,i,s,o,u=t._getCurrentViewIndex(),a=t._isCustomView(u),f=n.views[u].count||1;r||(r=[new Date]);if(n.viewType.toLowerCase()==="week"||a&&t._getCustomViewUnit()==="week"){i=n.selectedDate||r[0],o=n.firstDayOfWeek-i.getDay(),Math.abs(o)>6&&(o=i.getDay()-n.firstDayOfWeek),i=t._addDays(i,o),r=[];for(o=0;o<7*f;o+=1)s=t._addDays(i,o),r.push(s)}else if(a&&t._getCustomViewUnit()==="day"){i=n.selectedDate||r[0],r=[];for(o=0;o<f;o+=1)s=t._addDays(i,o),r.push(s)}return e&&(n.selectedDates=r),r},n.prototype._scrolling=function(e,t){var n=this.element.find(".wijmo-wijev-headercontainer");n.css({position:"relative",left:t.afterPosition.left})},n.prototype._resetHeaderContainer=function(){var e=this.element.find(".wijmo-wijev-headercontainer");e.css("left",0)},n.prototype._renderDayView=function(){var e=this,t=e.options,n=0,i=1440,s,o,u,a=e._getDayColumnDates(!0),f,l,c,h,p=new Date,d,v=!1,m=e.element.find(".wijmo-wijev-dayview"),g,y,b,w,E,S=7,x=e._isCustomView(),T,N=0,C,k=e._getCurrentViewIndex();if(x){T=t.views[k].count||1;switch(e._getCustomViewUnit()){case"day":E=T>S;break;case"week":E=T*7>S}}m.length===0?(m=r('<div class="wijmo-wijev-view wijmo-wijev-dayview '+t.wijCSS.content+'">'+'<h3 class="wijmo-wijev-header-title">title'+"</h3>"+'<div class="wijmo-wijev-dayview-inner">'+'<div class="wijmo-wijev-headercontainer">'+'<div class="wijmo-wijev-sizer">'+'<div class="wijmo-wijev-gmtlabel">'+e.localizeString("labelAllDay","all-day")+"</div>"+"</div>"+"</div>"+'<div class="wijmo-wijev-scrollpanel">'+'<div class="wijmo-wijev-scrollcontent">'+'<div class="wijmo-wijev-timeruler">'+'<div class="wijmo-wijev-currenttime-indicator">'+'<div class="wijmo-wijev-currenttime-indicator-arrow '+t.wijCSS.stateError+'"></div>'+'<div class="wijmo-wijev-currenttime-indicator-line '+t.wijCSS.stateError+'"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"),m.appendTo(e.element.find(".wijmo-wijev-view-container")),g=e.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel({hScroller:{scrollBarVisibility:E?"visible":"hidden"},animationOptions:{disabled:!0}})):g=e.element.find(".wijmo-wijev-scrollpanel"),g.wijsuperpanel("option","hScroller",{scrollBarVisibility:E?"visible":"hidden"}),g.wijsuperpanel("option","scrolled",E?r.proxy(e._scrolling,e):null),m.removeClass("wijmo-wijev-weekview wijmo-wijev-listview"),m.addClass("wijmo-wijev-"+(x?"custom":t.viewType.toLowerCase())+"view"),y=e.element.find(".wijmo-wijev-headercontainer"),b=e.element.find(".wijmo-wijev-scrollcontent"),w=b.find(".wijmo-wijev-timeruler"),x?m.find(".wijmo-wijev-gmtlabel").css("opacity",.7):m.find(".wijmo-wijev-gmtlabel").removeAttr("style");if(!e._templateDayColumn){w.find(".wijmo-wijev-timerulerinterval").remove(),s='<div class="wijmo-wijev-daycolumn">',C=!0;while(n<i)o="wijmo-wijev-timeinterval "+t.wijCSS.content+" wijmo-wijev-minute-"+n,C&&(o+=" wijmo-wijev-oddrow"),C=!C,u="wijmo-wijev-timerulerinterval "+t.wijCSS.content+" wijmo-wijev-minute-"+n,s+='<div class="'+o+'" style="height: '+t.timeIntervalHeight+'px"></div>',n+=t.timeInterval,N+=t.timeInterval,N>=t.timeRulerInterval&&(o+=" wijmo-wijev-timeinterval-hourstart",u+=" wijmo-wijev-timerulerinterval-hourstart",w.append(r('<div class="'+u+'" style="height:'+N/t.timeInterval*t.timeIntervalHeight+'px">'+e._formatString(t.timeRulerFormat,new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,n-N))+"</div>")),N=0);s+="</div>",e._templateDayColumn=r(s),e._templateDayHeader=r('<div class="wijmo-wijev-dayheadercolumn '+t.wijCSS.content+'">'+'<div class="wijmo-wijev-allday-cell '+t.wijCSS.content+'">'+'<div class="wijmo-wijev-daylabel">3 Monday</div>'+"</div>"+"</div>")}y.find(".wijmo-wijev-dayheadercolumn").remove(),b.find(".wijmo-wijev-daycolumn").remove();for(f=0,d=a.length;f<d;f+=1)h=a[f],l=e._getCachedDayHeader(h),c=e._getCachedDayColumn(h),l?(l=r(l),l.find(".wijmo-wijev-daylabel").html(e._formatDayHeaderDate(h))):(l=e._templateDayHeader.clone(!0),c=e._templateDayColumn.clone(!0),l.addClass(e._dayDateToCssClass(h)),l.find(".wijmo-wijev-daylabel").html(e._formatDayHeaderDate(h)),c.addClass(e._dayDateToCssClass(h)),v?v=!1:(c.addClass("wijmo-wijev-leftborder"),l.addClass("wijmo-wijev-leftborder")),e._compareDayDates(h,p)===0&&(c.addClass("wijmo-wijev-today "+t.wijCSS.stateHighlight),c.addClass("wijmo-wijev-leftborder"),c.addClass("wijmo-wijev-rightborder"),l.addClass("wijmo-wijev-today").find(".wijmo-wijev-allday-cell").addClass(t.wijCSS.stateHighlight),l.addClass("wijmo-wijev-leftborder"),l.addClass("wijmo-wijev-rightborder"),v=!0),f===d-1&&(c.addClass("wijmo-wijev-rightborder"),l.addClass("wijmo-wijev-rightborder"))),y.append(l),b.append(c);e._invalidateDayView(),e._renderDayViewAppointments()},n.prototype._getCachedDayHeader=function(e){var t=null;return this._dayViewCache&&this._dayViewCache[e]&&(t=this._dayViewCache[e].h),t},n.prototype._getCachedDayColumn=function(e){var t=null;return this._dayViewCache&&this._dayViewCache[e]&&(t=this._dayViewCache[e].c),t},n.prototype._storeDayCache=function(e,t,n){this._dayViewCache||(this._dayViewCache={}),this._dayViewCache[e]={h:t,c:n}},n.prototype._clearViewsCache=function(){this._clearDayViewCache(),this._clearListViewCache()},n.prototype._clearDayViewCache=function(){this._dayViewCache={}},n.prototype._clearListViewCache=function(){var e=this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container .wijmo-wijsuperpanel-templateouterwrapper");e[0]||(e=this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container .wijmo-wijsuperpanel-contentwrapper-touch")),e.data("wijevcal_agenda_initialized",!1),e.data("wijevcal_agenda_loadedeventscount",0)},n.prototype._invalidateDayView=function(e){var t=this,n=t.options,i=t.element.find(".wijmo-wijev-headercontainer"),s=t.element.find(".wijmo-wijev-scrollcontent"),o=s.find(".wijmo-wijev-timeruler"),u=i.find(".wijmo-wijev-dayheadercolumn"),a=s.find(".wijmo-wijev-daycolumn"),f=t._isCustomView(),l=f?"custom":n.viewType.toLowerCase(),c,h,p,d,v,m,g,y,b=o.outerWidth(),w,E,S,x,T=o.find(".wijmo-wijev-currenttime-indicator"),N;t._updateHeaderTitleText(),h=t.element.find(".wijmo-wijev-view.wijmo-wijev-"+l+"view .wijmo-wijev-header-title"),c=h.is(":visible")?h.outerHeight(!0):0,t._invalidateView(),t._maxAllDayEventCount||(t._maxAllDayEventCount=0),v=i.find(".wijmo-wijev-dayheadercolumn .wijmo-wijev-appointment").outerHeight(!0),v||(v=17),m=i.find(".wijmo-wijev-daylabel").outerHeight(!0),g=0;for(w=0;w<u.length;w+=1)y=r(u[w]).find(".wijmo-wijev-allday-cell .wijmo-wijev-appointment").length,y>g&&(g=y);d=v*g+m+v,i.outerHeight(d+Math.round(v/2)),i.find(".wijmo-wijev-allday-cell").outerHeight(d),p=t.element.find(".wijmo-wijev-view").width(),E=p-b,E-=18,S=t.element.find(".wijmo-wijev-view").innerHeight()-i.outerHeight(!0)-c,x=Math.floor(E/(a.length>7?7:a.length)),f&&a.length>7?(E=x*a.length,i.outerWidth(E+b+18),T.outerWidth(E+b)):(i.outerWidth(p),T.outerWidth("100%")),s.width(E+b),u.outerWidth(x),a.outerWidth(x),t._invalidateCurrentTimeIndicator(),N=t.element.find(".wijmo-wijev-scrollpanel"),N.outerWidth(p),N.outerHeight(S),t._refreshSuperPanel(N);switch(l){case"day":t._updateDayViewDetails();break;case"list":t._updateListViewDetails()}},n.prototype._refreshSuperPanel=function(e){(!r.support.isTouchEnabled||!r.support.isTouchEnabled())&&this._isIE8()?e.wijsuperpanel("paintPanel",!0):e.wijsuperpanel("refresh")},n.prototype._updateDayViewDetails=function(){var e=this.options,t=e.selectedDate,n=this.element.find(".wijmo-wijev-leftpane"),i=n.find(".wijmo-wijev-agenda-container");this._dayViewDetailsInit||(this._dayViewDetailsInit=!0,this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar(r.extend(!0,{culture:e.culture,cultureCalendar:e.cultureCalendar,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),showTitle:!1,showOtherMonthDays:!1,showWeekNumbers:!1,selectionMode:{day:!0,days:!1},selectedDatesChanged:r.proxy(function(e,t){t.dates&&!this._isDisabled()&&this.goToDate(t.dates[0])},this),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous")},e.calendar)),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-agenda-container").wijsuperpanel()),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("option","displayDate",t).wijcalendar("unSelectAll").wijcalendar("selectDate",t),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("refresh"),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-monthday-label").html(t.getDate()),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-fulldate-label").html(this._formatString(this.localizeString("dayDetailsLabelFulldateFormat","{0:dddd, MMMM d}"),t)),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-year-label").html(this._formatString(this.localizeString("dayDetailsLabelYearFormat","{0:yyyy}"),t)),this._updateAgendaList(this.element.find(".wijmo-wijev-day-details  .wijmo-wijev-agenda-container"),t,t,!1)},n.prototype._listViewAgendaScrolled=function(e,t){var n=this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container"),i=n.wijsuperpanel("option","vScroller"),s,o=i.scrollValue,u=i.scrollMax-i.scrollLargeChange*2,a=e.type,f=!1,l;a==="wijsuperpanelscroll"?(l=t.position,s=n.find(".wijmo-wijsuperpanel-contentwrapper-touch"),n.height()+l>=s.height()&&(f=!0)):s=n.find(".wijmo-wijsuperpanel-templateouterwrapper"),(o>=u||f)&&s.data("wijevcal_agenda_loadnextpage")&&(s.data("wijevcal_agenda_loadnextpage",!1),s.find(".wijmo-wijev-agenda-more-events").show().html(this.localizeString("agendaLoadingMoreEvents","Loading more events...")),this._renderAgendaEventsTimeoutId&&(clearTimeout(this._renderAgendaEventsTimeoutId),this._renderAgendaEventsTimeoutId=null),this._renderAgendaEventsTimeoutId=setTimeout(r.proxy(function(){this._renderAgendaEventsTimeoutId=null,this._renderAgendaEvents(s,null,null,!0,n),s.find(".wijmo-wijev-agenda-more-events").remove()},this),100))},n.prototype._updateListViewDetails=function(){this._listViewDetailsInit||(this._listViewDetailsInit=!0,r.support.isTouchEnabled&&r.support.isTouchEnabled()?this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container").wijsuperpanel({scroll:r.proxy(this._listViewAgendaScrolled,this)}):this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container").wijsuperpanel({scrolled:r.proxy(this._listViewAgendaScrolled,this)})),this._updateAgendaList(this.element.find(".wijmo-wijev-list-details  .wijmo-wijev-agenda-container"),null,null,!0)},n.prototype._updateAgendaList=function(e,t,n,i){var s=this.element.find(".wijmo-wijev-leftpane"),o=e;e.outerHeight(s.innerHeight()-e[0].offsetTop),o.find(".wijmo-wijsuperpanel-templateouterwrapper").length>0&&(o=o.find(".wijmo-wijsuperpanel-templateouterwrapper")),r.support.isTouchEnabled&&r.support.isTouchEnabled()&&(o=o.find(".wijmo-wijsuperpanel-contentwrapper-touch"));if(i&&o.data("wijevcal_agenda_initialized")){e.data("wijmo-wijsuperpanel")&&this._refreshSuperPanel(e);return}o.data("wijevcal_agenda_initialized",!0),o.data("wijevcal_agenda_loadedeventscount",0),o.html(""),this._renderAgendaEvents(o,t,n,i,e)},n.prototype._isIE8=function(){return r.browser.msie&&r.browser.version&&parseFloat(r.browser.version)<=8},n.prototype._renderAgendaEvents=function(e,t,n,i,o){var u=this._eventsView,a,f,l,c,h=0,p,d="",v="",m=null,g=null,y=this.options,b,w,E=100,S=this,x=e.data("wijevcal_agenda_loadedeventscount");t&&(m=s(t),g=this._addDays(s(n),1),c=(g.getTime()-m.getTime())/864e5);if(u){l=u.length<E+x||!i?u.length:E+x,e.data("wijevcal_agenda_loadedeventscount",l);if(!m){v="";for(f=x;f<l;f+=1){a=u[f];if(f===x||b.getDate()!==a.start.getDate())b=a.start,f!==0&&(d+='<ul class="wijmo-wijev-agenda-list">'+v+"</ul>",d+="</div>"),d+='<div class="wijmo-wijev-agenda-day-container '+this._dayDateToCssClass(b)+'">',i&&(d+=this._renderAgendaDayHeader(b)),v="";v+=this._renderAgendaAppointmentVisual(a),p+=1,f===l-1&&(d+='<ul class="wijmo-wijev-agenda-list">'+v+"</ul>",d+="</div>",l<u.length?(d+='<div class="wijmo-wijev-agenda-more-events">',d+=this._formatString(this.localizeString("agendaMoreEventsFormat","More events ({0})..."),u.length-l),d+="<div>",e.data("wijevcal_agenda_loadnextpage",!0)):e.data("wijevcal_agenda_loadnextpage",!1))}}else while(h<c){b=this._addDays(m,h),b=new Date(b.getFullYear(),b.getMonth(),b.getDate()),w=new Date(b.getFullYear(),b.getMonth(),b.getDate(),23,59,59),p=0,v="";for(f=x;f<l;f+=1)a=u[f],a.start<g&&a.end>m&&a.start<w&&a.start>=b&&(v+=this._renderAgendaAppointmentVisual(a),p+=1);v!==""&&(d+='<div class="wijmo-wijev-agenda-day-container '+this._dayDateToCssClass(b)+'">',i&&(d+=this._renderAgendaDayHeader(b)),d+='<ul class="wijmo-wijev-agenda-list">'+v+"</ul>",d+="</div>"),h+=1}r(d).appendTo(e)}e.on("click",".wijmo-wijev-agenda-event",r.proxy(this._onAgendaEventClick,this)).on("mouseover",".wijmo-wijev-agenda-event",function(e){if(S._isDisabled())return;r(this).addClass(y.wijCSS.stateHover)}).on("mouseout",".wijmo-wijev-agenda-event",function(e){if(S._isDisabled())return;r(this).removeClass(y.wijCSS.stateHover).removeClass(y.wijCSS.stateActive)}).on("mousedown",".wijmo-wijev-agenda-event",function(){if(S._isDisabled())return;r(this).addClass(y.wijCSS.stateActive)}).on("mouseup",".wijmo-wijev-agenda-event",function(){if(S._isDisabled())return;r(this).removeClass(y.wijCSS.stateActive)}),o.data("wijmo-wijsuperpanel")&&this._refreshSuperPanel(o)},n.prototype._renderAgendaDayHeader=function(e){var t='<div class="wijmo-wijev-agenda-header '+this.options.header+'">'+'<div class="wijmo-wijev-weekday">'+this._formatString("{0:dddd}",e)+"</div>"+'<div class="wijmo-wijev-date">'+this._formatString(this.localizeString("agendaHeaderFullDateFormat","{0:MMMM d, yyyy}"),e)+"</div>"+"</div>";return t},n.prototype._onAgendaEventClick=function(e){if(this._isDisabled())return;var t=r(e.target);t.hasClass("wijmo-wijev-agenda-event")||(t=t.parent(".wijmo-wijev-agenda-event")),t.length>0&&this.goToEvent(this._parseEventIdFromClass(t[0].className))},n.prototype._renderAgendaAppointmentVisual=function(e){var t='<li class="wijmo-wijev-agenda-event '+this._dayDateToCssClass(e.start)+" "+this._eventIdToCssClass(e.id)+" "+this.options.wijCSS.stateDefault+" "+this.options.wijCSS.helperClearFix+'">'+'<div class="wijmo-wijev-agenda-event-color '+"wijmo-wijev-event-color-"+(e.color||"default")+'">'+"<div></div>"+"</div>"+'<div class="wijmo-wijev-agenda-event-title">'+e.subject+"</div>"+'<div class="wijmo-wijev-agenda-event-time">'+(this.isAllDayEvent(e)?this.localizeString("labelAllDay","all-day"):this._formatString(this.localizeString("agendaTimeFormat","{0:hh:mm tt} to {1:hh:mm tt}"),e.start,e.end))+"</div>"+"</li>";return t},n.prototype._invalidateCurrentTimeIndicator=function(){var e=this.element.find(".wijmo-wijev-timeruler .wijmo-wijev-currenttime-indicator"),t=new Date,n=this.options;t=t.getMinutes()+t.getHours()*60,e.css("top",t/n.timeInterval*n.timeIntervalHeight)},n.prototype._onEventsDataChanged=function(){this._clearViewsCache(),this._prepareEventsForView(),this._renderActiveView(),this._trigger("eventsDataChanged",null,{eventsData:this.options.eventsData})},n.prototype._onCalendarsChanged=function(){this._trigger("calendarsChanged",null,{calendars:this.options.calendars})},n.prototype._renderDayViewAppointments=function(){var e=this,t=e._eventsView,n,i,s,o,u,a=e.element.find(".wijmo-wijev-headercontainer"),f=e.element.find(".wijmo-wijev-scrollcontent"),l=a.find(".wijmo-wijev-dayheadercolumn"),c=f.find(".wijmo-wijev-daycolumn"),h,p,d=e.options,v=e._getDayColumnDates(),m=v[0],g,y,b,w=null,E,S,x,T,N,C,k,L,A=[],O;g=v[v.length-1],g=new Date(g.getFullYear(),g.getMonth(),g.getDate(),23,59,59);if(t)for(s=0,u=v.length;s<u;s+=1)if(!c[s]._cached){h=v[s],h=new Date(h.getFullYear(),h.getMonth(),h.getDate()),p=new Date(h.getFullYear(),h.getMonth(),h.getDate(),23,59,59);for(i=0,o=t.length;i<o;i+=1)n=t[i],n.start<g&&n.end>m&&n.start<p&&n.end>h&&(this.isAllDayEvent(n)?(y=!0,S=r(e._getAllDayEventMarkup(n)),r(l[s]).find(".wijmo-wijev-allday-cell").append(S)):(x=n.start,T=n.end,x<h&&(x=h),T>p&&(T=p),N=(x-h)/1e3/60,C=(T-h)/1e3/60,k=Math.round(N*d.timeIntervalHeight/d.timeInterval),L=Math.round(C*d.timeIntervalHeight/d.timeInterval),S=r(e._getEventMarkup(n)),S.css("top",k),S.outerHeight(L-k),r(c[s]).append(S)));this._storeDayCache(v[s],l[s],c[s]),c[s]._cached=!0,A.push(c[s])}else A.push(c[s]);this._dayColumnsToResolve=A,this._dayColumnResolveIdx=0,this._resolveDayApptConflictsTimeout||(clearTimeout(this._resolveDayApptConflictsTimeout),this._resolveDayApptConflictsTimeout=null),this._resolveDayApptConflictsTimeout=setTimeout(r.proxy(this._resolveDayViewAppointmentConflictsCb1,this),1),y&&this._invalidateDayView(!0),this._dayViewScrollToEvent&&(S=this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ."+this._eventIdToCssClass(this._dayViewScrollToEvent.id)),S.length>0&&(O=S.parents(".wijmo-wijev-scrollpanel"),O.length>0&&O.wijsuperpanel("scrollChildIntoView",S)))},n.prototype._getAllDayEventMarkup=function(e){return'<div class="wijmo-wijev-appointment '+this._eventIdToCssClass(e.id)+'">'+'<div class="'+" wijmo-wijev-colordot wijmo-wijev-event-color-"+(e.color||"default")+'"></div>'+'<div class="wijmo-wijev-event-title">'+e.subject+"</div>"+"</div>"},n.prototype._getEventMarkup=function(e){var t=this,n={data:e,eventTemplate:null},i,s=t.options;return s.eventTemplate&&(n.eventTemplate=s.eventTemplate),t._trigger("eventCreating",null,n),i=n.eventTemplate?r(n.eventTemplate):null,i?(i.addClass("wijmo-wijev-appointment "+t._eventIdToCssClass(e.id)),i[0].outerHTML):'<div class="wijmo-wijev-appointment wijmo-wijev-event-color-'+(e.color||"default")+" "+t._eventIdToCssClass(e.id)+'">'+'<div class="wijmo-wijev-content"><div class="wijmo-wijev-title">'+t._formatString(t.options.eventTitleFormat,e.start,e.end,e.subject,e.location,"",e.description)+"</div></div>"+'<div class="wijmo-wijev-resizer">'+'<div class="'+t.options.wijCSS.icon+" "+t.options.wijCSS.iconHGripSolid+'">'+"&nbsp;</div></div>"+"</div>"},n.prototype._resolveDayViewAppointmentConflictsCb1=function(){this._resolveDayApptConflictsTimeout=null;if(!this._dayColumnsToResolve||this._dayColumnResolveIdx>=this._dayColumnsToResolve.length){this._renderComplete();return}this._resolveDayViewAppointmentConflicts(this._dayColumnsToResolve[this._dayColumnResolveIdx]),this._dayColumnResolveIdx=this._dayColumnResolveIdx+1,setTimeout(r.proxy(this._resolveDayViewAppointmentConflictsCb1,this),1)},n.prototype._renderComplete=function(){this.element.find(".loadCompletely").length===0&&r("<input type='hidden' class='loadCompletely'></input>").appendTo(this.element)},n.prototype._resolveDayViewAppointmentConflicts=function(e){var t=r(e).find(".wijmo-wijev-appointment"),n,i=[],s,o,u,a,f,l,c,h,p=0;n=r(t).toArray().sort(this._sortOffsetTop);for(o=0,l=t.length;o<l;o+=1){if(o<p)continue;a=n[o];for(u=o;u<l;u+=1)if(u!==o){f=n[u];if(!(a.offsetTop<f.offsetTop+f.offsetHeight&&a.offsetTop+a.offsetHeight>f.offsetTop))break;i[o]||(i[o]=[a]),i[o].push(f),f.offsetTop+f.offsetHeight>a.offsetTop+a.offsetHeight&&(a=f)}p=u}for(o=0,l=i.length;o<l;o+=1){s=i[o];if(s){c=s.length,s.sort(this._sortOffsetTop);for(u=0;u<c;u+=1)a=s[u],a.style.width=Math.floor(100/c)+"%",h=Math.floor(100*u/c),a.style.marginLeft=h+"%",a.style.zIndex=h}}},n.prototype._sortOffsetTop=function(e,t){return e.offsetTop<t.offsetTop?-1:e.offsetTop>t.offsetTop?1:0},n.prototype._onDayViewTimeIntervalClick=function(e){if(this._isDisabled())return;if(this.options.readOnly)return;this.showEditEventDialog(null,e.target,e)},n.prototype._onDayViewAllDayCellClick=function(e){if(this._isDisabled())return;if(this.options.readOnly)return;var t=r(e.target);if(t.hasClass("wijmo-wijev-appointment")||t.parents(".wijmo-wijev-appointment").length>0)return;if(t.hasClass("wijmo-wijev-daylabel")||t.parents(".wijmo-wijev-daylabel").length>0)return;this.showEditEventDialog(null,e.target,e)},n.prototype._onYearViewDayLabelClick=function(e){var t=this.options;if(this._isDisabled())return;if(r.inArray("month",this._viewsToLower(t.views))<0)return;var n=r(e.target).parents(".wijmo-wijev-yearcellcontainer"),t=this.options,i;n[0]&&(i=this._parseDateFromClass(n[0].className),t.viewType!=="month"&&(t.viewType="month",this._onViewTypeChanged()),t.selectedDates=[new Date(i)],this._onSelectedDatesChanged())},n.prototype._onMonthViewDayLabelClick=function(e){var t=this.options;if(this._isDisabled())return;if(r.inArray("day",this._viewsToLower(t.views))<0)return;var n=r(e.target).parents(".wijmo-wijev-monthcellcontainer"),t=this.options,i;n.length<1&&(n=r(e.target).parents(".wijmo-wijev-dayheadercolumn")),n[0]&&(i=this._parseDateFromClass(n[0].className),t.viewType!=="day"&&(t.viewType="day",this._onViewTypeChanged()),t.selectedDates=[new Date(i)],this._onSelectedDatesChanged())},n.prototype._onMonthViewCellClick=function(e){if(this._isDisabled())return;var t=r(e.target).parent(".wijmo-wijev-monthcellcontainer");if(this.options.readOnly)return;if(t.length<1)return;this.showEditEventDialog(null,t,e)},n.prototype._onYearViewCellClick=function(e){if(this._isDisabled())return;var t=r(e.target).parent(".wijmo-wijev-yearcellcontainer");if(this.options.readOnly)return;if(t.length<1)return;this.showEditEventDialog(null,t,e)},n.prototype._onAppointmentClick=function(e){var t=r(e.target),n;if(this._isDisabled())return;if(this.options.readOnly)return;if(this._apptDragResizeFlag)return;t.hasClass("wijmo-wijev-appointment")||(t=t.parents(".wijmo-wijev-appointment")),t.length>0&&(n=this.findEventById(t[0].className),this.showEditEventDialog(n,t,e))},n.prototype.findEventById=function(e){var t;if(e){t=e.indexOf("apptid_"),t!==-1&&(e=this._parseEventIdFromClass(e));if(this._eventsDataById)return this._eventsDataById[e]}return null},n.prototype._onMonthViewAppointmentMouseDown=function(e){if(this._isDisabled())return;if(this.options.readOnly)return;var t=r(e.target),n=t.hasClass("wijmo-wijev-appointment")?t:t.parents(".wijmo-wijev-appointment");e.preventDefault(),this.__targetAppt=n,r(document).bind("mouseup.tmp_wijevcal",r.proxy(this._onMonthViewAppointmentMouseUp,this)),this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").bind("mouseover.tmp_wijevcal",r.proxy(this._onMonthViewCellMouseOver,this))},n.prototype._onDayViewAppointmentMouseDown=function(e){if(this._isDisabled())return;if(this.options.readOnly)return;var t=r(e.target),n=t.hasClass("wijmo-wijev-appointment")?t:t.parents(".wijmo-wijev-appointment"),i=t.hasClass("wijmo-wijev-resizer")||t.parents(".wijmo-wijev-resizer").length>0;if(this._isDisabled())return;this._isApptResize=i,e.preventDefault(),this._isApptResize?(this.__startApptH=n[0].offsetHeight,this.__startApptY=n[0].offsetTop):this.__startApptY=n[0].offsetTop,this.__startClientY=e.clientY,this.__targetAppt=n,r(document).bind("mousemove.tmp_wijevcal",r.proxy(this._onDayViewAppointmentMouseMove,this)),r(document).bind("mouseup.tmp_wijevcal",r.proxy(this._onDayViewAppointmentMouseUp,this)),r(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").bind("mouseover.tmp_wijevcal",r.proxy(this._onDayViewColumnMouseOver,this)),r(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").bind("mouseover.tmp_wijevcal",r.proxy(this._onDayViewAllDayMouseOver,this))},n.prototype._onDayViewAppointmentMouseMove=function(e){if(this._isDisabled())return;e.preventDefault();var t=e.clientY-this.__startClientY,n,r=this.options,i,s,o;e.ctrlKey||(t=Math.round(t/r.timeIntervalHeight)*r.timeIntervalHeight),t!==0&&!this._apptDragResizeFlag&&(this._apptDragResizeFlag=!0,this.__targetAppt.addClass("wijmo-wijev-dragging"),this.__targetAppt.css("width","100%").css("margin-left","0").css("z-index","1000")),this._apptDragResizeFlag&&(this._isApptResize?(i=this.__startApptH+t,i<0?(i=Math.abs(i),n=this.__startApptY-i,n>=0&&(this.__targetAppt.css("height",i),this.__targetAppt.css("top",n))):this.__targetAppt.css("height",i)):(n=this.__startApptY+t,n<0&&(n=0),this.__targetAppt.css("top",n),s=this.__targetAppt.offset().top,o=this.__targetAppt.parents(".wijmo-wijev-scrollpanel"),o.length>0&&o.wijsuperpanel("scrollChildIntoView",this.__targetAppt),this.__startApptY=this.__startApptY-(this.__targetAppt.offset().top-s)),this._onApptVisualDargOrResize(this.__targetAppt,this.findEventById(this.__targetAppt[0].className)))},n.prototype._onDayViewAppointmentMouseUp=function(e){if(this._isDisabled())return;this.__targetAppt&&this.__targetAppt.removeClass("wijmo-wijev-dragging"),r(document).unbind(".tmp_wijevcal"),r(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").unbind(".tmp_wijevcal"),r(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").unbind(".tmp_wijevcal");if(this._apptDragResizeFlag||this._apptMovedFlag){var t=this.findEventById(this.__targetAppt[0].className);this._onApptVisualDargOrResize(this.__targetAppt,t),this._apptMovedFlag=!1,this._movedFromTimeInervalApptElem=null,this.updateEvent(t),window.setTimeout(r.proxy(function(){this.__targetAppt&&!this.__targetAppt.hasClass("wijmo-wijev-dragging")&&(this._apptDragResizeFlag=!1,this._resolveDayViewAppointmentConflicts(this.__targetAppt.parents(".wijmo-wijev-daycolumn")))},this),1)}},n.prototype._updateMonthViewApptVisual=function(e){var t=this.element.find(".wijmo-wijev-monthview ."+this._eventIdToCssClass(e.id)),n=this.options,r,i,o,u;if(t.length!==1)return;r=s(e.start),i=this._dayDateToCssClass(r),o=t[0].parentNode,u=this.element.find(".wijmo-wijev-monthcellcontainer."+i+">.wijmo-wijev-monthcell"),o.removeChild(t[0]),t.appendTo(u)},n.prototype._updateDayViewApptVisual=function(e){var t=this.element.find(".wijmo-wijev-dayview ."+this._eventIdToCssClass(e.id)),n=this.options,r,i,o,u,a,f,l,c;if(t.length!==1)return;this._addColorClass(t,e.color),t.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat,e.start,e.end,e.subject,e.location,"",e.description)),a=s(e.start),r=(e.start-a)/1e3/60,i=(e.end-a)/1e3/60,o=Math.round(r*n.timeIntervalHeight/n.timeInterval),u=Math.round(i*n.timeIntervalHeight/n.timeInterval),t.css("top",o),t.css("height",u-o),f=this._dayDateToCssClass(a),t.parents(".wijmo-wijev-daycolumn."+f).length!==1&&(l=t[0].parentNode,c=this.element.find(".wijmo-wijev-daycolumn."+f),l.removeChild(t[0]),t.appendTo(c))},n.prototype._updateAppointmentVisual=function(e){this.options.viewType==="month"?this._updateMonthViewApptVisual(e):this._updateDayViewApptVisual(e)},n.prototype._onApptVisualDargOrResize=function(e,t){if(this._isDisabled())return;var n=this.options,r=e[0].offsetTop,i=r+e[0].offsetHeight,o,u,a,f,l,c,h,p;e.parents(".wijmo-wijev-dayheadercolumn").length>0?p=e.parents(".wijmo-wijev-dayheadercolumn")[0]:p=e.parents(".wijmo-wijev-daycolumn")[0],h=this._parseDateFromClass(p.className,null),o=Math.round(r*n.timeInterval/n.timeIntervalHeight),u=Math.round(i*n.timeInterval/n.timeIntervalHeight),a=new Date(o*60*1e3+h.getTime()),f=new Date(u*60*1e3+h.getTime()),t&&(this._isApptResize?l=f:(c=t.end.getTime()-t.start.getTime(),l=new Date(a.getTime()+c)),t.allday=e.parents(".wijmo-wijev-dayheadercolumn").length>0,t.start=a,t.end=l,e.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat,t.start,t.end,t.subject,t.location,"",t.description)),!this._isApptResize&&l.getTime()!==f.getTime()&&e.css("height",Math.round((t.end-s(t.start))/1e3/60*n.timeIntervalHeight/n.timeInterval)-Math.round((t.start-s(t.start))/1e3/60*n.timeIntervalHeight/n.timeInterval)))},n.prototype._onDayViewColumnMouseOver=function(e){if(this._isDisabled())return;var t=r(e.target).parents(".wijmo-wijev-daycolumn"),n=this.__targetAppt.parents(".wijmo-wijev-daycolumn");if(t.length<1)return;if(n.length<1){n=this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn");if(n.length<1)return;this._movedFromTimeInervalApptElem?(this.__targetAppt.replaceWith(this._movedFromTimeInervalApptElem),this.__targetAppt=r(this._movedFromTimeInervalApptElem),this._movedFromTimeInervalApptElem=null):this.__targetAppt.html(this._getEventMarkup(this.findEventById(this.__targetAppt[0].className)))}t[0].className!==n[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this._resolveDayViewAppointmentConflicts(n),this.__targetAppt.appendTo(t),this._apptMovedFlag=!0)},n.prototype._onMonthViewCellMouseOver=function(e){if(this._isDisabled())return;var t=r(e.target),n=t.hasClass("wijmo-wijev-monthcellcontainer")?t:t.parents(".wijmo-wijev-monthcellcontainer"),i=this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer");if(n.length<1||i.length<1)return;n[0].className!==i[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this.__targetAppt.appendTo(n.find(".wijmo-wijev-monthcell")),this.__targetApptChanged=!0)},n.prototype._onMonthViewAppointmentMouseUp=function(){if(this._isDisabled())return;var e,t=this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer")[0],n=this._parseDateFromClass(t.className,null),i;r(document).unbind(".tmp_wijevcal"),this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").unbind(".tmp_wijevcal"),this.__targetApptChanged&&(this.__targetApptChanged=!1,e=this.findEventById(this.__targetAppt[0].className),i=(n.getTime()-s(e.start).getTime())/864e5,e.start=this._addDays(e.start,i),e.end=this._addDays(e.end,i),this.updateEvent(e))},n.prototype._onDayViewAllDayMouseOver=function(e){if(this._isDisabled())return;var t=r(e.target).parents(".wijmo-wijev-dayheadercolumn"),n=this.__targetAppt.parents(".wijmo-wijev-daycolumn"),i;if(t.length<1)return;n.length>0?(i=r(this._getAllDayEventMarkup(this.findEventById(this.__targetAppt[0].className))),this._movedFromTimeInervalApptElem=this.__targetAppt[0].cloneNode(!0),this.__targetAppt.replaceWith(i),this.__targetAppt=i):n=this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn");if(n.length<1)return;t[0].className!==n[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this._resolveDayViewAppointmentConflicts(n),this.__targetAppt.appendTo(r(t).find(".wijmo-wijev-allday-cell")),this._apptMovedFlag=!0)},n.prototype._getMonthGrid=function(e){var t=this,n=t.options,r=3,i=4,s,o,u,a,f,l,c;s="<div class = 'wijmo-wijev-yearview-inner'>",o=e.getFullYear();for(u=0;u<r;u++){s+="<div>";for(a=0;a<i;a++)f=u*4+a,c=new Date(o,f),l=t._formatString(t.localizeString("customYearViewMonthFormat","{0:MMM}"),c),s+=t._generateMonthCell(c,l);s+="</div>"}return s+="</div>",s.toString()},n.prototype._generateMonthCell=function(e,t){var n=this.options;return"<div class = '"+n.wijCSS.content+" wijmo-wijev-yearcellcontainer"+" wijmo-wijev-month_"+e.getFullYear()+"_"+e.getMonth()+"_1'>"+"<div class = 'wijmo-wijev-yearcellheader'>"+t+"</div>"+"<div  class = 'wijmo-wijev-yearcell'>"+"</div>"+"</div>"},n.prototype._getSuperPanelScrollPosition=function(e){return e.data("wijmoWijsuperpanel")?e.length===0?0:e.wijsuperpanel("option","vScroller").scrollValue:0},n.prototype._renderYearView=function(){var e=this,t=e.options,n=e.element.find(".wijmo-wijev-view.wijmo-wijev-yearview"),i,s,o,u,a,f=e._getCurrentViewIndex(),l=e._isCustomView(),c=t.views[f].count||1,h,p=l&&c>1;p&&(h=e._getSuperPanelScrollPosition(n.find(".wijmo-wijev-panel"))),n.length===0&&(n=r('<div class="wijmo-wijev-view wijmo-wijev-yearview '+t.wijCSS.content+'">'+"</div>"),n.appendTo(this.element.find(".wijmo-wijev-view-container"))),n.empty(),n.append(r('<h3 class="wijmo-wijev-header-title">title</h3>')),s=r('<div class = "wijmo-wijev-panel"></div>'),o=r('<div id = "wijmo-wijev-content"></div>'),s.append(o),n.append(s);for(u=0;u<c;u++)a=new Date(t.selectedDate.getFullYear()+u,t.selectedDate.getMonth(),1),p&&o.append(r('<h5 class="wijmo-wijev-year-title">'+this._formatString(this.localizeString("customYearViewSecondTitleFormat","{0:yyyy}"),a)+"</h5>")),i=r(this._getMonthGrid(a)),o.append(i);p&&s.wijsuperpanel({hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollValue:h},animationOptions:{disabled:!0}}),this._invalidateYearView(),this._renderYearViewAppointments()},n.prototype._renderYearViewAppointments=function(){var e=this._eventsView,t,n,i,s,o=this.element.find(".wijmo-wijev-yearcellcontainer"),u,a,f,l;if(e)for(i=0;i<o.length;i++){u=o[i],a=this._parseDateFromClass(u.className),f=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59);for(n=0,s=e.length;n<s;n+=1)t=e[n],t.start<f&&t.end>a&&(l=r('<div class="wijmo-wijev-appointment '+this._eventIdToCssClass(t.id)+'">'+'<div class="'+" wijmo-wijev-colordot wijmo-wijev-event-color-"+(t.color||"default")+'"></div>'+'<div class="wijmo-wijev-event-title">'+t.subject+"</div>"+"</div>"),r(u).find(".wijmo-wijev-yearcell").append(l))}o.find(".wijmo-wijev-yearcell").each(r.proxy(function(e,t){var n=r(t),i=n.find(".wijmo-wijev-appointment"),s=n.outerHeight(),o=i.outerHeight(),u=i.length*o,a=0;u>s&&(i.each(function(e,t){e*o+o>s&&(t.style.display="none",a+=1)}),a>0&&n.find(".wijmo-wijev-yearcell-showmore").length<1&&n.append(r('<div class="wijmo-wijev-yearcell-showmore">'+this._formatString(this.localizeString("yearCellMoreEventsFormat","{0}  more..."),a)+"</div>")))},this)),this._renderComplete()},n.prototype._invalidateYearView=function(){var e=this,t=e.options,n=e.element.find(".wijmo-wijev-yearview"),i=n.find(".wijmo-wijev-yearcellcontainer"),s=n.find(".wijmo-wijev-yearview-inner"),o=n.find(".wijmo-wijev-panel"),u=e.element.find(".wijmo-wijev-yearview .wijmo-wijev-header-title"),a=e._getCurrentViewIndex(),f,l,c,h,p;e._updateHeaderTitleText(),e._invalidateView(),h=n.innerWidth(),p=n.innerHeight()-u.outerHeight(!0),o.width(h),o.height(p),e._isCustomView()&&t.views[a].count>1&&(h-=18),s.outerWidth(h),s.outerHeight(p),h-=s.outerWidth(!0)-s.innerWidth(),p-=s.outerHeight(!0)-s.innerHeight(),i.outerWidth(Math.ceil(h/4)),i.outerHeight(Math.ceil(p/3)),f=i.height(),c=r(i[0]).find(".wijmo-wijev-yearcellheader").outerHeight(!0),l=f-c,i.find(".wijmo-wijev-yearcell").outerHeight(l),e._isCustomView()&&t.views[a].count>1&&e._refreshSuperPanel(o)},n.prototype._renderMonthView=function(){var e=this,t=e.options,n=t.selectedDate,i=t.firstDayOfWeek,s=!1,o=!1,u,a,f,l=new Date,c,h,p=!1,d,v,m,g,y,b=e._getCurrentViewIndex(),w=e._isCustomView(),E=w?t.views[b].count:1,S,x=[],T,N,C,k=e.element.find(".wijmo-wijev-view.wijmo-wijev-monthview"),L,A=t.dayHeaderFormat,O=t.firstRowDayHeaderFormat,M,_=w&&E>1;_&&(M=e._getSuperPanelScrollPosition(k.find(".wijmo-wijev-panel"))),n||(n=new Date);for(S=0;S<E;S++){T=a=new Date(n.getFullYear(),n.getMonth()+S,1),y={startDate:a,data:["","","","","","",""]};while(a.getDay()!==parseInt(i))a=this._addDays(a,-1);f=new Date(n.getFullYear(),n.getMonth()+S,e._daysInMonth(n.getMonth()+S,n.getFullYear())),u=a,c=0,h=0;while(u<f||c<7){u>f&&(f=u),v="",d="wijmo-wijev-monthcellcontainer "+t.wijCSS.content+" "+e._dayDateToCssClass(u),o=u.getMonth()!==T.getMonth()||u.getFullYear()!==T.getFullYear(),o&&(d+=" wijmo-wijev-othermonth"),p?p=!1:(d+=" wijmo-wijev-leftborder",c===6&&(d+=" wijmo-wijev-rightborder")),s=e._compareDayDates(u,l)===0,s&&(d+=" wijmo-wijev-today",d+=" wijmo-wijev-rightborder",p=!0),v+='<div class="'+d+'">',v+='<div class="wijmo-wijev-monthcellheader',o&&(v+=" "+t.wijCSS.prioritySecondary),s&&(v+=" "+t.wijCSS.stateHighlight),v+='">',s&&(v+='<span class="wijmo-wijev-todaylabel">'+this.localizeString("labelToday","Today")+"</span>"),h===0?v+=e._formatString(O,u):v+=e._formatString(A,u),v+="</div>",v+='<div class="wijmo-wijev-monthcell',o&&(v+=" "+t.wijCSS.prioritySecondary),s&&(v+=" "+t.wijCSS.stateHighlight),v+='"></div>',v+="</div>",y.data[c]=y.data[c]+v,c+=1,u=e._addDays(u,1);if(c>6){if(u>f)break;c=0,h+=1}}x.push(y)}k.length===0&&(k=r('<div class="wijmo-wijev-view wijmo-wijev-monthview '+t.wijCSS.content+'">'+"</div>"),k.appendTo(e.element.find(".wijmo-wijev-view-container"))),k.empty(),k.append(r('<h3 class="wijmo-wijev-header-title">title</h3>')),N=r('<div class = "wijmo-wijev-panel"></div>'),C=r('<div id = "wijmo-wijev-content"></div>'),N.append(C),k.append(N);for(m=0;m<x.length;m++){_&&C.append(r('<h5 class="wijmo-wijev-month-title">'+e._formatString(e.localizeString("customMonthViewSecondTitleFormat","{0:MMM}"),x[m].startDate)+"</h5>")),L=r('<div class="wijmo-wijev-monthview-inner"></div>'),C.append(L);for(g=0;g<7;g+=1)L.append('<div class="wijmo-wijev-monthcolumn">'+x[m].data[g]+"</div>")}_&&N.wijsuperpanel({hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollValue:M},animationOptions:{disabled:!0}}),e._invalidateMonthView(),e._renderMonthViewAppointments()},n.prototype._invalidateMonthView=function(){var e=this,t=e.options,n=e.element.find(".wijmo-wijev-monthview"),i=n.find(".wijmo-wijev-monthview-inner"),s=i.find(".wijmo-wijev-monthcolumn"),o=n.find(".wijmo-wijev-panel"),u=e.element.find(".wijmo-wijev-monthview .wijmo-wijev-header-title"),a,f,l,c,h,p,d,v=e._getCurrentViewIndex(),m;e._updateHeaderTitleText(),e._invalidateView();if(s.length<1)return;a=n.innerWidth(),f=n.innerHeight()-u.outerHeight(!0),o.width(a),o.height(f),e._isCustomView()&&t.views[v].count>1&&(a-=18),i.outerWidth(a),i.outerHeight(f),a-=i.outerWidth(!0)-i.innerWidth(),f-=i.outerHeight(!0)-i.innerHeight(),l=Math.floor(a/(s.length/i.length)),s.outerWidth(l),m=a-l*s.length,m>0&&r(s[s.length-1]).outerWidth(l+m),d=r(s[0]).find(".wijmo-wijev-weekdayname").outerHeight(!0),d||(d=0),r.each(i,function(e,t){var n=r(t),i=n.find(".wijmo-wijev-monthcellcontainer");c=Math.floor((f-d)/n.find(".wijmo-wijev-monthcolumn").eq(0).find(".wijmo-wijev-monthcellcontainer").length),i.outerHeight(c),h=r(i[0]).find(".wijmo-wijev-monthcellheader").outerHeight(!0),p=c-h,i.find(".wijmo-wijev-monthcell").outerHeight(p)}),e._isCustomView()&&t.views[v].count>1&&this._refreshSuperPanel(o)},n.prototype._renderMonthViewAppointments=function(){var e=this._eventsView,t,n,i,s,o,u=this.element.find(".wijmo-wijev-monthcellcontainer"),a,f,l,c;if(e)for(i=0,o=u.length;i<o;i+=1){a=u[i],f=this._parseDateFromClass(a.className),l=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59);for(n=0,s=e.length;n<s;n+=1)t=e[n],t.start<l&&t.end>f&&(c=r('<div class="wijmo-wijev-appointment '+this._eventIdToCssClass(t.id)+'">'+'<div class="'+" wijmo-wijev-colordot wijmo-wijev-event-color-"+(t.color||"default")+'"></div>'+'<div class="wijmo-wijev-event-title">'+t.subject+"</div>"+"</div>"),r(a).find(".wijmo-wijev-monthcell").append(c))}u.find(".wijmo-wijev-monthcell").each(r.proxy(function(e,t){var n=r(t),i=n.find(".wijmo-wijev-appointment"),s=n.outerHeight(),o=i.outerHeight(),u=i.length*o,a=0;u>s&&(i.each(function(e,t){e*o+o>s&&(t.style.display="none",a+=1)}),a>0&&n.find(".wijmo-wijev-monthcell-showmore").length<1&&n.append(r('<div class="wijmo-wijev-monthcell-showmore">'+this._formatString(this.localizeString("monthCellMoreEventsFormat","{0}  more..."),a)+"</div>")))},this)),this._renderComplete()},n.prototype.log=function(e,t){},n.prototype._log=function(e,t){var n;this.logPanel&&(n=new Date,this.logPanel.prepend(r('<span class="'+(t?t:"wijmo-wijev-information")+'">'+"["+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"] "+e+"</span><br/>")))},n.prototype._createLogPanel=function(){if(!this.logPanel){this.logDialog=r('<div title="Log"><div class="wijmo-wijev-log"></div></div>'),this.logDialog.appendTo(this.element);var e={};e[this.localizeString("buttonClearAll","Clear All")]=function(){r(this).find(".wijmo-wijev-log").html("")},e[this.localizeString("buttonClose","Close")]=function(){r(this).wijdialog("close")},this.logPanel=this.logDialog.wijdialog({captionButtons:{},buttons:e,width:600,height:420,position:["right","top"]}).find(".wijmo-wijev-log")}this.logDialog.wijdialog("open")},n.prototype.status=function(e,t){this.element.find(".wijmo-wijev-statusbar").html("<span class='"+(t?t:"wijmo-wijev-status")+"'>"+e+"</span>"),this.log(e,t?t:"wijmo-wijev-status"),this.statusbarEventsAdded||(this.statusbarEventsAdded=!0,this._initStatusbar())},n.prototype._invalidateView=function(){var e=this.element.find(".wijmo-wijev-rightpane"),t=this.element.find(".wijmo-wijev-leftpane"),n=this.element.find(".wijmo-wijev-headerbar"),i=this.element.find(".wijmo-wijev-navigationbar"),s=this.element.find(".wijmo-wijev-statusbar"),o=this.element.find(".wijmo-wijev-view-container"),u=this.element.find(".wijmo-wijev-view"),a,f,l,c,h,p,d,v,m,g;a=this.element.innerWidth()-(o.outerWidth(!0)-o.innerWidth()),f=this.element.innerHeight()-(o.outerHeight(!0)-o.innerHeight()),l=n.is(":visible")?n.outerHeight(!0):0,c=i.is(":visible")?i.outerHeight(!0):0,h=s.is(":visible")?s.outerHeight(!0):0,o.outerWidth(a),o.outerHeight(f-l-c-h),v=0;for(g=0;g<t.length;g+=1)r(t[g]).is(":visible")&&(v+=r(t[g]).outerWidth());m=e.is(":visible")?e.outerWidth():0,p=f-l-c-h,d=a-m-v-1,u.outerHeight(p),u.outerWidth(d),n.outerWidth(d+v),i.outerWidth(this.element.innerWidth()),s.outerWidth(d+v+m),t.outerHeight(f-l-c-h),e.outerHeight(f+100),this.element.find(".wijmo-wijev-datepager").wijdatepager("refresh")},n.prototype._daysInMonth=function(e,t){var n=new Date(t,e+1,0);return n.getDate()},n.prototype._addMinutes=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+t)},n.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},n.prototype._addYears=function(e,t){return new Date(e.getFullYear()+t,e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},n.prototype._setTime=function(e,t,n){var r;return e=new Date(e),e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),n&&(r=Math.floor((t.getTime()-n.getTime())/864e5),r>0&&(e=this._addDays(e,r))),e},n.prototype._addMonths=function(e,t){return new Date(e.getFullYear(),e.getMonth()+t,e.getDate())},n.prototype._compareDayDates=function(e,t){return e=new Date(e.getFullYear(),e.getMonth(),e.getDate()),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e<t?-1:e>t?1:0},n.prototype._dayDateToCssClass=function(e){return"wijmo-wijev-date_"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},n.prototype._parseDateFromClass=function(e,t,n){var r,i,s,o,u=new RegExp("wijmo-wijev-minute-(\\d+)\\s"),a=new RegExp("wijmo-wijev-date_(\\d+_\\d+_\\d+)\\s"),f=new RegExp("wijmo-wijev-month_(\\d+_\\d+_\\d+)\\s");return e?(o=a.exec(e+" "),o||(o=f.exec(e+" ")),s=o[1].split("_"),r=new Date(parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)),t&&(i=u.exec(t+" "),i&&(i=parseInt(i[1],10),r.setMinutes(i))),r):n||null},n.prototype._eventIdToCssClass=function(e){return"apptid_"+e},n.prototype._parseEventIdFromClass=function(e){var t="",n,r;return n=new RegExp("apptid_(\\S+)"),r=n.exec(e),r&&r.length>1&&(t=r[1]),t},n.prototype._isContainsDayDate=function(e,t){var n;if(!e)return!1;for(n=0;n<e.length;n+=1)if(this._compareDayDates(e[n],t)===0)return!0},n.prototype._formatString=function(e,t,n,r,i,s,o,u){var a,f=arguments,l,c,h=this;if(f.length<=1)return Globalize.format(f);typeof e=="string"&&(e==="_formatWeekTitle"?e=this._formatWeekTitle:e==="_formatMonthTitle"?e=this._formatMonthTitle:e==="_formatCustomTitle"?e=this._formatCustomTitle:typeof window[e]=="function"&&(e=window[e]));if(typeof e=="function"){c=[];for(l=1;l<f.length;l+=1)c[l-1]=f[l];return e.apply(this,c)}return a=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(a,function(e,t,n,r,i){return e=f[Number(t)+1],r?Globalize.format(e,r,h._getCulture()):e})},n.prototype._formatMonthTitle=function(e){return this._formatString(this.localizeString("monthViewHeaderFormat","{0:MMMM yyyy}"),e)},n.prototype._formatCustomTitle=function(e,t){var n=this,r=n.options,i=n._getCurrentViewIndex(),s=r.views[i].count===1;switch(this._getCustomViewUnit()){case"day":return s?n._formatString(n.localizeString("customSingleWeekViewHeaderFormat","{0:d}"),e,t):n._formatString(n.localizeString("customWeekViewHeaderFormat","{0:d} - {1:d}"),e,t);case"week":return n._formatString(n.localizeString("customWeekViewHeaderFormat","{0:d} - {1:d}"),e,t);case"month":return s?n._formatString(n.localizeString("customSingleMonthViewHeaderFormat","{0:MMMM yyyy}"),e,t):n._formatString(n.localizeString("customMonthViewHeaderFormat","{0:MMMM yyyy} - {1:MMMM yyyy}"),e,t);case"year":return s?n._formatString(n.localizeString("customSingleYearViewHeaderFormat","{0:yyyy}"),e,t):n._formatString(n.localizeString("customYearViewHeaderFormat","{0:yyyy} - {1:yyyy}"),e,t)}},n.prototype._formatWeekTitle=function(e,t){return e.getMonth()!==t.getMonth()?this._formatString(this.localizeString("weekViewHeaderFormat2Months","{0:MMMM} - {1:MMMM yyyy}"),e,t):this._formatString(this.localizeString("weekViewHeaderFormat","{0:MMMM yyyy}"),e)},n.prototype._formatDayHeaderDate=function(e){var t=this,n=t.options,r=t._isCustomView()?"custom":n.viewType.toLowerCase(),i=t.options.dayViewHeaderFormat;if(i[r])i=i[r];else if(!i[r])return"";return t._formatString(i,e)},n.prototype._getCulture=function(e){return this._innerCulture||this._resetCulture(e),this._innerCulture},n.prototype._resetCulture=function(e){var t=r.wijGetCulture(e||this.options.culture,this.options.cultureCalendar);this._innerCulture=t},n.prototype._isRTL=function(){return!!this._getCulture().isRTL},n.prototype._onAjaxError=function(e,t,n,r){t?(this.status("Ajax error "+t.status+" ("+t.statusText+")","error"),this.log("Error, requested url: "+n.url,"error"),t.responseText&&this.log("Error, response text: "+t.responseText,"error")):(this.status("Ajax error detected.","error"),this.log("Error, requested url: "+n.url,"error"))},n.prototype._onWindowResize=function(){this.invalidate()},n}(t.wijmoWidget);n.wijevcal=d;var v=function(){function e(){this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body ui-body-b",stateDefault:"ui-btn ui-btn-b"},this.initSelector=":jqmData(role='wijevcal')",this.culture="",this.cultureCalendar="",this.localization=null,this.datePagerLocalization=null,this.readOnly=!1,this.webServiceUrl="",this.colors=null,this.dataStorage={addEvent:null,updateEvent:null,deleteEvent:null,loadEvents:null,addCalendar:null,updateCalendar:null,deleteCalendar:null,loadCalendars:null},this.dataSource=null,this.eventsData=null,this.appointments=[],this.calendars=[],this.disabled=!1,this.editCalendarTemplate="",this.enableLogs=!1,this.eventTitleFormat="{2}",this.titleFormat={day:!1,week:"_formatWeekTitle",month:"_formatMonthTitle",list:!1,custom:"_formatCustomTitle"},this.firstDayOfWeek=0,this.headerBarVisible=!0,this.navigationBarVisible=!0,this.rightPaneVisible=!1,this.selectedDate=null,this.selectedDates=null,this.statusBarVisible=!1,this.timeInterval=30,this.timeIntervalHeight=15,this.timeRulerInterval=60,this.timeRulerFormat="{0:h tt}",this.dayHeaderFormat="{0:d }",this.firstRowDayHeaderFormat="{0:ddd d}",this.dayViewHeaderFormat={day:"all-day events",week:"{0:d dddd}",list:"{0:d dddd}",custom:"{0:d dddd}"},this.viewType="day",this.views=["day","week","month","list"],this.ensureEventDialogOnBody=!1,this.visibleCalendars=new Array("Default"),this.calendar=null,this.calendarsChanged=null,this.initialized=null,this.selectedDatesChanged=null,this.viewTypeChanged=null,this.eventCreating=null,this.beforeEditEventDialogShow=null,this.beforeAddEvent=null,this.beforeUpdateEvent=null,this.beforeDeleteEvent=null,this.beforeAddCalendar=null,this.beforeUpdateCalendar=null,this.beforeDeleteCalendar=null,this.eventsDataChanged=null}return e}();d.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new v),r.wijmo.registerWidget(i,d.prototype)})(t.evcal||(t.evcal={}));var n=t.evcal})(wijmo||(wijmo={}))});