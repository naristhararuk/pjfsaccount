var wijmo;define(["./wijmo.widget","./wijmo.wijgrid","./wijmo.wijmenu","./wijmo.wijdialog","./wijmo.wijsplitter","./wijmo.wijtree","./wijmo.wijpager","globalize"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijmo-wijtilelist",s=r.extend(new t.wijmo_css,{tilelist:i,tilelistList:i+"-list",tilelistItem:i+"-item",tilelistItemStateDefault:"",tilelistLink:i+"-link",tilelistContent:i+"-content",tilelistIconContainer:i+"-iconcontainer"}),o=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._create=function(){var e=this;t.prototype._create.call(this),e._createTileList(),e._attachEvents()},n.prototype._setOption=function(e,n){if(e==="data"){this._setData(n);return}t.prototype._setOption.call(this,e,n)},n.prototype._createTile=function(e){var t=this,n=r("<li>"),i=r("<a>"),s=r("<img>"),o=r("<div>"),u=r.extend(!0,{},e),a=t.options.wijCSS,f,l=a.stateHover;return n.hover(function(){r(this).addClass(l)},function(){r(this).removeClass(l)}),t._onTileCreating({tile:u,element:n})===!1?n:(n.addClass(a.tilelistItem+" "+a.tilelistItemStateDefault).attr("title",u.hint),i.addClass(a.tilelistLink).attr("href","javascript:void(0)").appendTo(n),o.addClass(a.tilelistIconContainer).appendTo(i),(f=u.iconFormat)?s=f():s.attr("alt",u.text).attr("src",u.path).attr("align","bottom"),s.appendTo(o),r("<span>").addClass(a.tilelistContent).text(u.text).appendTo(i),t._onTileCreated({tile:e,element:n}),n)},n.prototype._createTiles=function(e){var t=this,n=r("<ul>");return n.addClass(t.options.wijCSS.tilelistList),e&&r.each(e,function(e,r){n.append(t._createTile(r))}),n},n.prototype._createTileList=function(){var e=this,t=e.options,n=t.wijCSS,r=e.element;r.addClass(n.widget+" "+n.tilelist),t.data&&t.data.length&&r.append(e._createTiles(t.data))},n.prototype._disposeTiles=function(e){e&&e.remove()},n.prototype._setData=function(e){var t=this,n=t.element.find("ul:first");t.options.data=e,t._$focusTile=null,n&&t._disposeTiles(n),n=t._createTiles(e),t.element.append(n)},n.prototype._setTileFocus=function(e){var t=this,n=t.options.wijCSS,r=n.stateFocus;t.element.find("li."+r).removeClass(r),e&&e.addClass(r).find("."+n.tilelistLink).focus(),t._$focusTile=e},n.prototype._attachEvents=function(){var e=this,t=e.widgetName;e.element.on("click."+t,r.proxy(e._handleClick,e)).on("keydown."+t,r.proxy(e._handleKeyDown,e))},n.prototype._handleClick=function(e){var t=this;t.selectTile(t._getTileElement(r(e.target)),e.ctrlKey)},n.prototype._handleKeyDown=function(e){var t=this,n=r.ui.keyCode;switch(e.keyCode){case n.LEFT:t._movePrev();break;case n.UP:t._moveUp();break;case n.RIGHT:t._moveNext();break;case n.DOWN:t._moveDown();break;default:return}e.preventDefault()},n.prototype._getTileElement=function(e){return e.closest("li."+this.options.wijCSS.tilelistItem)},n.prototype.selectTile=function(e,t){var n=this,i=n.element,s=n.options,o=s.wijCSS.stateHighlight,u=i.find("li").filter(function(){return r(this).hasClass(o)}),a;if(!e||!e.length)return;!s.allowMultipleSelection||!t?(u.removeClass(o),e.addClass(o)):e.toggleClass(o),a=i.find("li").filter(function(){return r(this).hasClass(o)}),u!==a&&n._onSelectionChanged({oldSelection:n._createSelectionArgs(u),newSelection:n._createSelectionArgs(a)}),n._setTileFocus(e)},n.prototype._createSelectionArgs=function(e){var t=this,n=t.options.data,i=[],s=t.element.find("li."+t.options.wijCSS.tilelistItem);return r.each(e,function(e,t){i.push({tile:n[s.index(t)],element:r(t)})}),i},n.prototype._getVSiblingTile=function(e,t){var n=this,r=n.element,i=n.options.wijCSS,s=r.find("li."+i.tilelistItem),o=r.find("ul."+i.tilelistList).width(),u,a,f,l;return!e||!o?null:(u=s.index(e),a=e.outerWidth(!0),f=Math.floor(o/a),l=u+(t?-1:1)*f,l<0||l>=Math.ceil(s.length/f)*f?e:(l>=s.length&&(l=s.length-1),s.eq(l)))},n.prototype._movePrev=function(){var e=this,t=e._$focusTile;e.selectTile(t&&t.prev())},n.prototype._moveNext=function(){var e=this,t=e._$focusTile;e.selectTile(t&&t.next())},n.prototype._moveUp=function(){var e=this,t=e._$focusTile,n=t&&e._getVSiblingTile(t,!0);if(n==t)return;e.selectTile(n)},n.prototype._moveDown=function(){var e=this,t=e._$focusTile,n=t&&e._getVSiblingTile(t,!1);if(n==t)return;e.selectTile(n)},n.prototype._onTileCreating=function(e){return this._trigger("tileCreating",null,e)},n.prototype._onTileCreated=function(e){return this._trigger("tileCreated",null,e)},n.prototype._onSelectionChanged=function(e){return this._trigger("selectionChanged",null,e)},n.prototype.setFocus=function(){var e=this,t=e._$focusTile;t&&t.length>0?e._setTileFocus(t):e.selectTile(e.element.find("li."+e.options.wijCSS.tilelistItem).first())},n}(t.wijmoWidget);n.wijtilelist=o;var u=function(){function e(){this.data=null,this.allowMultipleSelection=!1,this.tileCreating=undefined,this.tileCreated=undefined,this.selectionChanged=undefined,this.wijCSS=s}return e}();o.prototype.widgetEventPrefix="wijtilelist",o.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new u),r.wijmo.registerWidget("wijtilelist",o.prototype)})(t.tilelist||(t.tilelist={}));var n=t.tilelist})(wijmo||(wijmo={})),function(t){(function(n){function O(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(r.inArray(e[n],t)===-1)return!1;return!0}function M(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].path===t)return e[n];return null}function _(e){var t=P(e);return e[e.length-1]===t?e:e+t}function D(e){var t=P(e);return e[e.length-1]===t?e.substring(0,e.length-1):e}function P(e){return e&&e.indexOf(h)!==-1?h:p}function H(e){var t=[],n=0,r=e.length,i,s;e.sort(function(e,t){return e.path>t.path?1:e.path>t.path?-1:0});for(;n<r;n++){i=e[n];if(!i.isFolder){t.push(i);continue}s=!1;for(var o=0,u=t.length;o<u;o++){var a=t[o];if(!a.isFolder)continue;if(a.path.indexOf(i.path)>-1){s=!0;break}}s||t.push(i)}return t}function B(e,t){return t.indexOf(_(e))===0}function j(e,t){var n,r=P(e);return e=_(e),B(e,t)?(n=D(t.substring(e.length)),n.indexOf(r)===-1):!1}function F(e){return r(e).hasClass(a.folderItem)}function I(e){return e?e.replace(d,h):""}function q(e,t){var n=P(t);return t[0]!==c||t[1]!==n?I(t):(e==null&&(e=""),e.length>0&&(e=_(e)),I(e+t.substring(2)))}function R(e,t){var n,r=P(e),i=D(e).split(r).pop();return t?(n=R(e).indexOf("."),n===-1?i:i.substring(0,n)):i}function U(e){var t=R(e),n=R(e).indexOf(".");return n===-1?"":t.substring(n+1)}function z(e){var t=P(e);return e.substring(0,D(e).lastIndexOf(t))}function W(e){return r.map(e.split("-"),function(e,t){return e?(t===0?e.charAt(0).toLowerCase():e.charAt(0).toUpperCase())+e.substring(1):""}).join("")}function X(e){if(!e)return 0;var t=r(e);return t.length?t.outerWidth(!0)-t.width():0}var r=jQuery,i="wijmo-wijfileexplorer",s=".wijfileexplorer",o="wijfileexplorercommand",u="wijfileexplorerDragItems",a=r.extend(new t.wijmo_css,{fileExplorer:i,loadingOverlay:i+"-overlay",loadingText:i+"-loadingtext",itemsViewContainer:i+"-itemsviewcontainer",emptyFolderTip:i+"-emptyfoldertip",splitterV:"wijmo-wijsplitter-vertical",splitterVPanel1:"wijmo-wijsplitter-v-panel1",splitterVPanel2:"wijmo-wijsplitter-v-panel2",splitterVPanel1Content:"wijmo-wijsplitter-v-panel1-content",splitterVPanel2Content:"wijmo-wijsplitter-v-panel2-content",folderExpandedIcon:"ui-icon-folder-open",folderCollapsedIcon:"ui-icon-folder-collapsed",documentIcon:"ui-icon-document",folderItem:i+"-folder",fileItem:i+"-file",toolbar:i+"-toolbar",toolbarBack:i+"-back",toolbarForward:i+"-forward",toolbarOpen:i+"-open",toolbarRefresh:i+"-refresh",toolbarNewFolder:i+"-newfolder",toolbarDelete:i+"-delete",toolbarSetDetailViewMode:i+"-grid",toolbarSetThumbnailViewMode:i+"-thumbnail",toolbarUploader:i+"-uploader",address:i+"-address",addressPanel:i+"-addresspanel",addressBar:i+"-addressbar",filter:i+"-filter",filterPanel:i+"-filterpanel",addressBarFullWidth:i+"-addressbar-fullwidth",fileTree:i+"-filetree",tvLink:"wijmo-wijtree-link",gridContainer:i+"-gvContainer",listViewContainer:i+"-lvContainer",grid:i+"-gridview",sizeContent:i+"-sizecontent",gridRow:"wijmo-wijgrid-row",gridInnerCell:"wijmo-wijgrid-innercell",thumbnailView:i+"-listview",tileItem:"wijmo-wijtilelist-item",tileContent:"wijmo-wijtilelist-content",contentItem:i+"-content",contentItemContainer:i+"-contentcontainer",link:i+"-link",dragContent:i+"-dragcontent"}),f={detail:"detail",thumbnail:"thumbnail"},l={"default":"default",fileTree:"fileTree"},c="~",h="/",p="\\",d=/\\/g,v={toolbar:"toolbar",addressBox:"addressBox",filterBox:"filterTextBox",treeView:"treeView",detailView:"grid",thumbnailView:"listView",contextMenu:"contextMenu"},m={getHostUri:"GetHostUri",getItems:"GetItems",paste:"Paste",move:"Move","delete":"Delete",newFolder:"CreateDirectory",rename:"Rename"},g={name:"name",size:"size"},y=0,b=1,w={ascending:"ascending",descending:"descending"},E=300,S=500,x="",T=w.ascending,N=0,C=1,k=g.name,L=["*.*"],A={focusFileExplorer:"Ctrl+F2",focusTreeView:"Shift+3",focusToolBar:"Shift+1",focusGrid:"Shift+4",focusAddressBar:"Shift+2",popupWindowClose:"Esc",focusPager:"Shift+5",contextMenu:"Shift+M",back:"Ctrl+K",forward:"Ctrl+L",open:"Enter",refresh:"Ctrl+F3",newFolder:"Shift+N","delete":"Delete",uploadFile:"Ctrl+U"},V=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._create=function(){var e=this;t.prototype._create.call(this),e._initDataOptions(),e._initCommands(),e._createInnerControls(),e._optionsUpdated(),e._initMembers(),e._attachEvents()},n.prototype._getGlobalEventNameSpaceSuffix=function(){var e=this;return e._globalEventNameSpaceSuffix||(e._globalEventNameSpaceSuffix="."+e.element.uniqueId().attr("id"))},n.prototype._attachEvents=function(){var e=this,t=e._getGlobalEventNameSpaceSuffix();r(document).on("keydown"+t,function(t){if(t.keyCode===r.ui.keyCode.TAB){e._moveFocus(!t.shiftKey)&&t.preventDefault();return}if(t.keyCode===r.ui.keyCode.ENTER&&e._handleEnterKeyDown())return;return e._processShortcut(t)}).on("mousedown"+t,function(t){e._isChildElement(r(t.target))||e.element.find("."+e._focusCss).removeClass(e._focusCss)})},n.prototype._isChildElement=function(e){return e.closest("."+a.fileExplorer).length>0},n.prototype._handleEnterKeyDown=function(){var e=this,t;return e._contextMenu.is(":visible")?(e._contextMenu.find("a."+e._focusCss).click(),!0):(t=e.element.find("li."+e._focusCss),t.parents("."+a.toolbar).length||t.parents("div.wijmo-wijpager").length>0?(t.find("a").click(),!0):!1)},n.prototype._getCurrentFocusedItem=function(){var e=this,t=e.element.find("li."+e._focusCss).first();return!t.length||!t.parentsUntil("."+a.toolbar).length&&!t.parentsUntil(".wijmo-wijpager").length?null:t},n.prototype._getNextFocusableItem=function(e){var t=this,n=t._getCurrentFocusedItem();return n&&n.length?n[e?"next":"prev"]():null},n.prototype._moveFocus=function(e){var t=this,n=t._getNextFocusableItem(e);return n&&n.length?(t._setFocus(n,n,n.parent()),!0):!1},n.prototype._initMembers=function(){var e=this,t=e.options.wijCSS;e._focusCss=t.stateFocus,e._activeCss=t.stateActive},n.prototype._optionsUpdated=function(){var e=this;e._layoutOptionsUpdated(),e._enableOpenFileUpdated(),e._enableCreateNewFolderUpdated(),e._enableCopyUpdated(),e._allowMultipleSelectionUpdated(),e._disabledUpdated(),e._createRootNodes(),e._executeWithHostUri(),e._loadCurrentFolder()},n.prototype._loadCurrentFolder=function(){var e=this,t=e._showingControls[v.detailView]||e._showingControls[v.thumbnailView];if(t&&!e._data()){e._openFolder(e._createCurrentStateRequest(),function(){return e._expand(e._getNodeByPath(e.options.currentFolder))});return}e._currentFolderUpdated(),e._expand(e._getNodeByPath(e.options.currentFolder))},n.prototype._createRootNodes=function(){var e=this,t=e._getTreeInitData();e._updateTreeViewData(null,t)},n.prototype._getTreeInitData=function(){var e=this;return e._enableAjax()?r.map(e._getRootPaths(),function(e){return{path:e,isFolder:!0,hasSubFolders:!0,hasChildren:!0}}):e._data()},n.prototype._selectCurrentFolderTreeNode=function(){this._selectTreeNode(this.options.currentFolder)},n.prototype._selectTreeNode=function(e){var t=this,n=t._getNodeByPath(e);if(!n)return;t._setSelection({path:n.options.value,isFolder:F(n.element),hasChildren:n.options.hasChildren,operatingArea:0}),n.options.selected||n.select(!0)},n.prototype.destroy=function(){var e=this,n=e.options.wijCSS,i=e._getGlobalEventNameSpaceSuffix();e._filterTimer&&(clearTimeout(e._filterTimer),e._filterTimer=null),e._showLoadingLayerTimer&&(clearTimeout(e._showLoadingLayerTimer),e._showLoadingLayerTimer=null),e._contextMenu&&e._contextMenu.data("wijmo-wijmenu")&&e._contextMenu.wijmenu("destroy"),e._dialog&&e._dialog.data("wijmo-wijdialog")&&e._dialog.wijdialog("destroy"),e._treeView&&e._treeView.data("wijmo-wijtree")&&e._treeView.wijtree("destroy"),e._pager&&e._pager.data("wijmo-wijpager")&&e._pager.wijpager("destroy"),e._detailView&&e._detailView.data("wijmo-wijgrid")&&e._detailView.wijgrid("destroy"),e._thumbnailView&&e._thumbnailView.data("wijmo-wijtilelist")&&e._thumbnailView.wijtilelist("destroy"),e._splitter&&e._splitter.data("wijmo-wijsplitter")&&e._splitter.wijsplitter("destroy"),r(document).off(i),r(window).off(i),e.element.removeClass(n.widget+" "+a.fileExplorer+" "+n.helperReset).attr("tabindex","").off(s).empty().removeUniqueId(),t.prototype.destroy.call(this)},n.prototype._initCommands=function(){var e=this;e._commands={open:new J("open",function(){return e._open()},e.localizeString("commandOpen","Open")),"delete":new J("delete",function(){return e._delete()},e.localizeString("commandDelete","Delete")),refresh:new J("refresh",function(){return e.refresh()},e.localizeString("commandRefresh","Refresh")),rename:new J("rename",function(){return e._rename()},e.localizeString("commandRename","Rename")),newFolder:new J("newFolder",function(){return e._newFolder()},e.localizeString("commandNewFolder","New Folder")),copy:new J("copy",function(){return e._copy()},e.localizeString("commandCopy","Copy")),paste:new J("paste",function(){return e._paste()},e.localizeString("commandPaste","Paste")),back:new J("back",function(){return e._back()},e.localizeString("commandBack","Back")),forward:new J("forward",function(){return e._forward()},e.localizeString("commandForward","Forward")),setDetailViewMode:new J("setDetailViewMode",function(){return e._setOption("viewMode",f.detail)},e.localizeString("commandSetDetailViewMode","Detail View Mode")),setThumbnailViewMode:new J("setThumbnailViewMode",function(){return e._setOption("viewMode",f.thumbnail)},e.localizeString("commandSetThumbnailViewMode","Thumbnail View Mode")),focusFileExplorer:new J("focusFileExplorer",function(){return e._focusFileExplorer()}),focusToolBar:new J("focusToolBar",function(){return e._focusToolBar()}),focusTreeView:new J("focusTreeView",function(){return e._focusTreeView()}),focusGrid:new J("focusGrid",function(){return e._focusGrid()}),focusPager:new J("focusPager",function(){return e._focusPager()}),focusAddressBar:new J("focusAddressBar",function(){return e._focusAddressBar()}),popupWindowClose:new J("popupWindowClose",function(){return e._popupWindowClose()}),contextMenu:new J("contextMenu",function(){return e._openContextMenu()})}},n.prototype._createInnerControls=function(){var e=this,t=e.options.wijCSS;e._showingControls={},e.element.addClass(t.widget+" "+a.fileExplorer+" "+t.helperReset).attr("tabindex","-1"),e._createToolbar(),e._createAddressBar(),e._createSplitter(),e._createDialog(),e._createContextMenu()},n.prototype._setDialogButtons=function(e){var t=this,n=null;e&&(n=[{text:t.localizeString("dialogOK","OK"),click:function(){t._dialogOk&&t._dialogOk(t._dialogInput.val()),r(this).wijdialog("close")}},{text:t.localizeString("dialogCancel","Cancel"),click:function(){r(this).wijdialog("close")}}]),t._dialog.wijdialog({buttons:n})},n.prototype._createDialog=function(){var e=this,t=e.element;e._dialog=r("<div>").css("overflow","hidden").appendTo(t),e._dialog.wijdialog({autoOpen:!1,modal:!0,resizable:!0,buttons:{Ok:function(){e._dialogOk&&e._dialogOk(e._dialogInput.val()),r(this).wijdialog("close")},Cancel:function(){r(this).wijdialog("close")}},captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}}}),e._dialogInput=r("<input>").css("width","100%").hide().appendTo(e._dialog),e._dialog.on("keydown"+s,function(t){t.keyCode===r.ui.keyCode.ENTER&&(e._dialogOk&&e._dialogOk(e._dialogInput.val()),e._dialog.wijdialog("close"),t.stopPropagation())}),e._dialogContent=r("<div>").css("width","100%").css("height","100%").css("overflow","hidden").appendTo(e._dialog)},n.prototype._createContextMenu=function(){var e=this,t=e.options,n=e.element,i=e._commands,u=r("<ul>").attr("tabindex","-1").appendTo(n),f=[i.open,i.newFolder,i.copy,i.paste,i["delete"],i.rename],l,c=e._getGlobalEventNameSpaceSuffix(),h;r.each(f,function(e,t){l=r("<li>").data(o,t).append(r("<a>").attr("href","#").text(t.text)).appendTo(u),t.addBindElement(l)}),u.wijmenu({orientation:"vertical",trigger:n,disabled:t.disabled,triggerEvent:"rtclick",animation:{easing:"easeOutCubic"},showing:function(t,n){if(!e._isActived()||e._isLoading()||!e._showingControls[v.contextMenu])return e._setContextItem(null),!1;e._contextMenu.wijmenu("deactivate");var r=t.which===3||!t.originalEvent?t:t.originalEvent.target;n.options.position={my:"left2 top2",at:"left center",of:r,collision:"fit"}},shown:function(){return e._focusContextMenu()},hidden:function(){e._setContextItem(null)},select:function(e,n){h=n.item.element.data(o),u.find("."+a.stateFocus).removeClass(t.wijCSS.stateFocus).removeClass(t.wijCSS.stateHover),h&&h.execute()}}).on("mousedown"+s,function(e){e.stopPropagation()}).on("keydown"+s,function(t){t.keyCode===r.ui.keyCode.ESCAPE&&e._hideContextItem()}),e._contextMenu=u,r(document).on("contextmenu"+c,function(t){e._hideContextItem()}).on("mousedown"+c,function(t){if(t.which===3)return;e._hideContextItem()}),e.element.on("contextmenu"+s,function(t){if(!e._isActived())return;var n=t.target,i=n&&e._getItemFromElement(n);e._setContextItem(null);if(!n||i==null)return;if(i.operatingArea===0||e._isSelected(i)){e._setContextItem(i);return}t.ctrlKey||(e._selectItemsViewItem(r(n)),e._setContextItem(i))})},n.prototype._focusContextMenu=function(){var e=this,t=e._contextMenu;if(!t||!t.length)return;t.focus()},n.prototype._hideContextItem=function(){var e=this;e._contextMenu&&(e._contextMenu.wijmenu("hideAllMenus"),e._setContextItem(null))},n.prototype._selectItemsViewItem=function(e){var t=this;if(t._showingControls[v.detailView]){t._selectDetailViewItem(e);return}t._showingControls[v.thumbnailView]&&t._selectThumbnailViewItem(e)},n.prototype._selectThumbnailViewItem=function(e){this._thumbnailView.wijtilelist("selectTile",e.closest("li"))},n.prototype._selectDetailViewItem=function(e){if(!e||e.length===0)return;var t=this,n=t._detailView,r=n.wijgrid("selection"),i=n.wijgrid("getCellInfo",e[0]);if(!r||!i)return;t._selectionUpdating=!0,r.clear(),t._selectionUpdating=!1,r.addRows(i.rowIndex())},n.prototype._showDialog=function(e,t,n,r,i,s){typeof s=="undefined"&&(s=!0);var o=this,u={title:e,resizable:n,width:r,height:i};s||o._setDialogButtons(!1),o._dialogContent.empty().append(t).show(),o._dialogInput.hide(),o._dialog.wijdialog(u).wijdialog("open"),o._dialogOk=null},n.prototype._showInputDialog=function(e,t,n){var r=this,i,s,o;r._setDialogButtons(!0),r._dialogContent.hide(),r._dialogInput.val(t).show(),r._dialog.wijdialog({title:e,resizable:!1,width:"300",height:"200"}).wijdialog("open"),i=r._dialogInput[0],s=i.value.length,s>0&&(i.setSelectionRange?i.setSelectionRange(0,s):i.createTextRange&&(o=i.createTextRange(),o.collapse(!0),o.moveStart("character",0),o.moveEnd("character",s),o.select())),r._dialogOk=n},n.prototype._showConfirmDialog=function(e,t,n){var r=this;r._setDialogButtons(!0),r._dialogContent.empty().append(t).show(),r._dialogInput.hide(),r._dialog.wijdialog({title:e,resizable:!1,width:"300",height:"200"}).wijdialog("open"),r._dialogOk=n},n.prototype._hideDialog=function(){this._dialog.wijdialog("close")},n.prototype._isVisibleControl=function(e){var t=this.options.visibleControls;return!t||t.indexOf(e)>-1},n.prototype._createToolbar=function(){var e=this,t=e.options,n=t.wijCSS,i=e._commands,u=[i.back,i.forward,i.open,i.refresh,i.newFolder,i["delete"],i.setDetailViewMode,i.setThumbnailViewMode],f=r("<div>").attr("tabindex","-1").addClass(n.helperReset).appendTo(e.element),l=r("<ul>").addClass(n.widget).addClass(n.helperReset).addClass(n.helperClearFix).addClass(n.stateDefault).addClass(a.toolbar).appendTo(f);e._toolbar=l,r.each(u,function(e,t){var i=r("<span>").addClass(n.icon),s=r("<a>").attr("herf","#").addClass(a.link).append(i),u=r("<li>").data(o,t).attr("title",t.text).addClass(a[W("toolbar-"+t.name)]).addClass(n.stateDefault).addClass(n.cornerAll).append(s).appendTo(l);t.addBindElement(u)}),l.on("click"+s,function(t){if(!e._isActived())return;var n=r(t.target).closest("li").data(o);n&&n.execute()}).on("mouseenter"+s,"li",function(){!t.disabled&&!r(this).hasClass(n.stateDisabled)&&r(this).addClass(n.stateHover)}).on("mouseleave"+s,"li",function(){r(this).removeClass(n.stateHover)}),e._showingControls[v.toolbar]=!0},n.prototype._createAddressBar=function(){var e=this,t=e.options.wijCSS,n=r("<div>").addClass(a.addressBar).addClass(t.helperClearFix).addClass(t.content).appendTo(e.element);e._createAddressBox(n),e._createFilterBox(n)},n.prototype._createAddressBox=function(e){var t=this,n=r("<div>").addClass(a.addressPanel).appendTo(e);t._addressBox=r("<div>").addClass(a.address).addClass(t.options.wijCSS.content).appendTo(n),t._showingControls[v.addressBox]=!0},n.prototype._createFilterBox=function(e){var t=this,n=t.options,i=r("<div>").addClass(a.filterPanel).appendTo(e),o=r("<input type='text'/>"),u=function(){t._filterTimer!=undefined&&(clearTimeout(t._filterTimer),t._filterTimer=null)},f="input"+s+" propertychange"+s+" keyup"+s,l=t._filterExpression()||x;t._filterBox=o.addClass(a.filter).addClass(n.wijCSS.content).appendTo(i).on("keydown"+s,function(e){e.stopPropagation(),e.keyCode===r.ui.keyCode.ENTER&&(n.enableFilteringOnEnterPressed&&t._filter(o.val()),e.preventDefault())}).on(f,function(e){if(n.enableFilteringOnEnterPressed)return;if(e.type==="propertychange"&&e.originalEvent.propertyName!=="value")return;u(),t._filterTimer=setTimeout(function(){t._filter(o.val()),u()},E)}).on("focus"+s,function(){t._restoreFocus=function(){o&&o.focus()}}),t._showingControls[v.filterBox]=!0,l!==o.val()&&o.val(l)},n.prototype._createSplitter=function(){var e=this,t=r("<div>"),n=r("<div>"),i=r("<div style='height:100%;'>"),s=function(){e._adjustDetailViewWidth(),e.options.treePanelWidth=i.wijsplitter("option","splitterDistance")};e._splitter=i.append(t).append(n).appendTo(e.element).wijsplitter({orientation:"vertical",sized:s,collapsed:s,expanded:s,fullSplit:!0}),e._createTreeView(t),e._createItemsView(n)},n.prototype._createTreeView=function(e){var t=this,n;t._treeView=r("<ul>").appendTo(e).wijtree({selectedNodeChanged:function(e,r){n=t._getItemFromElement(r.element);if(t._sameWithSelection(n))return;t.options.viewMode==="detail"&&t._detailView.wijgrid("selection").clear(),t._setSelection(n);if(t.options.mode===l["default"]){t._open();return}n.isFolder&&t._setCurrentFolder(n.path)}}),t._treeView.parent().addClass(a.fileTree),t._attachTreeViewEvents(),t._showingControls[v.treeView]=!0},n.prototype._attachTreeViewEvents=function(){var e=this,t=e.options,n=".wijmo-wijtree-parent";e._treeView.on("click"+s,n,function(t){if(!e._isActived())return;if(r(t.target).is("."+a.icon)){var n=r(this).data("wijmo-wijtreenode");n&&(!n.$nodes||!n.$nodes.length)&&(n.options.expanded||e._expandWithNewNodes(n.options.value))}}).on("dblclick"+s,n,function(n){if(!e._isActived())return;var i=r(this).data("wijmo-wijtreenode");if(r(n.target).parents(".wijmo-wijtree-item."+a.folderItem).length||!i)return;t.mode===l["default"]?i.options.expanded?i.collapse():e._expand(i):e._open(),n.stopPropagation()}).on("keydown"+s,function(n){if(t.disabled)return;if(n.keyCode===r.ui.keyCode.RIGHT){e._onTreeViewRightKeyDown();return}if(n.keyCode===r.ui.keyCode.ENTER){n.stopPropagation();return}if(n.keyCode===r.ui.keyCode.TAB&&!n.shiftKey){e._focusGrid(),n.preventDefault(),n.stopPropagation();return}return e._processShortcut(n)}),e._treeView.parents("."+a.fileTree).first().parent().on("mouseup"+s,function(){if(t.disabled)return;e._focusTreeView()})},n.prototype._initNodeHasChildren=function(e,t){e._setOption("hasChildren",t),!t&&e.options.expanded&&e.collapse()},n.prototype._setTreeViewNodes=function(e,t){var n=this,i=n.options,s=i.mode===l.fileTree,o=t.options.nodes.length;if(!e)return;n._initNodeHasChildren(t,!!e.length);while(o>0)t.remove(o-1),o--;r.each(e,function(e,i){if(!s&&!i.isFolder)return;var o={text:R(i.path),value:i.path,hasChildren:undefined,expandedIconClass:undefined,collapsedIconClass:undefined,itemIconClass:undefined,nodes:[]};i.isFolder?(o.hasChildren=(s?i.hasChildren:i.hasSubFolders)||!1,o.expandedIconClass=a.folderExpandedIcon,o.collapsedIconClass=a.folderCollapsedIcon):(o.hasChildren=!1,o.itemIconClass=a.documentIcon),t.add(o),t.element.find("li:last").addClass(i.isFolder?a.folderItem:a.fileItem);if(o.hasChildren){var u=t.getNodes(),f=r(u).filter(function(){return this.options.value==o.value});f.length>0&&n._setTreeViewNodes(i.children,f[0])}})},n.prototype._createItemsView=function(e){var t=this,n=r("<div>").addClass(a.itemsViewContainer).appendTo(e);t._itemsViewContainer=n,t._createDetailView(n),t._createThumbnailView(n),t._createEmptyFolderTip(n),t._createPager(e),t._attachItemsViewContainerEvents()},n.prototype._attachItemsViewContainerEvents=function(){var e=this,t=e.options;e._itemsViewContainer.on("click"+s,function(){if(t.disabled)return;e._focusGrid()}).on("keydown"+s,function(n){if(t.disabled)return;if(n.keyCode===r.ui.keyCode.TAB&&n.shiftKey){e._focusTreeView(),n.preventDefault(),n.stopPropagation();return}})},n.prototype._createEmptyFolderTip=function(e){var t=this,n=r("<div>").text(t.localizeString("emptyFolder","This folder is empty.")).addClass(a.emptyFolderTip).appendTo(e).hide();t._emptyFolderTip=n},n.prototype._createPager=function(e){var t=this,n=t.options.wijCSS,i=r("<div>").wijpager({mode:"numeric",pageIndexChanged:function(e,n){t._page(n.newPageIndex)}}).addClass(n.stateDefault).addClass(n.widget).addClass("wijmo-wijpager ui-helper-clearfix").appendTo(e);t._pager=i},n.prototype._adjustDetailViewWidth=function(){var e=this,t=e._detailView,n,r,i;if(!t||!t.length)return;e._cancelDetailViewSelectionChange=!e._getDetailViewSelectedCells().length(),r=e._getDetailViewMinWidth(),n=e._itemsViewContainer.scrollLeft(),i=t.parent(),i.css("width",""),r>i.width()&&i.width(t.outerWidth(!0)),e._detailView.wijgrid("doRefresh"),e._itemsViewContainer.scrollLeft(n),e._cancelDetailViewSelectionChange=!1},n.prototype._getDetailViewMinWidth=function(){var e=this,t=e._detailView.wijgrid("option","columns")[0].width||e._getNameColumnMinWidth();return t+e._getSizeColumnMinWidth()+e._getDetailViewOuterAreaWidth()},n.prototype._getDetailViewOuterAreaWidth=function(){var e=this;return e._detailViewOuterAreaWidth===undefined&&(e._detailViewOuterAreaWidth=X(e._detailView)),e._detailViewOuterAreaWidth},n.prototype._getSizeColumnMinWidth=function(){var e=this;return e._sizeColumnMinWidth===undefined&&(e._sizeColumnMinWidth=e._getColumnMinWidth(b,"."+a.sizeContent)),e._sizeColumnMinWidth},n.prototype._getNameColumnMinWidth=function(){var e=this;return e._nameColumnMinWidth===undefined&&(e._nameColumnMinWidth=e._getColumnMinWidth(y,"tbody>tr>td ."+a.contentItem)),e._nameColumnMinWidth},n.prototype._getColumnMinWidth=function(e,t){var n=this,i=n._detailView,s=i.find("th>."+a.gridInnerCell).eq(e),o=s.css("display"),u,f,l;return s.css("display","inline-block"),l=s.outerWidth(!0)+X(s.closest("th")),s.css("display",o),i.find(t).each(function(e,t){u=r(t),f===undefined&&(f=X(u.closest("td"))+X(u.closest("."+a.gridInnerCell))),l=Math.max(l,u.outerWidth(!0)+f)}),l},n.prototype._createDetailView=function(e){var t=this,n=t.options,i=n.wijCSS,s=function(e,n){var s=e.find(".wijmo-wijgrid-sort-icon");if(t._sortExpression()===n){if(!s||!s.length)s=r("<span>").addClass("wijmo-wijgrid-sort-icon  ui-icon").css("cursor","pointer").appendTo(e);t._sortDirection()===w.descending?(s.removeClass(i.iconArrowUp),s.addClass(i.iconArrowDown)):(s.removeClass(i.iconArrowDown),s.addClass(i.iconArrowUp))}else s.remove()},o=r("<table>").appendTo(e).wijgrid({rendered:function(){t._updatingDetailViewData&&(t._sizeColumnMinWidth=undefined,t._nameColumnMinWidth=undefined,t._detailViewOuterAreaWidth=undefined);var e=r(this).find("th .wijmo-wijgrid-innercell");s(e.eq(0),g.name),s(e.eq(1),g.size)},sorting:function(e,n){var r=n.column.dataKey===g.size?g.size:g.name,i=t._sortDirection()===w.descending?w.ascending:w.descending;return t._sort(r,i),!1},columnsAutogenerationMode:"none",allowSorting:!0,allowColSizing:!0,columnResized:function(){t._adjustDetailViewWidth()},columns:[{dataKey:"path",dataType:"string",headerText:t.localizeString("detailViewColumnNameTitle","Name"),cellFormatter:function(e){var t=e.row.data;if(t&&t.path&&e.row.type&r.wijmo.wijgrid.rowType.data){var i=n.wijCSS.icon,s=r("<span>"),o=r("<span>");return s.addClass(a.contentItem).text(R(t.path)),t.isFolder?(o.addClass(i+" "+a.folderCollapsedIcon),r(e.row.$rows).addClass(a.folderItem)):(o.addClass(i+" "+a.documentIcon),r(e.row.$rows).addClass(a.fileItem)),e.$container.empty().append(o).append(s).addClass(a.contentItemContainer),!0}}},{allowSizing:!1,dataKey:"size",dataType:"number",headerText:t.localizeString("detailViewColumnSizeTitle","Size"),cellFormatter:function(e){if(e.row.type&r.wijmo.wijgrid.rowType.data){var n=e.row.data.size,i="",s=e.$container;s.empty();if(n!=null){var o=n/1e3;i=Globalize.format(o,"n")+" "+t.localizeString("detailViewColumnSizeUnit","KB"),s.append(r("<span>").addClass(a.contentItemContainer).addClass(a.sizeContent).text(i))}return!0}}}]});t._detailView=o,t._attachDetailViewEvent(),t._showingControls[v.detailView]=!0},n.prototype._attachDetailViewEvent=function(){var e=this,t="."+a.gridRow,n="wijgrid";e._detailView.on(n+"currentcellchanging",function(){return!e._cancelDetailViewSelectionChange&&!e._updatingDetailViewData}),e.element.on("dblclick"+s,t,function(){e._open()}).on(n+"selectionchanged"+s,function(){e._onDetailViewSelectionChanged(),e._setItemsViewDrag(e._detailView)}),r(window).on("resize"+e._getGlobalEventNameSpaceSuffix(),function(){e._adjustDetailViewWidth()})},n.prototype._createThumbnailView=function(e){var t=this,n=t.options,i=n.wijCSS;t._thumbnailView=r("<div>").addClass(a.thumbnailView).appendTo(e).wijtilelist({allowMultipleSelection:n.allowMultipleSelection,tileCreating:function(e,t){var s=t.tile,o=t.element;s.text=R(s.path),s.hint=s.text,s.isFolder?(s.iconFormat=function(){return r("<span>").attr("alt",s.text).addClass(i.icon).addClass(a.folderCollapsedIcon)},o.addClass(a.folderItem)):(s.path=q(n.hostUri,s.path),o.addClass(a.fileItem))},selectionChanged:function(e,n){var i=[];r.each(n&&n.newSelection,function(e,t){i.push({path:t.tile.path,isFolder:t.tile.isFolder,operatingArea:1})}),t._setSelection(i),t._setItemsViewDrag(t._thumbnailView)}}).hide(),t._attachThumbnailViewEvent(),t._showingControls[v.thumbnailView]=!1},n.prototype._attachThumbnailViewEvent=function(){var e=this;e.element.on("dblclick"+s,"."+a.tileItem,function(){e._open()})},n.prototype._back=function(){this._moveHistory(-1)},n.prototype._moveHistory=function(e){var t=this;if(!t._isActived()||!e||!t._canBack()&&e<0||!t._canForward()&&e>0)return;t._updatingHistoryStep=e,t._openFolder(t._histories[t._currentHistoryIndex+e])},n.prototype._forward=function(){this._moveHistory(1)},n.prototype._expand=function(e,t){var n=this;if(!e){t&&t();return}e.$nodes&&e.$nodes.length?(n._expandWithExistedNodes(e),t&&t()):n._expandWithNewNodes(e.options.value,t)},n.prototype._open=function(e){var t=this;if(!t._isActived())return;var n=t._getOperatingItem();if(n.isFolder){if(n.path===t.options.currentFolder){t._expand(t._getNodeByPath(n.path));return}t._openFolder(n.path,function(){t._updateHistory(),e&&e()});return}t._openFile(n.path)},n.prototype._openFile=function(e){var t=this,n=R(e),i,s;if(t.options.enableOpenFile){if(t._triggerFileOpening({path:e})===!1)return;t._executeWithHostUri(function(){i=q(t.options.hostUri,e),s=r("<iframe src='"+i+"' style='border:none; width:100%; height:100%' frameborder='no'></iframe>"),t._showDialog(t.localizeString("openFileDialogTitle","View file: ")+n,s,!0,"480","480",!1),t._triggerFileOpened({path:e})})}},n.prototype._executeWithHostUri=function(e){var t=this;if(t.options.hostUri!=null){e&&e();return}t._getHostUriCall(e)},n.prototype._getHostUriCall=function(e){var t=this;t._tryAjax(m.getHostUri,null,null,function(n){t._setOption("hostUri",n.hostUri||""),e&&e()})},n.prototype._sortDirection=function(e){if(e===undefined)return this._sortDirectionValue||T;this._sortDirectionValue=e},n.prototype._sortExpression=function(e){if(e===undefined)return this._sortExpressionValue||k;this._sortExpressionValue=e},n.prototype._filterExpression=function(e){if(e===undefined)return this._filterExpressionValue||x;this._filterExpressionValue=e},n.prototype._pageCount=function(e){if(e===undefined)return this._pageCountValue||C;this._pageCountValue=e},n.prototype._pageIndex=function(e){if(e===undefined)return this._pageIndexValue||N;this._pageIndexValue=e},n.prototype._data=function(e){var t=this;if(e===undefined)return t._dataValue;t._dataValue=e,t._enableAjax()||(t._resolveData(),t._sortData())},n.prototype._removeDefaultInRequest=function(e){var t=r.extend({},e);return(!t.filterExpression||t.filterExpression===x)&&delete t.filterExpression,(!t.sortExpression||t.sortExpression===k)&&delete t.sortExpression,!t.sortDirection&&t.sortDirection===T&&delete t.sortDirection,!t.pageIndex&&t.pageIndex===N&&delete t.pageIndex,t},n.prototype._createDefaultRequest=function(e){var t=this,n=t.options,r={path:e||t.options.currentFolder,filterExpression:x,sortExpression:k,sortDirection:T};return n.allowPaging&&(r.pageIndex=N,r.pageSize=n.pageSize),r},n.prototype._createCurrentStateRequest=function(e){var t=this,n=t.options,r={path:e||t.options.currentFolder,filterExpression:t._filterExpression(),sortExpression:t._sortExpression(),sortDirection:t._sortDirection()};return n.allowPaging&&(r.pageIndex=t._pageIndex(),r.pageSize=n.pageSize),r},n.prototype._applyRequestData=function(e,t){var n=this,r=n.options;e.filterExpression!=null&&n._filterExpression(e.filterExpression),r.allowPaging&&(t&&t.pageIndex?n._pageIndex(t.pageIndex):n._pageIndex(N),t&&t.pageCount?n._pageCount(t.pageCount):n._pageCount(C)),e.sortExpression!=null&&n._sortExpression(e.sortExpression),e.sortDirection!=null&&n._sortDirection(e.sortDirection)},n.prototype._updateItemsViewCall=function(e,t){var n=this,i=r.extend(n._createCurrentStateRequest(),e);n._getItemsCall(i,function(e){n._data(e.itemOperationResults),n._applyRequestData(i,e),n._updateItemsView(),n._triggerFolderLoaded({currentFolder:n.options.currentFolder}),n._selectCurrentFolderTreeNode(),t&&t()})},n.prototype._openFolder=function(e,t,n){typeof e=="string"&&(e={path:e});var i=this,s=r.extend({},i._createDefaultRequest(),e);i._getItemsCall(s,function(e){i._data(e.itemOperationResults),i._applyRequestData(s,e),i._setCurrentFolder(s.path),t&&t()},n)},n.prototype._isDefaultSearchPattern=function(){return O(this.options.searchPatterns,this._getDefaultSearchPattern())},n.prototype._getDefaultSearchPattern=function(){return L},n.prototype._getItemsCall=function(e,t,n){var i=this,s=i.options;e=r.isPlainObject(e)?e:{path:e};if(e.path==null)return;!e.onlyFolder&&s.searchPatterns!=null&&!i._isDefaultSearchPattern()&&(e.searchPatterns=s.searchPatterns),e=i._removeDefaultInRequest(e),i._tryAjax(m.getItems,e,null,function(e){t&&t(e)},function(){return n&&n(),!1},function(){t&&t({itemsOperationResults:i._data()})})},n.prototype.refresh=function(e){var t=this;if(e&&e!==t.options.currentFolder){t._getNodeByPath(e)&&t._refreshTreeNode(e);return}t._openFolder(t._createCurrentStateRequest()),t._refreshTreeNode(t.options.currentFolder,function(){return t._selectCurrentFolderTreeNode()})},n.prototype._newFolder=function(){var e=this,t=e._getOperatingItem(),n=t&&t.operatingArea===0?t.path:e.options.currentFolder;e.options.enableCreateNewFolder&&e._showInputDialog(e.localizeString("newFolderDialogTitle","Enter new folder name"),e.localizeString("defaultNewFolderName","New Folder"),function(t){t&&e._newFolderCall(t,n)})},n.prototype._newFolderCall=function(e,t){var n=this,r=_(t)+e;if(n._triggerNewFolderCreating({path:r})===!1)return;n._tryAjax(m.newFolder,{path:r},null,function(){n._triggerNewFolderCreated({path:r}),n._refreshAfterAdd(t)},null,function(){n._addItemsInData({path:r,isFolder:!0,hasChildren:!1,hasSubFolder:!1,children:[]},n._getFolderData(t)),n.refresh(t)})},n.prototype._refreshTreeNode=function(e,t){var n=this;n._getItemsCall({path:e,onlyFolder:n.options.mode===l["default"]},function(r){n._updateTreeViewData(e,r.itemOperationResults),t&&t()})},n.prototype._delete=function(){var e=this;if(!e._isActived())return;var t=H(e._getOperatingItems());if(e._hasRootPath(t))return;t&&t.length&&e._showConfirmDialog(e.localizeString("deleteDialogTitle","Warning"),e.localizeString("deleteDialogAlertingText","Are you sure to delete the selected item? This operation cannot be undone."),function(){e._deleteCall(t)})},n.prototype._deleteCall=function(e){if(!e||!e.length)return;var t=this,n=[];r.each(e,function(e,r){if(t._triggerItemDeleting({path:r.path})===!1)return;n.push(r.path)}),t._tryAjax(m["delete"],{sourcePaths:n},null,function(n){if(!n.itemOperationResults||!n.itemOperationResults.length)return;var i=[];r.each(n.itemOperationResults,function(n,r){if(!r)return;if(r.success){i.push(M(e,r.path)),t._triggerItemDeleted({path:r.path});return}t._processError(r.error)}),t._refreshAfterDelete(i)},function(){t._refreshAfterDelete(e)},function(){t._removeItemsInData(e),t.refresh()})},n.prototype._rename=function(){var e=this,t=e._getOperatingItem(),n=e.options.allowFileExtensionRename;if(t){if(e._isRootPath(t.path))return;var r=R(t.path,!n&&!t.isFolder),i=n||t.isFolder?"":"."+U(t.path);e._showInputDialog(e.localizeString("renameDialogTitle","Enter new name"),r,function(n){if(n&&n!==r){if(e._triggerItemRenaming({path:t.path,newName:n})===!1)return;e._renameCall(t,n+i)}})}},n.prototype._renameCall=function(e,t){var n=this,i=z(e.path),s=_(i)+t;n._tryAjax(m.rename,{path:s,sourcePaths:[e.path]},null,function(){n._refreshAfterRename(e.path,_(i)+t),n._triggerItemRenamed({path:e.path,newName:R(t,!n.options.allowFileExtensionRename)})},null,function(){n._removeItemsInData(e,!0),n._addItemsInData(r.extend({},e,{path:s}),null,!0),n._data(n._data()),n.refresh()})},n.prototype._refreshAfterRename=function(e,t){var n=this,r=z(e);r===n.options.currentFolder?n.refresh():(n._refreshTreeNode(r),e===n.options.currentFolder&&n._openFolder(t))},n.prototype._copy=function(){var e=this;if(!e._isActived()||!e.options.enableCopy)return;var t=e._getOperatingItems(),n=[];r.each(t,function(t,r){if(e._triggerItemCopying({path:r.path})===!1)return;n.push(r)}),e._copiedItems=n,e._commands.paste.disabled(!1),r.each(n,function(t,n){e._triggerItemCopied({path:n.path})})},n.prototype._paste=function(e,t){var n=this,i=n._getOperatingItem(),s=[];t=t||(i.isFolder?i.path:z(i.path)),e=e||n._copiedItems;if(!t)return;r.each(e,function(e,r){if(n._triggerItemPasting({sourcePath:r.path,targetFolder:t})===!1)return;s.push(r)});if(!s.length)return;n._pasteCall(s,t)},n.prototype._expandWithNewNodes=function(e,t){var n=this;if(!e)return;n._refreshTreeNode(e,function(){n._expandWithExistedNodes(n._getNodeByPath(e)),t&&t()})},n.prototype._filter=function(e){var t=this;if(!t._isActived()||e===t._filterExpression())return;if(t._triggerFiltering({path:t.options.currentFolder,filterExpression:e})===!1)return;t._updateItemsViewCall({filterExpression:e},function(){t._triggerFiltered({path:t.options.currentFolder,filterExpression:e})})},n.prototype._sort=function(e,t){var n=this;if(!n._isActived())return;n._updateItemsViewCall({sortExpression:e,sortDirection:t})},n.prototype._page=function(e){var t=this;if(!t._isActived()||!t.options.allowPaging)return;t._updateItemsViewCall({pageIndex:e})},n.prototype._getDetailViewSelectedCells=function(){return this._detailView.wijgrid("selection").selectedCells()},n.prototype._onDetailViewSelectionChanged=function(){if(!this._isActived())return;var e=this,t=e._getDetailViewSelectedCells(),n=t.length(),i=[],s,o;for(s=0;s<n;s++)o=t.item(s),o.cellIndex()===0&&i.push({path:o.value(),isFolder:F(r(o.tableCell()).parent()),operatingArea:1});e._setSelection(i)},n.prototype._getExtendedKeyCode=function(){var e=this;return e._extendedKeyCode||(e._extendedKeyCode=r.extend({BACK:8,ESC:27,PAGEUP:33,PAGEDOWN:34,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},r.ui.keyCode)),e._extendedKeyCode},n.prototype._getInnerShortcuts=function(){var e=this;return e._innerShortcuts||(e._innerShortcuts={},r.each(e.options.shortcuts||{},function(t,n){e._innerShortcuts[t]=n.split("+")})),e._innerShortcuts},n.prototype._matchShortcuts=function(e){var t=this,n=t._getInnerShortcuts(),i,s,o,u,a=t._getExtendedKeyCode(),f=String.fromCharCode(e.keyCode);return r.each(n,function(t,n){s=(n.length&&n[0]).toLowerCase()+"Key",o=n.length&&(n.length===1?n[0]:n[1]).toUpperCase(),u=e[s];if(e.keyCode===a[o])return n.length===1||u?(i=t,!1):!0;if(f&&f===o)return n.length===1||u?(i=t,!1):!0}),i||!1},n.prototype._processShortcut=function(e){var t=this,n=t.options,i,s;if(n.disabled)return;i=t._matchShortcuts(e);if(!i)return;if(t._dialog.is(":visible")){if(i!=="popupWindowClose")return}else if(!t._isChildElement(r(e.target))&&i!=="focusFileExplorer")return;s=t._commands[i],s&&(s.execute(),e.stopPropagation(),e.preventDefault())},n.prototype._setFocus=function(e,t,n){var r=this,i=r._focusCss,s=t,o=n||r.element.parent();if(!e||!e.length)return;if(!s||!s.length)s=e;s&&s.focus(),o.find("."+i).removeClass(i),e.addClass(i)},n.prototype._focusFileExplorer=function(){var e=this;e._setFocus(e.element),e._restoreFocus=r.proxy(e._focusFileExplorer,e)},n.prototype._focusToolBar=function(){var e=this,t=e.element.find("."+a.toolbar),n=t.find("li").first();n.length&&(e._setFocus(t.parent()),n.addClass(e._focusCss))},n.prototype._focusTreeView=function(){var e=this,t=e._treeView,n;if(t&&t.length){if(t.find(":focus").length)return;n=t.find("span."+e._activeCss).first(),n&&n.length?n=n.find("a."+a.tvLink).first():n=t.find("li a."+a.tvLink).first(),e._setFocus(t.parent().parent(),n)}e._restoreFocus=r.proxy(e._focusTreeView,e)},n.prototype._focusGrid=function(){var e=this,t=e._detailView,n=e._thumbnailView,i=e._showingControls[v.detailView],s=e._showingControls[v.thumbnailView],o,u,f=e._itemsViewContainer.parent();if(f.hasClass(e._focusCss))return;i?t&&t.length&&(o=t.find("tbody tr td"),u=o.filter("."+a.stateHighlight).first(),e._setFocus(f),u.length===0?o.first().click():t.parent().focus()):s&&n&&n.length&&(e._setFocus(f),n.wijtilelist("setFocus")),e._restoreFocus=r.proxy(e._focusGrid,e)},n.prototype._focusAddressBar=function(){var e=this,t=e.element.find("."+a.addressBar);t&&t.length&&e._setFocus(t,t.find("input").first())},n.prototype._popupWindowClose=function(){var e=this;if(!e._dialog||!e._dialog.is(":visible"))return;e._hideDialog(),e._restoreFocus&&e._restoreFocus()},n.prototype._openContextMenu=function(){var e=this,t=e._getOperatingItem(),n=t&&e._getElementByPath(t.path,t.operatingArea);if(!n||!n.length)n=e.element;n.trigger("contextmenu")},n.prototype._focusPager=function(){var e=this,t=e.options,n=e._pager,r;if(!n||!n.length)return;r=n.find("a").first(),r&&r.length&&(e._setFocus(n),n.find("li."+a.stateActive).addClass(e._focusCss).off(s).on("keydown"+s,function(n){if(t.disabled)return;return e._processShortcut(n)}))},n.prototype._getElementByPath=function(e,t){var n=this,r;return t===0?(r=n._getNodeByPath(e),r&&r.element?r.element:null):n._getViewItemByPath(e,n._showingControls[v.detailView])},n.prototype._getViewItemByPath=function(e,t){var n=this;return t?n._getDetailViewItemByPath(e):n._getThumbnailViewItemByPath(e)},n.prototype._getDetailViewItemByPath=function(e){var t=this,n=t._detailView.find("tr"),i=n.first();return n.each(function(t,n){var s=r(n).find("td.wijgridtd"),o=!1;s.each(function(t,n){var i=r(n);if(i.text()===R(e))return o=!0,!1});if(o)return i=r(n),!1}),i},n.prototype._getThumbnailViewItemByPath=function(e){var t=this,n=t._thumbnailView.find("li"),i=n.first();return n.each(function(t,n){var s=r(n).find("span."+a.tileContent);if(s.text()===R(e))return i=r(n),!1}),i},n.prototype._onTreeViewRightKeyDown=function(){var e=this,t,n,r=e._treeView;if(r){n=r.find(":focus");if(!n||!n.length)n=r.find("."+e._focusCss);t=n.parents("li").first().data("wijmo-wijtreenode"),t&&!t.options.expanded&&(!t.$nodes||!t.$nodes.length)&&e._expandWithNewNodes(t.options.value)}},n.prototype._onTreeNodeClick=function(e,t){var n=this,r=n.options;if(!n._isActived())return;t._isClick=!1,t.options.selected||t._selectNode(!0),n._setSelection({path:t.options.value,isFolder:F(t.element),operatingArea:0},e.ctrlKey),r.mode===l["default"]&&n._openFolder(t.options.value)},n.prototype._isActived=function(){var e=this,t=e.options,n=e._getRootPaths();return!!(!t.disabled&&t.currentFolder&&n&&n.length)},n.prototype._setDragDrop=function(){var e=this;e._setTreeViewDragDrop(),e._setItemsViewDragDrop()},n.prototype._setTreeViewDragDrop=function(){var e=this,t=e._treeView.find("div.wijmo-wijtree-node");e._setDraggable(t),e._setDroppable(t)},n.prototype._setItemsViewDragDrop=function(){var e=this,t;e._showingControls[v.detailView]?t=e._detailView:e._showingControls[v.thumbnailView]&&(t=e._thumbnailView);if(t==null)return;e._setItemsViewDrag(t),e._setDroppable(t.find("."+a.folderItem))},n.prototype._setItemsViewDrag=function(e){var t=this,n=t.options,i=n.wijCSS,s=e.find("."+a.fileItem+",."+a.folderItem),o=s.hasClass("wijmo-wijgrid-row"),u,f;if(!s&&!s.length)return;t._setDraggable(s);if(!o)return;t._setDraggable(s.find("td[headers='Name']").find(".wijmo-wijgrid-innercell").children());if(n.disabled)return;s.each(function(e,t){u=r(t),f=o?u.find("td").hasClass(i.stateHighlight):u.hasClass(i.stateActive),u.draggable("option","disabled",!f)})},n.prototype._setDraggable=function(e){var t=this,n;e.each(function(e,i){n=r(i),n.data("ui-draggable")||n.draggable(t._createDragOptions())}),e.draggable("option","disabled",t.options.disabled)},n.prototype._setDroppable=function(e){var t=this,n;e.each(function(e,i){n=r(i),n.data("ui-droppable")||n.droppable({drop:function(e,n){t._onDrop(e,n,this)}})}),e.droppable("option","disabled",t.options.disabled)},n.prototype._createDragOptions=function(){var e=this;return{revert:"invalid",helper:function(t){var n=e._getItemFromElement(this),i=[],s=r("<ul>").addClass(e.options.wijCSS.helperReset),o=20,f,l,c=r(this);return n.operatingArea!==0?(e._isSelected(n)||(c.hasClass(a.tileItem)?e._thumbnailView.wijtilelist("selectTile",c,t.ctrlKey):(l=jQuery.Event("click"),l.ctrlKey=t.ctrlKey,l.shiftKey=t.shiftKey,l.target=t.target,f=e._detailView.data("wijmo-wijgrid"),f._onClick(l))),r.each(e._selection,function(e,t){i.push(t)})):i.push(n),r.each(i,function(e,t){var n=r("<span>").addClass("ui-icon").addClass(t.isFolder?a.folderCollapsedIcon:a.documentIcon),f=r("<span>").addClass(a.contentItem).addClass(a.dragContent).text(R(t.path)),l=r("<li>").append(n).append(f).height(o);s.append(l),s.data(u,i)}),c.draggable("option","cursorAt",{top:o*i.length/2,left:0}),s}}},n.prototype._onDrop=function(e,t,n){var r=this,i=t.helper.data(u),s=r._getItemFromElement(n).path,o,a=0,f;if(!i||!i.length)return;f=i.length,t.helper.data(u,null);for(;a<f;a++)if(i[a].path===s)return;o=H(i),e.ctrlKey?r._paste(o,s):r._hasRootPath(o)||r._move(o,s)},n.prototype._pasteCall=function(e,t){var n=this,i=r.map(e,function(e){return e.path});n._tryAjax(m.paste,{sourcePaths:i,path:t},null,function(e){if(!e.itemOperationResults||!e.itemOperationResults.length)return;r.each(e.itemOperationResults,function(e,r){if(!r)return;if(r.success){n._triggerItemPasted({path:r.path,targetFolder:t});return}n._processError(r.error)}),n._refreshAfterAdd(t)},function(){n._refreshAfterAdd(t)},function(){var i=r.map(e,function(e){return r.extend({},e,{path:_(t)+R(e.path)})});n._addItemsInData(i),n._refreshAfterAdd(t)})},n.prototype._move=function(e,t){var n=this,i=[];if(!e||!t)return;r.each(e,function(e,r){if(n._triggerItemMoving({sourcePath:r.path,targetFolder:t})===!1)return!1;i.push(r)});if(!i.length)return;var s=r.map(i,function(e){return e.path});n._tryAjax(m.move,{sourcePaths:s,path:t},null,function(e){if(!e.itemOperationResults||!e.itemOperationResults.length)return;var s=[];r.each(e.itemOperationResults,function(e,r){if(!r)return;if(r.success){n._triggerItemMoved({sourcePath:r.path,targetFolder:t}),s.push(M(i,r.path));return}n._processError(r.error)}),n._refreshAfterMove(s,t)},function(){n._refreshAfterMove(e,t)},function(){var i=r.map(e,function(e){return r.extend({},e,{path:_(t)+R(e.path)})});n._removeItemsInData(e,!0),n._addItemsInData(i),n._refreshAfterMove(e,t)})},n.prototype._refreshAfterAdd=function(e){this.refresh(e)},n.prototype._refreshAfterMove=function(e,t){this._refreshAfterDelete(e),this.refresh(t)},n.prototype._refreshAfterDelete=function(e){var t=this,n={},i=t.options.currentFolder,s,o=z(i);r.each(e,function(e,t){var r=t.path,u=z(t.path);n[r]=u,!s&&u===i&&(s=i),t.isFolder&&(!s&&(B(t.path,i)||t.path===i)?s=o:s&&B(t.path,s)&&(s=u))}),r.each(n,function(e,n){t._deleteTreeNode(e,n)}),s===i?t.refresh():s&&t._openFolder(s)},n.prototype._deleteTreeNode=function(e,t){var n=this,r=n._getNodeByPath(e),i=n._getNodeByPath(t),s;i&&r&&(s=!!(i.options.nodes.length-1),n._initNodeHasChildren(i,s),i.remove(r.element))},n.prototype._getCurrentFolderItem=function(){var e=this,t=e._data()||[],n=0,r=t.length,i=r>0,s=!1;for(;n<r;n++)if(t[n].isFolder){s=!0;break}return{path:e.options.currentFolder,isFolder:!0,hasChildren:i,hasSubFolders:s}},n.prototype._operatingItemsChanged=function(){this._updateCommandsForOperatingItems()},n.prototype._setOperatingItems=function(e){var t=this;r.isArray(e)||(e=[e]),t._operatingItems=e,t._operatingItemsChanged()},n.prototype._setContextItem=function(e){var t=this;t._contextItem=e,t._setOperatingItems(e||t._selection)},n.prototype._isSelected=function(e){var t=this._selection,n=!1;return t&&r.each(t,function(t,r){if(r.path===e.path&&r.operatingArea===e.operatingArea)return n=!0,!1}),n},n.prototype._sameWithSelection=function(e){var t=this._selection||[],n=!1,i;return e||(e=[]),r.isPlainObject(e)&&(e=[e]),e.length===t.length&&(n=!0,r.each(t,function(t,r){i=e[t];if(r.path!==i.path||r.operatingArea!==i.operatingArea)return n=!1,!1})),n},n.prototype._setSelection=function(e,t){var n=this;if(n._selectionUpdating)return;n._selection=n._selection||[],t||(n._selection.length=0),r.isArray(e)||(e=[e]);if(!e)return;r.each(e,function(e,t){t!=null&&n._selection.push(t)}),n._setOperatingItems(n._contextItem||n._selection),n._triggerItemSelected({path:n._selection&&n._selection.length?n._selection[0].path:null})},n.prototype._getOperatingItems=function(){var e=this,t=e._contextItem,n,i=e._selection;return t?(n=[t],t.operatingArea===1&&i&&r.each(i,function(e,r){r.operatingArea===1&&r.path!==t.path&&n.push(r)}),n):i&&i.length?i:[e._getCurrentFolderItem()]},n.prototype._getOperatingItem=function(){return this._getOperatingItems()[0]},n.prototype._getFocusedItemElement=function(){var e=this,t=e._getOperatingItem(),n;if(!t||!t.path)return null;e._currentFocusArea==="detailGrid"?n=e._detailView.find("td.wijgridtd"):e._currentFocusArea==="tileList"?n=e._thumbnailView.find("li.wijmo-wijtilelist-item"):e._currentFocusArea==="treeView"&&(n=e._treeView.find("li"));if(!n||!n.length)return;for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s&&s.text()===t.path)return s}},n.prototype._getItemFromElement=function(e){var t=this,n=t.options,r=t._getFileItem(e),i,s,o=P(n.currentFolder);if(!r||r.length===0)return;return r.is(":wijmo-wijtreenode")?(i=r.wijtreenode("option","value"),s=0):(i=n.currentFolder+o+t._getItemText(r),s=1),{path:i,isFolder:F(r),operatingArea:s}},n.prototype._getFileItem=function(e){return r(e).closest("."+a.folderItem+",."+a.fileItem)},n.prototype._isTreeviewNode=function(e){return this._getFileItem(e).is(":wijmo-wijtreenode")},n.prototype._getItemText=function(e){var t=e.find("span."+a.contentItem).filter(function(e,t){return!r(t).hasClass(a.dragContent)});if(t.length>0)return t.text();t=e.find("span.wijmo-wijtilelist-content");if(t.length>0)return t.text()},n.prototype._findItemInData=function(e,t){if(!t)return-1;e=r.isPlainObject(e)?e.path:e;for(var n=0,i=t.length;n<i;n++)if(e===t[n].path)return n;return-1},n.prototype._addItemsInData=function(e,t,n){r.isArray(e)||(e=[e]);var i=this,s=t?r.isArray(t)?t:t.children:i._getFolderData(z(e[0].path));if(!s)return;r.each(e,function(e,t){s.push(t),n||i._data(i._data())})},n.prototype._removeItemsInData=function(e,t){var n=this;r.isArray(e)||(e=[e]),r.each(e,function(e,r){var i=n._getFolderData(z(r.path));if(i){var s=n._findItemInData(r,i);s>-1&&(i.splice(s,1),t||n._data(n._data()))}})},n.prototype._getCurrentFolderData=function(){var e=this;return e._enableAjax()?e._data():e._getFolderData(e.options.currentFolder)},n.prototype._getFolderData=function(e,t){var n=this,r;arguments.length==1&&(t=n._data()),t=t||[];if(!e)return t;for(var i=0,s=t.length;i<s;i++){var o=t[i],u=o.path;if(j(e,u)){r=t;break}if(!o.isFolder)continue;if(u===e){r=o.children;break}if(j(u,e)){r=n._getFolderData(e,o.children);break}}return r||[]},n.prototype._sortData=function(e,t,n){var i=this;t||(t=g.name),e=e||i._data(),e.sort(function(e,r){return i._sortComparer(e,r,t,n)}),r.each(e,function(e,t){t.children&&i._sortData(t.children)})},n.prototype._sortComparer=function(e,t,n,r){return this._sortComparerInner(e,t,n)*(r?-1:1)},n.prototype._sortComparerInner=function(e,t,n){if(e.isFolder!=t.isFolder)return e.isFolder?-1:1;var r=e[n],i=t[n];return r===i?0:r>i?1:-1},n.prototype._resolveData=function(e){var t=this;arguments.length===0&&(t._data()||t._data([]),e=t._data()),r.each(e,function(e,n){!n.hasChildren&&!n.children&&(n.children=[]);if(n.children||n.children.length>0){n.hasChildren=!0;var r=!1;for(var i=0,s=n.children.length;i<s;i++)if(n.isFolder){r=!0;break}n.hasSubFolders=r,t._resolveData(n.children)}else n.hasChildren=!1,n.hasSubFolders=!1})},n.prototype._setCurrentFolder=function(e){var t=this,n=t.options.currentFolder;t.options.currentFolder=e,t._currentFolderUpdated(),n!==e&&t._triggerFolderChanged({newFolder:e,oldFolder:n})},n.prototype._setOption=function(e,n){var r=this,i=r.options,s=!1,o=!1;if(e==="currentFolder")return;if(e==="mode")s=n!==i.mode;else if(e==="allowPaging"||e==="pageSize"&&i.allowPaging)o=n!==i[e];t.prototype._setOption.call(this,e,n),e==="disabled"?r._disabledUpdated():e==="viewMode"||e==="mode"||e==="visibleControls"||e==="allowPaging"||e==="treePanelWidth"?r._layoutOptionsUpdated(s):e==="enableOpenFile"?r._enableOpenFileUpdated():e==="enableCreateNewFolder"?r._enableCreateNewFolderUpdated():e==="enableCopy"?r._enableCopyUpdated():e==="allowMultipleSelection"?r._allowMultipleSelectionUpdated():e==="actionUri"?r._actionUriUpdated():e==="initPath"||e==="viewPaths"?r._rootPathsUpdated():e==="shortcuts"&&(r._innerShortcuts=null),o&&r.refresh()},n.prototype._actionUriUpdated=function(){this.options.hostUri=null},n.prototype._disabledUpdated=function(){var e=this,t=e.options.disabled;e._contextMenu.wijmenu("option","disabled",t),e._detailView.wijgrid("option","disabled",t),e._thumbnailView.wijtilelist("option","disabled",t),e._treeView.wijtree("option","disabled",t),e._pager.wijpager("option","disabled",t),e._splitter.wijsplitter("option","disabled",t),e._filterBox.prop("disabled",t),e._setDragDrop()},n.prototype._getRootPaths=function(){var e=this.options,t=e.initPath,n=e.viewPaths;return n&&n.length?n:t?[t]:[]},n.prototype._enableOpenFileUpdated=function(){var e=this;e._commands.open.disabled(!e.options.enableOpenFile)},n.prototype._enableCreateNewFolderUpdated=function(){var e=this;e._commands.newFolder.disabled(!e.options.enableCreateNewFolder)},n.prototype._allowMultipleSelectionUpdated=function(){var e=this;e._detailView.wijgrid("option","selectionMode",e.options.allowMultipleSelection?"multiRow":"singleRow"),e._thumbnailView.wijtilelist("option","allowMultipleSelection",e.options.allowMultipleSelection)},n.prototype._enableCopyUpdated=function(){var e=this;e.options.enableCopy||(e._copiedItems=null),e._commands.copy.disabled(!e.options.enableCopy),e._commands.paste.disabled(!e.options.enableCopy||e._copiedItems==null||e._copiedItems.length===0)},n.prototype._initDataOptions=function(){var e=this,t=e.options.data,n;delete e.options.data;if(t&&t.length){n=e._getRootPaths();if(!n||!n.length)e.options.viewPaths=r.map(t,function(e){return e.path})}e.options.currentFolder||(n=e._getRootPaths(),n&&n.length&&(e.options.currentFolder=n[0])),t&&e._data(t)},n.prototype._currentFolderUpdated=function(){var e=this,t=e.options.currentFolder;e._updateHistory(),e._addressBox.text(t).attr("title",t);if(e._showingControls[v.detailView]||e._showingControls[v.thumbnailView])e._updateItemsView(),e._triggerFolderLoaded({currentFolder:t});e._showCurrentFolderTreeNode()},n.prototype._updateItemsView=function(){var e=this,t=e._showingControls[v.detailView],n=e._showingControls[v.thumbnailView],r=e._getCurrentFolderData();e._itemsViewContainer.height(Math.max(0,e._pager.parent().height()-(e.options.allowPaging?e._pager.outerHeight():0)-parseInt(e._itemsViewContainer.css("borderTopWidth"))-parseInt(e._itemsViewContainer.css("borderBottomWidth")))),t?(e._updatingDetailViewData=!0,e._detailView.wijgrid("option","data",r).wijgrid("ensureControl",!0),e._updatingDetailViewData=!1,e._adjustDetailViewWidth()):n&&e._thumbnailView.wijtilelist("option","data",r),!r||!r.length?e._emptyFolderTip.show():e._emptyFolderTip.hide(),e.options.allowPaging&&e._pager.wijpager("option",{pageCount:e._pageCount(),pageIndex:e._pageIndex()}),e._setItemsViewDragDrop()},n.prototype._updateHistory=function(){var e=this;e._histories||(e._histories=[],e._currentHistoryIndex=-1);var t=e.options.currentFolder,n=e._histories,r=n.length;if(e._updatingHistoryStep){var i=e._currentHistoryIndex+e._updatingHistoryStep;e._updatingHistoryStep=0;if(i>=r||i<0)return;e._currentHistoryIndex=i}else{if(r&&t===n[r-1])return;e._currentHistoryIndex++,n.splice(e._currentHistoryIndex,r-e._currentHistoryIndex,t)}e._commands.back.disabled(!e._canBack()),e._commands.forward.disabled(!e._canForward())},n.prototype._canBack=function(){var e=this;return e._histories&&e._histories.length>1&&e._currentHistoryIndex>0},n.prototype._canForward=function(){var e=this;return e._histories&&e._histories.length>1&&e._currentHistoryIndex<e._histories.length-1},n.prototype._showCurrentFolderTreeNode=function(){var e=this;e._expand(e._getParentNodeByPath(e.options.currentFolder),function(){return e._selectCurrentFolderTreeNode()})},n.prototype._expandWithExistedNodes=function(e){while(e)e.options.expanded||e.expand(),e=this._getParentNodeByPath(e.options.value)},n.prototype._updateTreeViewData=function(e,t){var n=this,r=n._getNodeByPath(e)||n._treeView.data("wijmoWijtree");t=t||[],n._setTreeViewNodes(n._getFolderData(e,t),r),n._setTreeViewDragDrop()},n.prototype._getParentNodeByPath=function(e){return e?this._getNodeByPath(z(e)):null},n.prototype._getNodeByPath=function(e,t){var n=this;t||(t=n._treeView.wijtree("getNodes"));for(var r=0;r<t.length;r++){var i=t[r];if(i.options.value==e)return i;var s=i.getNodes();if(s.length>0){var o=n._getNodeByPath(e,s);if(null==o)continue;return o}}return null},n.prototype._updateCommandsForOperatingItems=function(){var e=this,t=e._getOperatingItems(),n=e._commands;n.rename.disabled(e._isRootPath(t[0].path)),n["delete"].disabled(e._hasRootPath(t))},n.prototype._layoutOptionsUpdated=function(e){var t=this,n=t.options,r=n.wijCSS,i=t.element.find("."+a.addressBar),s=t.element.find("."+a.splitterV),o=t.element.find("."+a.splitterVPanel1),u=t.element.find("."+a.splitterVPanel2),c=t.element.find("."+a.splitterVPanel1Content),h=t.element.find("."+a.splitterVPanel2Content),p=t._isVisibleControl(v.toolbar),d=t._isVisibleControl(v.addressBox),m=t._isVisibleControl(v.detailView)&&n.mode===l["default"]&&n.viewMode===f.detail,g=t._isVisibleControl(v.thumbnailView)&&n.mode===l["default"]&&n.viewMode===f.thumbnail,y=t._isVisibleControl(v.detailView)&&t._isVisibleControl(v.thumbnailView)&&n.mode===l["default"],b=t._isVisibleControl(v.treeView),w=t._isVisibleControl(v.contextMenu),E=t._isVisibleControl(v.filterBox)&&(m||g),S=t._toolbar.children("."+a.toolbarSetDetailViewMode),x=t._toolbar.children("."+a.toolbarSetThumbnailViewMode),T=t._showingControls,N=T[v.treeView]&&(T[v.detailView]||T[v.thumbnailView]),C=b&&(m||g),k;t._showingControls={},t._showingControls[v.contextMenu]=w,t._showingControls[v.toolbar]=p,p?t._toolbar.show():t._toolbar.hide(),t._showingControls[v.addressBox]=d,d?(t._addressBox.show(),t._addressBox.parent().show(),E?t._addressBox.parent().removeClass(a.addressBarFullWidth):t._addressBox.parent().addClass(a.addressBarFullWidth)):(t._addressBox.hide(),t._addressBox.parent().hide()),t._showingControls[v.filterBox]=E,E?(t._filterBox.show(),t._filterBox.parent().show(),d?t._filterBox.parent().removeClass(a.addressBarFullWidth):t._filterBox.parent().addClass(a.addressBarFullWidth)):(t._filterBox.hide(),t._filterBox.parent().hide()),d||E?i.show():i.hide(),k=t.element.height()-(t._toolbar.is(":visible")?t._toolbar.height():0)-(i.is(":visible")?i.height():0),c.height(k),h.height(k),N!==C&&(c.detach(),h.detach(),C?(c.appendTo(o),h.appendTo(u)):(c.appendTo(t.element),h.appendTo(t.element))),C?(o.height(k),u.height(k),s.height(k).wijsplitter("option","splitterDistance",n.treePanelWidth).show()):s.hide(),t._showingControls[v.treeView]=b,b?(t._treeView.show(),c.show()):(t._treeView.hide(),c.hide()),t._showingControls[v.detailView]=m,m?(t._detailView.show(),t._detailView.parent().show()):(t._detailView.hide(),t._detailView.parent().hide()),t._showingControls[v.thumbnailView]=g,g?t._thumbnailView.show():t._thumbnailView.hide(),m||g?h.show():h.hide(),y?(S.show(),x.show()):(S.hide(),x.hide()),n.viewMode===f.thumbnail?(S.removeClass(r.stateActive),x.addClass(r.stateActive)):(S.toggleClass(r.stateActive),x.removeClass(r.stateActive)),t.options.allowPaging?t._pager.show():t._pager.hide(),e?t._refreshRoot():(m||g)&&t._updateItemsView()},n.prototype._rootPathsUpdated=function(){var e=this;e._histories=[],e._currentHistoryIndex=-1,e._refreshRoot()},n.prototype._refreshRoot=function(){var e=this;e._data(null),e.options.currentFolder=null,e._initDataOptions(),e._updateTreeViewData(null,[]),e._createRootNodes(),e._loadCurrentFolder()},n.prototype._triggerFiltering=function(e){return this._trigger("filtering",null,e)},n.prototype._triggerFiltered=function(e){this._trigger("filtered",null,e)},n.prototype._triggerItemDeleting=function(e){return this._trigger("itemDeleting",null,e)},n.prototype._triggerItemDeleted=function(e){this._trigger("itemDeleted",null,e)},n.prototype._triggerItemMoving=function(e){return this._trigger("itemMoving",null,e)},n.prototype._triggerItemMoved=function(e){this._trigger("itemMoved",null,e)},n.prototype._triggerItemPasting=function(e){return this._trigger("itemPasting",null,e)},n.prototype._triggerItemPasted=function(e){this._trigger("itemPasted",null,e)},n.prototype._triggerItemCopying=function(e){return this._trigger("itemCopying",null,e)},n.prototype._triggerItemCopied=function(e){this._trigger("itemCopied",null,e)},n.prototype._triggerItemRenaming=function(e){return this._trigger("itemRenaming",null,e)},n.prototype._triggerItemRenamed=function(e){this._trigger("itemRenamed",null,e)},n.prototype._triggerNewFolderCreating=function(e){return this._trigger("newFolderCreating",null,e)},n.prototype._triggerNewFolderCreated=function(e){this._trigger("newFolderCreated",null,e)},n.prototype._triggerErrorOccurred=function(e){return this._trigger("errorOccurred",null,e)},n.prototype._triggerItemSelected=function(e){this._trigger("itemSelected",null,e)},n.prototype._triggerFileOpening=function(e){return this._trigger("fileOpening",null,e)},n.prototype._triggerFileOpened=function(e){this._trigger("fileOpened",null,e)},n.prototype._triggerFolderChanged=function(e){this._trigger("folderChanged",null,e)},n.prototype._triggerFolderLoaded=function(e){this._trigger("folderLoaded",null,e)},n.prototype._createFakeResponse=function(){return{success:!0,hostUri:"",items:this._data()}},n.prototype._tryAjax=function(e,t,n,r,i,s){var o=this;if(!o._enableAjax()){s?s():r(o._createFakeResponse());return}o._ajaxActions||(o._ajaxActions=[]);var u=function(){o._ajaxActionEnded(),o._ajaxActions.shift(),o._nextAjaxAction(),o._ajaxActions&&o._ajaxActions.length===0&&o._restoreFocus&&o._restoreFocus()},a=function(e){if(!i||!i(e)){var t=typeof e=="string"?e:e.error;t=t||"Unknown error.",o._processError(t)}},f=function(e){e&&(e.success&&r?r(e):e.success||a(e)),u()},l=function(e){a(e),u()};t=t||{},t.commandName=e,o._ajaxActions.push(o._createAjaxAction(t,n,f,l)),o._ajaxActions.length===1&&o._nextAjaxAction()},n.prototype._processError=function(e){if(this._triggerErrorOccurred({error:e})===!1)return;alert(e)},n.prototype._nextAjaxAction=function(){var e=this;e._ajaxActions.length>0&&(e._ajaxActions[0](),e._ajaxActionStarted())},n.prototype._ajaxActionStarted=function(){var e=this;e._showLoadingLayer()},n.prototype._ajaxActionEnded=function(){var e=this;e._hideLoadingLayer()},n.prototype._isLoading=function(){var e=this;return e._showLoadingLayerTimer!=null||e._isLoadingLayerShowing()},n.prototype._isLoadingLayerShowing=function(){var e=this;return e._loadingLayer&&e._loadingLayer.length&&e._loadingLayer.is(":visible")},n.prototype._hideLoadingLayer=function(){var e=this;e._showLoadingLayerTimer!=null&&(clearTimeout(e._showLoadingLayerTimer),e._showLoadingLayerTimer=null),e._isLoadingLayerShowing()&&e._loadingLayer.hide()},n.prototype._showLoadingLayer=function(){var e=this,t=this.options.wijCSS;if(e._showLoadingLayerTimer!=null||e._loadingLayer&&e._loadingLayer.length&&e._loadingLayer.is(":visible"))return;e._showLoadingLayerTimer=setTimeout(function(){if(!e._loadingLayer||!e._loadingLayer.length)e._loadingLayer=r("<div>").append('<div class="'+a.loadingOverlay+" "+t.overlay+'"></div>'+'<span class="'+a.loadingText+" "+t.content+" "+t.cornerAll+'">'+'<span class="'+t.icon+" "+t.iconClock+'"></span>'+e.localizeString("loadingText","Loading...")+"</span>"),e._loadingLayer.hide(),e._loadingLayer.appendTo(e.element);e._loadingLayer.show(),e._loadingLayer.find("> ."+a.loadingText).position({my:"center",at:"center center",of:e.element,collision:"none"}),e._showLoadingLayerTimer=null},S)},n.prototype._createAjaxAction=function(e,t,n,i){var s=this;return function(){r.ajax({url:s.options.actionUri,data:e,context:t,success:n,error:i,dataType:"json",cache:!1})}},n.prototype._enableAjax=function(){return this.options.actionUri!==undefined},n.prototype._isRootPath=function(e){return r.inArray(e,this._getRootPaths())>-1},n.prototype._hasRootPath=function(e){var t=this;for(var n=0,i=e.length;n<i;n++){var s=e[n],o=r.isPlainObject(s)?s.path:s;if(t._isRootPath(o))return!0}return!1},n.prototype._getParentPath=function(e){return this._isRootPath(e)?null:z(e)},n.prototype.localizeString=function(e,t){var n=this._getLocalization();return n&&n[e]?n[e]:t},n.prototype._getLocalization=function(){return this.options.localization},n}(t.wijmoWidget);n.wijfileexplorer=V,function(e){e[e.TreeView=0]="TreeView",e[e.ItemsView=1]="ItemsView"}(n.OperatingArea||(n.OperatingArea={}));var $=n.OperatingArea,J=function(){function e(e,t,n){this.name=e,this.action=t,this.text=n,this._bindElements=[]}return e.prototype.disabled=function(e){var t=this;if(e===undefined)return t._disabled;t._disabled!==e&&(t._disabled=e,t._onDisabledChanged())},e.prototype._onDisabledChanged=function(){var e=this,t=r.wijmo.wijCSS.stateDisabled;r.each(e._bindElements,function(n,r){e.disabled()?r.addClass(t):r.removeClass(t)})},e.prototype.addBindElement=function(e){this._bindElements.push(e)},e.prototype.removeBindElement=function(e){var t=this._bindElements,n=r.inArray(e,t);n>-1&&t.splice(n,1)},e.prototype.execute=function(e){var t=this;t._disabled||t.action(e)},e}(),K=function(){function e(){this.mode=l["default"],this.searchPatterns=L.slice(),this.viewMode=f.detail,this.allowFileExtensionRename=!1,this.allowMultipleSelection=!1,this.allowPaging=!1,this.pageSize=10,this.shortcuts=r.extend({},A),this.enableOpenFile=!0,this.enableCreateNewFolder=!0,this.enableCopy=!0,this.enableFilteringOnEnterPressed=!1,this.visibleControls=[v.addressBox,v.contextMenu,v.detailView,v.filterBox,v.thumbnailView,v.toolbar,v.treeView].join(","),this.treePanelWidth=200,this.disabled=!1,this.itemSelected=null,this.fileOpened=null,this.fileOpening=null,this.itemCopying=null,this.itemCopied=null,this.itemRenaming=null,this.itemRenamed=null,this.itemDeleting=null,this.itemDeleted=null,this.errorOccurred=null,this.itemPasting=null,this.itemPasted=null,this.itemMoving=null,this.itemMoved=null,this.newFolderCreating=null,this.newFolderCreated=null,this.folderChanged=null,this.folderLoaded=null,this.filtering=null,this.filtered=null}return e}();n.wijfileexplorer_options=K,V.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new K),V.prototype.widgetEventPrefix="wijfileexplorer",r.wijmo.registerWidget("wijfileexplorer",V.prototype)})(t.fileexplorer||(t.fileexplorer={}));var n=t.fileexplorer}(wijmo||(wijmo={}))});