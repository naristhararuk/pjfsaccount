var wijmo;define(["globalize","./wijmo.widget","./wijmo.wijpopup","./wijmo.wijlist","./wijmo.wijsuperpanel","./wijmo.wijcharex"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i=t.getKeyCodeEnum(),s=function(t){function s(){t.apply(this,arguments),this._wasPopupShowing=!1,this._imeCompostiing=!1,this._boundMouseWheel=!1,this._blockNextTriggerClickedEvent=!1}return e(s,t),s.prototype._elemWithClasses=function(e,t){return typeof t=="undefined"&&(t=[]),r(e).addClass(t.join(" "))},s.prototype._divWithClasses=function(){var e=[];for(var t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];return this._elemWithClasses("<div/>",e)},s.prototype._spanWithClasses=function(){var e=[];for(var t=0;t<arguments.length-0;t++)e[t]=arguments[t+0];return this._elemWithClasses("<span/>",e)},s.prototype._horizontalBorderWidth=function(e){return e.leftBorderWidth()+e.rightBorderWidth()},s.prototype._verticalBorderWidth=function(e){return e.topBorderWidth()+e.bottomBorderWidth()},s.prototype._create=function(){var e=this;try{var n=document.activeElement==this.element[0]}catch(i){}var s=this._horizontalBorderWidth(this.element),o=this._verticalBorderWidth(this.element);if(this.element[0].tagName.toLowerCase()!=="input"&&this.element[0].tagName.toLowerCase()!=="textarea")throw"Target element is not a INPUT";this._creationDate=new Date,window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r)),this.element.is(":hidden")&&this.element.wijAddVisibilityObserver&&this.element.wijAddVisibilityObserver(function(){e._destroy(),e._create(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijinput"),this.element.data("widgetName",this.widgetName),r.effects&&r.effects.save?r.effects.save(this.element,["width","height"]):r.save&&r.save(this.element,["width","height"]);var u=this.options.wijCSS;this.element.wrap("<div><span/></div"),this.wrapper=this.element.parent(),this.outerDiv=this.wrapper.parent(),this.outerDiv.addClass([u.wijinput,u.widget,u.helperClearFix,u.stateDefault,u.cornerAll].join(" ")),this.wrapper.addClass(u.wijinputWrapper),this.element.addClass(u.wijinputInput).addClass(u.cornerAll).attr("role","textbox");if(!(l.IsIE()&&parseFloat(r.browser.version)<=7))try{this.element.attr("aria-multiline",!1)}catch(i){this.element[0].setAttribute("aria-multiline","false")}this.options.showTrigger!=undefined&&(this.options.showDropDownButton=this.options.showTrigger),this._createDropDownAndSpin(),this._initialize(),n&&r(function(){return e.element.focus().wijtextselection(0,e.element.val().length)});var a=this.element[0].style;a.width&&(this._isInPercents(a.width)?this.outerDiv.width(a.width):this.outerDiv.width(this.element.width()+s-this._horizontalBorderWidth(this.outerDiv)),this.element.width("")),a.height&&(this._isInPercents(a.height)?this.outerDiv.height(a.height):this.outerDiv.height(this.element.height()+o-this._verticalBorderWidth(this.outerDiv)),this.element.height(this.outerDiv.height()-(parseInt(this.wrapper.css("padding-top"))+parseInt(this.wrapper.css("padding-bottom")))),this.wrapper.height(a.height)),t.prototype._create.call(this)},s.prototype._createDropDownAndSpin=function(){this._createDropDownAndSpinElement(),this._createDropDownAndSpinStyle(),this._createDropDownAndSpinLayout()},s.prototype._createDropDownAndSpinElement=function(){var e=this.options.wijCSS,t=this.options.spinnerAlign,n=t==="verticalLeft",r=this.options.dropDownButtonAlign==="left",i=this.options.showSpinner,s=this._isDropDownButtonShown();this.options.buttonAlign!=null&&(n=this.options.buttonAlign=="left",r=this.options.buttonAlign=="left",t=this.options.buttonAlign=="left"?"verticalLeft":"verticalRight"),this.triggerBtn=null,this.spinUpElement=null,this.spinDownElement=null,this.outerDiv.css("overflow","hidden");if(s){var o=r?e.cornerLeft:e.cornerRight;this.triggerBtn=this._divWithClasses(e.wijinputTrigger,e.stateDefault,o).append(this._spanWithClasses(e.icon,e.iconArrowDown)).attr("role","button"),this.element.attr({role:"combobox","aria-expanded":!1})}i&&(this.spinnerLeft=this._divWithClasses(e.wijinputSpinnerLeft,e.wijinputButton),this.spinnerRight=this._divWithClasses(e.wijinputSpinnerRight,e.wijinputButton),t==="verticalLeft"||t==="verticalRight"?(this.spinUpElement=this._divWithClasses(e.stateDefault,e.wijinputSpinUp).append(this._spanWithClasses(e.icon,e.iconArrowUp)).css({padding:"0px"}).attr("role","upbutton"),this.spinDownElement=this._divWithClasses(e.stateDefault,e.wijinputSpinDown).append(this._spanWithClasses(e.icon,e.iconArrowDown)).css({padding:"0px"}).attr("role","downbutton")):(this.spinUpElement=this._divWithClasses(e.stateDefault,e.wijinputSpin).append(this._spanWithClasses(e.icon,e.iconPlus,e.glyphIcon,e.glyphIconPlus)).css({padding:"0px"}).attr("role","upbutton"),this.spinDownElement=this._divWithClasses(e.stateDefault,e.wijinputSpin).append(this._spanWithClasses(e.icon,e.iconMinus,e.glyphIcon,e.glyphIconMinus)).css({padding:"0px"}).attr("role","downbutton")),this.element.attr("role","spinner"))},s.prototype._createDropDownAndSpinStyle=function(){var e=this.options.wijCSS,t=this.options.spinnerAlign,n=this.options.spinnerAlign==="verticalLeft",r=this.options.dropDownButtonAlign==="left",i=this.options.showSpinner,s=this._isDropDownButtonShown();this.options.buttonAlign!=null&&(n=this.options.buttonAlign=="left",r=this.options.buttonAlign=="left",t=this.options.buttonAlign=="left"?"verticalLeft":"verticalRight");if(s&&i)if(r)switch(t){case"verticalLeft":this.outerDiv.addClass(e.inputSpinnerTriggerLeft);break;case"verticalRight":this.outerDiv.addClass(e.inputTriggerLeft),this.outerDiv.addClass(e.inputSpinnerRight);break;case"horizontalDownLeft":case"horizontalUpLeft":this.outerDiv.addClass(e.inputSpinnerTriggerLeft),this.outerDiv.addClass(e.inputSpinnerRight)}else switch(t){case"verticalLeft":this.outerDiv.addClass(e.inputTriggerRight),this.outerDiv.addClass(e.inputSpinnerLeft);break;case"verticalRight":this.outerDiv.addClass(e.inputSpinnerTriggerRight);break;case"horizontalDownLeft":case"horizontalUpLeft":this.outerDiv.addClass(e.inputSpinnerTriggerRight),this.outerDiv.addClass(e.inputSpinnerLeft)}else if(s)r?this.outerDiv.addClass(e.inputTriggerLeft):this.outerDiv.addClass(e.inputTriggerRight);else if(i)switch(t){case"verticalLeft":this.outerDiv.addClass(e.inputSpinnerLeft);break;case"verticalRight":this.outerDiv.addClass(e.inputSpinnerRight);break;case"horizontalDownLeft":case"horizontalUpLeft":this.outerDiv.addClass(e.inputSpinnerLeft),this.outerDiv.addClass(e.inputSpinnerRight)}if(s&&i)if(r)switch(t){case"verticalRight":this.spinUpElement.addClass(e.cornerTR),this.spinDownElement.addClass(e.cornerBR);break;case"horizontalDownLeft":this.spinUpElement.addClass(e.cornerRight);break;case"horizontalUpLeft":this.spinDownElement.addClass(e.cornerRight)}else switch(t){case"verticalLeft":this.spinUpElement.addClass(e.cornerTL),this.spinDownElement.addClass(e.cornerBL);break;case"horizontalDownLeft":this.spinDownElement.addClass(e.cornerLeft);break;case"horizontalUpLeft":this.spinUpElement.addClass(e.cornerLeft)}else if(i)switch(t){case"verticalLeft":this.spinUpElement.addClass(e.cornerTL),this.spinDownElement.addClass(e.cornerBL);break;case"verticalRight":this.spinUpElement.addClass(e.cornerTR),this.spinDownElement.addClass(e.cornerBR);break;case"horizontalDownLeft":this.spinDownElement.addClass(e.cornerLeft),this.spinUpElement.addClass(e.cornerRight);break;case"horizontalUpLeft":this.spinUpElement.addClass(e.cornerLeft),this.spinDownElement.addClass(e.cornerRight)}},s.prototype._createDropDownAndSpinLayout=function(){var e=this.options.spinnerAlign,t=this.options.showSpinner,n=this._isDropDownButtonShown();this.options.buttonAlign!=null&&(e=this.options.buttonAlign=="left"?"verticalLeft":"verticalRight"),n&&this.triggerBtn.appendTo(this.outerDiv);if(t)switch(e){case"verticalLeft":this.spinnerLeft.append(this.spinUpElement).append(this.spinDownElement).appendTo(this.outerDiv);break;case"verticalRight":this.spinnerRight.append(this.spinUpElement).append(this.spinDownElement).appendTo(this.outerDiv);break;case"horizontalDownLeft":this.spinnerLeft.append(this.spinDownElement).appendTo(this.outerDiv),this.spinnerRight.append(this.spinUpElement).appendTo(this.outerDiv);break;case"horizontalUpLeft":this.spinnerLeft.append(this.spinUpElement).appendTo(this.outerDiv),this.spinnerRight.append(this.spinDownElement).appendTo(this.outerDiv)}},s.prototype._isDropDownButtonShown=function(){var e=this.options.showTrigger;return e===undefined&&(e=!1),e||this.options.showDropDownButton},s.prototype._isInPercents=function(e){return e.match(/%$/)},s.prototype._createTextProvider=function(){return undefined},s.prototype._beginUpdate=function(){},s.prototype._endUpdate=function(){var e=this;this.element.mousewheel&&!this._boundMouseWheel&&(this.element.mousewheel(function(t,n){e.isFocused()&&e._doSpin(n>0,!1)&&t.preventDefault()}),this._boundMouseWheel=!0)},s.prototype._isPopupShowing=function(){return!!this._comboDiv&&this._comboDiv.wijpopup("isVisible")},s.prototype._onTriggerMouseDown=function(e){this._wasPopupShowing&&(this._blockNextTriggerClickedEvent=!0)},s.prototype._onTriggerMouseUp=function(e){},s.prototype._onTriggerClicked=function(){if(this._blockNextTriggerClickedEvent){this._blockNextTriggerClickedEvent=!1;return}this._popupVisible()?this._hidePopup():this._showPopup()},s.prototype._showPopup=function(){return this._popupComboList()},s.prototype._hidePopup=function(){this._comboDiv.wijpopup("hide")},s.prototype._initialize=function(){var e=this;this.element.data("initializing",!0),this._trigger("initializing"),this.element.data("preText",this.element.val()),this.element.data("elementValue",this.element.val()),this.element.data("errorstate",!1),this.element.data("breakSpinner",!0),this.element.data("prevSelection",null),this.element.data("simulating",!1),this._createTextProvider(),this._beginUpdate();var t=this.options,n=function(e){return(e.which?e.which:e.button)===1},i=function(t){if(e._isDisabled())return;if(!n(t))return;if(e.options.disableUserInput)return;e._trySetFocus(),l.IsFireFox4OrLater()&&e._stopEvent(t),e.element.data("breakSpinner",!1),e._addState("active",r(e)),e._doSpin(r(t.currentTarget).attr("role")=="upbutton",!0)},s=function(t){if(e._isDisabled())return;if(!n(t))return;if(e.options.disableUserInput)return;e._stopSpin(),e._removeState("active",r(e))};this.triggerBtn&&!t.disabledState&&this.triggerBtn.bind({mouseover:function(){if(e._isDisabled())return;e._addState("hover",r(e))},mouseout:function(){if(e._isDisabled())return;e._removeState("hover",r(e))},mousedown:function(t){if(e._isDisabled())return;if(!n(t))return;e._stopEvent(t),e._addState("active",r(e)),e._trigger("triggerMouseDown"),e._trigger("dropDownButtonMouseDown"),e._onTriggerMouseDown(t)},mouseup:function(t){e._onTriggerMouseUp(t)},click:function(t){if(e._isDisabled())return;e._stopEvent(t),e._stopSpin(),e._removeState("active",r(e)),e._trigger("triggerMouseUp"),e._trigger("dropDownButtonMouseUp"),e._onTriggerClicked(),l.IPad||e._trySetFocus()}}),this.spinUpElement&&!t.disabledState&&this.spinUpElement.bind({mouseover:function(){if(e._isDisabled())return;e._addState("hover",r(e))},mouseout:function(){if(e._isDisabled())return;e._removeState("hover",r(e)),e._removeState("active",r(e)),e._stopSpin()},mousedown:i,mouseup:s}),this.spinDownElement&&!t.disabledState&&this.spinDownElement.bind({mouseover:function(){if(e._isDisabled())return;e._addState("hover",r(e))},mouseout:function(){if(e._isDisabled())return;e._removeState("hover",r(e)),e._removeState("active",r(e)),e._stopSpin()},mousedown:i,mouseup:s}),this._attachInputEvent(),this.element.data("initializing",!1),this._resetData(),this._endUpdate(),this._updateText(),this.options.imeMode&&this.element.css("ime-mode",this.options.imeMode),this.element.data("initialized",!0),this._trigger("initialized")},s.prototype._attachInputEvent=function(){this.element.bind({"focus.wijinput":r.proxy(this._onFocus,this),"beforedeactivate.wijinput":r.proxy(this._onBeforeDeactivate,this),"blur.wijinput":r.proxy(this._onBlur,this),"mousedown.wijinput":r.proxy(this._onMouseDown,this),"mouseup.wijinput":r.proxy(this._onMouseUp,this),"keypress.wijinput":r.proxy(this._onKeyPress,this),"keydown.wijinput":r.proxy(this._onKeyDown,this),"keyup.wijinput":r.proxy(this._onKeyUp,this),"compositionstart.wijinput":r.proxy(this._onCompositionStart,this),"compositionend.wijinput":r.proxy(this._onCompositionEnd,this),"change.wijinput":r.proxy(this._onChange,this),"paste.wijinput":r.proxy(this._onPaste,this),"drop.wijinput":r.proxy(this._onDrop,this)}),this.element.bind("propertychange.wijinput input.wijinput",r.proxy(this._onInput,this))},s.prototype._detachInputEvent=function(){this.element.unbind(".wijinput")},s.prototype._init=function(){this.element.attr("readOnly")&&(this.options.readonly=!0),this.options.readonly===!0&&(this.options.disableUserInput=!0),(this.options.readonly===!0||this.options.disableUserInput===!0)&&this.element.attr("readOnly",!0),this.options.placeholder!=null&&(this.options.nullText=this.options.placeholder)},s.prototype._showNullText=function(){return!!this.options.nullText||this.options.nullText===""},s.prototype._setOption=function(e,t){switch(e){case"readonly":this._super(e,t),e="disableUserInput";break;case"placeholder":this._super(e,t),e="nullText";break;case"showTrigger":this.options.showTrigger=t,this.options.showDropDownButton=t}this._super(e,t);switch(e){case"spinnerAlign":case"dropDownButtonAlign":case"showDropDownButton":case"buttonAlign":case"showTrigger":case"showSpinner":this._destroy(),this._create();break;case"showNullText":case"nullText":this._updateText();break;case"imeMode":this.element.css("ime-mode",this.options.imeMode);break;case"disableUserInput":this.element.attr("readOnly",t);break;case"pickers":this._deleteComboDiv()}},s.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._toggleDisableInput(!0)},s.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._toggleDisableInput(!1)},s.prototype._toggleDisableInput=function(e){var t=this.options.wijCSS.stateDisabled;this.element.attr("disabled",e),this.element.toggleClass(t,e),this.triggerBtn&&this.triggerBtn.toggleClass(t,e),this.spinUpElement&&this.spinUpElement.toggleClass(t,e),this.spinDownElement&&this.spinDownElement.toggleClass(t,e)},s.prototype.destroy=function(){this._super(),this._comboDiv&&this._comboDiv.remove(),this.outerDiv&&this.outerDiv.remove(),this.spinnerLeft&&this.spinnerLeft.remove(),this.spinnerRight&&this.spinnerRight.remove(),this.spinDownElement&&this.spinDownElement.remove(),this.spinUpElement&&this.spinUpElement.remove(),this._destroy()},s.prototype.drop=function(){this._onTriggerClicked()},s.prototype.isDestroyed=function(){return!this.outerDiv},s.prototype._destroy=function(){if(this.isDestroyed())return;this.wrapper=undefined,this.outerDiv=undefined,this._detachInputEvent(),this.element.removeData("errorstate").removeData("breakSpinner").removeData("prevSelection").removeData("simulating").removeData("isPassword").removeClass(this.options.wijCSS.wijinputInput).removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow").removeAttr("aria-expanded"),this.element.parent().replaceWith(this.element),this.element.parent().replaceWith(this.element),r.effects&&r.effects.restore?r.effects.restore(this.element,["width","height"]):r.restore&&r.restore(this.element,["width","height"]),this.triggerBtn=undefined,this.spinnerLeft=undefined,this.spinnerRight=undefined,this.spinDownElement=undefined,this.spinUpElement=undefined},s.prototype.widget=function(){return this.outerDiv||this._super()},s.prototype._getCulture=function(e){if(!Globalize)return null;var t=r.extend(!0,{},Globalize.findClosestCulture(e||this.options.culture)||Globalize.findClosestCulture("default"));return this.options.cultureCalendar!==""&&this.options.cultureCalendar!=="standard"&&r.extend(t.calendar,t.calendars[this.options.cultureCalendar||"standard"]),t},s.prototype._addState=function(e,t){t.is(":not(.ui-state-disabled)")&&t.addClass(this.options.wijCSS.getState(e))},s.prototype._removeState=function(e,t){t.removeClass(this.options.wijCSS.getState(e))},s.prototype._isInitialized=function(){return!this.element.data("initializing")},s.prototype._setData=function(e){this.setText(e)},s.prototype._resetData=function(){},s.prototype._validateData=function(){},s.prototype.getText=function(){return this._isInitialized()?this._textProvider.toString(!0,!1,!1):this.element.val()},s.prototype.setText=function(e){this._isInitialized()?(this._textProvider.setText(e),e!==""&&this.element.val()!==this.options.nullText&&this.element.data("isShowNullText",!1),this._updateText()):this.element.val(e)},s.prototype.getPostValue=function(){return this._isInitialized()?this._textProvider.toString(!0,!1,!0):this.element.val()},s.prototype.selectText=function(e,t){var n=this;typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=this.getText().length),isNaN(e)&&(e=0),isNaN(t)&&(t=0),l.IsFireFox4OrLater()&&this.focus();if(this.element.is(":disabled"))return;this.isSelectingFromAPI=!0,this.element.wijtextselection(e,t),setTimeout(function(){return n.isSelectingFromAPI=!1},100)},s.prototype.focus=function(){if(this.element.is(":disabled"))return;this.element.get(0).focus()},s.prototype.isFocused=function(){return this.outerDiv?this.outerDiv.hasClass(this.options.wijCSS.stateFocus):!1},s.prototype.getSelectedText=function(){if(this.isFocused())return this.element.wijtextselection().text;if(this.element.data("prevSelection")){var e=this.element.data("prevSelection").start,t=this.element.data("prevSelection").end;return this.element.val().substring(e,t)}return""},s.prototype._raiseTextChanged=function(){var e=this.element.val(),t=this.element.data("preText");!!this.element.data("initialized")&&t!==e&&(this._trigger("textChanged",null,{text:e}),this.element.data("changed",!0)),this.element.data("preText",e)},s.prototype._raiseDataChanged=function(){},s.prototype._allowEdit=function(){return!this.element.is(":disabled")},s.prototype._updateText=function(e){typeof e=="undefined"&&(e=!1);if(!this._isInitialized())return;e=!!e;var t;if(this.element.data("selectionbeforeblur")!==undefined)t=this.element.data("selectionbeforeblur"),this.element.removeData("selectionbeforeblur");else try{t=this.element.wijtextselection()}catch(n){}var r=this.options;this.isDeleteAll&&this._showNullText()?(this.isDeleteAll=!1,r.date=null,this.element.val(r.nullText)):(this.element.val(this._textProvider.toString()),this.options.text=this._textProvider.toString(!0,!1,!1)),this.element.is(":disabled")||(e&&this.selectText(t.start,t.end),this.element.data("prevSelection",t)),this._raiseTextChanged(),this._raiseDataChanged()},s.prototype._trySetFocus=function(){if(document.activeElement!==this.element[0])try{this.options.disableUserInput||this.element.focus()}catch(e){}},s.prototype._deleteSelText=function(e){typeof e=="undefined"&&(e=!1);if(!this._allowEdit())return;var t=this.element.wijtextselection();if(e){if(t.end<1)return;t.end===t.start&&t.start--}t.end--,t.end<t.start&&(t.end=t.start);var r=new n.wijInputResult;this._textProvider.removeAt(t.start,t.end,r),this._updateText(),this.selectText(r.testPosition,r.testPosition)},s.prototype._fireIvalidInputEvent=function(e){var t=this,n=this._trigger("invalidInput",null,{widget:this,"char":e});if(r.isFunction(this.options.invalidInput)&&n===!0)return;if(!this.element.data("errorstate")){var i=this.options.invalidClass||this.options.wijCSS.stateError;this.element.data("errorstate",!0),window.setTimeout(function(){t.outerDiv&&t.outerDiv.removeClass(i),t.element.data("errorstate",!1)},200),this.outerDiv.addClass(i)}},s.prototype._onInput=function(e){var t=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(t){this.element.data("hasInput")===!0&&!this._imeCompostiing&&(this.element.data("hasInput",!1),this._simulate());return}if(!this._isSimulating()||!this.element.data("ime")||this.element.data("isComposingIME")){this.element.data("isComposingIME")&&this.element.data("simulationPending",!0);return}this._simulate()},s.prototype._keyDownPreview=function(e){var t=e.keyCode||e.which;return e.ctrlKey===!0&&t===88?!0:e.ctrlKey===!0&&t===90?!0:!1},s.prototype._onDoubleByteCharacter=function(){var e=this.element.data("lastDbsState"),t=this.element.wijtextselection(),n=this.element.val();this.element.data("isComposingIME")&&e&&e.selection.start===t.start&&e.Text===n?(this.element.removeData("lastDbsState"),this._simulateOnCompositionEnd()):(this.element.data("lastDbsState",{selection:t,text:n}),this._onCompositionStart())},s.prototype._onCompositionStart=function(){var e=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(e){this._imeCompostiing=!0,this._beforeSimulate(!0);return}if(this.element.data("isComposingIME"))return;this.element.data("isComposingIME",!0),this._beforeSimulate(!0)},s.prototype._onCompositionEnd=function(){var e=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(e){this._imeCompostiing=!1,this.element.data("hasInput",!0);return}this._simulateOnCompositionEnd()},s.prototype._simulateOnCompositionEnd=function(){if(!this.element.data("isComposingIME"))return;this.element.data("isComposingIME",!1),this._isInitialized()&&(!this._textProvider||!this._textProvider.noMask)&&this._simulateIfPending()},s.prototype._simulateIfPending=function(){this.element.data("simulationPending")&&this.element.data("lastSelection")&&this._simulate()},s.prototype._beforeSimulate=function(e){typeof e=="undefined"&&(e=!1),this.element.data("lastSelection")||(this.element.data("lastSelection",this.element.wijtextselection()),this.element.data("lastValue",this.element.val())),this.element.data("ime",e),this.element.data("simulating",!0)},s.prototype._isSimulating=function(){return this.element.data("simulating")},s.prototype._simulate=function(e){var t=this,n=null;this.element.data("simulationPending",!1);if(typeof e=="string")n=e;else{var r=this.element.wijtextselection(),i=this.element.data("lastSelection").start,s=r.end;s>=i&&(n=this.element.val().substring(i,s))}n&&window.setTimeout(function(){if(t._isLastValueNull())return;t.element.val(t.element.data("lastValue"));var e=t.element.data("lastSelection");t.element.wijtextselection(e),t._batchKeyPress=!0,t.element.data("simulating",!1);var r=jQuery.Event("keypress");r.ctrlKey=r.altKey=!1;for(var i=0;i<n.length;i++){r.which=r.charCode=r.keyCode=n.charCodeAt(i),t._nextChar=i===n.length-1?"":n.charAt(i+1),t._onKeyPress(r),t._nextChar="";var s=t._appendChar;s&&s.length>0&&(t._appendChar="",r.which=r.charCode=r.keyCode=s.charCodeAt(i),t._onKeyPress(r)),t._skipNextChar&&(i++,t._skipNextChar=!1)}t._batchKeyPress=!1,t._endSimulate()},1)},s.prototype._isLastValueNull=function(){return!this.element.data("lastValue")},s.prototype._endSimulate=function(){this._simulateIfPending(),this.element.removeData("ime"),this.element.removeData("lastSelection"),this.element.removeData("lastValue")},s.prototype._processKeyForDropDownList=function(e){var t=this._getKeyCode(e);if(!(!e.altKey||t!==i.UP&&t!==i.DOWN))return this._onTriggerClicked(),this._stopEvent(e),!0;if(t===i.ESCAPE&&this._wasPopupShowing)return this._hidePopup(),this._stopEvent(e),!0;if(this._wasPopupShowing&&this._comboDiv!==undefined){if(t===i.DOWN){try{this._comboDiv.wijlist("next")}catch(n){}return this._stopEvent(e),!0}if(t===i.UP){try{this._comboDiv.wijlist("previous")}catch(n){}return this._stopEvent(e),!0}if(t===i.ENTER)return this._comboDiv.wijlist("select"),e.preventDefault(),!0;if(t===i.PAGE_DOWN){try{this._comboDiv.wijlist("nextPage")}catch(n){}return this._stopEvent(e),!0}if(t===i.PAGE_UP){try{this._comboDiv.wijlist("previousPage")}catch(n){}return this._stopEvent(e),!0}}},s.prototype._processKeyOnNoMask=function(e){var t=this._getKeyCode(e);t===i.ENTER&&(this._onEnterDown(e),this.options.autoPostBack&&this._stopEvent(e));if(t===i.LEFT||t===i.RIGHT)if(this._processLeftRightKey(t===i.LEFT)){this._stopEvent(e);return}this._processKeyForDropDownList(e)},s.prototype._onKeyDown=function(e){var t=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(t&&this._imeCompostiing)return;this.element.data("prevSelection",null),this._deleteKeyDown=!1;if(!this._isInitialized())return;if(this._textProvider&&!!this._textProvider.noMask){this._processKeyOnNoMask(e);return}var n=this._getKeyCode(e);if(n===229){this._onDoubleByteCharacter();return}this._simulateOnCompositionEnd();if(this.options.disableUserInput){n===i.TAB?this._processTabKey(e)&&this._stopEvent(e):this._stopEvent(e);return}if(this._keyDownPreview(e)){this._stopEvent(e);return}if(this._processKeyForDropDownList(e))return;switch(n){case i.UP:this._doSpin(!0,!1),this._stopEvent(e);return;case i.DOWN:this._doSpin(!1,!1),this._stopEvent(e);return;case i.LEFT:case i.RIGHT:this._processLeftRightKey(n===i.LEFT)&&(this._trigger("keyExit"),this._stopEvent(e));return;case i.TAB:this._processTabKey(e)&&this._stopEvent(e);return}if(e.ctrlKey)switch(n){case i.INSERT:case 67:return;default:}if(e.ctrlKey||e.altKey)return;switch(n){case 112:case 113:case 114:case 115:case 116:case 117:case i.TAB:case i.CAPSLOCK:case i.END:case i.HOME:case i.CTRL:case i.SHIFT:return;case i.BACKSPACE:this._deleteSelText(!0),this._stopEvent(e);return;case i.DELETE:this._deleteSelText(!1),this._stopEvent(e),this._deleteKeyDown=!0;return;case i.ENTER:this._onEnterDown(e),this.options.autoPostBack&&this._stopEvent(e);break;case i.ESCAPE:this._stopEvent(e),window.setTimeout(r.proxy(this._resetData,this),1);return;case i.PAGE_UP:case i.PAGE_DOWN:case i.ALT:this._stopEvent(e);return}},s.prototype._onEnterDown=function(e){this.options.hideEnter&&this._stopEvent(e)},s.prototype._onKeyUp=function(e){var t=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(t&&this._imeCompostiing)return;if(this._textProvider&&!!this._textProvider.noMask)return;var n=this._getKeyCode(e);if(this._isSimulating()){n===i.ENTER&&this._simulateOnCompositionEnd();return}if(!this._isInitialized())return;if(n===i.ENTER||n===i.ESCAPE)return;if(this.options.disableUserInput){this._raiseTextChanged(),this._raiseDataChanged();return}this._stopEvent(e)},s.prototype._getKeyCode=function(e){var t=window.navigator.userAgent;return t.indexOf("iPod")===-1&&t.indexOf("iPhone")===-1||e.which!==127?e.keyCode||e.which:8},s.prototype._keyPressPreview=function(e){return!1},s.prototype._onKeyPress=function(e){if(this._isSimulating()||this._textProvider&&!!this._textProvider.noMask)return;var t=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(t&&this._imeCompostiing)return;this.element.data("prevSelection",null);if(this.options.disableUserInput)return;if(!this._allowEdit())return;if(e.ctrlKey&&e.keyCode===119){this._onPaste(e);return}var n=e.keyCode||e.which;if(l.IsFireFox4OrLater())switch(e.keyCode){case i.UP:case i.DOWN:case i.LEFT:case i.RIGHT:case i.HOME:case i.END:return}switch(n){case 0:case i.TAB:return;case i.BACKSPACE:this._stopEvent(e);return;case i.DELETE:if(this._deleteKeyDown){this._stopEvent(e);return}break;case i.ENTER:this.options.hideEnter&&this._stopEvent(e);return}if(e.ctrlKey||e.altKey)if(n!==i.SPACE)return;if(this._keyPressPreview(e))return;var t=window.navigator.userAgent.match(/iPhone|iPad|iPod/i);if(t&&!this._batchKeyPress){this.element.data("hasInput",!0),this._beforeSimulate(!0);return}var r=String.fromCharCode(n),s=this._textProvider.replaceWith(this.element.wijtextselection(),r);s?(this._updateText(),this.selectText(s.testPosition+1,s.testPosition+1),this.element.data("prevSelection",{start:s.testPosition+1,end:s.testPosition+1})):this._fireIvalidInputEvent(r),this._batchKeyPress||this._stopEvent(e)},s.prototype._isNullText=function(e){return e=e||this.element.val(),this._showNullText()&&e===this.options.nullText},s.prototype._doFocus=function(){var e=this.element.wijtextselection(),t=e.start;this._updateText();var n=this.element.val();n.length===t&&(t=0),r.browser.safari||this.selectText(t,t)},s.prototype._afterFocused=function(){this._isNullText()&&this._doFocus()},s.prototype._onFocus=function(e){if(this.options.disableUserInput)return;this.outerDiv.addClass(this.options.wijCSS.getState("focus"));if(!this.element.data("breakSpinner"))return;if(!this._isInitialized())return;if(!this._allowEdit())return;if(this.isSelectingFromAPI)return;this.element.data("focusNotCalledFirstTime")||this.element.data("focusNotCalledFirstTime",(new Date).getTime()),this._afterFocused()},s.prototype._onBeforeDeactivate=function(e){if(this.options.disableUserInput)return;if(!this.element.data("breakSpinner"))return;if(!this._isInitialized())return;if(!this._allowEdit())return;this.element.data("selectionbeforeblur",this.element.wijtextselection())},s.prototype._onBlur=function(e){if(this.options.disableUserInput)return;this._simulateOnCompositionEnd();if(this._isComboListVisible())return;var t=this.isFocused();this._removeState("focus",this.outerDiv);if(!this.element.data("breakSpinner")){this.element.get(0).focus();if(this.element.data("prevSelection")){var n=this.element.data("prevSelection").start;n!==undefined&&n!==null&&this.selectText(n,n)}return}if(!this._isInitialized()||!t)return;this.element.data("value",this.element.val()),this._updateTextOnLostFocus()},s.prototype._updateTextOnLostFocus=function(){var e=this;window.setTimeout(function(){e._onChange(),e._updateText(),e._validateData(),e.element.data("changed")&&(e.element.data("changed",!1),e._popupVisible()||(e._trigger("change"),e.element.change()))},100)},s.prototype._popupVisible=function(){return this._wasPopupShowing},s.prototype._onMouseDown=function(e){if(!this._isInitialized())return;if(this.element.is(":disabled"))return;if(l.IsMouseDownOnClearButton(e)){var t=!1;try{t=document.activeElement===e.target}catch(n){}this.element.data("focusedWhenMouseDown",t),this.element.data("mouseDownOnClearButton",!0);return}},s.prototype._onMouseUp=function(e){if(!this._isInitialized())return;if(this.element.is(":disabled"))return;if(l.IsMouseDownOnClearButton(e)&&this.element.data("mouseDownOnClearButton")&&this.element.data("focusedWhenMouseDown")===!0){if(!this.options.disableUserInput){var t=this;setTimeout(function(){t._processClearButton()},0)}this.element.data("mouseDownOnClearButton",!1);return}this.element.data("mouseDownOnClearButton",!1),this.element.data("focusedWhenMouseDown",!1);var n=this.element.wijtextselection();this.element.data("prevSelection",n);if(this.element.val()=="")return;var t=this;setTimeout(function(){t.element.val()==""&&t.setText("")},5),this.element.data("isFocusSelecting")&&(this.element.data("isFocusSelecting",!1),e.preventDefault())},s.prototype._onChange=function(){if(!this.element)return;var e=this.element.val(),t=this.getText();t!==e&&this.setText(e)},s.prototype._onPaste=function(e){if(this._textProvider&&!!this._textProvider.noMask)return;this._beforeSimulate();var t=this;window.setTimeout(function(){t._simulate()},1)},s.prototype._onDrop=function(e){this._beforeSimulate();if(e.originalEvent&&e.originalEvent.dataTransfer){var t=e.originalEvent.dataTransfer.getData("Text");t&&this._simulate(t)}},s.prototype._stopEvent=function(e){e.stopPropagation(),e.preventDefault()},s.prototype._calcSpinInterval=function(){return this._repeatingCount++,this._repeatingCount>10?50:this._repeatingCount>4?100:this._repeatingCount>2?200:400},s.prototype._doSpin=function(e,t){return!1},s.prototype._stopSpin=function(){this.element.data("breakSpinner",!0),this._repeatingCount=0;var e=this.element.data("spintimer");e&&(clearTimeout(e),this.element.data("spintimer",undefined))},s.prototype._hasComboItems=function(){return!!this._getcomboItems()&&this._getcomboItems().length},s.prototype._getcomboItems=function(){return!!this.options.comboItems&&this.options.comboItems.length>0?this.options.comboItems:this.options.pickers.list},s.prototype._getcomboWidth=function(){return this.options.comboWidth||this.options.pickers.width},s.prototype._getcomboHeight=function(){return this.options.comboHeight||this.options.pickers.height},s.prototype._isComboListVisible=function(){return this._comboDiv?this._comboDiv.wijpopup("isVisible"):!1},s.prototype._deleteComboDiv=function(){if(this._comboDiv==undefined)return;this._comboDiv.wijlist("destroy"),this._comboDiv.remove(),delete this._comboDiv},s.prototype._createComboDiv=function(){var e=this;if(this._comboDiv!==undefined)return;this._comboDiv=r("<div></div>").appendTo(document.body).css("position","absolute");var t=this._normalize(this._getcomboItems());this._comboDiv.wijlist({maxItemsCount:5,selected:function(t,n){e.options.disableUserInput||e._setData(n.item.value),e._comboDiv.wijpopup("hide"),e._trySetFocus()}}),this._comboDiv.wijlist("setItems",t),this._comboDiv.wijlist("renderList")},s.prototype._popupComboList=function(){var e=this;if(!this._hasComboItems())return!1;if(!this._allowEdit())return!1;var t=this.outerDiv.width(),n=this._getcomboWidth(),r=this._getcomboHeight();return this._comboDiv!=undefined&&n&&parseInt(n)!==this._comboDiv.width()&&this._deleteComboDiv(),this._createComboDiv(),this._comboDiv.width(t),this._comboDiv.wijlist("option","autoSize",!r),r&&this._comboDiv.height(r),n&&this._comboDiv.width(n),this._comboDiv.wijlist("refreshSuperPanel"),this._comboDiv.wijpopup({autoHide:!0,hidden:function(){e._trigger("dropDownClose"),e._wasPopupShowing=!1,e._comboDiv.wijlist("unselectItems"),e._comboDiv.wijlist("deactivate")},shown:function(){e._trigger("dropDownOpen"),e._wasPopupShowing=!0}}),this.outerDiv.attr("aria-expanded",!0),this._comboDiv.wijpopup("show",{of:this.outerDiv,offset:"0 4",hidden:function(){e.outerDiv.attr("aria-expanded",!1)}}),!0},s.prototype._normalize=function(e){return e.length&&e[0].label&&e[0].value?e:r.map(e,function(e){return typeof e=="string"?{label:e,value:e}:r.extend({label:e.label||e.value,value:e.value||e.label},e)})},s.prototype._processLeftRightKey=function(e){return!1},s.prototype._processTabKey=function(e){return!1},s.prototype._moveControl=function(e,t,n){var r=l.GetElements(),i=null,s={};if(r.length<2)return null;var o=l.GetNextFocusableControl(e,r,t),u=this;setTimeout(function(){l.SetElementFocus(o),u._trigger("keyExit")},0)},s.prototype._processClearButton=function(){},s}(t.wijmoWidget);n.wijinputcore=s;var o="wijmo-wijinput",u=o+"-",a=function(){function e(){this.wijCSS={wijinput:o,wijinputInput:u+"input",wijinputWrapper:u+"wrapper",wijinputWrapperSpinnerLeft:u+"wrapper-spinner-left",wijinputWrapperSpinnerRight:u+"wrapper-spinner-right",wijinputTrigger:u+"trigger",wijinputSpinnerLeft:u+"spinner-left",wijinputSpinnerRight:u+"spinner-right",wijinputButton:u+"button",wijinputSpin:u+"spin",wijinputSpinUp:u+"spinup",wijinputSpinDown:u+"spindown",glyphIcon:"glyphicon",glyphIconPlus:"glyphicon-plus",glyphIconMinus:"glyphicon-minus",iconPlus:"ui-icon-plus",iconMinus:"ui-icon-minus"},this.imeMode="",this.culture="",this.cultureCalendar="",this.invalidClass=r.wijmo.wijCSS.stateError,this.nullText=undefined,this.placeholder=undefined,this.showNullText=!1,this.hideEnter=!1,this.disableUserInput=!1,this.readonly=!1,this.buttonAlign=null,this.dropDownButtonAlign="right",this.showDropDownButton=!1,this.showTrigger=undefined,this.showSpinner=!1,this.comboItems=undefined,this.comboWidth=undefined,this.comboHeight=undefined,this.blurOnLeftRightKey="none",this.spinnerAlign="verticalRight",this.allowSpinLoop=!1,this.pickers={list:undefined,width:undefined,height:undefined},this.dropDownOpen=null,this.dropDownClose=null,this.initializing=null,this.initialized=null,this.triggerMouseDown=null,this.triggerMouseUp=null,this.dropDownButtonMouseDown=null,this.dropDownButtonMouseUp=null,this.textChanged=null,this.invalidInput=null,this.keyExit=null}return e}();s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new a),function(e){e[e.Default=-1]="Default",e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(n.MouseButton||(n.MouseButton={}));var f=n.MouseButton,l=function(){function e(){}return e.GetBrowserType=function(){var t=navigator.userAgent.toLowerCase();if(t.indexOf("msie")!=-1)e.ie=t.match(/msie ([\d.]+)/)[1];else if(t.indexOf("chrome")!=-1)e.chrome=t.match(/chrome\/([\d.]+)/)[1];else if(t.indexOf("safari")!=-1){var n=t.match(/version\/([\d.]+)/);n&&(e.safari=n[1])}else t.indexOf("firefox")!=-1?e.firefox=t.match(/firefox\/([\d.]+)/)[1]:t.indexOf("opera")!=-1&&(e.opera=t.match(/opera.([\d.]+)/)[1]);t.indexOf("ipad")!=-1&&(e.IPad=!0),e.engine=null,window.navigator.appName=="Microsoft Internet Explorer"&&(document.documentMode?e.engine=document.documentMode:(e.engine=5,document.compatMode&&document.compatMode=="CSS1Compat"&&(e.engine=7),e.ie&&e.ie.indexOf("6")==0&&(e.engine=6))),t.indexOf("rv:")!==-1&&t.indexOf("firefox")===-1&&(e.ie=e.engine=t.match(/rv:([\d.]+)/)[1])},e.IsMouseDownOnClearButton=function(t){if(!e.IsIE10OrLater())return!1;for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];for(var i=0;i<r.cssRules.length;i++)if(r.cssRules[i].selectorText=="::-ms-clear"&&r.cssRules[i].style.display=="none")return!1}var s=t.offsetX,o=t.offsetY,u=t.srcElement||t.target,a=u.clientWidth,f=u.clientHeight,l=parseInt(u.currentStyle.paddingLeft),c=parseInt(u.currentStyle.paddingRight);if(u.readOnly||t.button!=0)return!1;if(a-f+l+c<e.GetClearButtonShowThreshold(u))return!1;var h=a-f;return s>h&&s<=a&&o>=0&&o<f?!0:!1},e.CompareTextWithUnifiedNewline=function(e,t){return e.replace(/(\r\n|\r)/g,"\n")!=t.replace(/(\r\n|\r)/g,"\n")},e.GetClearButtonShowThreshold=function(t){var n=e.MeasureText("ABCDQ",t).Height,r=4.3604432*n-.76207324;return r=Math.round(r),r},e.GetClientOS=function(){var t;if(!e.IsIE()){var n=navigator.userAgent,r=n.indexOf("("),i=n.indexOf(")");t=n.substring(r+1,i)}else t=navigator.appVersion;return t.indexOf("NT 6.0")!=-1?"vista":t.indexOf("NT 5.2")!=-1?"win2003":t.indexOf("NT 5.1")!=-1?"winxp":t.indexOf("NT 5.0")!=-1?"win2000":t.indexOf("NT 6.1")!=-1?"Win7":t.indexOf("NT 6.2")!=-1?"Win8":t.indexOf("NT 6.3")!=-1?"Win8":t.indexOf("Android")!=-1?"Android":"unknow"},e.MeasureText=function(t,n){if(e.MeasureElement===undefined){var r=document.createElement("div");r.style.position="absolute",r.style.border="solid 0px",r.style.left="-100000px",r.style.top="-100000px";var i=window.document.createTextNode("");r.appendChild(i),document.body.appendChild(r),e.MeasureElement=r,e.MeasureTextElement=i}var r=e.MeasureElement,i=e.MeasureTextElement;if(document!=null){var s=document.body.contains(n);s||document.body.appendChild(n);var o=n.currentStyle||window.getComputedStyle(n,null);r.style.fontFamily=o.fontFamily,r.style.fontSize=o.fontSize,r.style.fontStyle=o.fontStyle,r.style.fontWeight=o.fontWeight,s||document.body.removeChild(n)}var u=null;if(typeof t=="string")i.nodeValue=t,u={Width:r.clientWidth,Height:r.clientHeight};else{u=[];for(var a=0;a<t.length;a++)i.nodeValue=t[a],u.push({Width:r.clientWidth,Height:r.clientHeight})}return u},e.SetElementFocus=function(e){e.focus()},e.GetAllElements=function(){return document.body.querySelectorAll?document.body.querySelectorAll("button, input, object, select, textarea"):document.body.all?document.body.all:document.body.getElementsByTagName("*")},e.GetElements=function(){var t=[],n=e.GetAllElements(),r=0,i=/^(?:button|input|object|select|textarea)$/i;for(var s=0;s<n.length;s++){if((!document.body.querySelectorAll||e.IsIE())&&!i.test(n[s].tagName.toLowerCase()))continue;var o=!n[s].disabled,u=n[s].style.visibility!=="hidden",a=n[s].type!="hidden"&&n[s].tabIndex!=-1,f=n[s].tagName.toLowerCase()=="textarea"&&n[s].tabIndex!=-1,l=a||f;o&&u&&l&&(t[r++]=n[s])}for(var s=0;s<t.length-1;s++)for(var c=s+1;c<t.length;c++)if(t[c].tabIndex<t[s].tabIndex){var h=t[s];t[s]=t[c],t[c]=h}return t},e.GetNextFocusableControl=function(e,t,n){typeof e=="string"&&(e=document.getElementById(e));var r=0;for(var i=0;i<t.length;i++)if(e===t[i]){n?r=(i+1)%t.length:r=(i-1+t.length)%t.length;break}return t[r]},e.MoveFocus=function(t,n){var r=e.GetElements(),i=e.GetNextFocusableControl(t,r,n);return e.SetElementFocus(i),i},e.IsPad=function(){var t=e.IPad||e.GetClientOS().toLowerCase()=="android";return t},e.IsIE=function(){return e.ie!==undefined},e.IsFireFox4OrLater=function(){return e.firefox!=null&&parseFloat(e.firefox)>=4},e.IsIE11OrLater=function(){return e.IsIE()&&e.engine>=11},e.IsIE10OrLater=function(){return e.IsIE()&&e.engine>=10},e.IsIE9OrLater=function(){return e.IsIE()&&e.engine>=9},e.IsIE8OrLater=function(){return e.IsIE()&&e.engine>=8},e.IsIE8OrBelow=function(){return e.IsIE()&&e.engine<=8},e.IsIE8=function(){return e.IsIE()&&e.engine==8},e.IsIE7=function(){return e.IsIE()&&e.engine==7},e.IsIE7OrLater=function(){return e.IsIE()&&e.engine>=7},e.IsIE9=function(){return e.IsIE()&&e.engine==9},e}();n.CoreUtility=l,l.GetBrowserType()})(t.input||(t.input={}));var n=t.input})(wijmo||(wijmo={}))});