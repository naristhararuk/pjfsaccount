var wijmo;define(["globalize","./wijmo.wijutil","./wijmo.widget","./wijmo.wijsuperpanel"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijlist",s="wijmo-wijlist-item",o=s+"-alternate",u=s+"-selected",a=s+"-first",f=s+"-last",l="wijmo-wijlistitem-active",c="item.wijlist",h=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype.removeAll=function(){var e=this;e.items=[],e._refresh()},i.prototype.addItem=function(e,t){var n=this;n._checkData(),t===null||t===undefined?n.items.push(e):n.items&&n.items.splice(t,0,e),n._refresh(),n._trigger("added",null,{item:e,index:t})},i.prototype.removeItem=function(e){var t=this,n;t._checkData(),n=t.indexOf(e),n>=0&&t.removeItemAt(n)},i.prototype.indexOf=function(e){var t=this,n=-1,r=0,i;t._checkData();for(r=0;r<t.items.length;r++){i=t.items[r];if(i.label===e.label&&i.value===e.value){n=r;break}}return n},i.prototype.findIndexByLabel=function(e){var t=this,n=-1,r=0,i;if(e===null||e===undefined)return n;t._checkData();for(r=0;r<t.items.length;r++){i=t.items[r];if(i.label===e){n=r;break}}return n},i.prototype.removeItemAt=function(e){var t=this;t._checkData(),t.items.splice(e,1),t._refresh()},i.prototype._checkData=function(){var e=this;e.items||(e.items=[])},i.prototype._refresh=function(){var e=this;e.renderList(),e.refreshSuperPanel()},i.prototype._setOption=function(e,t){var i=this,s=this.options,o,u,a,f;n.prototype._setOption.call(this,e,t);if(e==="selectionMode")f=i.selectedItem,f&&(f.selected=!1,f.element&&i._removeActiveClasses(f.element),i.selectedItem=undefined),i.selectedItems&&r.each(i.selectedItems,function(e,t){t.selected=!1,i._removeActiveClasses(t.element)}),i.selectedItems=[],t==="single"?s.selectedIndex=-1:s.selectedIndex=[];else if(e==="selectedIndex")i._initInvalidateSelectIndex(),i._setSelectedIndex();else if(e==="listItems")u=i._isBind(),u?(a=i._getRenderItems(),i.setItems(a)):i.setItems(t),i.renderList(),i.refreshSuperPanel();else if(e==="dataSource")u=i._isBind(),u&&(a=i._getRenderItems(),i.setItems(a),i.renderList(),i.refreshSuperPanel());else if(e==="autoSize"||e==="maxItemsCount")!s.autoSize&&i.element.is(":visible")&&(i._oriHeight!==0?i.element.height(i._oriHeight):(o=i.ul.outerHeight(),i.element.height(o),r(".wijmo-wijsuperpanel-statecontainer",i.element).height(o),r(".wijmo-wijsuperpanel-contentwrapper",i.element).height(o))),i.refreshSuperPanel()},i.prototype._innerDisable=function(){n.prototype._innerDisable.call(this),this._handleDisabledOption(!0,this.element)},i.prototype._innerEnable=function(){n.prototype._innerEnable.call(this),this._handleDisabledOption(!1,this.element)},i.prototype._initInvalidateSelectIndex=function(){var e=this.options,t=e.selectedIndex,n=this.items,i=[];e.selectionMode==="single"?(r.isArray(t)&&t.length&&(t=t[0]),n[t]||(t=-1)):(r.isArray(t)||(t=[t]),r.each(t,function(e,t){n[t]&&i.push(t)}),t=i),e.selectedIndex=t},i.prototype._setSelectedIndex=function(){var e=this.options,t=e.selectedIndex,n=this.items,i=this.selectedItem,s=this.selectedItems,o=e.selectionMode,u=-1,a=!0,f=!0;o==="single"?(i&&(u=r.inArray(i,n)),u===-1&&(a=!1),t===-1&&(f=!1)):(s&&s.length&&(u=[],r.each(s,function(e,t){u.push(r.inArray(t,n))})),u.length===0&&(a=!1),t.length===0&&(f=!1)),a&&this.unselectItems(u),f&&this.selectItems(t,!1,!0)},i.prototype._create=function(){var e=this,t=this.element,i=this.options,s=i.wijCSS,o=s.widget+" "+s.content+" "+s.cornerAll+" wijmo-wijlist",u;window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r)),e._oriHeight=parseInt(t.css("height"),10),t.addClass(o).attr({role:"listbox","aria-activedescendant":l,"aria-multiselectable":i.selectionMode==="multiple"}).bind("click."+e.widgetName,e,e._onListClick).bind("mousedown."+e.widgetName,e,e._onListMouseDown),t.is("div")&&t.children().is("ul")&&(e._isInnerData=!0,e._templates=[],r.each(r("ul > li",t),function(t,n){e._templates.push({templateHtml:n.innerHTML})}),e._oriChildren=t.children().hide()),e.ul=r("<ul class='"+s.listul+"'></ul>").appendTo(t),i.listItems!==null&&(u=e._getRenderItems(),u&&(e.setItems(u),e.renderList(),e.refreshSuperPanel())),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.refreshSuperPanel(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijlist"),n.prototype._create.call(this)},i.prototype._isBind=function(){var e=this.options,t=e.listItems;return t!==null&&t.label&&t.label.bind?!0:!1},i.prototype._getRenderItems=function(){var e=this.options,t=e.listItems;return t!==null?r.isArray(t)&&t.length>0&&typeof t[0].label=="string"?t:t.label&&t.label.bind?this._getMappingItems():null:null},i.prototype._getMappingItems=function(){var e=this.options,t=e.dataSource,n=e.listItems,i,s,o;return!t||!n?null:!n.label||!n.label.bind||!n.value||!n.value.bind?null:(s=n.label.bind,o=n.value.bind,t&&t.length!==0?(i=[],r.each(t,function(e,t){i.push({label:t[s],value:t[o]})}),i):null)},i.prototype._handleDisabledOption=function(e,t){var n=this;e?(n.disabledDiv||(n.disabledDiv=n._createDisabledDiv(t)),n.disabledDiv.appendTo("body")):n.disabledDiv&&(n.disabledDiv.remove(),n.disabledDiv=null)},i.prototype._createDisabledDiv=function(e){var t=this,n=e||t.element,i=n.offset(),s=n.outerWidth(),o=n.outerHeight();return r("<div></div>").addClass(t.options.wijCSS.stateDisabled).css({"z-index":"99999",position:"absolute",width:s,height:o,left:i.left,top:i.top,"pointer-events":"auto"})},i.prototype.setTemplateItems=function(e){this._setItemsByExtend(e,!0)},i.prototype.setItems=function(e){this._setItemsByExtend(e,!1)},i.prototype._setItemsByExtend=function(e,n){var i=this,s,o=[];e&&r.each(e,function(e,t){o[e]=r.extend(!0,{label:"",value:""},t)});if(n){if(i._templates&&o&&o.length!==i._templates.length)return;i.items=o,i.items||(i.items=[]),r.each(i._templates,function(e){i.items[e]?i.items[e].templateEncoded||(i.items[e].templateHtml=t.htmlEncode(i._templates[e].templateHtml),i.items[e].templateEncoded=!0):i.items.push({templateHtml:t.htmlEncode(i._templates[e].templateHtml),templateEncoded:!0,label:o[e].label,value:o[e].value})})}else i.items=o;if(!o)return null;i._initSelectedIndex(),s=r.grep(o,function(e){return e.selected},undefined),i.options.selectionMode==="single"?(i.selectedItems=[],i.selectedItem=s.length>0?s[0]:undefined):i.selectedItems=s},i.prototype._initSelectedIndex=function(){function s(e){r.each(e,function(e,t){t.selected&&(t.selected=!1)})}var e=this.items,t=this.options,n=t.selectionMode,i;this._initInvalidateSelectIndex(),i=t.selectedIndex,n==="single"?i!==-1&&(s(e),e[i].selected=!0):i.length>0&&(s(e),r.each(i,function(t,n){e[n].selected=!0}))},i.prototype._removeActiveClasses=function(e){var t=u+" "+this.options.wijCSS.stateActive;e.removeClass(t+" wijmo-wijcombobox-selecteditem")},i.prototype.filterItems=function(e,n,i,o){var a=this,f=a._escapeRegex(e),l,c=u+" "+a.options.wijCSS.stateActive,h=a.options.wijCSS.priorityPrimary,p="highlight-filter",d,v="",m=!1,g=null;if(!this.items)return null;r("li[wijhidden]."+s,a.element)&&r("li[wijhidden]."+s,a.element).length>0&&(m=!0),r("span."+p,a.element)&&r("span."+p,a.element).length>0&&(m=!0);if(!m&&(!e||e.length===0)){r.each(this.items,function(e,t){t.selected?(a.activate(null,t,!1),t.element&&t.element.addClass(c),a.selectedItem=t):a._removeActiveClasses(t.element)});return}return l=new RegExp(f,"i"),r.each(this.items,function(e,s){d=s.label,s.templateHtml?s.templateEncoded?d=t.htmlDecode(s.templateHtml):d=s.templateHtml:s.text!==undefined&&(d=s.text),r("span."+p,s.element).length>0&&s.element.empty().append(d);var o=l.exec(s.label);o===null&&n?s.element&&(s.element.hide(),s.element.attr("wijhidden","wijhidden")):(s.selected?(a.activate(null,s,!1),s.element&&s.element.addClass(c),a.selectedItem=s):a._removeActiveClasses(s.element),i&&(v=d.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+f+")(?![^<>]*>)(?![^&;]+;)","gi"),"<span class='"+h+" "+p+"'>$1</span>"),s.element&&s.element.html(v)),s.element&&!s.element.is(":visible")&&(s.element.show(),s.element.removeAttr("wijhidden")),f!==undefined&&f.length!==0&&g===null&&o&&o.index===0&&(g=s))}),g},i.prototype.popItem=function(){var e=this;e._checkData(),e.items.pop(),e._refresh()},i.prototype.getList=function(){return this.ul},i.prototype.getSelectedItems=function(){return this.options.selectionMode==="single"?this.selectedItem||null:this.selectedItems},i.prototype._onListClick=function(e){var t=e.data;if(t._isDisabled())return;if(!r(e.target).closest("."+s).length)return;t.select(e)},i.prototype._onListMouseDown=function(e){var t=e.data,n;if(t._isDisabled())return;if(!r(e.target).closest("."+s).length)return;t.active&&t.active.element&&(n=t.active.element.data(c)),t._trigger("mouseDown",e,{item:n})},i.prototype.destroy=function(){var e=this,t=this.element,r=this.options,i=r.wijCSS,s=i.widget+" "+i.content+" "+i.cornerAll+" wijmo-wijlist";e.superPanel!==undefined&&e.superPanel.destroy(),t.removeClass("wijmo-wijobserver-visibility").removeClass(s).removeAttr("role").removeAttr("aria-activedescendant").unbind("."+e.widgetName),e.ul.remove(),e.disabledDiv&&(e.disabledDiv.remove(),e.disabledDiv=null),e._isInnerData&&e._oriChildren.show(),n.prototype.destroy.call(this)},i.prototype.activate=function(e,t,n){var r=this,i,s;r.deactivate();if(t===null||t===undefined)return;if(r._trigger("focusing",e,t)===!1)return;i=r.active=t,s=i&&i.element,s&&(r.options.addHoverItemClass&&s.addClass(r.options.wijCSS.stateHover),s.attr("id",l)),n&&r.superPanel!==undefined&&r.superPanel.scrollChildIntoView(s),r.element.is(":visible")&&r._trigger("focus",e,t)},i.prototype.deactivate=function(){var e=this,t=e.active,n;if(!t)return;n=t.element,e._trigger("blur",null,t),n&&n.removeClass(e.options.wijCSS.stateHover).removeAttr("id"),e.active=undefined},i.prototype.next=function(e){this.move("next","."+s+":first",e)},i.prototype.nextPage=function(){this.superPanel.doScrolling("bottom",!0)},i.prototype.previous=function(e){this.move("prev","."+s+":last",e)},i.prototype.previousPage=function(){this.superPanel.doScrolling("top",!0)},i.prototype.first=function(){return this.active&&this.active.element.is(":visible")&&!this.active.element.prevAll(":visible").length},i.prototype.last=function(){return this.active&&this.active.element.is(":visible")&&!this.active.element.nextAll(":visible").length},i.prototype.move=function(e,t,n){var r=this,i,o;if(!r.active||!r.active.element.is(":visible")){i=r.ul.children(":visible"+t).data(c),r.activate(n,i,!0);return}o=r.active.element[e+"All"](":visible."+s).eq(0),o.length?r.activate(n,o.data(c),!0):r.activate(n,r.element.children(t).data(c),!0)},i.prototype.select=function(e,t){var n=this,i,o,a=n.options,f=u+" "+n.options.wijCSS.stateActive,l,h,p;if(!n.active){if(!e)return;n.active=r(r(e.target).closest("."+s)).data(c);if(!n.active)return}i=n.active.element;if(i===undefined||i.attr("wijhidden"))return;l=i.data(c);if(!l)return;h=n.options.selectionMode==="single",h?(p=n.selectedItem,i.addClass(f).attr("aria-selected","true"),l.selected=!0,p!==undefined&&l!==p&&(p.selected=!1,p.element&&(n._removeActiveClasses(p.element),p.element.removeAttr("aria-selected"))),n.selectedItem=l,o=r.inArray(l,n.items),n._trigger("selected",e,{item:l,previousItem:p,selectedIndex:o,data:t})):(l.selected=!l.selected,l.selected?i.addClass(f).attr("aria-selected","true"):(n._removeActiveClasses(i),i.removeAttr("aria-selected","true"),r.support.isTouchEnabled&&r.support.isTouchEnabled()&&i.removeClass(a.wijCSS.stateHover)),o=[],n.selectedItems=r.grep(n.items,function(e,t){return e.selected&&o.push(t),e.selected===!0},undefined),n._trigger("selected",e,{selectedIndex:o,item:l,selectedItems:n.selectedItems}))},i.prototype._findItemsByValues=function(e){var t,n=[];return n=r.grep(this.items,function(n,r){t=!1;for(var i=0;i<e.length;i++)n.value===e[i]&&(t=!0);return t},undefined),n},i.prototype._findItemsByIndices=function(e){var t=this,n=this.items.length,i=[];return r.each(e,function(e,r){r>=0&&r<n&&i.push(t.items[r])}),i},i.prototype.getItems=function(e,t){var n=this,i,s,o,u;s=r.isArray(e),i=!s&&typeof e=="number"||s&&typeof e[0]=="number",o=s?e:[e];if(!t)u=n._findItemsByValues(o);else{if(!i)return[];u=n._findItemsByIndices(o)}return u},i.prototype.selectItems=function(e,t,n){var i=this,s=this.options.selectionMode==="single",o=u+" "+i.options.wijCSS.stateActive,a,f,l;l=i.getItems(e,n),s?(l.length>0&&(a=l[0],a.selected=!0,a.element.addClass(o)),f=i.selectedItem,f&&(f.selected=!1,i._removeActiveClasses(f.element)),i.selectedItem=a,t&&i._trigger("selected",null,{item:a,previousItem:f})):(r.each(l,function(e,t){t.selected=!0,t.element.addClass(o)}),i.selectedItems=r.grep(i.items,function(e){return e.selected},undefined),t&&i._trigger("selected",null,{selectedItems:i.selectedItems}))},i.prototype.unselectItems=function(e){var t=this,n=this.options.selectionMode,i,s;if(n==="single")i=t.selectedItem,i&&(i.selected=!1,t._removeActiveClasses(i.element),t.selectedItem=undefined);else{s=t.getItems(e,!0);if(!s||s.length===0)return;r.each(s,function(e,n){n.selected=!1,t._removeActiveClasses(n.element)}),t.selectedItems=r.grep(t.items,function(e){return e.selected},undefined)}},i.prototype.renderList=function(){var e=this,t=this.ul,n=this.options,r,i,s,o,u;t.empty(),r=e.items;if(r===undefined||r===null)return;i=r.length;if(i===0)return;s=n.selectionMode==="single";for(o=0;o<i;o++)u=r[o],e._renderItem(t,u,o,s);i>0&&(r[0].element&&r[0].element.addClass(a),r[i-1].element&&r[i-1].element.addClass(f)),e._trigger("listRendered",null,e)},i.prototype._renderItem=function(e,n,i,s){var a=this,f=r("<li role='option' class='"+a.options.wijCSS.listItem+" "+a.options.wijCSS.cornerAll+"'></li>"),l=u+" "+a.options.wijCSS.stateActive,h,p;n.element=f,n.list=a;if(a._trigger("itemRendering",null,n)===!1)return;return h=n.label,n.title&&f.attr("title",n.title),n.templateHtml?n.templateEncoded?h=t.htmlDecode(n.templateHtml):h=n.templateHtml:n.text!==undefined&&(h=n.text),f.bind("mouseover",function(e){if(a._isDisabled())return;a.activate(e,n,!1)}).bind("mouseout",function(){if(a._isDisabled())return;a.options.keepHightlightOnMouseLeave||a.deactivate()}).data(c,n),n.templateHtml?f.append(h):f.text(h),f.appendTo(e),a._isInnerData||(p=n.imageUrl,p!==undefined&&p.length>0&&f.prepend("<img src='"+n.imageUrl+"'>")),n.selected&&(a.activate(null,n,!1),f.addClass(l)),i%2===1&&f.addClass(o),a._trigger("itemRendered",null,n),f},i.prototype._escapeRegex=function(e){return e===undefined?e:e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},i.prototype.adjustOptions=function(){var e=this.options,t;if(e.data!==null)for(t=0;t<e.listItems.length;t++)delete e.listItems[t].element,delete e.listItems[t].list;return e},i.prototype.refreshSuperPanel=function(){var e=this,t=this.element,n=this.options,i=this.ul,o=i.children("."+s+":first"),u,a,f,l=t.find(".wijmo-wijsuperpanel-header"),c=t.find(".wijmo-wijsuperpanel-footer"),h=null,p,d,v,m,g,y,b,w,E=e.superPanel||t.data("wijmo-wijsuperpanel");if(!t.is(":visible"))return!1;a=i.outerHeight(),f=t.innerWidth(),n.autoSize&&(h=o.outerHeight(!0)*n.maxItemsCount),h!==null&&t.height(Math.min(h,a));if(!(e.items&&e.items.length>0)&&!E)return;p=t.innerHeight(),l.length&&(p-=l.height()),c.length&&(p-=c.height()),v=a-p,d=p/v,y=101*d/(1+d),m=o.outerHeight()/v*(101-y),e.superPanel===undefined?(b={allowResize:!1,keyboardSupport:!1,bubbleScrollingEvent:!0,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollSmallChange:m,scrollLargeChange:y}},r.extend(b,n.superPanelOptions),e.superPanel=t.wijsuperpanel(b).data("wijmo-wijsuperpanel"),e.superPanel&&e.superPanel.vNeedScrollBar&&(i.setOutWidth(f-18),e.superPanel.refresh())):(g=e.superPanel.options.vScroller,g.scrollLargeChange=y,g.scrollSmallChange=m,e.superPanel.paintPanel(),e.superPanel.vNeedScrollBar||r.support.isTouchEnabled&&r.support.isTouchEnabled()?(i.setOutWidth(f-18),e.superPanel.refresh()):(i.setOutWidth(t.outerWidth()),u=t.children(".wijmo-wijsuperpanel-header").outerHeight(),u!==null&&u!==undefined&&t.height(a+u),e.superPanel.refresh())),w=i.css("padding-top"),w.length>0?(g=e.superPanel.options.vScroller,g.firstStepChangeFix=e.superPanel.scrollPxToValue(parseFloat(w),"v")):g.firstStepChangeFix=0,i.setOutWidth(i.parent().parent().innerWidth()),e._isDisabled()&&e.disabledDiv&&e.disabledDiv.css("left",t.offset().left).css("top",t.offset().top).css("width",t.outerWidth()).css("height",t.outerHeight())},i}(t.wijmoWidget);n.wijlist=h;var p=function(){function e(){this.wijCSS={listul:"wijmo-wijlist-ul",listItem:"wijmo-wijlist-item"},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-b",stateDefault:"ui-btn ui-btn-b",stateHover:"ui-btn-up-b",stateActive:"ui-btn-down-b"},this.initSelector=":jqmData(role='wijlist')",this.dataSource=null,this.listItems=[],this.selected=null,this.selectionMode="single",this.selectedIndex=-1,this.autoSize=!1,this.maxItemsCount=5,this.addHoverItemClass=!0,this.superPanelOptions=null,this.disabled=!1,this.focusing=null,this.focus=null,this.blur=null,this.itemRendering=null,this.itemRendered=null,this.listRendered=null,this.added=null,this.keepHightlightOnMouseLeave=!1}return e}();h.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new p),r.wijmo.registerWidget("wijlist",h.prototype)})(t.list||(t.list={}));var n=t.list})(wijmo||(wijmo={}))});