var wijmo;define(["./wijmo.raphael","./wijmo.widget","jquery","./wijmo.wijslider"],function(){(function(e){(function(e){var t=function(){function t(){}return t.getBounds=function(t){if(!t||t.length===0)return null;var n=Number.MAX_VALUE,r=n,i=-Number.MAX_VALUE,s=i;return $.each(t,function(e,t){t.x<n&&(n=t.x),t.x>i&&(i=t.x),t.y<r&&(r=t.y),t.y>s&&(s=t.y)}),new e.Rectangle(new e.Point(n,r),new e.Size(i-n,s-r))},t.getListBounds=function(e){var n,r;return $.each(e,function(e,i){r=t.getBounds(i),r&&(n=r.union(n))}),n},t.getPoints=function(t){if(!t)return null;var n=[],r=t.length;r-=r%2;for(var i=0;i<r;i++){var s=new e.Point(t[i],t[++i]);n.push(s)}return n},t.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2},t.createListPath=function(e,n){var r="",i;return $.each(e,function(e,n){i=t.createPath(n),i&&(r+=i)}),r},t.createPath=function(e,t){if(!e)return null;var n=e.length,r,i=null,s;if(n>0){s=e[0],i="M"+s.x+" "+s.y;for(var o=1;o<n;o++)r=e[o],i+="L"+r.x+" "+r.y;t&&(i+="Z")}return i},t.getPointData=function(t){var n=null;return t&&t.length>0&&(n=new e.Point(t[0],t[1])),n},t.getLineData=function(e){var n=null;return e&&e.length>0&&(n=[],$.each(e,function(e,r){n.push(t.getPointData(r))})),n},t.getPolygonData=function(e){var n=null;return e&&e.length>0&&(n=[],$.each(e,function(e,r){n.push(t.getLineData(r))})),n},t}();e.Utils=t})(e.maps||(e.maps={}));var t=e.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(t){var n=function(){function e(e,t){var n=this;if(typeof e=="number")n.x=e,n.y=t;else{var r=e;n.x=r.x,n.y=r.y}}return e.prototype.offset=function(t,n){return new e(this.x+t,this.y+n)},e.prototype.scale=function(t,n){return new e(this.x*t,this.y*n)},e.empty=new e(0,0),e}();t.Point=n;var r=function(){function e(e,t){var n=this;if(typeof e=="number")n.width=e,n.height=t;else{var r=e;n.width=r.width,n.height=r.height}}return e.prototype.scale=function(t,n){return new e(this.width*t,this.height*n)},e.empty=new e(0,0),e}();t.Size=r;var i=function(){function e(e,t){this.location=e,this.size=t}return e.prototype.intersect=function(t){var i=this,s=Math.max(i.location.x,t.location.x),o=Math.min(i.location.x+i.size.width,t.location.x+t.size.width),u=Math.max(i.location.y,t.location.y),a=Math.min(i.location.y+i.size.height,t.location.y+t.size.height);return o>=s&&a>=u?new e(new n(s,u),new r(o-s,a-u)):null},e.prototype.isEmpty=function(){var e=this;return e.size.width===0&&e.size.height===0&&e.location.x===0&&e.location.y===0},e.prototype.getRight=function(){return this.location.x+this.size.width},e.prototype.getBottom=function(){return this.location.y+this.size.height},e.prototype.intersectsWith=function(e){if(!e)return!1;var t=this;return t.location.x<=e.location.x+e.size.width&&t.location.x+t.size.width>=e.location.x&&t.location.y<=e.location.y+e.size.height&&t.location.y+t.size.height>=e.location.y},e.prototype.union=function(t){var i=this;if(!t)return $.extend(!0,{},i);var s=Math.min(i.location.x,t.location.x),o=Math.min(i.location.y,t.location.y),u=Math.max(i.location.x+i.size.width,t.location.x+t.size.width),a=Math.max(i.location.y+i.size.height,t.location.y+t.size.height);return new e(new n(s,o),new r(u-s,a-o))},e.empty=new e(n.empty,r.empty),e}();t.Rectangle=i;var s=function(){function e(){this.fill="transparent",this.fillOpacity=1,this.stroke="#000",this.strokeOpacity=1,this.strokeWidth=1,this.strokeDashArray="",this.strokeLineCap=0,this.strokeLineJoin=0,this.strokeMiterLimit=1}return e.prototype.createElement=function(e){return null},e.prototype._setElementAttributes=function(e){var t=this;e&&(e.attr({fill:t.fill,"fill-opacity":t.fillOpacity,stroke:t.stroke,"stroke-opacity":t.strokeOpacity,"stroke-width":t.strokeWidth,"stroke-dasharray":t.strokeDashArray,"stroke-linecap":l[t.strokeLineCap]||l[0],"stroke-linejoin":c[t.strokeLineJoin]||c[0],"stroke-miterlimit":t.strokeMiterLimit}),t.fill==="transparent"&&e.attr("fill","white").attr("fill-opacity","0"))},e}();t.Shape=s;var o=function(n){function r(){n.apply(this,arguments)}return e(r,n),r.prototype.createElement=function(e){e.setStart();var n=this,r=t.Utils.createPath(n.points,!1),i;return r&&e.path(r),i=e.setFinish(),n._setElementAttributes(i),i},r}(s);t.Polyline=o;var u=function(n){function r(){n.apply(this,arguments)}return e(r,n),r.prototype.createElement=function(e){e.setStart();var n=this,r,i;return n.points&&$.each(n.points,function(n,i){r=t.Utils.createPath(i,!1),r&&e.path(r)}),i=e.setFinish(),n._setElementAttributes(i),i},r}(s);t.MultiPolyline=u;var a=function(n){function r(){n.apply(this,arguments),this.fillRule=0,this.pointsList=[]}return e(r,n),r.prototype.createElement=function(e){e.setStart();var n=this,r=t.Utils.createListPath(n.pointsList,!0),i;return r&&e.path(r),i=e.setFinish(),n._setElementAttributes(i),i},r}(s);t.Polygon=a,function(e){e[e.evenOdd=0]="evenOdd",e[e.nonezero=1]="nonezero"}(t.FillRule||(t.FillRule={}));var f=t.FillRule;(function(e){e[e.butt=0]="butt",e[e.square=1]="square",e[e.round=2]="round"})(t.PenLineCap||(t.PenLineCap={}));var l=t.PenLineCap;(function(e){e[e.bevel=0]="bevel",e[e.round=1]="round",e[e.miter=2]="miter"})(t.PenLineJoin||(t.PenLineJoin={}));var c=t.PenLineJoin})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={})),function(e){(function(e){var t=function(){function t(){}return t.createClippedLines=function(e,n){var r=[],i=e.length;for(var s=1;s<i;s++){var o=t._clipSegmentCS(n,[e[s-1],e[s]]);o&&r.push(o)}return r},t._clipSegmentCS=function(e,n){var r=!1,i=n[0],s=n[1],o=t._csCode(e,i),u=t._csCode(e,s),a=s.x-i.x,f=s.y-i.y,l=0,c=0;if(a!==0)c=f/a;else if(f===0)return o===0&&u===0?[i,s]:null;f!==0&&(l=a/f);var h=4,p,d;do{if((o&u)>0)break;if(o===0&&u===0){r=!0;break}o===0&&(p=o,o=u,u=p,d=i.x,i.x=s.x,s.x=d,d=i.y,i.y=s.y,s.y=d);if((o&1)>0){var v=e.location.x;i.y+=c*(v-i.x),i.x=v}else if((o&2)>0){var m=e.location.x+e.size.width;i.y+=c*(m-i.x),i.x=m}else if((o&4)>0){var g=e.location.y+e.size.height;i.x+=l*(g-i.y),i.y=g}else if((o&8)>0){var y=e.location.y;i.x+=l*(y-i.y),i.y=y}o=t._csCode(e,i)}while(--h>=0);return r?[i,s]:null},t.clipPolygon=function(n,r){var i=n.length;if(i<2)return null;var s=[];for(var o=0;o<i;o++)s.push(n[o]);var u=r.location.x,a=r.location.y,f=u+r.size.width,l=a+r.size.height;return s=t._clipPolygonByLine(s,new e.Point(u,a),new e.Point(f,a)),s=t._clipPolygonByLine(s,new e.Point(f,a),new e.Point(f,l)),s=t._clipPolygonByLine(s,new e.Point(f,l),new e.Point(u,l)),s=t._clipPolygonByLine(s,new e.Point(u,l),new e.Point(u,a)),s},t.clipPolygonList=function(e,n){var r=[];return $.each(e,function(e,i){r.push(t.clipPolygon(i,n))}),r},t._clipPolygonByLine=function(e,t,n){var r=[],i=e.length;if(i>0){var s=e[i-1];for(var o=0;o<i;o++){var u=e[o];this._inside(u,t,n)?this._inside(s,t,n)?r.push(u):(r.push(this._intersect(s,u,t,n)),r.push(u)):this._inside(s,t,n)&&r.push(this._intersect(s,u,t,n)),s=u}}return r},t._inside=function(e,t,n){return n.x>t.x&&e.y>=t.y?!0:n.x<t.x&&e.y<=t.y?!0:n.y>t.y&&e.x<=n.x?!0:n.y<t.y&&e.x>=n.x?!0:!1},t._intersect=function(t,n,r,i){var s=new e.Point(0,0);return r.y===i.y?(s.y=r.y,s.x=t.x+(r.y-t.y)*(n.x-t.x)/(n.y-t.y)):(s.x=r.x,s.y=t.y+(r.x-t.x)*(n.y-t.y)/(n.x-t.x)),s},t._csCode=function(e,t){var n=0,r=e.location.x,i=e.location.y,s=r+e.size.width,o=i+e.size.height;return t.x<r?++n:t.x>s&&(n+=2),t.y>o?n+=4:t.y<i&&(n+=8),n},t}();e.ClippingEngine=t})(e.maps||(e.maps={}));var t=e.maps}(wijmo||(wijmo={})),function(e){(function(e){var t=function(){function t(){}return t.prototype.project=function(t){return new e.Point((t.x+180)/360,(1-Math.log(Math.tan(t.y*Math.PI/180)+1/Math.cos(t.y*Math.PI/180))/Math.PI)/2)},t.prototype.unproject=function(t){var n=Math.PI-2*Math.PI*t.y;return new e.Point(t.x*360-180,180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n))))},t}();e.MercatorProjection=t})(e.maps||(e.maps={}));var t=e.maps}(wijmo||(wijmo={})),function(e){(function(e){var t=function(){function t(t,n,r,i,s){this.element=t,this.center=n,this.zoom=r,this.tileWidth=i,this.tileHeight=s;var o=this,u,a;o._updateSize(),o._projection=new e.MercatorProjection,u=o.logicToGeographic(new e.Point(0,0)),a=o.logicToGeographic(new e.Point(1,1)),o.minLongitude=u.x,o.maxLongitude=a.x,o.minLatitude=a.y,o.maxLatitude=u.y}return t.prototype._updateSize=function(){var t=this,n=t.element;t._size=new e.Size(n.width(),n.height())},t.prototype.viewToGeographic=function(e){var t=this;return t.logicToGeographic(t.viewToLogic(e))},t.prototype.geographicToView=function(e){var t=this;return t.logicToView(t.geographicToLogic(e))},t.prototype.viewToLogic=function(t){var n=this,r=n.getViewCenter(),i=n.getLogicCenter(),s=n.getFullMapSize(),o=(new e.Size(t.x-r.x,t.y-r.y)).scale(1/s.width,1/s.height);return n._rangeLogicPoint((new e.Point(i)).offset(o.width,o.height))},t.prototype.logicToView=function(t){var n=this,r=n._rangeLogicPoint(t),i=n.getViewCenter(),s=n.getLogicCenter(),o=n.getFullMapSize(),u=(new e.Size(r.x-s.x,r.y-s.y)).scale(o.width,o.height);return(new e.Point(i)).offset(u.width,u.height)},t.prototype.geographicToLogic=function(e){var t=this;return t._rangeLogicPoint(t._projection.project(e))},t.prototype.logicToGeographic=function(e){var t=this,n=t._rangeLogicPoint(e);return t._projection.unproject(n)},t.prototype.getViewSize=function(){return this._size},t.prototype.getLogicSize=function(){var t=this,n=t.getViewSize(),r=t.getFullMapSize();return(new e.Size(n)).scale(1/r.width,1/r.height)},t.prototype.getViewCenter=function(){var t=this,n=t._size;return(new e.Point(n.width,n.height)).scale(.5,.5)},t.prototype.getLogicCenter=function(){var e=this;return e.geographicToLogic(e.center)},t.prototype.getFullMapSize=function(){var t=this;return(new e.Size(t.tileWidth,t.tileHeight)).scale(Math.pow(2,t.zoom),Math.pow(2,t.zoom))},t.prototype.distance=function(e,t){var n=6371e3,r=(t.y-e.y)*(Math.PI/180),i=(t.x-e.x)*(Math.PI/180),s=Math.sin(r*.5)*Math.sin(r*.5)+Math.cos(e.y*(Math.PI/180))*Math.cos(t.y*(Math.PI/180))*Math.sin(i*.5)*Math.sin(i*.5),o=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return n*o},t.prototype._rangeLogicPoint=function(e){var t=0,n=.9999999999;return e.x<t&&(e.x=t),e.y<t&&(e.y=t),e.x>n&&(e.x=n),e.y>n&&(e.y=n),e},t}();e.CoordConverter=t})(e.maps||(e.maps={}));var t=e.maps}(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery;n.cultureMapping={en:"en-US",zh:"zh-Hans",ja:"ja-JP"};var i=function(){function e(){this.tileWidth=256,this.tileHeight=256,this.minZoom=1,this.maxZoom=19,this._uriFormat="",this._subdomains=["0","1","2","3","4","5","6","7"]}return e.prototype.getUrl=function(e,t,n){var r=this,i=r._subdomains[(n*Math.pow(2,e)+t)%r._subdomains.length];return r._uriFormat.replace("{subdomain}",i).replace("{quadkey}",r._getQuadkey(e,t,n)).replace("{culture}",r._getCulture())},e.prototype._getQuadkey=function(e,t,n){var r="",i=[0,2,1,3];for(var s=e;s>0;--s)r+=i[t>>s-1<<1&2|n>>s-1&1];return r},e.prototype._getCulture=function(){var e=r("body").attr("lang"),n=r("html").attr("lang"),i=e||n||"en";return t.maps.cultureMapping[i]||"en-US"},e}(),s=function(t){function n(){t.apply(this,arguments),this._uriFormat="http://ecn.t{subdomain}.tiles.virtualearth.net/tiles/r{quadkey}.jpeg?g=2889&mkt={culture}&shading=hill"}return e(n,t),n}(i),o=function(t){function n(){t.apply(this,arguments),this._uriFormat="http://ecn.t{subdomain}.tiles.virtualearth.net/tiles/a{quadkey}.jpeg?g=2889&mkt={culture}&shading=hill"}return e(n,t),n}(i),u=function(t){function n(){t.apply(this,arguments),this._uriFormat="http://ecn.t{subdomain}.tiles.virtualearth.net/tiles/h{quadkey}.jpeg?g=2889&mkt={culture}&shading=hill"}return e(n,t),n}(i),a=function(){function e(){}return e.bingMapsRoadSource=new s,e.bingMapsAerialSource=new o,e.bingMapsHybridSource=new u,e}();n.MapSource=a})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery;(function(e){e[e.vector=0]="vector",e[e.items=1]="items",e[e.virtual=2]="virtual",e[e.custom=3]="custom"})(n.LayerType||(n.LayerType={}));var i=n.LayerType,s=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._create=function(){t.prototype._create.call(this);var e=this;e._updating=!1,e._needUpdate=!1},n.prototype._createPaper=function(e,t){var n,i=Raphael(e,1,1);return r(i.canvas).css("overflow","visible"),this._resizePaper(i,t),i},n.prototype._resizePaper=function(e,t){Raphael.svg?r(e.canvas).css("width",t.width+"px").css("height",t.height+"px"):r(e.canvas).css("clip","rect(0px,"+t.width+"px,"+t.height+"px,0px)")},n.prototype._setOption=function(e,n){var r=this,i=this.options;if(i[e]!==n)switch(e){case"center":r._setCenter(n);return;case"zoom":r._setZoom(n);return}t.prototype._setOption.call(this,e,n)},n.prototype._setCenter=function(e){var t=this,n=t.options;if(n.center.x!==e.x||n.center.y!==e.y)n.center=e,t.update()},n.prototype._setZoom=function(e){var t=this,n=t.options;n.zoom!==e&&(n.zoom=e,t.update())},n.prototype._render=function(){},n.prototype.update=function(){var e=this,t=e.options;if(e._updating){e._needUpdate=!0;return}e._render()},n.prototype.beginUpdate=function(){this._updating=!0},n.prototype.endUpdate=function(){var e=this;e._updating=!1,e._needUpdate&&e.update()},n.prototype.refresh=function(){this.update()},n}(t.wijmoWidget);n.wijlayer=s;var o=function(){function e(){}return e}();n.wijlayer_options=o,s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new o),r.wijmo.registerWidget("wijlayer",s.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijmo-wijmaps-vectorlayer-canvas",s="wijmo-wijmaps-layercontainer",o="wijmo-wijmaps-vectorlayer-shape",u="wijmo-wijmaps-vectorlayer-mark",a="wijmo-wijmaps-vectorlayer-marklabel",f="wijmoWijvectorlayerData",l;(function(e){e[e.placemark=0]="placemark",e[e.polyline=1]="polyline",e[e.polygon=2]="polygon"})(l||(l={}));var c;(function(e){e[e.hidden=0]="hidden",e[e.autoHide=1]="autoHide",e[e.visible=2]="visible"})(c||(c={}));var h;(function(e){e[e.center=0]="center",e[e.left=1]="left",e[e.right=2]="right",e[e.top=3]="top",e[e.bottom=4]="bottom"})(h||(h={}));var p=function(){function e(e){this.minSize=0,this.maxSize=0,this.minZoom=0,this.maxZoom=0;if(!e)return;var t=this;t.minSize=e.minSize||0,t.maxSize=e.maxSize||0,t.minZoom=e.minZoom||0,t.maxZoom=e.maxZoom||0}return e.prototype.isDefault=function(){return this.minSize===0&&this.maxSize===0&&this.minZoom===0&&this.maxZoom===0},e}();n.LOD=p;var d=function(){function e(){}return e}(),v=function(){function e(e,t,n,r,i,s){var o=this;o._scaleX=e,o._scaleY=t,o._offsetX=n,o._offsetY=r,o._extraX=i,o._extraY=s}return e.prototype.init=function(t){var n=this,r=t.converter,i=r.getViewSize(),s=r.getLogicSize(),o=t.center,u=i.width/s.width,a=r.geographicToLogic(o),f=.5*i.width-a.x*u,l=.5*i.height-a.y*u;n._ax=e.toRad*n._scaleX*u,n._bx=n._offsetX*u+f+n._extraX,n._ay=.5*n._scaleY*u,n._by=n._offsetY*u+l+n._extraY,n._converter=r},e.prototype.project=function(t){var r=this,i=r._converter;i&&(t.y>i.maxLatitude&&(t.y=i.maxLatitude),t.y<i.minLatitude&&(t.y=i.minLatitude));var s=Math.sin(t.y*e.toRad),o=t.x*r._ax+r._bx,u=Math.log((1+s)/(1-s))*r._ay+r._by;return new n.Point(o,u)},e.prototype.unproject=function(t){var r=this,i=(t.x-r._offsetX)*e.toDeg/r._scaleX,s=Math.atan(n.Utils.sinh((t.y-r._offsetY)/r._scaleY))*e.toDeg;return new n.Point(i,s)},e.toRad=Math.PI/180,e.toDeg=180/Math.PI,e}(),m=function(t){function p(){t.apply(this,arguments)}return e(p,t),p.prototype._create=function(){var e=this,n="."+o;e._proj=new v(1/(Math.PI*2),-1/(Math.PI*2),.5,.5,-p._offsetX,-p._offsetY),e._cache=null,e._needFullUpdateShape=!1,e._needDrawMarkShape=!1,e._container=r('<div class="'+i+'"></div>').appendTo(e.element).on("click."+e.widgetName,n,function(t){e._onItemMouseEvent("click",t,this)}).on("mousedown."+e.widgetName,n,function(t){e._onItemMouseEvent("mouseDown",t,this)}).on("mouseup."+e.widgetName,n,function(t){e._onItemMouseEvent("mouseUp",t,this)}).on("mousemove."+e.widgetName,n,function(t){e._onItemMouseEvent("mouseMove",t,this)}).on("mouseenter."+e.widgetName,n,function(t){e._onItemMouseEvent("mouseEnter",t,this)}).on("mouseleave."+e.widgetName,n,function(t){e._onItemMouseEvent("mouseLeave",t,this)}),t.prototype._create.call(this),e._setData(e.options.data)},p.prototype._setOption=function(e,n){var r=this,i=this.options;if(i[e]!==n)switch(e){case"dataType":r._setDataType(n);return;case"data":r._setData(n);return}t.prototype._setOption.call(this,e,n)},p.prototype._setDataType=function(e){var t=this;t.options.dataType=e},p.prototype._setData=function(e){var t=this,n=t.options;n.data=e,typeof e=="string"?t._prepareDataFromUri(e):r.isFunction(e)?t._applyData(e()):t._applyData(e)},p.prototype._prepareDataFromUri=function(e){var t=this;r.ajax({url:e,data:null,context:null,success:function(e){t._uriLoaded(e)},error:null,dataType:"json"})},p.prototype._uriLoaded=function(e){var t=this;t._applyData(e)},p.prototype._applyData=function(e){var t=this;if(t._data===e)return;t._data=e,t._applyDataInternal(e)},p.prototype._applyDataInternal=function(e){var t=this,n=t.options;n.dataType===B.wijJson?t._applyWijJsonData(e):n.dataType===B.geoJson&&t._applyGeoJsonData(e),t._needFullUpdateShape=!0,t.update()},p.prototype._applyWijJsonData=function(e){this._createVectors(e)},p.prototype._applyGeoJsonData=function(e){var t=this,n=w.create(e);n&&n.applyData(e,{}),t._vectorObj=n},p.prototype._createVectors=function(e){var t=this,n=this,i=new y;e&&e.vectors&&r.each(e.vectors,function(e,n){var r=t._createVector(n);if(r){var s=new b(r);s.applyData(n),i.addChild(s)}}),n._vectorObj=i},p.prototype._createVector=function(e){switch(l[e.type]){case 2:return new P;case 0:return new _;case 1:return new D}return null},p.prototype._render=function(){var e=this;t.prototype._render.call(this),e._updateShape()},p.prototype._createContainer=function(){var e=this,t=p._clipRect;e._destroyContainer(),e._shapeContainer=r('<div class="'+s+'"></div>'),e._paper=e._createPaper(e._shapeContainer[0],new n.Size(t.getRight(),t.getBottom())),e._group=e._paper.group(),e._placemarkContainer=r('<div class="'+s+"\" style='visibility:hidden;'></div>")},p.prototype._destroyContainer=function(){var e=this;e._paper&&e._paper.remove(),e._shapeContainer&&e._shapeContainer.off("."+e.widgetName).remove(),e._placemarkContainer&&e._placemarkContainer.off("."+e.widgetName).remove()},p.prototype._refreshPaper=function(){var e=this;e._container.css("left",p._offsetX+"px").css("top",p._offsetY+"px"),e._createContainer(),e._marks=[],e._vectorObj&&e._drawVectorObj(e._vectorObj),e._container.append(e._shapeContainer),e._container.append(e._placemarkContainer),e._arrangeMarks(),e._arrangeLabels(),e._placemarkContainer.css("visibility","visible")},p.prototype._drawVectorObj=function(e){var t=this;t._drawSingleVectorObj(e),e&&e.children&&e.children.length>0&&r.each(e.children,function(e,n){t._drawVectorObj(n)})},p.prototype._drawSingleVectorObj=function(e){var t=this,n,i,s,u={vector:e,shape:null};e.vectorItems&&(r.each(e.vectorItems,function(e,r){r.visible&&(n=r.getShape(),n&&(s=n.createElement(t._paper),s&&(t._group.push(s),i?s.forEach(function(e){i.push(e)}):i=s)),r instanceof _&&t._drawPlacemark(r,u))}),i&&(u.shape=i,r.each(i,function(e,t){r.wijraphael.addClass(r(t.node),o),r(t.node).data(f,u)}),t._onShapeCreated("shapeCreated",u)))},p.prototype._drawPlacemark=function(e,t){var n=this,r={location:e.point};n._needDrawMarkShape||n._drawMark(e,t,r),n._drawLabel(e,r),(r.mark||r.label)&&n._marks.push(r)},p.prototype._drawMark=function(e,t,n){var i=this,s=i.options.placemark,o,a,l,c,h,p;if(s===null)return;s.render?a=s.render(t):s.image&&(a=r("<img src='"+s.image+"' />"));if(!a||!a.length)return;n.mark=a,a.addClass(u).data(f,t).appendTo(i._placemarkContainer)},p.prototype._arrangeMarks=function(){var e=this,t=e.options,i=t.placemark||{},s,o,u,a,f,l;e._marks&&r.each(e._marks,function(e,r){r.mark&&(o=r.mark,s=t.converter.geographicToView(r.location),u=r.markSize||i.size||new n.Size(o.width(),o.height()),a=i.pinPoint||new n.Point(u.width/2,u.height/2),s.x-=p._offsetX,s.y-=p._offsetY,l=s.x-a.x,f=s.y-a.y,r.markSize=u,o.css("position","absolute").css("left",l+"px").css("top",f+"px"))})},p.prototype._drawLabel=function(e,t){var n=this,i=n.options.placemark||{},s=c[i.labelVisibility]||0,o=e.label||e.name;if(s===0||!o)return;var u=e.getViewBounds().location,f=r("<span style='position:absolute;' class='"+a+"'>"+o+"</span>").appendTo(n._placemarkContainer);t.label=f},p.prototype._arrangeLabels=function(e){var t=this,n=t.options,i=n.placemark||{},s=[];e=e||c[i.labelVisibility]||0,r.each(t._marks,function(r,i){if(i.label){var o,u,a=!1,f=s.length,l;o=n.converter.geographicToView(i.location),o.x-=p._offsetX,o.y-=p._offsetY,u=t._calculateLabelBounds(o,i.label,i.labelSize);if(e===1)for(l=0;l<f;l++)if(u.intersectsWith(s[l])){a=!0;break}a?i.label.remove():(i.label.css("left",u.location.x+"px").css("top",u.location.y+"px"),i.labelSize=u.size,e===1&&s.push(u))}})},p.prototype._calculateLabelBounds=function(e,t,r){var i=this,s=i.options.placemark||{},o=h[s.labelPosition]||0,u=r?r.width:t.outerWidth(),a=r?r.height:t.outerHeight(),f,l;return o===1?(f=e.x-u,l=e.y-a/2):o===2?(f=e.x,l=e.y-a/2):o===3?(f=e.x-u/2,l=e.y-a):o===4?(f=e.x-u/2,l=e.y):(f=e.x-u/2,l=e.y-a/2),new n.Rectangle(new n.Point(f,l),new n.Size(u,a))},p.prototype._translatePaper=function(e,t){var n=this,r=p._offsetX+e,i=p._offsetY+t;n._container.css("left",r+"px").css("top",i+"px")},p.prototype._scalePaper=function(e,t,n,r){var i=this;if(Raphael.vml){i._container.empty();return}var s=i.options.converter.getViewSize(),o=p._offsetX,u=p._offsetY,a=s.width/2-p._offsetX,f=s.height/2-p._offsetY,l=Raphael.matrix(1,0,0,1,0,0);i._container.css("left",o+"px").css("top",u+"px"),i._arrangeMarks(),i._arrangeLabels(2),l.translate(n,r),l.scale(e,t,a,f),i._group.transform(l)},p.prototype._updateShape=function(){var e=this;if(!e._cache||e._needFullUpdateShape){e._fullUpdateShape();return}var t=e.options,n=t.converter,r=n.geographicToView(t.center),i=n.geographicToView(e._cache.center),s=i.x-r.x,o=i.y-r.y;if(t.zoom===t.targetZoom){var u=p._clipRect;if(t.zoom!==e._cache.zoom||e._needFullUpdateShape||Math.abs(s)>.4*u.size.width||Math.abs(o)>.4*u.size.height){e._fullUpdateShape();return}e._translatePaper(s,o)}else{var a=Math.pow(2,t.zoom)/Math.pow(2,e._cache.zoom);e._scalePaper(a,a,s,o)}return},p.prototype._updateVectorObj=function(e,t,n,i,s){var o=this;o._updateSingleVectorObj(e,t,n,i,s),e&&e.children&&e.children.length>0&&r.each(e.children,function(e,r){o._updateVectorObj(r,t,n,i,s)})},p.prototype._updateSingleVectorObj=function(e,t,n,i,s){var o=this;e.vectorItems&&r.each(e.vectorItems,function(e,r){o._updateVectorItem(r,t,n,i,s)})},p.prototype._updateVectorItem=function(e,t,n,r,i){e.visible=!1;if(!n.intersectsWith(e.getBounds()))return;e.getViewBounds(t),e.isVisible(r,i)&&(e.visible=!0,e.updateShape(t))},p.prototype._fullUpdateShape=function(){var e=this,t=e.options,r=t.placemark||{},i=t.minSize==null?3:t.minSize,s=t.converter,o=i*i;e._needDrawMarkShape=!r.image&&!r.render,e._needFullUpdateShape=!1;if(!e._vectorObj)return;e._cache={zoom:t.zoom,center:t.center};var u=function(t){return e._proj.project(t)};e._proj.init(t);var a=p._clipRect,f=a.location.x,l=a.location.y,c=f+a.size.width,h=l+a.size.height,d=s.viewToGeographic(new n.Point(f+p._offsetX,l+p._offsetY)),v=s.viewToGeographic(new n.Point(c+p._offsetX,h+p._offsetY)),m=n.Utils.getBounds([d,v]);e._updateVectorObj(e._vectorObj,u,m,o,t.zoom),e._refreshPaper()},p.prototype._onShapeCreated=function(e,t){this._trigger(e,null,t)},p.prototype._onItemMouseEvent=function(e,t,n){var i=this;if(i._isDisabled())return;i._trigger(e,t,r(n).data(f))},p.prototype.refresh=function(){var e=this;e._data=null,this._setData(e.options.data)},p.prototype.destroy=function(){var e=this;e._paper&&e._paper.remove(),e._container.off("."+e.widgetName).remove(),t.prototype.destroy.call(this)},p._offsetX=-2e3,p._offsetY=-2e3,p._clipRect=new n.Rectangle(new n.Point(-p._offsetX-1e3,-p._offsetY-1e3),new n.Size(3e3,3e3)),p}(n.wijlayer);n.wijvectorlayer=m;var g;(function(e){e[e.Point=0]="Point",e[e.MultiPoint=1]="MultiPoint",e[e.LineString=2]="LineString",e[e.MultiLineString=3]="MultiLineString",e[e.Polygon=4]="Polygon",e[e.MultiPolygon=5]="MultiPolygon",e[e.GeometryCollection=6]="GeometryCollection",e[e.Feature=7]="Feature",e[e.FeatureCollection=8]="FeatureCollection"})(g||(g={}));var y=function(){function e(){this.type="VectorCollection",this.parent=null,this.children=[],this.vectorItems=null}return e.prototype.applyData=function(e){},e.prototype.addChild=function(e){this.children.push(e),e.parent=this},e}(),b=function(){function e(e){this.item=e,this.type="Vector",this.vectorItems=[e]}return e.prototype.applyData=function(e){this.data=e,this.item.applyData(e)},e}(),w=function(){function e(){this.type="Object"}return e.prototype.applyData=function(e,t){this.data=e,this.properties=t},e.prototype._addChild=function(e){var t=this;t.children=t.children||[],t.children.push(e),e.parent=t},e.create=function(e){switch(e.type){case g[0]:return new S;case g[1]:return new x;case g[2]:return new T;case g[3]:return new N;case g[4]:return new C;case g[5]:return new k;case g[6]:return new L;case g[7]:return new A;case g[8]:return new O}return null},e}(),E=function(t){function n(){t.apply(this,arguments),this.type="Geometry"}return e(n,t),n.prototype._createVectorItem=function(e){switch(e){case 2:return new P;case 0:return new _;case 1:return new D}return null},n}(w),S=function(t){function n(){t.apply(this,arguments),this.type="Point"}return e(n,t),n.prototype.applyData=function(e,n){var r=this,i;t.prototype.applyData.call(this,e,n),r.data=e,e.coordinates&&(i=r._createVectorItem(0),i.applyGeoData(e.coordinates,n),r.vectorItems=[i])},n}(E),x=function(t){function n(){t.apply(this,arguments),this.type="MultiPoint"}return e(n,t),n.prototype.applyData=function(e,n){var i=this,s;t.prototype.applyData.call(this,e,n),i.data=e,e.coordinates&&(i.vectorItems=[],r.each(e.coordinates,function(e,t){s=i._createVectorItem(0),s.applyGeoData(t,n),i.vectorItems.push(s)}))},n}(E),T=function(t){function n(){t.apply(this,arguments),this.type="LineString"}return e(n,t),n.prototype.applyData=function(e,n){var r=this,i;t.prototype.applyData.call(this,e,n),r.data=e,e.coordinates&&(i=r._createVectorItem(1),i.applyGeoData(e.coordinates,n),r.vectorItems=[i])},n}(E),N=function(t){function n(){t.apply(this,arguments),this.type="MultiLineString"}return e(n,t),n.prototype.applyData=function(e,n){var i=this,s;t.prototype.applyData.call(this,e,n),i.data=e,e.coordinates&&(i.vectorItems=[],r.each(e.coordinates,function(e,t){s=i._createVectorItem(1),s.applyGeoData(t,n),i.vectorItems.push(s)}))},n}(E),C=function(t){function n(){t.apply(this,arguments),this.type="Polygon"}return e(n,t),n.prototype.applyData=function(e,n){var r=this,i;t.prototype.applyData.call(this,e,n),r.data=e,e.coordinates&&(i=r._createVectorItem(2),i.applyGeoData(e.coordinates,n),r.vectorItems=[i])},n}(E),k=function(t){function n(){t.apply(this,arguments),this.type="MultiPolygon"}return e(n,t),n.prototype.applyData=function(e,n){var i=this,s;t.prototype.applyData.call(this,e,n),i.data=e,e.coordinates&&(i.vectorItems=[],r.each(e.coordinates,function(e,t){s=i._createVectorItem(2),s.applyGeoData(t,n),i.vectorItems.push(s)}))},n}(E),L=function(t){function n(){t.apply(this,arguments),this.type="GeometryCollection"}return e(n,t),n.prototype.applyData=function(e,n){var i=this,s;t.prototype.applyData.call(this,e,n),e.geometries&&r.each(e.geometries,function(e,t){s=w.create(t),s.applyData(t,n),i._addChild(s)}),i.geometries=i.children},n}(E),A=function(t){function n(){t.apply(this,arguments),this.type="Feature"}return e(n,t),n.prototype.applyData=function(e){var n=this,r;t.prototype.applyData.call(this,e,e.properties),e.geometry&&(r=w.create(e.geometry),r.applyData(e.geometry,e.properties),n._addChild(r),n.geometry=r)},n}(w),O=function(t){function n(){t.apply(this,arguments),this.type="FeaturesCollectiton"}return e(n,t),n.prototype.applyData=function(e){var n=this,i;t.prototype.applyData.call(this,e,null),e.features&&r.each(e.features,function(e,t){i=w.create(t),i.applyData(t,null),n._addChild(i)}),n.features=n.children},n}(w),M=function(){function e(){this._lod=new p,this.visible=!0}return e.prototype.applyData=function(e){this._applyProperties(e)},e.prototype.applyGeoData=function(e,t){this._applyProperties(t)},e.prototype._applyProperties=function(e){var t=this;e&&(t.name=e.name,t.fill=e.fill,t.fillOpacity=e.fillOpacity,t.stroke=e.stroke,t.strokeOpacity=e.strokeOpacity,t.strokeWidth=e.strokeWidth,t.strokeDashArray=e.strokeDashArray,t.strokeLineCap=n.PenLineCap[e.strokeLineCap],t.strokeLineJoin=n.PenLineJoin[e.strokeLineJoin],t.strokeMiterLimit=e.strokeMiterLimit,t._lod=new p(e.lod))},e.prototype.getBounds=function(){return null},e.prototype.getViewBounds=function(e){return null},e.prototype.isVisible=function(e,t){var n=0,r=this.getViewBounds();r.isEmpty()||(n=r.size.width*r.size.width+r.size.height*r.size.height);var i=this._lod;if(i&&i.isDefault())return n>=e;var s=t>=i.minZoom&&t<=i.maxZoom;return s?i.maxSize===0?n>=i.minSize*i.minSize:this._lod.minSize===0?n<=i.maxSize*i.maxSize:n>=i.minSize*i.minSize&&n<=i.maxSize*i.maxSize:!1},e.prototype.getShape=function(){return null},e.prototype._initShape=function(e){var t=this;t.fill!=null&&(e.fill=t.fill),t.fillOpacity!=null&&(e.fillOpacity=t.fillOpacity),t.stroke!=null&&(e.stroke=t.stroke),t.strokeOpacity!=null&&(e.strokeOpacity=t.strokeOpacity),t.strokeWidth!=null&&(e.strokeWidth=t.strokeWidth),t.strokeDashArray&&(e.strokeDashArray=t.strokeDashArray),t.strokeLineCap!=null&&(e.strokeLineCap=t.strokeLineCap),t.strokeLineJoin&&(e.strokeLineJoin=t.strokeLineJoin),t.strokeMiterLimit&&(e.strokeMiterLimit=t.strokeMiterLimit)},e.prototype.updateShape=function(e){},e.convertPoints=function(t,n){var r=null;if(t!=null){var i=t.length,s=n(t[0]);r=[],r.push(s);for(var o=1;o<i;o++){var u=n(t[o]);if(Math.abs(u.x-s.x)>=e.optRad||Math.abs(u.y-s.y)>=e.optRad)r.push(u),s=u}}return r},e.convertPointsList=function(t,n){var i=null;return t!=null&&t.length>0&&(i=[],r.each(t,function(t,r){var s=e.convertPoints(r,n);s&&i.push(s)})),i},e.optRad=1.5,e}();n.VectorItem=M;var _=function(t){function r(){t.apply(this,arguments)}return e(r,t),r.prototype.applyData=function(e){t.prototype.applyData.call(this,e),e.coordinates&&e.coordinates.length>1&&(this.point=new n.Point(e.coordinates[0],e.coordinates[1]))},r.prototype.applyGeoData=function(e,r){t.prototype.applyGeoData.call(this,e,r),this.point=n.Utils.getPointData(e)},r.prototype._applyProperties=function(e){var n=this;e&&(t.prototype._applyProperties.call(this,e),n.label=e.label)},r.prototype.getBounds=function(){var e=this;return new n.Rectangle(new n.Point(e.point.x,e.point.y),new n.Size(0,0))},r.prototype.getViewBounds=function(){return this._bnds},r.prototype.isVisible=function(e,t){var n=this._lod,r=!0;return n.isDefault()||(r=t>=n.minZoom&&t<=n.maxZoom),r},r.prototype.getShape=function(){return null},r.prototype.updateShape=function(e){var t=this,r=e(t.point),i=new n.Rectangle(new n.Point(r.x,r.y),new n.Size(0,0));t._bnds=i},r}(M),D=function(t){function r(){t.apply(this,arguments)}return e(r,t),r.prototype.applyData=function(e){var r=this;t.prototype.applyData.call(this,e),r.points=n.Utils.getPoints(e.coordinates),r._gbnds=n.Utils.getBounds(r.points)},r.prototype.applyGeoData=function(e,r){t.prototype.applyGeoData.call(this,e,r);var i=this;i.points=n.Utils.getLineData(e),i._gbnds=n.Utils.getBounds(i.points)},r.prototype.getBounds=function(){return this._gbnds},r.prototype.getViewBounds=function(e){var t=this;if(e){var r=new n.Point(t._gbnds.location.x,t._gbnds.location.y),i=new n.Point(t._gbnds.getRight(),t._gbnds.getBottom());r=e(r),i=e(i),t._bnds=n.Utils.getBounds([r,i])}return t._bnds},r.prototype.getShape=function(){return this._plines},r.prototype.updateShape=function(e){var t=this,r=m._clipRect,i=M.convertPoints(t.points,e);return t._plines||(t._plines=new n.MultiPolyline,t._initShape(t._plines)),t._bnds=n.Utils.getBounds(i),t._bnds.size.width>r.size.width||t._bnds.size.height>r.size.height?(t._plines.points=n.ClippingEngine.createClippedLines(i,r),t._bnds=t._bnds.intersect(r)):t._plines.points=[i],this._bnds},r}(M),P=function(t){function r(){t.apply(this,arguments)}return e(r,t),r.prototype.applyData=function(e){var r=this,i,s;t.prototype.applyData.call(this,e),r.pointsList=[n.Utils.getPoints(e.coordinates)],r._gbnds=n.Utils.getListBounds(r.pointsList)},r.prototype.applyGeoData=function(e,r){var i=this;t.prototype.applyGeoData.call(this,e,r),i.pointsList=n.Utils.getPolygonData(e),i._gbnds=n.Utils.getListBounds(i.pointsList)},r.prototype.getBounds=function(){return this._gbnds},r.prototype.getViewBounds=function(e){var t=this;if(e){var r=new n.Point(t._gbnds.location.x,t._gbnds.location.y),i=new n.Point(this._gbnds.getRight(),this._gbnds.getBottom());r=e(r),i=e(i),t._bnds=n.Utils.getBounds([r,i])}return t._bnds},r.prototype.getShape=function(){return this._polygon},r.prototype.updateShape=function(e){var t=this,r=m._clipRect,i=M.convertPointsList(t.pointsList,e);t._polygon||(t._polygon=new n.Polygon,t._initShape(t._polygon)),t._bnds=n.Utils.getListBounds(i);if(t._bnds.size.width>r.size.width||t._bnds.size.height>r.size.height)i=n.ClippingEngine.clipPolygonList(i,r),t._bnds=n.Utils.getListBounds(i);t._polygon.pointsList=i},r}(M),H=function(t){function n(){t.apply(this,arguments),this.dataType=B.wijJson,this.minSize=3,this.placemark=null,this.shapeCreated=null,this.mouseEnter=null,this.mouseLeave=null,this.mouseDown=null,this.mouseUp=null,this.mouseMove=null,this.click=null}return e(n,t),n}(n.wijlayer_options);n.wijvectorlayer_options=H;var B=function(){function e(){}return e.wijJson="wijJson",e.geoJson="geoJson",e}();m.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new H),r.wijmo.registerWidget("wijvectorlayer",r.wijmo.wijlayer,m.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijmo-wijmaps-layercontainer",s=function(t){function s(){t.apply(this,arguments),this._maxZoom=20}return e(s,t),s.prototype._create=function(){var e=this;e._container=r('<div class="'+i+'"></div>'),e.element.append(e._container),e._paper=e._createPaper(e._container[0],e.options.converter.getViewSize()),t.prototype._create.call(this),e._setRequest(e.options.request)},s.prototype._setOption=function(e,n){var r=this,i=this.options;if(i[e]!==n)switch(e){case"request":r._setRequest(n);return;case"slices":r._setSlices(n);return}t.prototype._setOption.call(this,e,n)},s.prototype._setRequest=function(e){var t=this;t.options.request=e,t._refreshLayer()},s.prototype._setSlices=function(e){var t=this;t.options.slices=e,t._refreshLayer()},s.prototype._refreshLayer=function(){var e=this,t=e.options;e._slices=e._sortSlices(t.slices),e._clear(),e.update()},s.prototype._render=function(){var e=this,t=e.options,i=e._getMatchedSlice();if(i===null){e._clear();return}e._resizePaper(e._paper,t.converter.getViewSize());var s=r.inArray(i,e._slices),o=s>0?e._slices[s-1].zoom:e._maxZoom,u=e._getLogicBounds(),a=u.location,f=new n.Point(u.getRight(),u.getBottom()),l=[];for(var c=Math.floor(a.x*i.longitudeSlices);c<f.x*i.longitudeSlices;c++)for(var h=Math.floor(a.y*i.latitudeSlices);h<f.y*i.latitudeSlices;h++)l.push(new n.Region(i,c,h));var p=r.grep(e._visibleRegions,function(e){for(var t=0;t<l.length;t++)if(e.equals(l[t]))return!1;return!0});r.each(p,function(t,n){e._removeRegion(n)});var d=r.grep(l,function(t){for(var n=0;n<e._visibleRegions.length;n++)if(t.equals(e._visibleRegions[n]))return!1;return!0}),v=r.grep(e._visibleRegions,function(e){return r.inArray(e,p)===-1});e._visibleRegions=v.concat(d),r.each(d,function(r,s){var u=t.converter.logicToGeographic(new n.Point(s.longitude/i.longitudeSlices,(s.latitude+1)/i.latitudeSlices)),a=t.converter.logicToGeographic(new n.Point((s.longitude+1)/i.longitudeSlices,s.latitude/i.latitudeSlices)),f=t.request(e._paper,e.options.zoom,o,u,a);f&&(s.items=f.items,f.items&&n.wijitemslayer._setItemsData(f.items))}),e._relayout()},s.prototype._relayout=function(){var e=this,t=e.options,r=t.converter;n.wijitemslayer._relayoutRegions(r,e._visibleRegions)},s.prototype._removeRegion=function(e){e.items&&r.each(e.items,function(e,t){t.elements.remove()})},s.prototype._clear=function(){var e=this;e._visibleRegions=[],e._paper&&e._paper.clear()},s.prototype._getMatchedSlice=function(){var e=this;if(!e._slices)return null;var t=e._slices.length,n,r;for(n=0;n<t;n++){r=e._slices[n];if(r.zoom<=e.options.zoom)return r}return null},s.prototype._sortSlices=function(e){return e?e.sort(function(e,t){return-(e.zoom-t.zoom)}):[]},s.prototype._getLogicBounds=function(){var e=this,t=e.options.converter,r=t.viewToLogic(new n.Point(0,0)),i=t.getLogicSize();return new n.Rectangle(r,i)},s.prototype.refresh=function(){this._refreshLayer(),t.prototype.refresh.call(this)},s.prototype.destroy=function(){var e=this;e._paper&&e._paper.remove(),e._container.remove(),t.prototype.destroy.call(this)},s}(n.wijlayer);n.wijvirtuallayer=s;var o=function(t){function n(){t.apply(this,arguments),this.slices=[]}return e(n,t),n}(n.wijlayer_options);n.wijvirtuallayer_options=o,s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new o),r.wijmo.registerWidget("wijvirtuallayer",s.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijmo-wijmaps-layercontainer",s=function(){function e(e,t,n){this.latitudeSlices=e,this.longitudeSlices=t,this.zoom=n}return e}();n.MapSlice=s;var o=function(){function e(e,t,n){this.slice=e,this.longitude=t,this.latitude=n}return e.prototype.equals=function(e){var t=this;return t.slice===e.slice&&t.longitude===e.longitude&&t.latitude===e.latitude},e}();n.Region=o;var u=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._create=function(){var e=this;e._container=r('<div class="'+i+'"></div>'),e.element.append(e._container),e._paper=e._createPaper(e._container[0],e.options.converter.getViewSize()),t.prototype._create.call(this),e._setRequest(e.options.request)},n.prototype._setOption=function(e,n){var r=this,i=this.options;if(i[e]!==n)switch(e){case"request":r._setRequest(n);return}t.prototype._setOption.call(this,e,n)},n.prototype._setRequest=function(e){var t=this;t.options.request=e,t._clear();if(e){var r=e(t._paper);if(r){var i=new o(new s(1,1,0),0,0);i.items=r.items,n._setItemsData(r.items),t._visibleRegions=[i]}}t.update()},n.prototype._render=function(){var e=this,t=e.options.converter;e._resizePaper(e._paper,t.getViewSize()),n._relayoutRegions(e.options.converter,e._visibleRegions)},n.prototype._clear=function(){var e=this;e._visibleRegions=null,e._paper&&e._paper.clear()},n._relayoutRegions=function(e,t){if(!t)return;var n=e.getViewSize(),i=n.width/e.getLogicSize().width,s=e.getLogicCenter(),o=n.width/2-s.x*i,u=n.height/2-s.y*i;r.each(t,function(t,n){n.items&&r.each(n.items,function(t,n){if(n.elements){var s=e.geographicToLogic(n.location),a=s.x*i+o-(n.pinpoint?n.pinpoint.x:0),f=s.y*i+u-(n.pinpoint?n.pinpoint.y:0),l="t"+a+","+f;r.each(n.elements,function(e,t){t.transform(t.data("wijmo-transform")+l)})}})})},n._setItemsData=function(e){e&&r.each(e,function(e,t){t.elements&&r.each(t.elements,function(e,t){t.data("wijmo-transform",t.transform())})})},n.prototype.refresh=function(){var e=this;e._setRequest(e.options.request),t.prototype.refresh.call(this)},n.prototype.destroy=function(){var e=this;e._paper&&e._paper.remove(),e._container.remove(),t.prototype.destroy.call(this)},n}(n.wijlayer);n.wijitemslayer=u;var a=function(t){function n(){t.apply(this,arguments)}return e(n,t),n}(n.wijlayer_options);n.wijitemslayer_options=a,u.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new a),r.wijmo.registerWidget("wijitemslayer",u.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i=.5,s=20,o=158,u={layerContainerCss:"wijmo-wijmaps-layercontainer",toolsLayerCss:"wijmo-wijmaps-toolslayer",panCss:"wijmo-wijmaps-pan",panpointCss:"wijmo-wijmaps-panpoint",zoomCss:"wijmo-wijmaps-zoomer",scaleCss:"wijmo-wijmaps-scaler",scaleLableCss:"wijmo-wijmaps-content",scaleValueCss:"wijmo-wijmaps-scalervalue"},a=function(t){function a(){t.apply(this,arguments)}return e(a,t),a.prototype._create=function(){var e=this;e.element.addClass(u.toolsLayerCss),e._on(e.element,{dblclick:function(e,t){e.stopPropagation()}}),e._speed=i,e._isPanning=!1,e._createPanPanel(),e._createZoomPanel(),e._createScalePanel()},a.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._handleDisabledOption(!0)},a.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._handleDisabledOption(!1)},a.prototype._handleDisabledOption=function(e){var t=this,n={disabled:e};t._zoomSlider&&t._zoomSlider.wijslider(n)},a.prototype._setOption=function(e,n){var r=this,i=this.options;if(i[e]!==n)switch(e){case"center":r._setCenter(n);return;case"zoom":r._setZoom(n);return}t.prototype._setOption.call(this,e,n)},a.prototype._setCenter=function(e){var t=this,n=t.options;n.center=e,t._updateScalePanel()},a.prototype._setZoom=function(e){var t=this,n=t.options;n.zoom=e,t._zoomSlider.wijslider({orientation:"vertical",range:!1,min:n.minZoom,max:n.maxZoom,step:1,value:n.zoom,values:null}),t._updateScalePanel()},a.prototype._createPanPanel=function(){var e=this,t=e.options,i=e.element,s,o,a,f,l,c,h,p;e._panPanel=r('<div class="'+u.panCss+" "+t.wijCSS.stateDefault+'"></div>').appendTo(i),e._on(e._panPanel,{mousedown:function(t,i){e._isPanning=!0,e._startPanning(e._panPanel,e._getPanPointOffset(e._panPanel,new n.Point(t.pageX,t.pageY))),r(document).disableSelection(),t.stopPropagation()},dragstart:function(e,t){e.preventDefault()},selectstart:function(e,t){e.preventDefault()}}),e._on(r(document),{mouseup:function(t,n){e._isPanning=!1,e._stopPanning(),r(document).enableSelection()},mousemove:function(t,r){e._isPanning&&e._startPanning(e._panPanel,e._getPanPointOffset(e._panPanel,new n.Point(t.pageX,t.pageY)))}}),e._panPoint=r('<div class="'+u.panpointCss+" "+t.wijCSS.content+" "+t.wijCSS.stateActive+'"></div>').hide().appendTo(i),a=r('<div class="'+t.wijCSS.icon+" "+t.wijCSS.iconArrowLeft+'"></div>'),f=r('<div class="'+t.wijCSS.icon+" "+t.wijCSS.iconArrowRight+'"></div>'),l=r('<div class="'+t.wijCSS.icon+" "+t.wijCSS.iconArrowUp+'"></div>'),c=r('<div class="'+t.wijCSS.icon+" "+t.wijCSS.iconArrowDown+'"></div>'),e._panPanel.append(a,f,l,c)},a.prototype._getPanPointOffset=function(e,t){var n=e.offset();return t.offset(-n.left,-n.top)},a.prototype._startPanning=function(e,t){var r=this,i=r.options,s=i.converter.getViewCenter(),o=new n.Point(e.outerWidth()/2,e.outerHeight()/2),u=t.offset(-o.x,-o.y),a=Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2)),f=new n.Point(t.x,t.y),l;r._panningTimer&&clearInterval(r._panningTimer),r._panningTimer=setInterval(function(){l=i.converter.viewToGeographic((new n.Point(u.scale(r._speed,r._speed))).offset(s.x,s.y)),r._trigger("targetCenterChanged",null,{targetCenter:l})},20),a>o.x&&(f=o.scale(u.x/a,u.y/a).offset(o.x,o.y)),f=f.offset(e.position().left,e.position().top),r._panPoint.css("left",f.x-r._panPoint.width()/2).css("top",f.y-r._panPoint.height()/2).show()},a.prototype._stopPanning=function(){var e=this;e._panningTimer&&clearInterval(e._panningTimer),e._panPoint.hide()},a.prototype._createZoomPanel=function(){var e=this,t=e.options,n=e.element;e._zoomSlider=r("<div></div>").css("height","100%").css("font-size","13px"),e._zoomPanel=r('<div class="'+u.zoomCss+'"></div>').append(e._zoomSlider),n.append(e._zoomPanel),e._zoomSlider.wijslider({orientation:"vertical",range:!1,min:t.minZoom,max:t.maxZoom,step:1,value:t.zoom,values:null}),e._on(e._zoomPanel,{mousedown:function(e,t){e.stopPropagation()}}),e._on(!0,e._zoomPanel,{wijsliderchange:function(t,n){e._trigger("targetZoomChanged",null,{targetZoom:n.value})}})},a.prototype._createScalePanel=function(){var e=this,t=e.options,n=e.element;e._scalePanel=r('<div class="'+u.scaleCss+" "+t.wijCSS.content+'"></div>').appendTo(n),e._on(e._scalePanel,{mousedown:function(e,t){e.stopPropagation()},dblclick:function(e,t){e.stopPropagation()}}),e._metersLabel=r('<span class="'+u.scaleLableCss+'"></span>'),e._milesLabel=r('<span class="'+u.scaleLableCss+'"></span>'),e._metersValue=r('<span class="'+u.scaleValueCss+" "+t.wijCSS.stateDefault+'"></span>'),e._milesValue=r('<span class="'+u.scaleValueCss+" "+t.wijCSS.stateDefault+'"></span>'),e._scalePanel.append(e._metersLabel,e._metersValue,r("<br />"),e._milesLabel,e._milesValue),e._updateScalePanel()},a.prototype._updateScalePanel=function(){var e=this;e._updateScale(e._metersValue,e._metersLabel,1,1e3,"km","m"),e._updateScale(e._milesValue,e._milesLabel,3.2808399,5280,"mi","ft")},a.prototype._updateScale=function(e,t,n,r,i,u){if(e){var a=this,f=a.options,l=s,c=o,h=a._getDistance(l)*n,p=a._getDistance(c)*n,d=a._roundest(Math.floor(h),Math.floor(p));d.toString().length<=Math.ceil(Math.LOG10E*Math.log(r))?t&&t.text(d+" "+u):(h/=r,p/=r,d=a._roundest(Math.floor(h),Math.floor(p)),t&&t.text(d+" "+i))}var v=(d-h)*1/(p-h);e.width(Math.max(l*(1-v)+c*v,0))},a.prototype._getDistance=function(e){var t=this,r=t.options;return r.converter.distance(r.center,r.converter.viewToGeographic((new n.Point(r.converter.getViewCenter())).offset(r.center.x<0?e:-e,0)))},a.prototype._roundest=function(e,t){var n=this,r=t.toString(),i=e.toString();for(var s=0;s<r.length;++s)if(r.length>i.length||r[s]!=i[s])return parseInt(n._padRight(r.substring(0,s+1),r.length,"0"));return t},a.prototype._padRight=function(e,t,n){if(e.length<t){var r,i=new String;for(r=1;r<=t-e.length;r++)i+=n;return e+i}return e},a.prototype.destroy=function(){var e=this;r(document).off("."+e.widgetName),e._panPanel.remove(),e._zoomSlider.wijslider("destroy").remove(),e._panPanel.off("."+e.widgetName).remove(),e._zoomPanel.off("."+e.widgetName).remove(),e._scalePanel.off("."+e.widgetName).remove(),e.element.removeClass(u.toolsLayerCss).off("."+e.widgetName),t.prototype.destroy.call(this)},a}(t.wijmoWidget);n.wijtoolslayer=a;var f=function(){function e(){}return e}();n.wijtoolslayer_options=f,a.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new f),r.wijmo.registerWidget("wijtoolslayer",a.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijmo-wijmaps-tile",s=function(t){function s(){t.apply(this,arguments)}return e(s,t),s.prototype._create=function(){var e=this,t=e.options;e._tileItems={},e._tileScale=e._getTileScale(Math.round(t.zoom),t.zoom),e._renderTiles()},s.prototype._setOption=function(e,n){var r=this,i=r.options;if(i[e]!==n)switch(e){case"center":r._setCenter(n);return;case"zoom":r._setZoom(n);return;case"source":r._setSource(n);return}t.prototype._setOption.call(this,e,n)},s.prototype._setCenter=function(e){var t=this,r=t.options,i=new n.Size(e.x-r.center.x,e.y-r.center.y);t._offsetTiles(i),r.center=e,t._renderTiles()},s.prototype._setZoom=function(e){var t=this,n=t.options,r=n.zoom,i,s;e>=n.source.minZoom&&e<=n.source.maxZoom&&(t._tileScale=t._getTileScale(Math.round(e),e),t._scaleTiles(t._getTileScale(r,e)),n.zoom=e,setTimeout(function(){t._renderTiles()},10))},s.prototype._setSource=function(e){var t=this,n=t.options;n.source=e,r.each(t._tileItems,function(e,n){n.img.remove(),delete t._tileItems[e]}),t._renderTiles()},s.prototype._offsetTiles=function(e){var t=this,i=t._getViewFullSize();r.each(t._tileItems,function(t,r){r.bounds.location=(new n.Point(r.bounds.location)).offset(-e.width*i.width,-e.height*i.height),r.img.css("left",r.bounds.location.x).css("top",r.bounds.location.y)})},s.prototype._getTileScale=function(e,t){return Math.pow(2,t-e)},s.prototype._scaleTiles=function(e){var t=this,i=t._getViewSize(),s=new n.Rectangle(new n.Point(0,0),i);r.each(t._tileItems,function(r,o){o.bounds.location.x=i.width/2-(i.width/2-o.bounds.location.x)*e,o.bounds.location.y=i.height/2-(i.height/2-o.bounds.location.y)*e,o.bounds.size=(new n.Size(o.bounds.size)).scale(e,e),s.intersect(o.bounds)?o.img.css("left",o.bounds.location.x).css("top",o.bounds.location.y).css("width",o.bounds.size.width).css("height",o.bounds.size.height):(o.img.remove(),delete t._tileItems[r])})},s.prototype._renderTiles=function(){var e=this,t=e.options,i=Math.round(t.zoom),s=e._getLeftTopTileItem(),u=e._getViewSize(),a=e._getTileSize(),f=e._getMaxTileCount(t.zoom),l=f-s.columnIndex,c=f-s.rowIndex,h=Math.min(l,Math.ceil((u.width-s.bounds.location.x)/a.width)),p=Math.min(c,Math.ceil((u.height-s.bounds.location.y)/a.height)),d,v,m,g,y,b=r.extend({},e._tileItems),w=[];for(m=s.rowIndex;m<s.rowIndex+p;m++)for(g=s.columnIndex;g<s.columnIndex+h;g++)d=s.bounds.location.x+a.width*(g-s.columnIndex),v=s.bounds.location.y+a.height*(m-s.rowIndex),y=new o(g,m,new n.Rectangle(new n.Point(d,v),new n.Size(a.width,a.height)),i),e._renderTile(y,i,b,w)},s.prototype._renderTile=function(e,t,n,s){var o=this,u=o.options,a=e.bounds.location,f=e.bounds.size,l,c,h,p,d="tile_"+e.columnIndex+"_"+e.rowIndex+"_"+e.zoomLevel;o._tileItems[d]?(h=o._tileItems[d],h.bounds=e.bounds,h.img.css("left",a.x).css("top",a.y).css("width",f.width).css("height",f.height),o.element.append(h.img)):(o._tileItems[d]=e,c=u.source.getUrl(e.zoomLevel,e.columnIndex,e.rowIndex),l="left:"+a.x+"px; top:"+a.y+"px; width:"+f.width+"px; height:"+f.height+"px; display:none",e.img=r('<img class="'+i+'" style="'+l+'" src="'+c+'"></img>'),s.push(d),e.img.one("load.wijmultiscaleimage",function(r,i){o._onTileLoad(e.img,d,t,n,s)}),o.element.append(e.img))},s.prototype._onTileLoad=function(e,t,n,i,s){var o=this,u=o.options;e.fadeIn(600,function(){s.splice(r.inArray(t,s),1),s.length==0&&r.each(i,function(e,t){o._isUselessTile(t,n)&&(t.img.remove(),r("img[src='"+t.img.attr("src")+"']").length==0&&(delete i[e],delete o._tileItems[e]))})})},s.prototype._isUselessTile=function(e,t){var r=this,i=r.options,s=Math.round(i.zoom),o=new n.Rectangle(n.Point.empty,r._getViewSize()),u=o.intersect(e.bounds);return e.zoomLevel===t||e.zoomLevel===s?!u:!0},s.prototype._isPointInRect=function(e,t){return e.x>=t.location.x&&e.x<=t.location.x+t.size.width&&e.y>=t.location.y&&e.y<=t.location.y+t.size.height},s.prototype._getLeftTopTileItem=function(){var e=this,t=e.options,r=e._getMaxTileCount(t.zoom),i=(new n.Point(t.center)).scale(r,r),s=e._getTileSize(),u=e._getViewSize(),a=Math.floor(i.y),f=Math.floor(i.x),l=e._getViewCenter().offset(-(i.x%1)*s.width,-(i.y%1)*s.height);while(f>0&&l.x>0)f-=1,l.x-=s.width;while(a>0&&l.y>0)a-=1,l.y-=s.height;return new o(f,a,new n.Rectangle(l,s),Math.round(t.zoom))},s.prototype._getTileSize=function(){var e=this,t=e.options;return(new n.Size(t.source.tileWidth,t.source.tileHeight)).scale(e._tileScale,e._tileScale)},s.prototype._getMaxTileCount=function(e){return Math.pow(2,Math.round(e))},s.prototype._getViewSize=function(){var e=this;return new n.Size(e.element.width(),e.element.height())},s.prototype._getViewCenter=function(){var e=this,t=e._getViewSize();return new n.Point(t.width/2,t.height/2)},s.prototype._getViewFullSize=function(){var e=this,t=e.options,r=Math.pow(2,t.zoom);return(new n.Size(t.source.tileWidth,t.source.tileHeight)).scale(r,r)},s.prototype.destroy=function(){this.element.children().remove(),t.prototype.destroy.call(this)},s}(t.wijmoWidget);n.wijmultiscaleimage=s;var o=function(){function e(e,t,n,r,i){this.columnIndex=e,this.rowIndex=t,this.bounds=n,this.zoomLevel=r,this.img=i}return e}(),u=function(){function e(){this.center=new n.Point(0,0),this.zoom=3}return e}();n.wijmultiscaleimage_options=u,s.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new u),r.wijmo.registerWidget("wijmultiscaleimage",s.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}));var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i=1,s=20,o=256,u=256,a="wijmo-wijmaps",f="wijmo-wijmaps-container",l="wijmo-wijmaps-tileslayer",c="wijmo-wijmaps-layercontainer",h=function(h){function p(){h.apply(this,arguments)}return e(p,h),p.prototype._create=function(){var e=this,t=e.options;e._setInnerSource(t.source,function(){e._createMaps()}),h.prototype._create.call(this)},p.prototype._createMaps=function(){var e=this,f=e.element,l=e.options,c,h,p,d,v,m;f.addClass(a),f.addClass(l.wijCSS.content),f.attr("tabindex",-1),e._isPanning=!1,e._isZooming=!1,e._isCenterChanging=!1,e._keyCode=t.getKeyCodeEnum(),e._innerSource?(e._minZoom=e._innerSource.minZoom,e._maxZoom=e._innerSource.maxZoom,e._coordConverter=new n.CoordConverter(f,new n.Point(l.center.x,l.center.y),l.zoom,e._innerSource.tileWidth,e._innerSource.tileHeight)):(e._minZoom=i,e._maxZoom=s,e._coordConverter=new n.CoordConverter(f,new n.Point(l.center.x,l.center.y),l.zoom,o,u)),l.targetCenter||(l.targetCenter=r.extend({},l.center)),l.targetZoom===undefined&&(l.targetZoom=l.zoom),e._createLayers(),l.targetZoom!==l.zoom&&(p=l.targetZoom,l.targetZoom=l.zoom,e._setTargetZoom(p));if(l.targetCenter.x!==l.center.x||l.targetCenter.y!==l.center.y)d=l.targetCenter,l.targetCenter=l.center,e._setTargetCenter(d);e._on(f,{dragstart:function(e,t){e.preventDefault()},selectstart:function(e,t){e.preventDefault()},mousewheel:function(t,r){var i=new n.Point(t.pageX-f.offset().left,t.pageY-f.offset().top);r>0?e._zoomIn(i):e._zoomOut(i),t.preventDefault()},dblclick:function(t,r){var i=new n.Point(t.pageX-f.offset().left,t.pageY-f.offset().top);e._zoomIn(i)},mousedown:function(t,i){f.focus(),e._isPanning=!0,e._panningStartPosition=new n.Point(t.pageX,t.pageY),r(document).disableSelection()},keydown:function(t,n){e._onKeyDown(t)&&t.preventDefault()},keypress:function(t,n){e._onKeyPress(t)&&t.preventDefault()}}),e._on(r(document),{mouseup:function(t,n){e._isPanning=!1,r(document).enableSelection()},mousemove:function(t,r){e._isPanning&&(c=e._panningStartPosition.x-t.pageX,h=e._panningStartPosition.y-t.pageY,e._panningStartPosition=new n.Point(t.pageX,t.pageY),e._panning(c,h))}})},p.prototype._innerDisable=function(){h.prototype._innerDisable.call(this),this._handleDisabledOption(!0)},p.prototype._innerEnable=function(){h.prototype._innerEnable.call(this),this._handleDisabledOption(!1)},p.prototype._handleDisabledOption=function(e){var t=this,n=t.options,i=t._layers,s={disabled:e};i&&r.each(i,function(e,t){t.element[t.wijname](s)}),t._innerSource&&t._multiScaleImageContainer.wijmultiscaleimage(s),n.showTools&&t._toolsLayerContainer.wijtoolslayer(s),e?t._disabledCover.show():t._disabledCover.hide()},p.prototype._setOption=function(e,t){var n=this,r=this.options;if(r[e]!==t)switch(e){case"center":n._setCenter(t);return;case"targetCenter":n._setTargetCenter(t);return;case"zoom":n._setZoom(t);return;case"targetZoom":n._setTargetZoom(t);return;case"layers":n._setLayers(t);return;case"showTools":n._setShowTools(t);return;case"source":n._setSource(t);return}h.prototype._setOption.call(this,e,t)},p.prototype._setInnerSource=function(e,t){var i=this,s=i.options,o;switch(e){case"bingMapsRoadSource":i._innerSource=n.MapSource.bingMapsRoadSource,o=!0;break;case"bingMapsAerialSource":i._innerSource=n.MapSource.bingMapsAerialSource,o=!0;break;case"bingMapsHybridSource":i._innerSource=n.MapSource.bingMapsHybridSource,o=!0;break;default:i._innerSource=e,o=!1}o&&s.bingMapsKey&&s.bingMapsKey!==""?r.ajax({url:"http://dev.virtualearth.net/webservices/v1/LoggingService/LoggingService.svc/Log?entry=0&auth="+s.bingMapsKey+"&fmt=1&type=3&group=wijmo&name=wijmaps&mkt=en-us&jsonp=?",data:null,context:null,success:function(e){i._authenticationResult=e?e.authenticationResultCode:"",i._sessionId=e?e.sessionId:"",t()},error:function(e){t()},dataType:"json",timeout:5e3}):t()},p.prototype._setShowTools=function(e){var t=this,n=t.options;n.showTools=e,e?t._createToolsLayer():t._destroyToolsLayer()},p.prototype._setSource=function(e){var t=this,n=t.options;n.source=e,t._setInnerSource(e,function(){t._refreshTileLayer()})},p.prototype._refreshTileLayer=function(){var e=this;e._destroyTileLayer(),e._innerSource?(e._minZoom=e._innerSource.minZoom,e._maxZoom=e._innerSource.maxZoom,e._coordConverter.tileWidth=e._innerSource.tileWidth,e._coordConverter.tileHeight=e._innerSource.tileHeight,e._createMultiScaleImageLayer()):(e._minZoom=i,e._maxZoom=s,e._coordConverter.tileWidth=o,e._coordConverter.tileHeight=u)},p.prototype._setLayers=function(e){var t=this;t.options.layers=e,t._destroyInnerLayers(),t._createInnerLayers()},p.prototype._setCenter=function(e){var t=this;t.options.targetCenter=e,t._trigger("targetCenterChanged",null,{targetCenter:e}),t._setCenterInternal(new n.Point(e.x,e.y))},p.prototype._setCenterInternal=function(e){var t=this,n=t.options;n.center={x:e.x,y:e.y},t._coordConverter.center=e,t._updateLayers(),t._trigger("centerChanged",null,{center:n.center})},p.prototype._setZoom=function(e,t){var n=this,r=n.options;e!==r.zoom&&e>=n._minZoom&&e<=n._maxZoom&&(n.options.targetZoom=e,n._trigger("targetZoomChanged",null,{targetZoom:e}),n._setZoomInternal(e,t))},p.prototype._setZoomInternal=function(e,t){var r=this,i=r.options,s,o,u;o=r._coordConverter.getViewCenter(),s=t?t:o,u=(new n.Size(s.x-o.x,s.y-o.y)).scale(1-Math.pow(2,i.zoom-e),1-Math.pow(2,i.zoom-e)),r._offsetCenter(u.width,u.height),i.zoom=e,r._coordConverter.zoom=e,r._updateLayers(),r._trigger("zoomChanged",null,{zoom:i.zoom})},p.prototype._zoomIn=function(e){var t=this,n=t.options,r=Math.min(Math.round(n.targetZoom+1),t._maxZoom);n.zoom!==r&&t._setTargetZoom(r,e)},p.prototype._zoomOut=function(e){var t=this,n=t.options,r=Math.max(Math.round(n.targetZoom-1),t._minZoom);n.zoom!==r&&t._setTargetZoom(r,e)},p.prototype._setTargetZoom=function(e,t){var n=this,r=n.options,i;e>n._maxZoom&&(e=n._maxZoom),e<n._minZoom&&(e=n._minZoom);if(e!==r.targetZoom){r.targetZoom=e,n._trigger("targetZoomChanged",null,{targetZoom:e});if(n._isZooming)return;n._isZooming=!0,clearInterval(n._targetZoomTimer),n._targetZoomTimer=setInterval(function(){n._isZooming&&(Math.abs(r.zoom-r.targetZoom)<.001?(i=r.targetZoom,n._isZooming=!1,clearInterval(n._targetZoomTimer)):i=r.targetZoom*r.targetZoomSpeed+r.zoom*(1-r.targetZoomSpeed),n._setZoomInternal(i,t))},20)}},p.prototype._setTargetCenter=function(e){var t=this,r=t.options,i,s=t._coordConverter;e.x<s.minLongitude&&(e.x=s.minLongitude),e.x>s.maxLongitude&&(e.x=s.maxLongitude),e.y<s.minLatitude&&(e.y=s.minLatitude),e.y>s.maxLatitude&&(e.y=s.maxLatitude);if(r.targetCenter.x!==e.x||r.targetCenter.y!==e.y){r.targetCenter=e,t._trigger("targetCenterChanged",null,{targetCenter:e});if(t._isCenterChanging)return;t._isCenterChanging=!0,clearInterval(t._targetCenterTimer),t._targetCenterTimer=setInterval(function(){t._isCenterChanging&&(Math.abs(r.targetCenter.x-r.center.x)<.001&&Math.abs(r.targetCenter.y-r.center.y)<.001?(i=new n.Point(r.targetCenter.x,r.targetCenter.y),t._isCenterChanging=!1,clearInterval(t._targetCenterTimer)):i=new n.Point(r.targetCenter.x*r.targetCenterSpeed+r.center.x*(1-r.targetCenterSpeed),r.targetCenter.y*r.targetCenterSpeed+r.center.y*(1-r.targetCenterSpeed)),t._setCenterInternal(i))},20)}},p.prototype._panning=function(e,t){var n=this,r=n.options;(e!==0||t!==0)&&n._offsetCenter(e,t)},p.prototype._offsetCenter=function(e,t){if(e===0&&t==0)return;var r=this,i=r._coordConverter,s=i.getFullMapSize(),o=(new n.Point(i.getLogicCenter())).offset(e/s.width,t/s.height),u=i.logicToGeographic(o);r._setCenter({x:u.x,y:u.y})},p.prototype._onKeyDown=function(e){var t=this,n=t.options,r=t._coordConverter,i=5,s,o=t._keyCode,u=r.getViewSize(),a=0,f=0;switch(e.which){case o.UP:f=-i;break;case o.DOWN:f=i;break;case o.LEFT:a=-i;break;case o.RIGHT:a=i;break;case o.HOME:a=-u.width;break;case o.END:a=u.width;break;case o.PAGE_UP:f=-u.height;break;case o.PAGE_DOWN:f=u.height;break;default:return!1}if(a!==0||f!==0)s=r.geographicToView(n.targetCenter),t._setTargetCenter(r.viewToGeographic({x:s.x+a,y:s.y+f}));return!0},p.prototype._onKeyPress=function(e){var t=this,n=t.options.targetZoom,r=n;switch(String.fromCharCode(e.which)){case"+":r++;break;case"-":r--;break;default:return!1}return n!==r&&t._setTargetZoom(r),!0},p.prototype._createLayers=function(){var e=this,t=e.options;e._container=r("<div class='"+f+"'></div>").appendTo(e.element),e._multiScaleImageContainer=r('<div class="'+c+" "+l+'"></div>').appendTo(e._container),e._innerSource&&e._createMultiScaleImageLayer(),e._layersContainer=r('<div class="'+c+'"></div>').appendTo(e._container),e._createInnerLayers(),e._toolsLayerContainer=r('<div class="'+c+'"></div>').appendTo(e._container),t.showTools&&e._createToolsLayer(),e._disabledCover=r("<div class='"+f+"'></div>").hide().appendTo(e.element)},p.prototype._createMultiScaleImageLayer=function(){var e=this,t=e.options;e._multiScaleImageContainer.wijmultiscaleimage(e._createMultiscaleimageOptions())},p.prototype._createInnerLayers=function(){var e=this,t=e.options,i=e.element;t.layers&&(e._layers=[],r.each(t.layers,function(t,r){var i=r.type===n.LayerType[3]?r.widgetName:"wij"+r.type+"layer",s=e._createLayer(i,r);s&&e._layers.push({wijname:i,options:r,element:s})}))},p.prototype._createToolsLayer=function(){var e=this,t=e.options;e._toolsLayerContainer.wijtoolslayer({center:new n.Point(t.center.x,t.center.y),zoom:t.targetZoom,minZoom:e._minZoom,maxZoom:e._maxZoom,converter:e._coordConverter}),e._toolsLayerContainer.on("wijtoolslayertargetzoomchanged."+e.widgetName,function(n,r){t.targetZoom!==r.targetZoom&&e._setTargetZoom(r.targetZoom)}).on("wijtoolslayertargetcenterchanged."+e.widgetName,function(n,r){r.targetCenter&&(!t.targetCenter||t.targetCenter.x!==r.targetCenter.x||t.targetCenter.y!==r.targetCenter.y)&&e._setTargetCenter({x:r.targetCenter.x,y:r.targetCenter.y})})},p.prototype._createLayer=function(e,t){var n=this,i=n._createWijlayerOptions(t),s=r('<div class="'+c+'"></div>');return n._layersContainer.append(s),s[e]?s[e](i):null},p.prototype._createWijlayerOptions=function(e){var t=this,i=t.options;return r.extend(new n.wijlayer_options,{disabled:t._isDisabled(),center:new n.Point(i.center.x,i.center.y),zoom:i.zoom,targetCenter:new n.Point(i.targetCenter.x,i.targetCenter.y),targetZoom:i.targetZoom,isZooming:t._isZooming,converter:t._coordConverter},e)},p.prototype._updateLayers=function(){var e=this,t=e.options,i=e._layers,s;e._coordConverter._updateSize(),i&&r.each(i,function(t,n){s=e._createWijlayerOptions(n.options),n.element[n.wijname]("beginUpdate"),n.element[n.wijname](s),n.element[n.wijname]("endUpdate")}),e._innerSource&&e._multiScaleImageContainer.wijmultiscaleimage(e._createMultiscaleimageOptions()),t.showTools&&e._toolsLayerContainer.wijtoolslayer({center:new n.Point(t.center.x,t.center.y),zoom:t.targetZoom,converter:e._coordConverter})},p.prototype._createMultiscaleimageOptions=function(){var e=this,t=e.options;return{source:e._innerSource,zoom:t.zoom,center:e._coordConverter.geographicToLogic(new n.Point(t.center.x,t.center.y))}},p.prototype.refreshLayers=function(){var e=this,t=e.options,n=e._layers;n&&r.each(n,function(e,t){t.element[t.wijname]("refresh")})},p.prototype.viewToGeographic=function(e){return this._coordConverter.viewToGeographic(e)},p.prototype.geographicToView=function(e){return this._coordConverter.geographicToView(e)},p.prototype.viewToLogic=function(e){return this._coordConverter.viewToLogic(e)},p.prototype.logicToView=function(e){return this._coordConverter.logicToView(e)},p.prototype.distance=function(e,t){return this._coordConverter.distance(e,t)},p.prototype.destroy=function(){var e=this,t=e.options,n=e.element;n.removeClass(a),n.removeClass(t.wijCSS.content),n.removeAttr("tabindex"),e.element.off("."+e.widgetName),r(document).off("."+e.widgetName),e._destroyLayers(),h.prototype.destroy.call(this)},p.prototype._destroyLayers=function(){var e=this,t=e.options;e._innerSource&&e._destroyTileLayer(),e._destroyInnerLayers(),t.showTools&&e._destroyToolsLayer(),e._container.remove(),e._disabledCover.remove()},p.prototype._destroyTileLayer=function(){var e=this;e._multiScaleImageContainer.data().wijmoWijmultiscaleimage&&e._multiScaleImageContainer.off("."+e.widgetName).wijmultiscaleimage("destroy")},p.prototype._destroyToolsLayer=function(){var e=this;e._toolsLayerContainer.data().wijmoWijtoolslayer&&this._toolsLayerContainer.off("."+e.widgetName).wijtoolslayer("destroy")},p.prototype._destroyInnerLayers=function(){var e=this;e._layers&&(r.each(e._layers,function(e,t){t.element[t.wijname]("destroy").remove()}),e._layers=null)},p}(t.wijmoWidget);n.wijmaps=h;var p=function(){function e(){this.source="bingMapsRoadSource",this.bingMapsKey="",this.center={x:0,y:0},this.zoom=1,this.showTools=!0,this.targetZoomSpeed=.3,this.targetCenterSpeed=.3,this.layers=[]}return e}();n.wijmaps_options=p,h.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new p),r.wijmo.registerWidget("wijmaps",h.prototype)})(t.maps||(t.maps={}));var n=t.maps})(wijmo||(wijmo={}))});