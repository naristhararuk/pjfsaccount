var wijmo;define(["./wijmo.wijgauge"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(t){var n=180,r=9,i=5,s=function(s){function o(){s.apply(this,arguments)}return e(o,s),o.prototype._create=function(){var e=this;s.prototype._create.call(this),e.element.addClass(this.options.wijCSS.radialGauge)},o.prototype._set_radius=function(){var e=this;e._autoCalculate(),e.redraw()},o.prototype._set_startAngle=function(){var e=this;e._redrawMarksAndLabels(),e._setPointer()},o.prototype._set_sweepAngle=function(e){var t=this;e>360&&(t.options.endAngle=360),t._redrawMarksAndLabels(),t._setPointer()},o.prototype._set_width=function(){var e=this;e._autoCalculate(),s.prototype._set_width.call(this)},o.prototype._set_height=function(){var e=this;e._autoCalculate(),s.prototype._set_height.call(this)},o.prototype._set_origin=function(){var e=this;e._autoCalculate()},o.prototype._set_cap=function(){var e=this;e._removeCap(),e._paintCap(),e._positionCapWithBehindPointer()},o.prototype._removeCap=function(){var e=this;e.cap&&(e._destroyRaphaelElement(e.cap),e.cap=null)},o.prototype._set_pointer=function(){var e=this;e._removePointer(),e._paintPointerExcludeCap(),e._setPointer(),e._positionCapWithBehindPointer()},o.prototype._clearState=function(){s.prototype._clearState.call(this),this.markBbox=null},o.prototype._clearElements=function(){s.prototype._clearElements.call(this),this._removeCap()},o.prototype._valueToAngleIncludeOffset=function(e){return t.GaugeUtil.mod360(this._valueToAngle(e)+n)},o.prototype._valueToAngle=function(e){var t=this,n=t._valueToLogical(e);return t._logicalToAngle(n)},o.prototype._angleToValue=function(e){var t=this,n=t._angleToLogical(e);return t._logicalToValue(n)},o.prototype._logicalToAngle=function(e){var t=this,n=t.options,r=n.startAngle,i=n.sweepAngle,s=n.isInverted;return s?r*e+(r+i)*(1-e):r*(1-e)+(r+i)*e},o.prototype._angleToLogical=function(e){var n=this,r=n.options,i=r.startAngle,s=r.isInverted,o=t.GaugeUtil.mod360(e-i),u=r.sweepAngle,a,f;return u===0||o===0?s?1:0:(u<0&&(o=360-o,u=-u),a=o-u,a>0?(f=360-o,a<f?1:0):s?1-o/u:o/u)},o.prototype._generatePoints=function(e,t,n,s){var o=this,u=o.options.isInverted,a=parseInt((r+r*(Math.abs(parseInt((t-e).toString(),10))/(r*i))).toString(),10),f=[],l,c,h,p,d;for(d=0;d<a;d++)l=d/(a-1),c=n+(s-n)*l,p=e+(t-e)*l,h=o._angleToValue(p),f.push(o._valueToPoint(h,c));return f},o.prototype._valueToPoint=function(e,t){var n=this,r=n._valueToAngleIncludeOffset(e)*Math.PI/180,i=t;return{x:i*Math.cos(r),y:i*Math.sin(r)}},o.prototype._pointToValue=function(e){var n=t.GaugeUtil.mod360(Math.atan2(e.x,-e.y)*180/Math.PI);return this._angleToValue(n)},o.prototype._radiusScreen=function(e){return Math.max(this.options.radius*e,0)},o.prototype._autoCalculate=function(){var e=this,n=e.options,r=n.width,i=n.height,s,o,u,a=t.GaugeUtil.formatString(n.max,n.labels.format),f=0,l,c=i-n.marginTop-n.marginBottom,h=r-n.marginLeft-n.marginRight;e.centerPoint={x:n.marginLeft+h*n.origin.x,y:n.marginTop+c*n.origin.y},e.radius=n.radius,n.radius==="auto"&&(e.faceRadius=Math.min(h,c)/2,l=e._getFaceBorder(),e.faceRadius-=l,s=e._getMarkerbbox(n.tickMajor).width,o=e._getMarkerbbox(n.tickMinor).width,u=e._getLabelBBox(a).width,n.tickMajor.position==="center"?(f-=s/2,f-=u):n.tickMajor.position==="outside"&&(f-=s,f-=u),n.tickMinor.position==="center"?f=Math.min(f,-o/2):n.tickMinor.position==="outside"&&(f=Math.min(f,-o)),e.radius=e.faceRadius+f,n.tickMajor.position!=="inside"&&(e.faceRadius+=f))},o.prototype._getFaceBorder=function(){var e=this,t=e._paintFace(),n=t.attr("stroke-width")||1;return t.type==="set"&&(n=t[0].attr("stroke-width")||1),t.wijRemove(),n},o.prototype._getMaxRangeWidth=function(){var e=this,t=e.options,n=0;return $.each(t.ranges,function(e,t){n=Math.max(n,t.width||0,t.startWidth||0,t.endWidth||0)}),n},o.prototype._getMarkerbbox=function(e){var t=this,n=t._paintMarkEle(e),r=n.wijGetBBox();return n.wijRemove(),{width:r.width,height:r.height}},o.prototype._paintMark=function(e,t,n){var r=this,i,s=t.position||"inside",o=t.offset||0;return i=r._paintMarkEle(t),i.attr(t.style),$.wijraphael.addClass($(i.node),r.options.wijCSS.radialGaugeMarker),$(i.node).data("value",e),r._applyAlignment(i,s,o),r._setMarkValue(e,i),i},o.prototype._applyAlignment=function(e,t,n){if(!e)return;var r=e.wijGetBBox(),i=r.width/2,s=0;switch(t){case"outside":s-=i+n;break;case"inside":s+=i+n}e.transform("t"+s+","+0)},o.prototype._paintMarkEle=function(e){var n=this,r=n.options,i={x:n.centerPoint.x-n.radius,y:n.centerPoint.y},s=e.marker||"circle",o=s==="rect"?5:2,u=2,a,f=e.style["stroke-width"]||0;if(s==="tri"||s==="invertedTri")o=5,u=3;return s==="cross"&&(e.style.fill=e.style.stroke||e.style.fill),isNaN(i.x)&&(i.x=0),a=o*e.factor,u+=f*2,a+=f*2,$.isFunction(s)?s.call(n,n.canvas,i,r):s==="tri"?n.canvas.isoTri(i.x,i.y,a,u,1):s==="invertedTri"?n.canvas.isoTri(i.x,i.y,a,u,0):t.GaugeUtil.paintMarker(n.canvas,s,i.x,i.y,a,u,!0)},o.prototype._setMarkValue=function(e,t){var n=this,r=n._valueToAngle(e);t.transform(Raphael.format("r{0},{1},{2}...",r,n.centerPoint.x,n.centerPoint.y))},o.prototype._paintLabel=function(e,n){var r=this,i=r._valueToAngle(e),s=n.format,o=n.style,u=n.offset,a=e.toString(),f=r.options.tickMajor,l=f.position||"inside",c,h,p,d,v;s!==""&&(a=t.GaugeUtil.formatString(e,s)),p=r._getMarkerBbox(),v=r._getLabelBBox(a);switch(l){case"inside":d=p.x+p.width+v.width/2;break;case"outside":d=p.x-v.width/2;break;default:d=p.x-v.width/2}return d=r.centerPoint.x-d+u,c=t.GaugeUtil.getPositionByAngle(r.centerPoint.x,r.centerPoint.y,d,i),h=r.canvas.text(c.x,c.y,a),h.attr(o),$.wijraphael.addClass($(h.node),r.options.wijCSS.radialGaugeLabel),h},o.prototype._getLabelBBox=function(e){var t=this,n=t.options,r,i;return r=t.canvas.text(0,0,e),r.attr(n.gaugeLableStyle),i=r.wijGetBBox(),r.wijRemove(),i},o.prototype._getMarkerBbox=function(){var e=this,t=e.options,n=t.tickMajor,r;return e.markBbox||(r=e._paintMarkEle(n),e._applyAlignment(r,n.position,n.offset||0),e.markBbox=r.wijGetBBox(),r.wijRemove()),e.markBbox},o.prototype._paintFace=function(){var e=this,t=e.options,n=Math.min(t.width,t.height)/2,r,i;return e.faceRadius&&(n=e.faceRadius),t.face&&t.face.template&&$.isFunction(t.face.template)?(i={canvas:e.canvas,r:n,origin:{x:e.centerPoint.x,y:e.centerPoint.y}},t.face.template.call(e,i)):(r=e.canvas.circle(e.centerPoint.x,e.centerPoint.y,n),t.face&&t.face.style&&r.attr(t.face.style),$.wijraphael.addClass($(r.node),t.wijCSS.radialGaugeFace),r)},o.prototype._paintPointer=function(){var e=this,t=e.options;e._paintPointerExcludeCap(),t.cap&&t.cap.visible&&(e._paintCap(),e._positionCapWithBehindPointer())},o.prototype._paintPointerExcludeCap=function(){var e=this,t=e.options,n=t.pointer,r=e.radius*n.length,i={x:e.centerPoint.x-r+n.offset*e.radius,y:e.centerPoint.y-n.width/2},s;if(!n.visible)return;n.template&&$.isFunction(n.template)?s=n.template.call(e.canvas,i,$.extend({},n,{length:r})):(n.shape==="rect"?s=e.canvas.rect(i.x-n.width/2,i.y,r,n.width):s=e.canvas.isoTri(i.x-n.width/2,i.y,r,n.width),n.style&&s.attr(n.style)),e.pointer=s,$.wijraphael.addClass($(s.node),t.wijCSS.radialGaugePointer)},o.prototype._paintCap=function(){var e=this,t=e.options,n=t.cap,r;if(!n)return;if(n.template&&$.isFunction(n.template))return r={canvas:e.canvas,origin:{x:e.centerPoint.x,y:e.centerPoint.y}},n.template.call(e,r);e.cap=e.canvas.circle(e.centerPoint.x,e.centerPoint.y,n.radius),n.style&&e.cap.attr(n.style),$.wijraphael.addClass($(e.cap.node),t.wijCSS.radialGaugeCap)},o.prototype._positionCapWithBehindPointer=function(){var e=this,t=e.options;t.cap&&t.cap.visible&&(t.cap.behindPointer?e.pointer&&e.pointer.toFront():e.cap&&e.cap.toFront())},o.prototype._paintRange=function(e){var t=this,n=t.options,r=isNaN(e.startValue)?0:e.startValue,i=isNaN(e.endValue)?0:e.endValue,s=isNaN(e.startWidth)?isNaN(e.width)?0:e.width:e.startWidth,o=isNaN(e.endWidth)?isNaN(e.width)?0:e.width:e.endWidth,u=e.startDistance||1,a=e.endDistance||1,f,l;r!==i&&(i>r?(f=Math.max(r,n.min),l=Math.min(n.max,i)):(f=Math.max(n.min,i),l=Math.min(n.max,r)),u*=t.radius,a*=t.radius,t._drawRange(f,l,u,a,s,o,e))},o.prototype._drawRange=function(e,t,n,r,i,s,o){var u=this,a=u._valueToAngle(e),f=u._valueToAngle(t),l=u._generatePoints(a,f,i+n,s+r),c=u._generatePoints(a,f,n,r),h,p,d=[];$.each(l,function(e,t){d.push(e===0?"M":"L"),d.push($.round(t.x+u.centerPoint.x),",",$.round(t.y+u.centerPoint.y))});for(h=c.length-1;h>=0;h--)d.push("L",$.round(c[h].x+u.centerPoint.x),",",$.round(c[h].y+u.centerPoint.y));d.push("Z"),p=u.canvas.path(d.join()),p.attr(o.style),u.ranges.push(p),$.wijraphael.addClass($(p.node),u.options.wijCSS.radialGaugeRange)},o.prototype._setOffPointerValue=function(){var e=this,t=e._valueToAngle(0);e.pointer.transform(Raphael.format("r{0},{1},{2}",t,e.centerPoint.x,e.centerPoint.y))},o.prototype._setPointer=function(){var e=this,t=e.options,n=e._valueToAngle(t.value),r=t.animation,i=Raphael.format("r{0},{1},{2}",n,e.centerPoint.x,e.centerPoint.y);if(!e.pointer)return;s.prototype._setPointer.call(this),r.enabled?e.pointer.stop().wijAnimate({transform:i},r.duration,r.easing):e.pointer.transform(i)},o.prototype.destroy=function(){s.prototype.destroy.call(this),this.element.removeClass(this.options.wijCSS.radialGauge)},o.prototype._clearVariables=function(){s.prototype._clearVariables.call(this);var e=this;e.radius=null,e.centerPoint=null,e.faceRadius=null},o}(t.wijgauge);t.wijradialgauge=s,s.prototype.widgetEventPrefix="wijradialgauge";var o=function(){function e(){this.initSelector=":jqmData(role='wijradialgauge')",this.wijCSS={radialGauge:"wijmo-wijradialgauge",radialGaugeLabel:"wijmo-wijradialgauge-label",radialGaugeMarker:"wijmo-wijradialgauge-mark",radialGaugeFace:"wijmo-wijradialgauge-face",radialGaugePointer:"wijmo-wijradialgauge-pointer",radialGaugeCap:"wijmo-wijradialgauge-cap",radialGaugeRange:"wijmo-wijradialgauge-range"},this.radius="auto",this.startAngle=0,this.sweepAngle=180,this.pointer={length:.8,style:{fill:"#1E395B",stroke:"#1E395B"},width:8,offset:.15,shape:"tri",visible:!0,template:null},this.origin={x:.5,y:.5},this.labels={format:"",style:{fill:"#1E395B","font-size":12,"font-weight":"800"},offset:30,visible:!0},this.tickMinor={position:"inside",offset:30,style:{fill:"#1E395B"},visible:!0,factor:1,marker:"rect",interval:5},this.tickMajor={position:"inside",offset:27,style:{fill:"#1E395B",stroke:"#1E395B","stroke-width":1},visible:!0,interval:10,factor:2,marker:"rect"},this.cap={radius:15,style:{fill:"#1E395B",stroke:"#1E395B"},behindPointer:!1,visible:!0,template:null},this.face={style:{fill:"r(0.9, 0.60)#FFFFFF-#D9E3F0",stroke:"#7BA0CC","stroke-width":4},template:null}}return e}();s.prototype.options=$.extend(!0,{},t.wijgauge.prototype.options,new o),$.wijmo.registerWidget("wijradialgauge",s.prototype)})(t.gauge||(t.gauge={}));var n=t.gauge})(wijmo||(wijmo={}))});