var wijmo;define(["./wijmo.widget","globalize"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(n){(function(r){"use strict";var i=jQuery,s="wijtooltip",o="@wijtp@",u="wijmo-wijtooltip",a=u+"-arrow-",f=parseFloat,l=window,c=document,h=Math,p=h.max,d,v=function(n){function r(){n.apply(this,arguments)}return e(r,n),r.prototype._setOption=function(e,t){var r=this,s="_set_"+e,o=r.options[e];if(e==="controlwidth"){r._setSize("width",t);return}if(e==="controlheight"){r._setSize("height",t);return}n.prototype._baseWidget.call(this).prototype._setOption.apply(r,arguments),i.isPlainObject(t)&&(r.options[e]=i.extend({},o,t)),r[s]&&r[s](o),r._isDisabled()&&r._hideTooltip()},r.prototype._set_cssClass=function(){var e=this,t=e.options,n=e._tooltipCache._$tooltip;if(!n)return;n.hasClass(t.cssClass)||n.addClass(t.cssClass)},r.prototype._set_content=function(e){var t=this;t._isAjaxCallback?(t._callbacked=!0,t.show(),t._callbacked=!1):t._setText()},r.prototype._create=function(){var e=this,t=e.options,i=e.element,s=i&&i.attr("id"),u="",a="",f=t.group||o,l=r._getTooltip(f);l?l.count++:(l=e._createTooltip(),l.count=1,r._tooltips[f]=l),a=t.cssClass?t.cssClass:"",l._$tooltip.hasClass(a)||l._$tooltip.addClass(a),t.position.of=e.element,e._bindLiveEvents(),e._tooltipCache=l,s&&(u=l._$tooltip.attr("aria-describedby"),u=u===undefined?"":u+" ",l._$tooltip.attr("aria-describedby",u+s)),t.controlwidth&&t.controlwidth!==""&&e._setSize("width",t.controlwidth),t.controlheight&&t.controlheight!==""&&e._setSize("height",t.controlheight),n.prototype._baseWidget.call(this).prototype._create.apply(e,arguments)},r.prototype.destroy=function(){var e=this,t=e.element,i=e.options.group||o,s=e._tooltipCache._showAtAnimationTimer;t.unbind(".tooltip"),t.attr("title",e._content),n.prototype.destroy.call(this),s&&(clearTimeout(s),s=null),r._removeTooltip(i),e._tooltipCache=null},r.prototype.widget=function(){return this._tooltipCache._$tooltip},r.prototype.show=function(){this.showAt(null)},r.prototype.showAt=function(e){var t=this,n=t._tooltipCache,r=n?n._$tooltip:null,s=t.options;if(!n||t._isDisabled())return;r.stop(!0,!0),n._showAnimationTimer&&(clearTimeout(n._showAnimationTimer),n._showAnimationTimer=null),n._showAtAnimationTimer&&(clearTimeout(n._showAtAnimationTimer),n._showAtAnimationTimer=null),n._hideAnimationTimer&&(clearTimeout(n._hideAnimationTimer),n._hideAnimationTimer=null);if(!e){if(s.ajaxCallback&&i.isFunction(s.ajaxCallback)&&!t._callbacked){t._isAjaxCallback=!0,s.ajaxCallback.call(t.element);return}t._setText()}s.showDelay?n._showAtAnimationTimer=setTimeout(function(){t._showToolTipHelper(e,r)},s.showDelay):t._showToolTipHelper(e,r)},r.prototype.hide=function(){var e=this,t=e._tooltipCache;if(!t)return;t._showAnimationTimer&&(clearTimeout(t._showAnimationTimer),t._showAnimationTimer=null),t._showAtAnimationTimer&&(clearTimeout(t._showAtAnimationTimer),t._showAtAnimationTimer=null),t._hideAnimationTimer&&(clearTimeout(t._hideAnimationTimer),t._hideAnimationTimer=null),e.options.hideDelay?t._hideAnimationTimer=setTimeout(i.proxy(e._hideTooltip,e),e.options.hideDelay):e._hideTooltip()},r.prototype._createTooltip=function(){var e=this,n=e.options,r=new t,s=i("<div></div>").addClass(n.wijCSS.tooltip).addClass(n.wijCSS.widget).addClass(n.wijCSS.content).addClass(n.wijCSS.cornerAll),o=i("<div></div>").addClass(n.wijCSS.tooltipContainer),u=i("<div></div>").addClass(n.wijCSS.content).addClass(n.wijCSS.tooltipPointer).append(i("<div></div>").addClass(n.wijCSS.tooltipPointerInner)),a=i("<div></div>").addClass(n.wijCSS.tooltipTitle).addClass(n.wijCSS.header).addClass(n.wijCSS.cornerAll),f=i("<a href='#'></a>").addClass(n.wijCSS.tooltipClose).addClass(n.wijCSS.stateDefault).addClass(n.wijCSS.cornerAll);return f.append(i("<span></span>").addClass(n.wijCSS.icon).addClass(n.wijCSS.iconClose)).unbind("click").bind("click",i.proxy(e._onClickCloseBtn,e)),n.closeBehavior!=="sticky"&&f.hide(),n.showCallout||u.hide(),s.append(a).append(f).append(o).append(u).css("position","absolute").attr("role","tooltip").appendTo("body").hide(),r._$tooltip=s,r._container=o,r._callout=u,r._closeBtn=f,r._title=a,r},r.prototype._showToolTipHelper=function(e,t){if(e){var n=this,r=n._tooltipCache,i={},s,o,u=t.is(":visible"),a=r?r._callout:null;if(!a)return;n._setText(),d=t.offset(),t.offset({left:0,top:0}).show(),s=n._getCalloutShape(),i=this._getOffsetPosition(e,t,a,s),o=n._flipTooltip(i,s),n._setUnfilledCallout(o),t&&o!=s&&(i=this._getOffsetPosition(e,t,a,o)),t.offset(i),u||t.hide(),n._calloutShape=o}else{d=t.offset();if(this.options.mouseTrailing){this._setCalloutCss();if(t.is(":visible"))return}this._setPosition()}this._showTooltip()},r.prototype._getOffsetPosition=function(e,t,n,r){var i={left:0,top:0},s=t.width(),o=t.height(),u,f,l,c,h;this._removeCalloutCss(),t.addClass(a+r),c=n.position().left,h=n.position().top,u=this._getBorder(n),f=u.left||u.right,l=u.top||u.bottom;switch(r){case"rt":i={left:e.x-s-f,top:e.y-h};break;case"rc":i={left:e.x-s-f,top:e.y-o/2};break;case"rb":i={left:e.x-s-f,top:e.y-h-l};break;case"lt":i={left:e.x+f,top:e.y-h};break;case"lc":i={left:e.x+f,top:e.y-o/2};break;case"lb":i={left:e.x+f,top:e.y-h-l};break;case"tl":i={left:e.x-c,top:e.y+l};break;case"tc":i={left:e.x-s/2,top:e.y+l};break;case"tr":i={left:e.x-c-f,top:e.y+l};break;case"bl":i={left:e.x-c,top:e.y-o-l};break;case"bc":i={left:e.x-s/2,top:e.y-o-l};break;case"br":i={left:e.x-c-f,top:e.y-o-l};break;case"cc":i={left:e.x-s/2,top:e.y-o/2}}return i},r.prototype._bindLiveEvents=function(){var e=this,t=e.options,n=e.element;e._content===undefined&&(e._content=n.attr("title"),n.attr("title","")),n.unbind(".tooltip"),t.mouseTrailing&&n.bind("mousemove.tooltip",function(n){if(e._isDisabled())return;var r=t.position.offset||"",i=r.split(" ");i.length===2?e.showAt({x:n.pageX+parseInt(i[0],10),y:n.pageY+parseInt(i[1],10)}):e.showAt({x:n.pageX,y:n.pageY})}),n.bind("mouseout.tooltip",i.proxy(e._hideIfNeeded,e));switch(t.triggers){case"hover":n.bind("mouseover.tooltip",i.proxy(e.show,e));break;case"click":n.bind("click.tooltip",i.proxy(e.show,e));break;case"focus":n.bind("focus.tooltip",i.proxy(e.show,e)).bind("blur.tooltip",i.proxy(e._hideIfNeeded,e));break;case"rightClick":n.bind("contextmenu.tooltip",function(t){e.show(),t.preventDefault()})}},r.prototype._hideIfNeeded=function(){var e=this,t=e.options,n=t.closeBehavior,r=e._tooltipCache&&e._tooltipCache._$tooltip&&e._tooltipCache._$tooltip.is(":visible");if(n==="sticky"||t.modal||!r||n==="none"||e._isDisabled())return;e.hide()},r.prototype._flipTooltip=function(e,t){var n=this,r=n._tooltipCache,i=r?r._$tooltip:null,s={width:i.width(),height:i.height()},o,u,a,f;return o=n._flipCallout(e,s,t),o.calloutShape},r.prototype._flipCallout=function(e,t,n){var r=this,s=r.options,o=r._tooltipCache,u=o._$tooltip,f={h:!1,v:!1},c=i(l),h=(s.position.collision||"flip").split(" ");h.length===1&&(h[1]=h[0]);if(!o||h[0]!=="flip"&&h[1]!=="flip")return{flip:f,calloutShape:null};h[0]==="flip"&&(e.left<0&&(f.h=!0,n.indexOf("r")>-1&&(n=n.replace(/r/,"l"),f.h="r")),e.left+t.width>c.width()+c.scrollLeft()&&(f.h=!0,n.indexOf("l")>-1&&(n=n.replace(/l/,"r"),f.h="l"))),h[0]==="flip"&&(e.top<0&&(f.v=!0,n.indexOf("b")>-1&&(n=n.replace(/b/,"t"),f.v="b")),e.top+t.height>c.height()+c.scrollTop()&&(f.v=!0,n.indexOf("t")>-1&&(n=n.replace(/t/,"b"),f.v="t")));if(f.h||f.v)r._removeCalloutCss(),u.addClass(a+n);return{flip:f,calloutShape:n}},r.prototype._set_position=function(e){var t=this,n=t.options,r=n.position;n.showCallout&&((e.my!==r.my||e.at!==r.at)&&t._setPosition(),t._setCalloutOffset(!0)),t._setText()},r.prototype._set_showCallout=function(){var e=this,t=e._tooltipCache,n=t?t._callout:null;if(!t||!n)return;e.options.showCallout?(e._setCalloutCss(),n.show()):n.hide(),e._setPosition()},r.prototype._set_closeBehavior=function(){var e=this,t=e._tooltipCache,n=t?t._closeBtn:null;n&&n[e.options.closeBehavior==="sticky"?"show":"hide"]()},r.prototype._set_triggers=function(){this._bindLiveEvents()},r.prototype._set_mouseTrailing=function(){this._bindLiveEvents()},r.prototype._getCalloutShape=function(){var e=this,t=e.options.position,n=function(e){return i.makeArray(i.map(e,function(e){return e.substr(0,1)}))},r=n(t.my.split(" ")),s=n(t.at.split(" ")),o=[];return r.length===2&&(o=r),r[0]===s[0]?(r[1]==="t"&&s[1]==="b"||r[1]==="b"&&s[1]==="t")&&o.reverse():s[0]==="c"&&o.reverse(),o[0]==="c"&&o.reverse(),o.join("")},r.prototype._setCalloutCss=function(){var e=this,t=e.options,n=e._tooltipCache,r=n?n._$tooltip:null,s="",o="",u=i.support.isTouchEnabled;if(!t.showCallout&&!u)return;e._removeCalloutCss(),o=e._getCalloutShape(),s=a+o,r&&r.addClass(s)},r.prototype._removeCalloutCss=function(){var e=this._tooltipCache,t;e&&(t=e._$tooltip,i.each(["tl","tc","tr","bl","bc","br","rt","rc","rb","lt","lc","lb","cc"],function(e,n){var r=a+n;if(t.hasClass(r))return t.removeClass(r),!1}))},r.prototype._getBorder=function(e){var t={};return i.each(["top","right","left","bottom"],function(n,r){t[r]=f(e.css("border-"+r+"-width"))}),t},r.prototype._setPosition=function(){var e=this,t=e.options,n=t.position,r=n.my,s=e._tooltipCache,o=s?s._$tooltip:null,u=o.is(":hidden"),a=e._getCalloutShape(),l=a?a.split(""):null,c=[0,0],h=s._callout,p,d,v,m,g,y={width:o.width(),height:o.height()},b,w,E=i.support.isTouchEnabled;e._setCalloutCss(),u&&o.show(),o.css({left:0,top:0});if(t.showCallout){p=e._getBorder(h),v=f(h.css("left")),d=f(h.css("top")),m=f(h.css("right")),g=f(h.css("bottom"));switch(l[0]){case"l":c[0]=p.right;break;case"r":c[0]=-p.left;break;case"b":c[1]=g;break;case"t":c[1]=-d}switch(l[1]){case"t":c[1]=-d;break;case"b":c[1]=g;break;case"r":c[0]=m;break;case"l":c[0]=-v}}if(E&&E()){switch(l[0]){case"l":c[0]=c[0]+30;break;case"r":c[0]=c[0]-30;break;case"b":c[1]=c[1]-30;break;case"t":c[1]=c[1]+30}switch(l[1]){case"t":c[1]=c[1]+30;break;case"b":c[1]=c[1]-30;break;case"r":c[0]=c[0]-30;break;case"l":c[0]=c[0]+30}}n.my.indexOf(" ")>-1?r=n.my.split(" ")[0]+"+"+c[0]+" "+n.my.split(" ")[1]+"+"+c[1]:r=n.my+"+"+c[0]+" "+n.my+"+"+c[1],o.position({my:r,at:n.at,of:n.of,collision:"none none"}),b=e._flipCallout(o.offset(),y,a),w=b.flip;if(w.h||w.v)o.css({left:0,top:0}),o.position({my:r,at:n.at,of:n.of,collision:n.collision});t.showCallout&&e._setUnfilledCallout(a),e._calloutShape=a,u&&o.hide()},r.prototype._setCalloutOffset=function(e){var t=this,n=t.options,r=t._tooltipCache,s=r?r._$tooltip:null,o=r&&r._callout,u=t._calloutShape,a=!1,f=n.position.offset,l="",c=[],h=n.calloutAnimation;if(!o)return;if(!f||f.length===0)return;o.stop(!0,!0),i.each(["tr","tc","tl","bl","bc","br"],function(e,t){if(u===t)return a=!0,!1}),f&&(c=f.split(" "),c.length===2?l=a?c[0]:c[1]:c.length===1&&(l=c[0])),c&&c.length===2&&c[0]==="none"&&c[1]==="none"?o.css("left","").css("top",""):l==="none"?o.css(a?"left":"top",""):l!==""&&(e&&!e.disabled?a?o.animate({left:l},h.duration,h.easing):o.animate({top:l},h.duration,h.easing):o.css(a?"left":"top",l))},r.prototype._setUnfilledCallout=function(e){var t=this,n=t._tooltipCache,r=n?n._$tooltip:null,i=n&&n._callout,s=i&&i.children(),o=e.split(""),u=r?r.css("background-color"):"";if(!s)return;s.css({"border-left-color":"","border-top-color":"","border-bottom-color":"","border-right-color":""});if(!t.options.calloutFilled)switch(o[0]){case"l":s.css("border-right-color",u);break;case"t":s.css("border-bottom-color",u);break;case"r":s.css("border-left-color",u);break;case"b":s.css("border-top-color",u)}},r.prototype._showTooltip=function(){var e=this,t=e.options,n=e._tooltipCache,s=n?n._$tooltip:null,o,u,a;if(!n)return;if(e._trigger("showing",null,e)===!1){s.is(":visible")&&s.hide();return}e._showModalLayer(),s.css("z-index",99999),i.fn.wijshow?(u={show:!0,context:s},o=i.extend({},t.animation,t.showAnimation),s.is(":visible")&&(a=s.offset(),s.offset(d),i.extend(u,{pos:a}),o.animated="tooltipSlide"),s.wijshow(o,r.animations,u,null,function(){e._trigger("shown")})):(s.show(),e._trigger("shown")),e._setCalloutOffset(!1)},r.prototype._hideTooltip=function(){var e=this,t=e.options,n=e._tooltipCache,s=n?n._$tooltip:null,o=i.extend({},t.animation,t.hideAnimation),u;if(!n)return;if(e._trigger("hiding",null,e)===!1)return;e._hideModalLayer(),i.fn.wijhide?(u={show:!1,context:s},s.wijhide(o,r.animations,u,null,function(){e._trigger("hidden"),s.css("z-index","")})):(s.hide(),e._trigger("hidden"),s.css("z-index",""))},r.prototype._getContent=function(e){var t={data:""},n;return i.isFunction(e)?(n=e.call(this.element,t),t.data!==""?t.data:n):window[e]&&i.isFunction(window[e])?(n=window[e].call(this.element,t),t.data!==""?t.data:n):e},r.prototype._setText=function(){var e=this,t=e.options,n=e._tooltipCache,r="",i="",s=n?n._title:null;if(!n)return;r=e._getContent(t.content),r=r===""?e._content:r,n._container.html(r),i=e._getContent(t.title),i!==""?s.html(i).show():s.hide()},r.prototype._showModalLayer=function(){var e=this,t=e.options,n=null;e.options.modal&&(n=i("<div>").addClass(t.wijCSS.overlay).css("z-index",99e3).width(e._getDocSize("Width")).height(e._getDocSize("Height")).appendTo("body"),i(window).bind("resize.wijtooltip",function(){n.width(e._getDocSize("Width")).height(e._getDocSize("Height"))}),e._tooltipCache._modalLayer=n)},r.prototype._hideModalLayer=function(){var e=this,t=e._tooltipCache._modalLayer;t&&(t.css("z-index","").remove(),t=null,i(window).unbind("resize.wijtooltip"))},r.prototype._getDocSize=function(e){var t,n,r="documentElement",s="body";return i.browser.msie&&parseFloat(i.browser.version)<9?(t=p(c[r]["scroll"+e],c[s]["scroll"+e]),n=p(c[r]["offset"+e],c[s]["offset"+e]),t<n?i(l)[e.toLowerCase()]()+"px":t+"px"):i(c)[e.toLowerCase()]()+"px"},r.prototype._setSize=function(e,t){var n=this,r=n._tooltipCache,i=r?r._$tooltip:null;i&&i.css(e,t)},r.prototype._onClickCloseBtn=function(e){this.hide(),e.preventDefault()},r._getTooltip=function(e){return r._tooltips[e]},r._removeTooltip=function(e){var t=r._tooltips[e];t&&(t.count--,t.count<=0&&(t._title.remove(),delete t._title,t._closeBtn.unbind(),t._closeBtn.remove(),delete t._closeBtn,t._callout.remove(),delete t._callout,t._container.remove(),delete t._container,t._$tooltip.remove(),delete t._$tooltip,t._modalLayer&&(t._modalLayer.remove(),delete t._modalLayer),r._tooltips[e]=null,delete r._tooltips[e]))},r._tooltips=new Array,r.animations={fade:function(e,t){e=i.extend({duration:300,easing:"swing"},e,t),e.context.stop(!0,!0).animate(e.show?{opacity:"show"}:{opacity:"hide"},e)},tooltipSlide:function(e,t){e=i.extend({duration:300,easing:"swing"},e,t),e.context.stop(!0,!0).animate({left:e.pos.left,top:e.pos.top},e)}},r}(n.wijmoWidget);r.wijtooltip=v;var m=function(){function e(){this.initSelector=":jqmData(role='wijtooltip')",this.wijCSS={tooltip:"wijmo-wijtooltip",tooltipContainer:"wijmo-wijtooltip-container",tooltipPointer:"wijmo-wijtooltip-pointer",tooltipPointerInner:"wijmo-wijtooltip-pointer-inner",tooltipTitle:"wijmo-wijtooltip-title",tooltipClose:"wijmo-wijtooltip-close"},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-a",stateDefault:"ui-btn ui-btn-a",stateHover:"ui-btn-down-a",stateActive:"ui-btn-down-a"},this.content="",this.title="",this.closeBehavior="auto",this.mouseTrailing=!1,this.triggers="hover",this.position={my:"left bottom",at:"right top",offset:null},this.showCallout=!0,this.animation={animated:"fade",duration:500,easing:null},this.showAnimation={},this.hideAnimation={},this.showDelay=150,this.hideDelay=150,this.calloutAnimation={duration:1e3,disabled:!1,easing:null},this.calloutFilled=!1,this.modal=!1,this.group=null,this.ajaxCallback=null,this.showing=null,this.shown=null,this.hiding=null,this.hidden=null,this.cssClass="",this.controlwidth=null,this.controlheight=null}return e}();v.prototype.options=i.extend(!0,{},n.wijmoWidget.prototype.options,new m),i.wijmo.registerWidget(s,v.prototype)})(n.tooltip||(n.tooltip={}));var r=n.tooltip})(wijmo||(wijmo={}));var t=function(){function e(){}return e}()});