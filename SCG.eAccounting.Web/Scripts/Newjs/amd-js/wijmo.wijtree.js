var wijmo;define(["./wijmo.widget","./wijmo.wijtextbox","./wijmo.wijutil"],function(){var e=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};(function(t){(function(n){var r=jQuery,i="wijtree",s="wijtreenode",o={wijtreeInner:"wijmo-wijtree-inner"},u=function(e){var t=[];for(var n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})},a=function(e,t){var n=r.wijmo.wijtreenode.prototype.options.wijCSS,i="<div class='wijmo-checkbox ui-widget' role='checkbox'><div class='wijmo-checkbox-box ui-widget ui-corner-all {0}' style='position: relative;'><span class='{1}'></span></div></div>",s=[n.stateDefault],o=["wijmo-checkbox-icon"];return t==="triState"||t==="indeterminate"?(s.push(n.stateActive),o.push(n.icon),o.push(n.iconStop)):e&&(s.push(n.stateActive),o.push(n.icon),o.push(n.iconCheck)),u(i,s.join(" "),o.join(" "))},f=function(e,t,n){typeof n=="undefined"&&(n=!1);var i="",s=r.wijmo.wijtreenode.prototype.options;return r.each(e,function(e,u){if(!r.isPlainObject(u))return!0;var l=u.navigateUrl||"#",c=u.nodes&&u.nodes.length>0,h=u.expanded===null||u.expanded===undefined?s.expanded:u.expanded,p=u.wijCSS===null||u.wijCSS===undefined?s.wijCSS:u.wijCSS,d="<li class='"+(c?"wijmo-wijtree-parent":"wijmo-wijtree-item")+"'><div class='wijmo-wijtree-node "+p.stateDefault+(c?" wijmo-wijtree-header ":"")+(t&&c?h?"wijmo-state-expanded":"wijmo-state-collapsed":"")+"' role='treeitem' aria-expanded='false' aria-checked='false' aria-selected='false'><span class='"+o.wijtreeInner+" "+p.wijtreeInner+" "+p.helperClearFix+" "+p.cornerAll+"'>";c&&(d+="<span class='wijmo-wijtree-hitarea "+(t?p.icon+" "+(h?p.iconArrowRightDown:p.iconArrowRight):"")+"'></span>"),d+="<span class='wijmo-wijtree-nodeimage'></span>",n&&(d+=a(u.checked,u.checkState)),d+=r.browser.safari?"<a href='"+l+"'>":"<a class='wijmo-wijtree-link' href='"+l+"'>",typeof u.text=="string"&&u.text&&(d+="<span>"+u.text+"</span>"),d+="</a></span></div>",c&&(d+="<ul class='wijmo-wijtree-list wijmo-wijtree-child "+p.helperReset+"'",t&&!h&&(d+=" style='display: none'"),d+=">",d+=f(u.nodes,t,n),d+="</ul>"),d+="</li>",i+=d}),i},l=function(e,t,n,i,s){return r.fn[i]&&(e.data("owner",n),!!t&&r.isPlainObject(t)?(r.extend(t,{treeClass:s}),e[i](t)):e[i]({treeClass:s})),e},c=function(e,t,n,i,s){return r.fn[i]?(l(e,t,n,i,s),e.data(e.data("widgetName"))):null},h=function(e,t){if(t==undefined)return;return e.each(function(){this.innerHTML="",r(this).append(t)})},p=function(e){var t=e.data(e.data("widgetName"));return r.isPlainObject(t)?null:t},d=function(e,t){t?e.removeAttr("tabindex"):e.attr("tabindex")!=="-1"&&e.attr("tabindex","-1")},v=function(t){function n(){t.apply(this,arguments)}return e(n,t),n.prototype._create=function(){window.wijmoApplyWijTouchUtilEvents&&(r=window.wijmoApplyWijTouchUtilEvents(r)),this._initState(),this._createTree(),this._attachEvent(),this._attachNodeEvent(),t.prototype._create.call(this)},n.prototype._setOption=function(e,n){var r=this,i=!1,s=r.options,o;switch(e){case"allowDrag":r._setAllowDrag(n);break;case"allowDrop":r._setAllowDrop(n);break;case"showCheckBoxes":r._setCheckBoxes(n);break;case"showExpandCollapse":r.options.showExpandCollapse!==n&&(i=!0);break;default:}t.prototype._setOption.call(this,e,n),e==="nodes"&&(n&&n.length?r._createChildNodes():r._clearChildNodes()),i===!0&&r._setHitArea(n)},n.prototype._innerDisable=function(){t.prototype._innerDisable.call(this),this._toggleDisableTree(!0)},n.prototype._innerEnable=function(){t.prototype._innerEnable.call(this),this._toggleDisableTree(!1)},n.prototype._toggleDisableTree=function(e){this._setAllowDrag(!e)},n.prototype._initState=function(){var e=this,t=e.options;e._selectedNodes=[],e._checkedNodes=[],t.nodes||(t.nodes=[]),e._insertPosition="unKnown",e.nodeWidgetName="wijtreenode"},n.prototype._initVariable=function(){var e=this;e._creatingNode=!1,e._allNodesCreated=!1,e._initNodesCreated=!1,e._initializingTree=!1,e._nextNodeIndex=0,e._nodesCntPerPage=0,e._totalNodesCreated=0},n.prototype._createTree=function(){var e=this,t=e.options,n=["wijmo-wijtree",t.wijCSS.widget,t.wijCSS.content,t.wijCSS.helperClearFix,t.wijCSS.cornerAll].join(" "),i=["wijmo-wijtree-list ",t.wijCSS.helperReset,t.showExpandCollapse?"":"wijmo-wijtree-allexpanded"].join(" "),s=e.element;s.is("ul")?(e.$nodes=s,s.wrap("<div></div>"),e.widgetDom=s.parent()):s.is("div")&&(e.widgetDom=s,e.$nodes=e.widgetDom.children("ul").eq(0)),e.$nodes.length&&(e.widgetDom.addClass(n).attr({role:"tree","aria-multiselectable":!0}),e.$nodes.addClass(i),e._createChildNodes(),e.widgetDom.append(r("<div>").css("clear","both")),d(e.element.find(".wijmo-wijtree-link:gt(0)"),!1))},n.prototype._clearChildNodes=function(){this.$nodes.empty(),this.nodes&&this.nodes.length&&(this.nodes.length=0)},n.prototype._getItemHeight=function(){return this.$nodes.children("li:first").children(".wijmo-wijtree-node").outerHeight(!0)},n.prototype._createNodesAtIdle=function(){this._creatingNode||this._createNodesPartially(!1);return},n.prototype._createNodesPartially=function(e){this._creatingNode=!0;if(this._allNodesCreated||!this.options.nodes||!this.options.nodes.length){this._unbindCreateNodesEvent();return}var t=this,n={nIndex:undefined,htmlGenerated:!0},i,s=t.$nodes.children("li"),o,u=t._totalNodesCreated;i=t._getField("nodes");if(!i)return;while(t._nextNodeIndex<s.length){if(i[t._nextNodeIndex]!=null){t._nextNodeIndex++;continue}n.nIndex=t._nextNodeIndex,o=c(r(s[t._nextNodeIndex]),n,t,t.nodeWidgetName,t.widgetFullName),i[t._nextNodeIndex]=o,t._nextNodeIndex++;if(!e&&u+t._nodesCntPerPage<t._totalNodesCreated)break}this._nextNodeIndex>=s.length&&(this._unbindCreateNodesEvent(),this._allNodesCreated=!0),this._creatingNode=!1},n.prototype._bindCreateNodesEvent=function(){var e=this;r(document).bind("scroll."+this.widgetName,r.proxy(e._createNodesAtIdle,e)).bind("mousemove."+this.widgetName,r.proxy(e._createNodesAtIdle,e)).bind("click."+this.widgetName,r.proxy(e._createNodesAtIdle,e)).bind("keydown."+this.widgetName,r.proxy(e._createNodesAtIdle,e))},n.prototype._unbindCreateNodesEvent=function(){r(document).unbind("."+this.widgetName)},n.prototype._createChildNodes=function(){var e=this,t=e.options,n={nIndex:undefined,htmlGenerated:!1},i=[],s=e.$nodes,o,u,a;t.nodes&&t.nodes.length?(e._initVariable(),h(s,f(t.nodes,t.showExpandCollapse,t.showCheckBoxes)),e._nodesCntPerPage=document.documentElement.clientHeight/e._getItemHeight(),n.htmlGenerated=!0,e._initializingTree=!0,o=s.children("li"),o.each(function(t,s){a=r(s),n.nIndex=t,e._initNodesCreated?(u=null,e._allNodesCreated=!1):(u=c(a,n,e,e.nodeWidgetName,e.widgetFullName),e._nextNodeIndex++),i.push(u),e._totalNodesCreated>=e._nodesCntPerPage*2&&(e._initNodesCreated=!0)}),e._initializingTree=!1,e._allNodesCreated=e._nextNodeIndex>=o.length,e._allNodesCreated||e._bindCreateNodesEvent()):(o=s.children("li"),o.each(function(s,o){a=r(o),u=c(a,n,e,e.nodeWidgetName,e.widgetFullName),i.push(u),!r.browser.safari&&u.$navigateUrl&&u.$navigateUrl.length&&u.$navigateUrl.is("a")&&u.$navigateUrl.addClass("wijmo-wijtree-link"),t.nodes.push(u.options)})),e._hasChildren=i.length>0,e._setField("nodes",i),e.nodes=i},n.prototype._createNodeWidget=function(e,t){return l(e,t,this,this.nodeWidgetName,this.widgetFullName)},n.prototype._attachEvent=function(){this._attachDroppable()},n.prototype._attachDroppable=function(){var e=this,t=e.options,n=t.droppable,i={accept:"li",scope:"tree"},s={drop:function(i,s){var u=s.draggable,a=e._getNodeWidget(u),f,l,c,h,p,d,v,m=-1,g=a._tree.options.showCheckBoxes;n=t.droppable;if(e._trigger("nodeBeforeDropped",i,s)===!1||!a||e._isDisabled()){e._isDragging=!1;return}f=a._dropTarget,l=a._insertPosition;if(f&&l!=="unKnown"){c=a._getOwner(),c&&(v=u.index()),a._tree._isDragging=!1;if(l==="end")m=f.getNodes().length,h=f;else if(l==="before"||l==="after")h=f._getOwner(),p=h.getNodes(),d=r.inArray(f,p),d!==-1&&(m=l==="before"?d:d+1);if(!h._isAllowDrop()){e._isDragging=!1;return}n&&r.isFunction(n.drop)?(s.oldParent=c.element,s.newParent=h.element,s.oldIndex=v,s.newIndex=m,n.drop.call(e.element,i,s)):(c&&c.remove(u),m!==-1&&((l==="before"||l==="after")&&d!==r.inArray(f,p)&&m--,e.$nodes.children("li").length?h.add(u,m):e.add(u,m))),g!==e.options.showCheckBoxes&&a._setCheckBoxes(e.options.showCheckBoxes),r("a",u).eq(0).blur(),a.options.selected&&a._setSelected(!1),o(c),o(h),r.extend(s,{sourceParent:c?c.element:null,sIndex:v,targetParent:h.element,tIndex:m,widget:a}),e._trigger("nodeDropped",i,s)}}},o=function(t){!t.element.is(":"+e.widgetFullName)&&t.getNodes().length>0&&t._tree.options.showCheckBoxes&&t._tree.options.allowTriState&&t.getNodes()[0]._setParentCheckState()};r.extend(i,n,s),r.fn.droppable&&e.widgetDom.droppable(i)},n.prototype._attachNodeEvent=function(){this.element.bind("focusin."+this.widgetName,r.proxy(this._onFocus,this)).bind("focusout."+this.widgetName,r.proxy(this._onBlur,this)).bind("click."+this.widgetName,r.proxy(this._onClick,this)).bind("mouseover."+this.widgetName,r.proxy(this._onMouseOver,this)).bind("mouseout."+this.widgetName,r.proxy(this._onMouseOut,this)).bind("keydown."+this.widgetName,r.proxy(this._onKeyDown,this))},n.prototype._onClick=function(e){this._callEvent(e,"_onClick"),r.browser.webkit&&this.widgetDom.focus()},n.prototype._onFocus=function(e){var t;e.data||(t=this._getNodeByDom(e.target),e.data=t.data(t.data("widgetName"))),this._callEvent(e,"_onFocus")},n.prototype._onBlur=function(e){var t;e.data||(t=this._getNodeByDom(e.target),e.data=t.data(t.data("widgetName"))),this._callEvent(e,"_onBlur")},n.prototype._onKeyDown=function(e){this._callEvent(e,"_onKeyDown")},n.prototype._onMouseOut=function(e){this._callEvent(e,"_onMouseOut")},n.prototype._onMouseOver=function(e){this._callEvent(e,"_onMouseOver")},n.prototype._callEvent=function(e,t){!this._allNodesCreated&&this.options.nodes&&this.options.nodes.length&&this._createNodesAtIdle();var n=e.target,r;if(n){r=this._getNodeWidgetByDom(n);if(r===null)return;r._hasChildren&&r._getField("nodes")&&!r._allNodesCreated&&r.options.nodes&&r.options.nodes.length&&r._createChildNodesAtIdle(),r[t](e)}},n.prototype._nodeSelector=function(){return":wijmo-wijtreenode"},n.prototype.getSelectedNodes=function(){return this._selectedNodes},n.prototype.getCheckedNodes=function(){var e=this,t=[],n=e.nodeWidgetName;return r(e._nodeSelector(),e.element).each(function(e,i){r(i)[n]("option","checked")&&r(i)[n]("option","checkState")!=="indeterminate"&&t.push(r(i))}),t},n.prototype.destroy=function(){var e=this,n=e.$nodes,i=e.options,s=["wijmo-wijtree",i.wijCSS.widget,i.wijCSS.content,i.wijCSS.helperClearFix,i.wijCSS.cornerAll].join(" ");e.widgetDom.removeClass(s).removeAttr("role").removeAttr("aria-multiselectable"),d(e.element.find(".wijmo-wijtree-link"),!0),e.widgetDom.data("ui-droppable")&&e.widgetDom.droppable("destroy"),e._unbindCreateNodesEvent(),e.element.unbind("."+e.widgetName),e.widgetDom.children("div[style]:last").remove(),n.removeData("nodes").removeClass("wijmo-wijtree-list "+i.wijCSS.helperReset),n.children("li").each(function(t,n){var i=e._getNodeWidget(r(n));i&&i.destroy()}),r.wijmo.wijtree.prototype.options.nodes=null,t.prototype.destroy.call(this)},n.prototype.add=function(e,t){var n=null,i={},s,o=this,u,a,f,l,c;r.browser.safari?f="<li><a href='{0}'>{1}</a></li>":f="<li><a href='{0}' class='wijmo-wijtree-link'>{1}</a></li>",typeof e=="string"?(s=r(f.replace(/\{0\}/,"#").replace(/\{1\}/,e)),o._createNodeWidget(s,i),n=s.data(s.data("widgetName"))):e.jquery?(e.data("widgetName")||o._createNodeWidget(e,i),n=e.data(e.data("widgetName")),n._setField("owner",o)):e.nodeType?(s=r(e),o._createNodeWidget(s,i),n=s.data(s.data("widgetName"))):r.isPlainObject(e)&&(s=r(f.replace(/\{0\}/,e.url?e.url:"#").replace(/\{1\}/,e.text)),e.isAddedNodeWithOptions=!0,o._createNodeWidget(s,e),n=s.data(s.data("widgetName")));if(n===null)return;a=o.nodes.length,(!t||t>a)&&t!==0&&(t=a),l=n.getNodes(),n._tree=o;for(u=0;u<l.length;u++)l[u]._tree=o;a>0&&a!==t?(c=this.$nodes.find(">li:eq("+t+")"),n.element.get(0)!==c.get(0)&&n.element.insertBefore(c)):o.$nodes.append(n.element),o._changeCollection(t,n),n._initNodeClass()},n.prototype.remove=function(e){var t=-1,n,i=this.$nodes.children("li");e&&e.jquery?t=e.index():typeof e=="number"&&(t=e);if(t<0||t>=this.nodes.length)return;n=this.nodes[t],n?n.element.detach():r(i[t]).detach(),this._changeCollection(t)},n.prototype._changeCollection=function(e,t){var n=this.nodes,r=this.options.nodes;t?(n.splice(e,0,t),r.splice(e,0,t.options)):(n.splice(e,1),r.splice(e,1))},n.prototype.getNodes=function(){return this.options.nodes&&this.options.nodes.length&&this._createNodesPartially(!0),this.nodes},n.prototype._createParentNodes=function(e){var t=this,n={nIndex:undefined,htmlGenerated:!0},i,s=[],o=e;if(o.closest("ul").parent().hasClass("wijmo-wijtree"))n.nIndex=this.element.children("li").index(o),c(o,n,t,t.nodeWidgetName,t.widgetFullName);else{while(!o.closest("ul").parent().hasClass("wijmo-wijtree")){o=o.closest("ul").closest("li"),s.push(o);if(p(o))break}s.reverse(),r.each(s,function(e,r){i=p(r),i||(n.nIndex=r.parent().children("li").index(r),i=c(r,n,t,t.nodeWidgetName,t.widgetFullName)),i._createChildNodeWidget()})}return p(e)},n.prototype.findNodeByText=function(e){var t=this,n=r(".wijmo-wijtree-node a>span",this.$nodes).filter(function(){return r(this).text()===e}),i=null,s;return n.length&&(s=n.eq(0).closest("li"),i=p(s),i||(i=t._createParentNodes(s))),i},n.prototype._setAllowDrag=function(e){var t=this,n,i=t._nodeSelector(),s="wijmo-"+t.nodeWidgetName;if(!r.fn.draggable)return;e?(n=t.element.find(i),n.each(function(){var e=r(this).data(s);!r(this).data("ui-draggable")&&e.options.allowDrag!==!1&&(!e.$navigateUrl.data("events")||!e.$navigateUrl.data("events").mousedown)&&e.$navigateUrl.one("mousedown."+e.widgetName,e,e._onMouseDown)})):(n=t.element.find(i+":ui-draggable"),n.each(function(){var e=r(this).data(s);e.options.allowDrag||r(this).draggable("destroy")}))},n.prototype._setAllowDrop=function(e){if(!r.fn.droppable)return;this.widgetDom.data("ui-droppable")||this._attachDroppable()},n.prototype._setCheckBoxes=function(e){var t=this;r.each(t.getNodes(),function(t,n){n._setCheckBoxes(e)})},n.prototype._setHitArea=function(e){var t=this;t.$nodes[e?"addClass":"removeClass"]("wijmo-wijtree-allexpanded"),t.$nodes.children("li").each(function(n,i){var s=t._getNodeWidget(r(i));s!==null&&s._setHitArea(e)})},n.prototype._getNodeWidget=function(e){if(e.is(this._nodeSelector())){var t=e.data(e.data("widgetName"));return t}return null},n.prototype._getNodeWidgetByDom=function(e){var t=this._getNodeByDom(e);return this._getNodeWidget(t)},n.prototype._getNodeByDom=function(e){return r(e).closest(this._nodeSelector())},n.prototype._refreshNodesClass=function(){var e=this.getNodes(),t;for(t=0;t<e.length;t++)e[t]._initNodeClass()},n.prototype._getField=function(e){return this.element.data(e)},n.prototype._setField=function(e,t){this.element.data(e,t)},n.prototype._isAllowDrop=function(){return this.options.allowDrop},n}(t.wijmoWidget);n.wijtree=v;var m=function(n){function i(){n.apply(this,arguments)}return e(i,n),i.prototype._setOption=function(e,t){var i=this,s;switch(e){case"accessKey":i.$navigateUrl!==null&&i.$navigateUrl.attr("accesskey",t);break;case"checked":i.options[e]!==t&&i._checkClick();break;case"collapsedIconClass":case"expandedIconClass":case"itemIconClass":i.options[e]=t,i._initNodeImg();break;case"expanded":i._setExpanded(t);break;case"selected":i._setSelected(t);break;case"text":i._setText(t);break;case"toolTip":i._setToolTip(t);break;case"navigateUrl":i._setNavigateUrlHref(t);break;case"allowDrag":i._setAllowDrag(t);break;default:}e==="nodes"?(i.options.nodes.length=0,i._setField("nodes",null),i._setNodes=!0,r.each(t,function(e,t){i.options.nodes.push(t)}),i.options.nodes.concat(),t&&t.length?(i._hasChildren=i._hasSubNodes(),i._createChildNodes(),i._initNodeClass()):i._clearChildNodes()):n.prototype._setOption.call(this,e,t)},i.prototype._initVariable=function(){var e=this;e._allNodesCreated=!1,e._initNodesCreated=!1,e._nextNodeIndex=0},i.prototype._initState=function(){var e=this;e._tree=null,e._dropTarget=null,e._checkState="unChecked",e._insertPosition="unKnown",e.$nodeBody=null,e.$checkBox=null,e.$hitArea=null,e.$nodes=null,e.$subnodes=null},i.prototype._create=function(){var e=this,t=e.options;e._setNodes=t.isAddedNodeWithOptions,e._initState(),e.element.data("widgetName","wijmo-wijtreenode"),e._createTreeNode(),e._initNode(),t.selected&&e._tree._selectedNodes.push(e),t.checked&&(e._checkState="checked"),n.prototype._create.call(this)},i.prototype._createTreeNode=function(){var e=this.element,t,n=this,i,s=n.options;n._tree===null&&(n._tree=n._getTree()),isNaN(s.nIndex)?s.nodes||(s.nodes=[]):(i=n._getOwner().options,t=i.nodes[s.nIndex],t&&!t.nodes&&(t.nodes=[]),r.extend(s,t),i.nodes[s.nIndex]=s),n._isHtmlGenerated()?(n._tree._totalNodesCreated++,n.$nodeBody=e.children(".wijmo-wijtree-node"),n.$inner=n.$nodeBody.children("."+o.wijtreeInner),n.$nodeImage=n.$inner.children(".wijmo-wijtree-nodeimage"),n._tree.options.showCheckBoxes&&(n.$checkBox=e.find(">div>span>div.wijmo-checkbox"),n.$checkBoxBody=n.$checkBox.children("div"),n.$checkBoxIcon=n.$checkBoxBody.children("span")),n.$navigateUrl=n.$inner.children("a"),n.$text=n.$navigateUrl.children("span").eq(0)):(n.$nodeImage=r("<span>"),n.$nodeBody=r("<div>").attr({role:"treeitem","aria-expanded":!1,"aria-checked":!1,"aria-selected":!1}),n.$navigateUrl=e.children("a"),n.$navigateUrl.length===0&&(n.$navigateUrl=e.children("div"),n.$navigateUrl.addClass("wijmo-wijtree-template"),n._isTemplate=!0),n.$navigateUrl.length===0&&(n.$navigateUrl=r("<a href='#'></a>")),n._isTemplate||(n.$text=n.$navigateUrl.children("span").eq(0),n.$text.length===0&&(n.$navigateUrl.wrapInner("<span></span>"),n.$text=n.$navigateUrl.children("span").eq(0))),n.$inner=r("<span></span>").addClass(s.wijCSS.helperClearFix+" "+o.wijtreeInner+" "+s.wijCSS.wijtreeInner+" "+s.wijCSS.cornerAll),n.$inner.append(n.$nodeImage),n._tree.options.showCheckBoxes&&n._createTreeCheck(),n.$inner.append(n.$navigateUrl),n.$nodeBody.append(n.$inner),e.prepend(n.$nodeBody)),n._hasChildren=n._hasSubNodes(),n._createChildNodes()},i.prototype._clearChildNodes=function(){var e=this._getField("nodes");this.$nodes.empty(),e&&e.length&&(e.length=0),this.$subnodes&&this.$subnodes.length&&(this.$subnodes.length=0)},i.prototype._createChildNodes=function(){var e=this,t=e.options,n=e.element;e._initVariable(),e._hasChildren?(e.$nodes===null&&(e.$nodes=n.children("ul").eq(0)),e._isHtmlGenerated()?e.$hitArea=e.$inner.children(".wijmo-wijtree-hitarea"):(n.addClass("wijmo-wijtree-parent"),e.$nodeBody.addClass("wijmo-wijtree-node wijmo-wijtree-header "+t.wijCSS.stateDefault),e.$hitArea=r("<span>"),e.$inner.prepend(e.$hitArea),e.$nodes.addClass("wijmo-wijtree-list wijmo-wijtree-child "+t.wijCSS.helperReset)),(t.expanded||!e._isHtmlGenerated())&&e._createChildNodeWidget()):(e._isHtmlGenerated()||(n.addClass("wijmo-wijtree-item"),e.$nodeBody.addClass("wijmo-wijtree-node "+t.wijCSS.stateDefault)),e._setField("nodes",[]))},i.prototype._isHtmlGenerated=function(){return!!this.options.htmlGenerated},i.prototype._createInitNode=function(e,t,n,i,u){var a=this,f;return f=p(e),f||(u&&u.push(e),i.nIndex=t,!a._initNodesCreated||!a._isHtmlGenerated()?(f=c(e,i,a,s,a.options.treeClass),!u&&!r.browser.safari&&e.children(".wijmo-wijtree-node").find("."+o.wijtreeInner+" a").addClass("wijmo-wijtree-link"),f._index=t,a._nextNodeIndex++):(f=null,a._allNodesCreated=!1),a._tree._initializingTree?a._tree._totalNodesCreated>=a._tree._nodesCntPerPage*2&&(a._initNodesCreated=!0):a._nextNodeIndex>=a._tree._nodesCntPerPage*2&&(a._initNodesCreated=!0)),a._allNodesCreated=a._nextNodeIndex>=n,f},i.prototype._bindCreateNodesEvent=function(){var e=this;r(document).bind("scroll."+this.widgetName,r.proxy(e._createChildNodesAtIdle,e)).bind("mousemove."+this.widgetName,r.proxy(e._createChildNodesAtIdle,e)).bind("click."+this.widgetName,r.proxy(e._createChildNodesAtIdle,e)).bind("keydown."+this.widgetName,r.proxy(e._createChildNodesAtIdle,e))},i.prototype._unbindCreateNodesEvent=function(){r(document).unbind("."+this.widgetName)},i.prototype._createChildNodesAtIdle=function(){this._tree._creatingNode||this._createChildNodesPartially(!1);return},i.prototype._createChildNodesPartially=function(e){this._tree._creatingNode=!0;var t=this,n={nIndex:undefined,htmlGenerated:!0},i=[],o=t.$nodes.children("li"),u,a=t._nextNodeIndex;t._getField("nodes")?i=t._getField("nodes"):t._setField("nodes",i);if(this._allNodesCreated||!this.options.nodes||!this.options.nodes.length){this._unbindCreateNodesEvent();return}while(t._nextNodeIndex<o.length){if(i[t._nextNodeIndex]!=null){t._nextNodeIndex++;continue}n.nIndex=t._nextNodeIndex,u=c(r(o[t._nextNodeIndex]),n,t,s,t.options.treeClass),i[t._nextNodeIndex]=u,t._nextNodeIndex++;if(!e&&a+t._tree._nodesCntPerPage<t._nextNodeIndex)break}this._nextNodeIndex>=o.length&&(this._unbindCreateNodesEvent(),this._allNodesCreated=!0),this._tree._creatingNode=!1},i.prototype._createChildNode=function(){var e=this,t=e.options,n=[],i,s={nIndex:undefined,cfli:undefined,treeClass:t.treeClass,nodes:undefined,htmlGenerated:e._isHtmlGenerated()};if(e._setNodes&&t.nodes&&t.nodes.length){if(!e.$nodes||!e.$nodes.length)e.$nodes=r("<ul>").appendTo(e.element);h(e.$nodes,f(t.nodes,e._tree.options.showExpandCollapse,e._tree.options.showCheckBoxes)),e.$subnodes=[],s.htmlGenerated=!0,i=e.$nodes.children("li"),i.each(function(t,o){var u=r(o);n.push(e._createInitNode(u,t,i.length,s,e.$subnodes))})}else t.nodes||(t.nodes=[]),e.$subnodes===null&&e._updateSubNodes(),r.each(e.$subnodes,function(t,r){e._isHtmlGenerated()||(s.nodes=[]),n.push(e._createInitNode(r,t,e.$subnodes.length,s))});return e._allNodesCreated||e._bindCreateNodesEvent(),n},i.prototype._initNode=function(){var e=this,t=e.options;e._initialized||(e._initialized=!0,e._initNavigateUrl(),!e._isTemplate&&e.$text&&e.$text.length&&(e._text=e.$text.html(),t.text=e._text),e._hasChildren=e._hasSubNodes(),e._initNodesUL(),e._initNodeClass(),e._initNodeImg(),e._isAllowDrag()&&e.$navigateUrl.one("mousedown."+e.widgetName,e,e._onMouseDown))},i.prototype._initNodeClass=function(){var e=this,t=e.options,n,i="wijmo-wijtree-item",s=t.wijCSS.icon+" "+(t.expanded?t.wijCSS.iconArrowRightDown:t.wijCSS.iconArrowRight);e._tree.options.showExpandCollapse&&(e._hasChildren||!!t.hasChildren?(e._isHtmlGenerated()||(e.$nodeBody.removeClass("wijmo-state-expanded wijmo-state-collapsed"),t.expanded?e.$nodeBody.addClass("wijmo-state-expanded"):e.$nodeBody.addClass("wijmo-state-collapsed")),e.$hitArea!==null?(e.$hitArea.removeClass([t.wijCSS.icon,t.wijCSS.iconArrowRightDown,t.wijCSS.iconArrowRight].join(" ")),e.$hitArea.addClass(s)):(e.$hitArea=r("<span>").addClass(s).prependTo(e.$inner),e.element.removeClass(i).addClass("wijmo-wijtree-parent")),e._hasChildren&&e.$nodes&&e.$nodes.length&&(n=t.expanded?"":"none",e.$nodes.css({display:n}))):e.$hitArea&&e.$hitArea.length&&(e.$hitArea.remove(),e.$hitArea=null,e.element.removeClass("wijmo-wijtree-parent").addClass(i))),!e._hasChildren&&e.$nodes&&e.$nodes.length&&e.$nodes.css({display:"none"}),t.selected&&e.$inner&&e.$inner.addClass(t.wijCSS.stateActive)},i.prototype._initNodesUL=function(){var e=this;!e._isHtmlGenerated()&&e._tree.options.showExpandCollapse&&e._hasChildren&&e.$nodes&&e.$nodes.length&&e.$nodes[e._expanded?"show":"hide"]()},i.prototype._initNavigateUrl=function(){var e=this,t;if(e._isHtmlGenerated())return;t=e.$navigateUrl.attr("href"),this._isTemplate||(!t||t.length===0)&&e._setNavigateUrlHref("#")},i.prototype._applyIconClass=function(e,t){var n=e.attr("expandediconclass");n&&(t.expandedIconClass=n,e.removeAttr("expandediconclass")),n=e.attr("collapsediconclass"),n&&(t.collapsedIconClass=n,e.removeAttr("collapsediconclass")),n=e.attr("itemiconclass"),n&&(t.itemIconClass=n,e.removeAttr("itemiconclass"))},i.prototype._initNodeImg=function(){var e=this,t=e.options,n=e.element;if(e.$nodeImage===null||!e.$nodeImage.length)e.$nodeImage=r("<span>");e._applyIconClass(n,t),t.collapsedIconClass!==""&&t.expandedIconClass!==""?(e.$nodeImage.removeClass().addClass(t.wijCSS.icon).addClass(t.expanded?t.expandedIconClass:t.collapsedIconClass),e._tree.options.showExpandCollapse||e.$nodeImage.addClass(t.expandedIconClass),e.$nodeImage.insertBefore(e.$checkBox)):t.itemIconClass!==""&&(e.$nodeImage.removeClass().addClass(t.wijCSS.icon),e.$nodeImage.addClass(t.itemIconClass),e.$nodeImage.insertBefore(e.$checkBox))},i.prototype._setNavigateUrlHref=function(e){if(this.$navigateUrl){if(e===""||typeof e=="undefined"||e===null)e="#";this.$navigateUrl.attr("href",e)}},i.prototype._editNode=function(){this._tree._editMode=!0,this.$navigateUrl.hide(),this.$editArea||(this.$editArea=r('<input type="text">').wijtextbox()),this.$editArea.val(this.$text.html()),this.$editArea.insertBefore(this.$navigateUrl),this.$editArea.bind("blur",this,this._editionComplete),this.$editArea.focus()},i.prototype._editionComplete=function(e){var t=e.data,n;t._tree._editMode=!1,t.$editArea&&(n=t.$editArea.val(),t.$editArea.remove()),t.$navigateUrl.show(),t.$editArea=null,t._changeText(n)},i.prototype._changeText=function(e){var t=this,n=t.options;t.$text!==null&&e!==""&&(t.$text.text(e),n.text=e,t._tree._trigger("nodeTextChanged",null,t))},i.prototype._toggleExpanded=function(){var e=this,t=e.options;e._isClosestDisabled()||(e._hasChildren||t.hasChildren)&&e._setExpanded(!t.expanded)},i.prototype._createChildNodeWidget=function(){var e=this,t=[];e._getField("nodes")||(e._hasChildren&&(t=e._createChildNode()),e._setField("nodes",t))},i.prototype._expandNode=function(e){var t=this,n=t._tree.options,r=e?"nodeExpanding":"nodeCollapsing";if(t._tree._trigger(r,null,{node:this,params:this.options.params})===!1)return;t._createChildNodeWidget(),t.$nodeBody.attr("aria-expanded",e),t._expanded=e,t.options.expanded=e,t._isClosestDisabled()||(e?n.expandDelay>0?(window.clearTimeout(t._expandTimer),t._expandTimer=window.setTimeout(function(){t._expandNodeVisually()},n.expandDelay)):t._expandNodeVisually():n.collapseDelay>0?(window.clearTimeout(t._collapseTimer),t._collapseTimer=window.setTimeout(function(){t._collapseNodeVisually()},n.collapseDelay)):t._collapseNodeVisually())},i.prototype._expandNodeVisually=function(){var e=this,t,n=e.options;e._tree.options.autoCollapse&&(t=e.element.siblings(":"+this.widgetFullName),r.each(t,function(n){var r=e._getNodeWidget(t[n]);r.options.expanded&&r._setExpanded(!1)})),n.collapsedIconClass!==""&&n.expandedIconClass!==""&&e.$nodeImage.removeClass(n.collapsedIconClass).addClass(n.expandedIconClass),e._internalSetNodeClass(!0),e._show()},i.prototype._collapseNodeVisually=function(){var e=this;e.options.collapsedIconClass!==""&&e.options.expandedIconClass!==""&&e.$nodeImage.removeClass(e.options.expandedIconClass).addClass(e.options.collapsedIconClass),e._tree._focusNode&&e.$nodes.find(e._tree._focusNode.$navigateUrl).length&&e._setFocused(!0),e._internalSetNodeClass(!1),e._hide()},i.prototype._internalSetNodeClass=function(e){var t=this.options.wijCSS,n=[t.icon,t.iconArrowRightDown,t.iconArrowRight].join(" ");if(!this.$hitArea)return;this.$hitArea.removeClass(n).addClass(t.icon).addClass(e?t.iconArrowRightDown:t.iconArrowRight),this.$nodeBody.removeClass("wijmo-state-expanded").removeClass("wijmo-state-collapsed"),e?this.$nodeBody.addClass("wijmo-state-expanded"):this.$nodeBody.addClass("wijmo-state-collapsed")},i.prototype._show=function(){this._animation(!0)},i.prototype._hide=function(){this._animation(!1)},i.prototype._animation=function(e){function l(e){e.css(f)!==a&&e.css(f,a)}var t=this,n=t.$nodes,i=e?"expandAnimation":"collapseAnimation",s=e?"nodeExpanded":"nodeCollapsed",o,u=t._tree.options[i],a,f;n&&n.length&&(u?(r.browser.msie&&parseInt(r.browser.version)<9?f="filter":f="opacity",a=n.css(f),o=u.animated||u.effect,r.effects&&!!o?n[e?"show":"hide"](o,{easing:u.easing},u.duration,function(){l(n),t._tree._trigger(s,null,t)}):n[e?"show":"hide"](u.duration,function(){l(n),t._tree._trigger(s,null,t)})):(n[e?"show":"hide"](),t._tree._trigger(s,null,t)))},i.prototype._getBounds=function(e){var t=e.height(),n=e.width(),r=e.offset().top,i=e.offset().left;return{h:t,w:n,t:r,l:i}},i.prototype._isMouseInsideRect=function(e,t){return e.x<t.l||e.x>=t.l+t.w?!1:e.y<=t.t+1||e.y>=t.t+t.h?!1:!0},i.prototype._getNodeByMouseOn=function(e){var t=this;return r("li").each(function(){var n=t._getBounds(r(this));if(e.y>n.t&&e.y<n.t+n.h&&e.x>n.l&&e.x<n.l+n.w)return r(this)}),null},i.prototype._drowTemplate=function(e,t,n){var r="unKnown",i=n.is(".wijmo-wijtree-node")?n:n.children(".wijmo-wijtree-node"),s=this._getBounds(i);return t.width(i.width()),e.y>s.t&&e.y<s.t+s.h/2?(t.offset({left:s.l,top:s.t}),r="before"):e.y>s.t+s.h/2&&e.y<s.t+s.h&&(t.offset({left:s.l,top:s.t+s.h}),r="after"),r},i.prototype._beginDrag=function(e){var t=this,n=t.element,i,s=t._tree.options,u=s.draggable,a=r("<div>").addClass("wijmo-wijtree-insertion "+s.wijCSS.stateDefault),f={cursor:"point",cursorAt:{top:15,left:-25},helper:function(){return r("<div>"+t.$navigateUrl.html()+"</div>").addClass(s.wijCSS.header).addClass(s.wijCSS.cornerAll)},distance:r.browser.msie?1:10,handle:t.$navigateUrl,scope:"tree"},l={start:function(e,i){t._tree._isDragging=!0,t._tree.widgetDom.prepend(a),t._tree._trigger("nodeDragStarted",e,t),u&&r.isFunction(u.start)?u.start.call(t.element,e,i):n.hide()},drag:function(e,n){var i=e,s=i.srcElement||i.originalEvent.target,f=r(s),l,c={x:i.pageX,y:i.pageY};a&&a.hide(),f&&(l=t._getNodeWidget(s),l&&!l._tree._isDisabled()?(f.closest("."+o.wijtreeInner,t.element).length?t._insertPosition="end":(a.show(),t._insertPosition=t._drowTemplate(c,a,l.element)),l!==t&&(t._dropTarget=l)):f.is(":"+t.options.treeClass)&&(t._dropTarget=f.data(t.options.treeClass),t._insertPosition="end")),t._tree._trigger("nodeDragging",e,t),u&&r.isFunction(u.drag)&&u.drag.call(t.element,e,n)},stop:function(e,i){a.remove(),t._dropTarget=null,t._insertPosition="unKnown",t._tree._isDragging=!1,u&&r.isFunction(u.stop)?u.stop.call(t.element,e,i):(n.show(),t._resetDrag())}};typeof s.dropVisual=="string"?(i=r(s.dropVisual),a=i.length?i:a):r.isFunction(s.dropVisual)&&(i=r(s.dropVisual.call()),a=i.length?i:a),a.hide(),r.extend(f,u,l),r.fn.draggable&&(n.draggable(f).trigger(e),r.browser.mozilla&&t._setFocused(!0))},i.prototype._resetDrag=function(){var e=this,t,n,r=e.options;!e._isAllowDrag()&&e.element.data("ui-draggable")&&e.element.draggable("destroy"),t=e.getNodes();for(n=0;n<t.length;n++)t[n]._resetDrag()},i.prototype._createTreeCheck=function(){var e=this,t=e.options,n=a(t.checked,t.checkState);e.$checkBox=r(n),e.$checkBox.insertAfter(e.$nodeImage),e.$checkBoxBody=e.$checkBox.children("div"),e.$checkBoxIcon=e.$checkBoxBody.children("span")},i.prototype._mouseOverTreeCheck=function(e){var t=r(e.target),n=this,i=n.options,s=i.wijCSS;n._isOverCheckbox(t)&&n.$checkBoxBody.addClass(s.stateHover)},i.prototype._mouseOutTreeCheck=function(e){var t=r(e.target),n=this,i=n.options,s=i.wijCSS;n._isOverCheckbox(t)&&n.$checkBoxBody.removeClass(s.stateHover)},i.prototype._setTreeCheckState=function(e){var t=this,n=t.options,r=n.wijCSS,i=r.icon+" "+r.iconCheck,s=r.icon+" "+r.iconStop;e==="unCheck"?(t.$checkBoxBody.removeClass(r.stateActive),t.$checkBoxIcon.removeClass(i+" "+s)):e==="check"?(t.$checkBoxBody.addClass(r.stateActive),t.$checkBoxIcon.removeClass(s).addClass(i)):e==="triState"&&(t.$checkBoxBody.addClass(r.stateActive),t.$checkBoxIcon.removeClass(i).addClass(s))},i.prototype._checkClick=function(){var e=this,t=e.options;if(!e._isClosestDisabled()){if(e._tree._trigger("nodeCheckChanging",null,e)===!1)return;t.checked&&e._checkState==="indeterminate"?(e._checkState="checked",e._checkItem()):(e._checkState=t.checked?"unChecked":"checked",e._setChecked(!t.checked)),e._tree._trigger("nodeCheckChanged",null,e)}},i.prototype._checkItem=function(){var e=this,t=!1,n=e._tree;if(n===null||!n.options.showCheckBoxes)return;n.options.autoCheckNodes&&e._checkState!=="indeterminate"&&(t=!0,e._changeChecked(e.options.checked)),n.options.allowTriState&&e._setParentCheckState(),e.options.checked?e._checkNode(t):e._unCheckNode(t)},i.prototype._checkNode=function(e){var t=this,n=t.options,r=this.getNodes(),i;t._checkState==="checked"?(t._setTreeCheckState("check"),n.checkState="checked"):t._checkState==="indeterminate"&&(t._setTreeCheckState("triState"),n.checkState="indeterminate");if(e)for(i=0;i<r.length;i++)r[i]._checkNode(!0)},i.prototype._unCheckNode=function(e){var t=this.getNodes(),n=this.options,r;this._setTreeCheckState("unCheck"),n.checkState="unChecked";if(e)for(r=0;r<t.length;r++)t[r]._unCheckNode(!0)},i.prototype._changeChecked=function(e){var t=this.getNodes();r.each(t,function(t,n){n.options.checked=e,n.$nodeBody.attr("aria-checked",e),n._checkState=e?"checked":"unChecked",n._changeChecked(e)})},i.prototype._setParentCheckState=function(){var e=this._getOwner(),t,n=!0,r=!1,i=!1,s,o=this;if(e.element.is(":"+o.options.treeClass))return;t=e.getNodes();for(s=0;s<t.length;s++){t[s]._checkState==="indeterminate"&&(i=!0),t[s].options.checked?r=!0:n=!1;if(!n&&r)break}i?(e._checkState="indeterminate",e._setChecked(!0)):r?(n?(e._checkState="checked",e._checkNode(!1)):e._checkState="indeterminate",e._setChecked(!0)):(e._checkState="unChecked",e._setChecked(!1),e._unCheckNode(!1)),e._setParentCheckState()},i.prototype._isOverCheckbox=function(e){return e.closest(".wijmo-checkbox",this.element).length>0},i.prototype._isWithinHitArea=function(e){return this.$hitArea&&this.$hitArea[0]===e[0]},i.prototype._isOverInner=function(e){return e.closest("."+o.wijtreeInner,this.element).length>0},i.prototype._onKeyDown=function(e){var n=r(e.target),i=this;if(i._isOverInner(n)){if(e.keyCode===t.getKeyCodeEnum().TAB)return!0;i._keyAction(e)}},i.prototype._onClick=function(e){var t=r(e.target),n=this;n._isOverCheckbox(t)?(n._checkClick(),e.preventDefault(),e.stopPropagation()):n._isWithinHitArea(t)?(n._toggleExpanded(),e.preventDefault(),e.stopPropagation()):n._isOverInner(t)&&n._click(e)},i.prototype._onMouseDown=function(e){var t=r(e.target),n=e.data;!n._tree._isDisabled()&&n._isAllowDrag()&&t.closest(".wijmo-wijtree-node",n.element).length>0&&n._beginDrag(e)},i.prototype._onMouseOver=function(e){var t=r(e.target),n=this,i=r(e.relatedTarget);n._isOverInner(t)&&(this._tree._overNode!==n||i.is(":"+this.widgetFullName)||i.is(".wijmo-wijtree-node"))&&(n._isClosestDisabled()||n._mouseOver(e),this._tree._overNode=n),n._isClosestDisabled()||(n._mouseOverHitArea(e),n._mouseOverTreeCheck(e))},i.prototype._onMouseOut=function(e){var t=r(e.target),n=this,i=r(e.relatedTarget),s=this._getNodeWidget(i.get(0));n._isOverInner(t)&&(this._tree._overNode!==s||i.is(":"+this.widgetFullName)||i.is(".wijmo-wijtree-list")||i.is(".ui-effects-wrapper")||i.is(".wijmo-wijtree-node"))&&(n._isClosestDisabled()||n._mouseOut(e),this._tree._overNode=null),n._isClosestDisabled()||(n._mouseOutHitArea(e),n._mouseOutTreeCheck(e))},i.prototype._onFocus=function(e){var t=r(e.target),n=this,i=n.options.wijCSS;n._isOverInner(t)&&!n._isClosestDisabled()&&!t.hasAllClasses(i.iconArrowRightDown)&&!t.hasAllClasses(i.iconArrowRight)&&!n._isOverCheckbox(t)&&(n._tree._focusNode?(n._tree._focusNode.$navigateUrl.trigger("focusout"),d(n._tree._focusNode.$navigateUrl,!1)):d(n._tree.nodes[0].$navigateUrl,!1),d(t,!0),n._focused=!0,n._tree._focusNode=this,n.$inner.addClass(i.stateFocus),n._tree._trigger("nodeFocus",e,n))},i.prototype._onBlur=function(e){var t=r(e.target),n=e.data,i=n.options.wijCSS;n._isClosestDisabled()||(n._focused=!1,n._isOverInner(t)&&n.$inner.removeClass(i.stateFocus),n._tree._trigger("nodeBlur",e,n))},i.prototype._click=function(e){var t=this,n=t.options,i=t._tree,s=t.$navigateUrl.attr("href");if(!t._isClosestDisabled()){if(!/^[#,\s]*$/.test(s)){if(!r.browser.msie||!/^7\.[\d]*/.test(r.browser.version))return;if(s.indexOf(window.location.href)<0)return}t._isClick=!0,i._ctrlKey=e.ctrlKey,n.selected&&i._ctrlKey?t._setSelected(!1):n.selected&&!t._tree._editMode&&i.options.allowEdit&&!t._isTemplate?t._editNode():t._setSelected(!n.selected),t._isTemplate||(e.preventDefault(),e.stopPropagation())}else t._setNavigateUrlHref("")},i.prototype._selectNode=function(e,t){var n=this,i=n.options,s,o;!n._isClosestDisabled()&&!n._tree._isDragging&&(s=n._tree._ctrlKey,s?(o=r.inArray(n,n._tree._selectedNodes),o!==-1&&!e&&(n._tree._selectedNodes.splice(o,1),n.$inner.removeClass(i.wijCSS.stateActive))):(r.each(n._tree._selectedNodes,function(e,t){t.$inner.removeClass(i.wijCSS.stateActive),t.options.selected=!1,t.$nodeBody.attr("aria-selected",!1)}),n._tree._selectedNodes=[]),e?(o=r.inArray(n,n._tree._selectedNodes),o===-1&&this._tree._selectedNodes.push(n),n.$inner.addClass(i.wijCSS.stateActive)):n.$inner.removeClass(i.wijCSS.stateActive),n._isClick&&n._tree._trigger("nodeClick",t,n),n._isClick=!1,n._tree._ctrlKey=!1,n._tree._trigger("selectedNodeChanged",t,n))},i.prototype._keyAction=function(e){var n=e.target,r=this,i=!1,s=t.getKeyCodeEnum();if(r._isClosestDisabled())return;if(n){if(r._tree._editMode&&e.keyCode!==s.ENTER)return;switch(e.keyCode){case s.UP:r._moveUp();break;case s.DOWN:r._moveDown();break;case s.RIGHT:r._tree.options.showExpandCollapse&&r._moveRight();break;case s.LEFT:r._tree.options.showExpandCollapse&&r._moveLeft();break;case 83:!r._tree._editMode&&r._tree.options.allowSorting&&r.sortNodes();break;case 113:r._tree.options.allowEdit&&r._editNode();break;case 109:r._tree.options.showExpandCollapse&&this._expanded&&r._setExpanded(!1);break;case 107:r._tree.options.showExpandCollapse&&!this._expanded&&r._setExpanded(!0);break;case s.ENTER:r._tree._editMode&&(e.data=r,r._editionComplete(e),r._setFocused(!0),i=!0,e.preventDefault());break;case s.SPACE:r._tree.options.showCheckBoxes&&r._checkClick()}r._customKeyDown(e.keyCode,i),!r._isTemplate&&e.keyCode!==s.ENTER&&(e.preventDefault(),e.stopPropagation())}},i.prototype._customKeyDown=function(e,t){},i.prototype._prevNode=function(e){var t=e.element;if(t.prev().length>0)return t.prev().data(t.data("widgetName"))},i.prototype._nextNode=function(e){var t=e.element;if(t.next().length>0)return t.next().data(t.data("widgetName"))},i.prototype._getNextExpandedNode=function(e){var t=e,n=e.getNodes(),r;return e._expanded&&n.length>0&&(r=n[n.length-1],r!==null&&(t=this._getNextExpandedNode(r))),t},i.prototype._getNextNode=function(e){var t=null,n=this;return e.element.is(":"+n.options.treeClass)?null:(t=n._nextNode(e),t?t:n._getNextNode(e._getOwner()))},i.prototype._moveUp=function(){var e=this._getCurrentLevel(),t=this._prevNode(this);t?this._getNextExpandedNode(t)._setFocused(!0):e>0&&this._getOwner()._setFocused(!0)},i.prototype._moveDown=function(){var e=this.getNodes(),t,n,r;this._expanded&&e.length>0?e[0]._setFocused(!0):(t=this._nextNode(this),t?t._setFocused(!0):(n=this._getOwner(),r=this._getNextNode(n),r&&r._setFocused(!0)))},i.prototype._moveLeft=function(){var e=this._getOwner();this._expanded?this._setExpanded(!1):e!==null&&!e.element.is(":"+this.options.treeClass)&&e._setFocused(!0)},i.prototype._moveRight=function(){if(this._hasChildren)if(!this._expanded)this._setExpanded(!0);else{var e=this.getNodes()[0];e!==null&&e._setFocused(!0)}},i.prototype._mouseOver=function(e){var t=this,n=t._tree;n._editMode||(t._mouseOverNode(),n._isDragging||n._trigger("nodeMouseOver",e,t))},i.prototype._mouseOut=function(e){var t=this,n=t._tree;n._editMode||(t._mouseOutNode(),n._isDragging||n._trigger("nodeMouseOut",e,t))},i.prototype._mouseOverNode=function(){this.$inner!==null&&!this._isOverNode&&(this.$inner.addClass(this.options.wijCSS.stateHover),this._isOverNode=!0)},i.prototype._mouseOutNode=function(){this.$inner!==null&&this._isOverNode&&(this.$inner.removeClass(this.options.wijCSS.stateHover),this._isOverNode=!1)},i.prototype._mouseOverHitArea=function(e){var t,n,r=this,i=r._tree;i.options.expandCollapseHoverUsed&&r._hasChildren&&!r._isOverHitArea&&(t=r._getBounds(r.element),n={x:e.pageX,y:e.pageY},r._isMouseInsideRect(n,t)&&(r._isOverHitArea=!0,r._setExpanded(!0)))},i.prototype._mouseOutHitArea=function(e){var t={x:e.pageX,y:e.pageY},n,r=this,i=r._tree;i.options.expandCollapseHoverUsed&&(r._hasChildren&&!!r._isOverHitArea?(n=r._getBounds(r.element),r._isMouseInsideRect(t,n)||(r._isOverHitArea=!1,r._setExpanded(!1))):r._getOwner().element.is(":"+r.widgetFullName)&&(n=r._getBounds(r._getOwner().element),r._isMouseInsideRect(t,n)||(r._getOwner()._isOverHitArea=!1,r._getOwner()._setExpanded(!1))))},i.prototype.destroy=function(){var e=this,t,i=e.options,s;e.element.data("ui-draggable")&&e.element.draggable("destroy"),e.$hitArea&&e.$hitArea.remove(),e.$checkBox&&e.$checkBox.remove(),e.$nodeImage&&e.$nodeImage.remove(),e._unbindCreateNodesEvent(),e.$navigateUrl.unwrap().unwrap().removeClass(i.wijCSS.stateDefault).removeClass(i.wijCSS.stateActive).unbind("mousedown"),t=e.element.find("ul:first").show(),t.removeClass(),t.children("li").each(function(){s=r(this);var e=p(s);e&&e.destroy()}),e.element.removeData("nodes").removeData("owner").removeData("widgetName").removeClass(),n.prototype.destroy.call(this)},i.prototype.add=function(e,t){var n=null,i,s,u=this,a,f,l,c,h,p;r.browser.safari?l="<li><a href='{0}'>{1}</a></li>":l="<li><a href='{0}' class='wijmo-wijtree-link'>{1}</a></li>",typeof e=="string"?(i=r(l.replace(/\{0\}/,"#").replace(/\{1\}/,e)),u._createNodeWidget(i),n=i.data(i.data("widgetName"))):e.jquery?(e.data("widgetName")||u._createNodeWidget(e),n=e.data(e.data("widgetName"))):e.nodeType?(i=r(e),u._createNodeWidget(i),n=i.data(i.data("widgetName"))):r.isPlainObject(e)&&(i=r(l.replace(/\{0\}/,e.url?e.url:"#").replace(/\{1\}/,e.text)),e.isAddedNodeWithOptions=!0,u._createNodeWidget(i,e),n=i.data(i.data("widgetName")));if(n===null)return;r.browser.safari||(h=u.element.children(".wijmo-wijtree-node").find("."+o.wijtreeInner+" .wijmo-wijtree-link"),h&&h.length>0&&h.removeClass("wijmo-wijtree-link"),p=u.element.children(".wijmo-wijtree-node").find("."+o.wijtreeInner+" .wijmo-checkbox"),p&&p.length>0&&p.removeClass("wijmo-checkbox")),s=u.getNodes(),(!t||t>s.length)&&t!==0&&(t=s.length),r.mobile&&n.element.find("a").addClass("ui-link"),a=n.getNodes(),n._tree=u._tree;for(f=0;f<a.length;f++)a[f]._tree=u._tree;n._setField("owner",u),c=s.length;if(!u.$nodes||!u.$nodes.length)u.$nodes=r("<ul></ul>").addClass("wijmo-wijtree-list").addClass(u.options.wijCSS.helperReset).addClass("wijmo-wijtree-child"),u.element.append(u.$nodes);c>0&&c!==t?n.element.get(0)!==s[t].element.get(0)&&n.element.insertBefore(s[t].element):u.$nodes.append(n.element),u.$subnodes=null,u._changeCollection(t,n),u._collectionChanged(),n._initNodeClass(),r.browser.safari||setTimeout(function(){h&&h.length>0&&h.addClass("wijmo-wijtree-link"),p&&p.length>0&&p.addClass("wijmo-checkbox")},0)},i.prototype.remove=function(e){var t=-1,n,r=this,i=this.getNodes();e.jquery?t=e.index():typeof e=="number"&&(t=e);if(t<0||t>=i.length)return;n=i[t],n.element.detach(),r.$subnodes=null,r._changeCollection(t),r._collectionChanged()},i.prototype.getNodes=function(){return this._hasChildren?this._createChildNodesPartially(!0):this._setField("nodes",[]),this._getField("nodes")},i.prototype._changeCollection=function(e,t){var n=this.getNodes(),r=this.options.nodes;t?(n.splice(e,0,t),r.splice(e,0,t.options)):(n.splice(e,1),r.splice(e,1))},i.prototype.sortNodes=function(){var e=this.getNodes();this._sort(),r.each(e,function(e,t){t._index=e,t._insertBefore(e)}),this._refreshNodesClass()},i.prototype.check=function(e){this._setOption("checked",e)},i.prototype.select=function(e){this._setOption("selected",e)},i.prototype.getOwner=function(){var e=this._getOwner();return e&&e.element.is("li")?e:null},i.prototype.expand=function(){this._setOption("expanded",!0)},i.prototype.collapse=function(){this._setOption("expanded",!1)},i.prototype._insertBefore=function(e){var t=this.element.parent().children("li");this.element.index()!==e&&this.element.insertBefore(t.eq(e))},i.prototype._sort=function(){var e=this.getNodes();this._isSorted?this._isDecsSort?(e.sort(this._compare2NodeTextDesc),this._isDecsSort=!1):(e.sort(this._compare2NodeTextAsc),this._isDecsSort=!0):(e.sort(this._compare2NodeTextAsc),this._isSorted=!0,this._isDecsSort=!0)},i.prototype._compare2NodeTextAsc=function(e,t){if(e!==null&&t!==null)return e._text.localeCompare(t._text)},i.prototype._compare2NodeTextDesc=function(e,t){if(e!==null&&t!==null)return-1*e._text.localeCompare(t._text)},i.prototype._collectionChanged=function(){this._hasChildren=this._hasSubNodes(),this._initNodeClass()},i.prototype._refreshNodesClass=function(){var e=this.getNodes(),t;for(t=0;t<e.length;t++)e[t]._initNodeClass()},i.prototype._setChecked=function(e){var t=this;if(t.options.checked===e&&t._checkState!=="indeterminate")return;t.options.checked=e,t.$nodeBody.attr("aria-checked",e),this._checkItem()},i.prototype._isClosestDisabled=function(){var e=this,t="."+e._tree.widgetFullName+"-disabled,."+e.widgetFullName+"-disabled";return e.element.closest(t,e._tree.element).length?!0:!1},i.prototype._setExpanded=function(e){var t=this,n=t.options;if(t._expanded===e)return;(t._hasChildren||n.hasChildren)&&t._expandNode(e)},i.prototype._setFocused=function(e){e?(this.$navigateUrl.focus(),this._setFocusNode()):this.$navigateUrl.trigger("focusout")},i.prototype._setFocusNode=function(){this._tree._focusNode&&r.browser.webkit&&this._tree._focusNode.$navigateUrl.trigger("focusout"),this._focused=!0,this._tree._focusNode=this,this.$inner.addClass(this.options.wijCSS.stateFocus)},i.prototype._setToolTip=function(e){e.length?this.element.attr("title",e):this.element.removeAttr("title")},i.prototype._setText=function(e){this._text!==e&&e.length&&(this._text=e,this._changeText(e))},i.prototype._setSelected=function(e){var t=this,n=t.options;n.selected!==e&&(n.selected=e,t.$nodeBody.attr("aria-selected",e),t._selectNode(e),t._setFocused(e))},i.prototype._setCheckBoxes=function(e){var t=this;t.$checkBox?t.$checkBox[e?"show":"hide"]():e&&t._createTreeCheck(),r.each(t.getNodes(),function(t,n){n._setCheckBoxes(e)})},i.prototype._setHitArea=function(e){var t=this;t._hasChildren&&(e?(t._initNodeClass(),t.$hitArea&&t.$hitArea.show()):(t._expanded=!0,t.options.expanded=!0,t.$nodeBody.attr("aria-expanded",!0),t.$nodes&&t.$nodes.length&&t.$nodes.show(),t._initNodeClass(),t.$hitArea&&t.$hitArea.hide())),r.each(t.getNodes(),function(t,n){n._setHitArea(e)})},i.prototype._getOwner=function(){return this._getField("owner")},i.prototype._getTree=function(){var e=this._getOwner();return e?e._tree?e._tree:e:null},i.prototype._getInitElement=function(){var e=r("<li>"),t=this,n=r("<ul>"),i=t.getNodes();return e.append(t.$navigateUrl.clone()),i.length&&(e.append(n),r.each(i,function(e,t){var r=t._getInitElement();n.append(r)})),e},i.prototype._updateSubNodes=function(){var e,t;this.$subnodes=[];if(this.$nodes===null||!this.$nodes.length)return;e=this.$nodes.children("li");for(t=0;t<e.length;t++)this.$subnodes.push(r(e[t]))},i.prototype._hasSubNodes=function(){return this.options.nodes&&this.options.nodes.length>0?!0:this._isHtmlGenerated()?!1:(this.$nodes===null&&(this.$nodes=this.element.children("ul").eq(0)),this.$nodes.length===0?!1:(this.$subnodes===null&&this._updateSubNodes(),this.$subnodes.length>0))},i.prototype._getNodeWidget=function(e){var t=this._getNodeByDom(e),n;return t.length>0?(n=t.data(t.data("widgetName")),n):null},i.prototype._createNodeWidget=function(e,t){return l(e,t,this,s,this.options.treeClass)},i.prototype._getNodeByDom=function(e){return r(e).closest(":"+this.widgetFullName)},i.prototype._getCurrentLevel=function(){return this.element.parentsUntil(":"+this.options.treeClass).length-1},i.prototype._getField=function(e){return this.element.data(e)},i.prototype._setField=function(e,t){this.element.data(e,t)},i.prototype._setAllowDrag=function(e){var t=this;e?t.$navigateUrl.one("mousedown."+t.widgetName,t,t._onMouseDown):t.element.data("ui-draggable")&&t.element.draggable("destroy")},i.prototype._isAllowDrag=function(){var e=this,t=e.options,n=e._tree.options;return t.allowDrag||n.allowDrag&&t.allowDrag!==!1?!0:!1},i.prototype._isAllowDrop=function(){var e=this,t=e.options,n=e._tree.options;return t.allowDrop||n.allowDrop&&t.allowDrop!==!1?!0:!1},i}(t.wijmoWidget);n.wijtreenode=m;var g=function(){function e(){this.wijCSS={wijtreeInner:""},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-b",stateDefault:"ui-btn ui-btn-b",stateHover:"ui-btn-down-c",stateActive:"ui-btn-down-b"},this.treeClass="wijmo-wijtree",this.initSelector=":jqmData(role='wijtreenode')",this.accessKey="",this.checked=!1,this.collapsedIconClass="",this.expanded=!1,this.expandedIconClass="",this.itemIconClass="",this.navigateUrl="",this.selected=!1,this.text="",this.toolTip="",this.hasChildren=!1,this.params={},this.nodes=null,this.allowDrag=null,this.allowDrop=null}return e}(),y=function(){function e(){this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-b",stateDefault:"ui-btn ui-btn-b",stateHover:"ui-btn-down-b",stateActive:"ui-btn-down-c"},this.allowDrag=!1,this.allowDrop=!1,this.allowEdit=!1,this.allowSorting=!0,this.allowTriState=!0,this.autoCheckNodes=!0,this.autoCollapse=!1,this.disabled=!1,this.expandCollapseHoverUsed=!1,this.showCheckBoxes=!1,this.showExpandCollapse=!0,this.expandAnimation={effect:"blind",easing:"linear",duration:200},this.expandDelay=0,this.collapseAnimation={effect:"blind",easing:"linear",duration:200},this.collapseDelay=0,this.draggable=null,this.droppable=null,this.dropVisual=null,this.nodes=null,this.nodeBlur=null,this.nodeFocus=null,this.nodeClick=null,this.nodeCheckChanging=null,this.nodeCheckChanged=null,this.nodeCollapsed=null,this.nodeExpanded=null,this.nodeDragging=null,this.nodeDragStarted=null,this.nodeBeforeDropped=null,this.nodeDropped=null,this.nodeMouseOver=null,this.nodeMouseOut=null,this.nodeTextChanged=null,this.selectedNodeChanged=null,this.nodeExpanding=null,this.nodeCollapsing=null}return e}();m.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new g),v.prototype.options=r.extend(!0,{},t.wijmoWidget.prototype.options,new y),r.wijmo.registerWidget("wijtree",v.prototype),r.wijmo.registerWidget("wijtreenode",m.prototype)})(t.tree||(t.tree={}));var n=t.tree})(wijmo||(wijmo={}))});